var app=function(){"use strict";function t(){}function e(t){return t()}function i(){return Object.create(null)}function n(t){t.forEach(e)}function r(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(e,i,n){e.$$.on_destroy.push(function(e,...i){if(null==e)return t;const n=e.subscribe(...i);return n.unsubscribe?()=>n.unsubscribe():n}(i,n))}function a(t,e){t.appendChild(e)}function l(t,e,i){t.insertBefore(e,i||null)}function c(t){t.parentNode&&t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function h(){return t=" ",document.createTextNode(t);var t}function d(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function p(t,e,i){null==i?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function f(t,e){t.value=null==e?"":e}let m;function g(t){m=t}function y(){if(!m)throw new Error("Function called outside component initialization");return m}function _(){const t=y();return(e,i,{cancelable:n=!1}={})=>{const r=t.$$.callbacks[e];if(r){const o=function(t,e,{bubbles:i=!1,cancelable:n=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,i,n,e),r}(e,i,{cancelable:n});return r.slice().forEach((e=>{e.call(t,o)})),!o.defaultPrevented}return!0}}const v=[],x=[];let b=[];const w=[],S=Promise.resolve();let T=!1;function I(t){b.push(t)}function P(t){w.push(t)}const k=new Set;let C=0;function A(){if(0!==C)return;const t=m;do{try{for(;C<v.length;){const t=v[C];C++,g(t),E(t.$$)}}catch(t){throw v.length=0,C=0,t}for(g(null),v.length=0,C=0;x.length;)x.pop()();for(let t=0;t<b.length;t+=1){const e=b[t];k.has(e)||(k.add(e),e())}b.length=0}while(v.length);for(;w.length;)w.pop()();T=!1,k.clear(),g(t)}function E(t){if(null!==t.fragment){t.update(),n(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(I)}}const M=new Set;let z;function D(t,e){t&&t.i&&(M.delete(t),t.i(e))}function L(t,e,i,n){if(t&&t.o){if(M.has(t))return;M.add(t),z.c.push((()=>{M.delete(t),n&&(i&&t.d(1),n())})),t.o(e)}else n&&n()}function R(t,e,i){const n=t.$$.props[e];void 0!==n&&(t.$$.bound[n]=i,i(t.$$.ctx[n]))}function B(t){t&&t.c()}function F(t,i,o,s){const{fragment:a,after_update:l}=t.$$;a&&a.m(i,o),s||I((()=>{const i=t.$$.on_mount.map(e).filter(r);t.$$.on_destroy?t.$$.on_destroy.push(...i):n(i),t.$$.on_mount=[]})),l.forEach(I)}function O(t,e){const i=t.$$;null!==i.fragment&&(!function(t){const e=[],i=[];b.forEach((n=>-1===t.indexOf(n)?e.push(n):i.push(n))),i.forEach((t=>t())),b=e}(i.after_update),n(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function j(t,e){-1===t.$$.dirty[0]&&(v.push(t),T||(T=!0,S.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function N(e,r,o,s,a,l,u,h=[-1]){const d=m;g(e);const p=e.$$={fragment:null,ctx:[],props:l,update:t,not_equal:a,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(d?d.$$.context:[])),callbacks:i(),dirty:h,skip_bound:!1,root:r.target||d.$$.root};u&&u(p.root);let f=!1;if(p.ctx=o?o(e,r.props||{},((t,i,...n)=>{const r=n.length?n[0]:i;return p.ctx&&a(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),f&&j(e,t)),i})):[],p.update(),f=!0,n(p.before_update),p.fragment=!!s&&s(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(c)}else p.fragment&&p.fragment.c();r.intro&&D(e.$$.fragment),F(e,r.target,r.anchor,r.customElement),A()}g(d)}class V{$destroy(){O(this,1),this.$destroy=t}$on(e,i){if(!r(i))return t;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(i),()=>{const t=n.indexOf(i);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const $=[];function U(e,i=t){let n;const r=new Set;function s(t){if(o(e,t)&&(e=t,n)){const t=!$.length;for(const t of r)t[1](),$.push(t,e);if(t){for(let t=0;t<$.length;t+=2)$[t][0]($[t+1]);$.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(o,a=t){const l=[o,a];return r.add(l),1===r.size&&(n=i(s)||t),o(e),()=>{r.delete(l),0===r.size&&n&&(n(),n=null)}}}}var q="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var G={exports:{}};G.exports=function(){
/*! *****************************************************************************
    	    Copyright (c) Microsoft Corporation.
    	    Permission to use, copy, modify, and/or distribute this software for any
    	    purpose with or without fee is hereby granted.
    	    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    	    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    	    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    	    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    	    PERFORMANCE OF THIS SOFTWARE.
    	    ***************************************************************************** */
var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};function e(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var i=function(){return i=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},i.apply(this,arguments)};function n(t,e,i){if(i||2===arguments.length)for(var n,r=0,o=e.length;r<o;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:q,o=Object.keys,s=Array.isArray;function a(t,e){return"object"!=typeof e||o(e).forEach((function(i){t[i]=e[i]})),t}"undefined"==typeof Promise||r.Promise||(r.Promise=Promise);var l=Object.getPrototypeOf,c={}.hasOwnProperty;function u(t,e){return c.call(t,e)}function h(t,e){"function"==typeof e&&(e=e(l(t))),("undefined"==typeof Reflect?o:Reflect.ownKeys)(e).forEach((function(i){p(t,i,e[i])}))}var d=Object.defineProperty;function p(t,e,i,n){d(t,e,a(i&&u(i,"get")&&"function"==typeof i.get?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},n))}function f(t){return{from:function(e){return t.prototype=Object.create(e.prototype),p(t.prototype,"constructor",t),{extend:h.bind(null,t.prototype)}}}}var m=Object.getOwnPropertyDescriptor;function g(t,e){var i;return m(t,e)||(i=l(t))&&g(i,e)}var y=[].slice;function _(t,e,i){return y.call(t,e,i)}function v(t,e){return e(t)}function x(t){if(!t)throw new Error("Assertion Failed")}function b(t){r.setImmediate?setImmediate(t):setTimeout(t,0)}function w(t,e){return t.reduce((function(t,i,n){var r=e(i,n);return r&&(t[r[0]]=r[1]),t}),{})}function S(t,e){if("string"==typeof e&&u(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var i=[],n=0,r=e.length;n<r;++n){var o=S(t,e[n]);i.push(o)}return i}var s=e.indexOf(".");if(-1!==s){var a=t[e.substr(0,s)];return null==a?void 0:S(a,e.substr(s+1))}}function T(t,e,i){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){x("string"!=typeof i&&"length"in i);for(var n=0,r=e.length;n<r;++n)T(t,e[n],i[n])}else{var o=e.indexOf(".");if(-1!==o){var a=e.substr(0,o),l=e.substr(o+1);if(""===l)void 0===i?s(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=i;else{var c=t[a];c&&u(t,a)||(c=t[a]={}),T(c,l,i)}}else void 0===i?s(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=i}}function I(t,e){"string"==typeof e?T(t,e,void 0):"length"in e&&[].map.call(e,(function(e){T(t,e,void 0)}))}function P(t){var e={};for(var i in t)u(t,i)&&(e[i]=t[i]);return e}var k=[].concat;function C(t){return k.apply([],t)}var A="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(C([8,16,32,64].map((function(t){return["Int","Uint","Float"].map((function(e){return e+t+"Array"}))})))).filter((function(t){return r[t]})),E=new Set(A.map((function(t){return r[t]})));function M(t){var e={};for(var i in t)if(u(t,i)){var n=t[i];e[i]=!n||"object"!=typeof n||E.has(n.constructor)?n:M(n)}return e}function z(t){for(var e in t)if(u(t,e))return!1;return!0}var D=null;function L(t){D=new WeakMap;var e=R(t);return D=null,e}function R(t){if(!t||"object"!=typeof t)return t;var e=D.get(t);if(e)return e;if(s(t)){e=[],D.set(t,e);for(var i=0,n=t.length;i<n;++i)e.push(R(t[i]))}else if(E.has(t.constructor))e=t;else{var r=l(t);for(var o in e=r===Object.prototype?{}:Object.create(r),D.set(t,e),t)u(t,o)&&(e[o]=R(t[o]))}return e}var B={}.toString;function F(t){return B.call(t).slice(8,-1)}var O="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",j="symbol"==typeof O?function(t){var e;return null!=t&&(e=t[O])&&e.apply(t)}:function(){return null};function N(t,e){var i=t.indexOf(e);return i>=0&&t.splice(i,1),i>=0}var V={};function $(t){var e,i,n,r;if(1===arguments.length){if(s(t))return t.slice();if(this===V&&"string"==typeof t)return[t];if(r=j(t)){for(i=[];!(n=r.next()).done;)i.push(n.value);return i}if(null==t)return[t];if("number"==typeof(e=t.length)){for(i=new Array(e);e--;)i[e]=t[e];return i}return[t]}for(e=arguments.length,i=new Array(e);e--;)i[e]=arguments[e];return i}var U="undefined"!=typeof Symbol?function(t){return"AsyncFunction"===t[Symbol.toStringTag]}:function(){return!1},Z=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],G=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Z),K={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function H(t,e){this.name=t,this.message=e}function W(t,e){return t+". Errors: "+Object.keys(e).map((function(t){return e[t].toString()})).filter((function(t,e,i){return i.indexOf(t)===e})).join("\n")}function X(t,e,i,n){this.failures=e,this.failedKeys=n,this.successCount=i,this.message=W(t,e)}function J(t,e){this.name="BulkError",this.failures=Object.keys(e).map((function(t){return e[t]})),this.failuresByPos=e,this.message=W(t,this.failures)}f(H).from(Error).extend({toString:function(){return this.name+": "+this.message}}),f(X).from(H),f(J).from(H);var Y=G.reduce((function(t,e){return t[e]=e+"Error",t}),{}),Q=H,tt=G.reduce((function(t,e){var i=e+"Error";function n(t,n){this.name=i,t?"string"==typeof t?(this.message="".concat(t).concat(n?"\n "+n:""),this.inner=n||null):"object"==typeof t&&(this.message="".concat(t.name," ").concat(t.message),this.inner=t):(this.message=K[e]||i,this.inner=null)}return f(n).from(Q),t[e]=n,t}),{});tt.Syntax=SyntaxError,tt.Type=TypeError,tt.Range=RangeError;var et=Z.reduce((function(t,e){return t[e+"Error"]=tt[e],t}),{});function it(t,e){if(!t||t instanceof H||t instanceof TypeError||t instanceof SyntaxError||!t.name||!et[t.name])return t;var i=new et[t.name](e||t.message,t);return"stack"in t&&p(i,"stack",{get:function(){return this.inner.stack}}),i}var nt=G.reduce((function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=tt[e]),t}),{});function rt(){}function ot(t){return t}function st(t,e){return null==t||t===ot?e:function(i){return e(t(i))}}function at(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function lt(t,e){return t===rt?e:function(){var i=t.apply(this,arguments);void 0!==i&&(arguments[0]=i);var n=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?at(n,this.onsuccess):n),r&&(this.onerror=this.onerror?at(r,this.onerror):r),void 0!==o?o:i}}function ct(t,e){return t===rt?e:function(){t.apply(this,arguments);var i=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?at(i,this.onsuccess):i),n&&(this.onerror=this.onerror?at(n,this.onerror):n)}}function ut(t,e){return t===rt?e:function(i){var n=t.apply(this,arguments);a(i,n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?at(r,this.onsuccess):r),o&&(this.onerror=this.onerror?at(o,this.onerror):o),void 0===n?void 0===s?void 0:s:a(n,s)}}function ht(t,e){return t===rt?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function dt(t,e){return t===rt?e:function(){var i=t.apply(this,arguments);if(i&&"function"==typeof i.then){for(var n=this,r=arguments.length,o=new Array(r);r--;)o[r]=arguments[r];return i.then((function(){return e.apply(n,o)}))}return e.apply(this,arguments)}}nt.ModifyError=X,nt.DexieError=H,nt.BulkError=J;var pt="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ft(t,e){pt=t}var mt={},gt=100,yt="undefined"==typeof Promise?[]:function(){var t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,l(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,l(e),t]}(),_t=yt[0],vt=yt[1],xt=yt[2],bt=vt&&vt.then,wt=_t&&_t.constructor,St=!!xt;function Tt(){queueMicrotask(qt)}var It=function(t,e){Dt.push([t,e]),kt&&(Tt(),kt=!1)},Pt=!0,kt=!0,Ct=[],At=[],Et=ot,Mt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:rt,pgp:!1,env:{},finalize:rt},zt=Mt,Dt=[],Lt=0,Rt=[];function Bt(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=zt;if("function"!=typeof t){if(t!==mt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Nt(this,this._value))}this._state=null,this._value=null,++e.ref,jt(this,t)}var Ft={get:function(){var t=zt,e=ne;function i(i,n){var r=this,o=!t.global&&(t!==zt||e!==ne),s=o&&!ae(),a=new Bt((function(e,a){$t(r,new Ot(fe(i,t,o,s),fe(n,t,o,s),e,a,t))}));return this._consoleTask&&(a._consoleTask=this._consoleTask),a}return i.prototype=mt,i},set:function(t){p(this,"then",t&&t.prototype===mt?Ft:{get:function(){return t},set:Ft.set})}};function Ot(t,e,i,n,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=i,this.reject=n,this.psd=r}function jt(t,e){try{e((function(e){if(null===t._state){if(e===t)throw new TypeError("A promise cannot be resolved with itself.");var i=t._lib&&Zt();e&&"function"==typeof e.then?jt(t,(function(t,i){e instanceof Bt?e._then(t,i):e.then(t,i)})):(t._state=!0,t._value=e,Vt(t)),i&&Gt()}}),Nt.bind(null,t))}catch(e){Nt(t,e)}}function Nt(t,e){if(At.push(e),null===t._state){var i=t._lib&&Zt();e=Et(e),t._state=!1,t._value=e,Wt(t),Vt(t),i&&Gt()}}function Vt(t){var e=t._listeners;t._listeners=[];for(var i=0,n=e.length;i<n;++i)$t(t,e[i]);var r=t._PSD;--r.ref||r.finalize(),0===Lt&&(++Lt,It((function(){0==--Lt&&Kt()}),[]))}function $t(t,e){if(null!==t._state){var i=t._state?e.onFulfilled:e.onRejected;if(null===i)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Lt,It(Ut,[i,t,e])}else t._listeners.push(e)}function Ut(t,e,i){try{var n,r=e._value;!e._state&&At.length&&(At=[]),n=pt&&e._consoleTask?e._consoleTask.run((function(){return t(r)})):t(r),e._state||-1!==At.indexOf(r)||Xt(e),i.resolve(n)}catch(t){i.reject(t)}finally{0==--Lt&&Kt(),--i.psd.ref||i.psd.finalize()}}function qt(){pe(Mt,(function(){Zt()&&Gt()}))}function Zt(){var t=Pt;return Pt=!1,kt=!1,t}function Gt(){var t,e,i;do{for(;Dt.length>0;)for(t=Dt,Dt=[],i=t.length,e=0;e<i;++e){var n=t[e];n[0].apply(null,n[1])}}while(Dt.length>0);Pt=!0,kt=!0}function Kt(){var t=Ct;Ct=[],t.forEach((function(t){t._PSD.onunhandled.call(null,t._value,t)}));for(var e=Rt.slice(0),i=e.length;i;)e[--i]()}function Ht(t){function e(){t(),Rt.splice(Rt.indexOf(e),1)}Rt.push(e),++Lt,It((function(){0==--Lt&&Kt()}),[])}function Wt(t){Ct.some((function(e){return e._value===t._value}))||Ct.push(t)}function Xt(t){for(var e=Ct.length;e;)if(Ct[--e]._value===t._value)return void Ct.splice(e,1)}function Jt(t){return new Bt(mt,!1,t)}function Yt(t,e){var i=zt;return function(){var n=Zt(),r=zt;try{return he(i,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{he(r,!1),n&&Gt()}}}h(Bt.prototype,{then:Ft,_then:function(t,e){$t(this,new Ot(null,null,t,e,zt))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],i=arguments[1];return"function"==typeof e?this.then(null,(function(t){return t instanceof e?i(t):Jt(t)})):this.then(null,(function(t){return t&&t.name===e?i(t):Jt(t)}))},finally:function(t){return this.then((function(e){return Bt.resolve(t()).then((function(){return e}))}),(function(e){return Bt.resolve(t()).then((function(){return Jt(e)}))}))},timeout:function(t,e){var i=this;return t<1/0?new Bt((function(n,r){var o=setTimeout((function(){return r(new tt.Timeout(e))}),t);i.then(n,r).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&p(Bt.prototype,Symbol.toStringTag,"Dexie.Promise"),Mt.env=de(),h(Bt,{all:function(){var t=$.apply(null,arguments).map(le);return new Bt((function(e,i){0===t.length&&e([]);var n=t.length;t.forEach((function(r,o){return Bt.resolve(r).then((function(i){t[o]=i,--n||e(t)}),i)}))}))},resolve:function(t){return t instanceof Bt?t:t&&"function"==typeof t.then?new Bt((function(e,i){t.then(e,i)})):new Bt(mt,!0,t)},reject:Jt,race:function(){var t=$.apply(null,arguments).map(le);return new Bt((function(e,i){t.map((function(t){return Bt.resolve(t).then(e,i)}))}))},PSD:{get:function(){return zt},set:function(t){return zt=t}},totalEchoes:{get:function(){return ne}},newPSD:oe,usePSD:pe,scheduler:{get:function(){return It},set:function(t){It=t}},rejectionMapper:{get:function(){return Et},set:function(t){Et=t}},follow:function(t,e){return new Bt((function(i,n){return oe((function(e,i){var n=zt;n.unhandleds=[],n.onunhandled=i,n.finalize=at((function(){var t=this;Ht((function(){0===t.unhandleds.length?e():i(t.unhandleds[0])}))}),n.finalize),t()}),e,i,n)}))}}),wt&&(wt.allSettled&&p(Bt,"allSettled",(function(){var t=$.apply(null,arguments).map(le);return new Bt((function(e){0===t.length&&e([]);var i=t.length,n=new Array(i);t.forEach((function(t,r){return Bt.resolve(t).then((function(t){return n[r]={status:"fulfilled",value:t}}),(function(t){return n[r]={status:"rejected",reason:t}})).then((function(){return--i||e(n)}))}))}))})),wt.any&&"undefined"!=typeof AggregateError&&p(Bt,"any",(function(){var t=$.apply(null,arguments).map(le);return new Bt((function(e,i){0===t.length&&i(new AggregateError([]));var n=t.length,r=new Array(n);t.forEach((function(t,o){return Bt.resolve(t).then((function(t){return e(t)}),(function(t){r[o]=t,--n||i(new AggregateError(r))}))}))}))})));var Qt={awaits:0,echoes:0,id:0},te=0,ee=[],ie=0,ne=0,re=0;function oe(t,e,i,n){var r=zt,o=Object.create(r);o.parent=r,o.ref=0,o.global=!1,o.id=++re,Mt.env,o.env=St?{Promise:Bt,PromiseProp:{value:Bt,configurable:!0,writable:!0},all:Bt.all,race:Bt.race,allSettled:Bt.allSettled,any:Bt.any,resolve:Bt.resolve,reject:Bt.reject}:{},e&&a(o,e),++r.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=pe(o,t,i,n);return 0===o.ref&&o.finalize(),s}function se(){return Qt.id||(Qt.id=++te),++Qt.awaits,Qt.echoes+=gt,Qt.id}function ae(){return!!Qt.awaits&&(0==--Qt.awaits&&(Qt.id=0),Qt.echoes=Qt.awaits*gt,!0)}function le(t){return Qt.echoes&&t&&t.constructor===wt?(se(),t.then((function(t){return ae(),t}),(function(t){return ae(),ge(t)}))):t}function ce(t){++ne,Qt.echoes&&0!=--Qt.echoes||(Qt.echoes=Qt.awaits=Qt.id=0),ee.push(zt),he(t,!0)}function ue(){var t=ee[ee.length-1];ee.pop(),he(t,!1)}function he(t,e){var i=zt;if((e?!Qt.echoes||ie++&&t===zt:!ie||--ie&&t===zt)||queueMicrotask(e?ce.bind(null,t):ue),t!==zt&&(zt=t,i===Mt&&(Mt.env=de()),St)){var n=Mt.env.Promise,o=t.env;(i.global||t.global)&&(Object.defineProperty(r,"Promise",o.PromiseProp),n.all=o.all,n.race=o.race,n.resolve=o.resolve,n.reject=o.reject,o.allSettled&&(n.allSettled=o.allSettled),o.any&&(n.any=o.any))}}function de(){var t=r.Promise;return St?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function pe(t,e,i,n,r){var o=zt;try{return he(t,!0),e(i,n,r)}finally{he(o,!1)}}function fe(t,e,i,n){return"function"!=typeof t?t:function(){var r=zt;i&&se(),he(e,!0);try{return t.apply(this,arguments)}finally{he(r,!1),n&&queueMicrotask(ae)}}}function me(t){Promise===wt&&0===Qt.echoes?0===ie?t():enqueueNativeMicroTask(t):setTimeout(t,0)}-1===(""+bt).indexOf("[native code]")&&(se=ae=rt);var ge=Bt.reject;function ye(t,e,i,n){if(t.idbdb&&(t._state.openComplete||zt.letThrough||t._vip)){var r=t._createTransaction(e,i,t._dbSchema);try{r.create(),t._state.PR1398_maxLoop=3}catch(r){return r.name===Y.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t.close({disableAutoOpen:!1}),t.open().then((function(){return ye(t,e,i,n)}))):ge(r)}return r._promise(e,(function(t,e){return oe((function(){return zt.trans=r,n(t,e,r)}))})).then((function(t){if("readwrite"===e)try{r.idbtrans.commit()}catch(t){}return"readonly"===e?t:r._completion.then((function(){return t}))}))}if(t._state.openComplete)return ge(new tt.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return ge(new tt.DatabaseClosed);t.open().catch(rt)}return t._state.dbReadyPromise.then((function(){return ye(t,e,i,n)}))}var _e="4.0.7",ve=String.fromCharCode(65535),xe=-1/0,be="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",we="String expected.",Se=[],Te="__dbnames",Ie="readonly",Pe="readwrite";function ke(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Ce={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ae(t){return"string"!=typeof t||/\./.test(t)?function(t){return t}:function(e){return void 0===e[t]&&t in e&&delete(e=L(e))[t],e}}function Ee(){throw tt.Type()}function Me(t,e){try{var i=Le(t),n=Le(e);if(i!==n)return"Array"===i?1:"Array"===n?-1:"binary"===i?1:"binary"===n?-1:"string"===i?1:"string"===n?-1:"Date"===i?1:"Date"!==n?NaN:-1;switch(i){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return De(Re(t),Re(e));case"Array":return ze(t,e)}}catch(t){}return NaN}function ze(t,e){for(var i=t.length,n=e.length,r=i<n?i:n,o=0;o<r;++o){var s=Me(t[o],e[o]);if(0!==s)return s}return i===n?0:i<n?-1:1}function De(t,e){for(var i=t.length,n=e.length,r=i<n?i:n,o=0;o<r;++o)if(t[o]!==e[o])return t[o]<e[o]?-1:1;return i===n?0:i<n?-1:1}function Le(t){var e=typeof t;if("object"!==e)return e;if(ArrayBuffer.isView(t))return"binary";var i=F(t);return"ArrayBuffer"===i?"binary":i}function Re(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Be=function(){function t(){}return t.prototype._trans=function(t,e,i){var n=this._tx||zt.trans,r=this.name,o=pt&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===t?"read":"write"," ").concat(this.name));function s(t,i,n){if(!n.schema[r])throw new tt.NotFound("Table "+r+" not part of transaction");return e(n.idbtrans,n)}var a=Zt();try{var l=n&&n.db._novip===this.db._novip?n===zt.trans?n._promise(t,s,i):oe((function(){return n._promise(t,s,i)}),{trans:n,transless:zt.transless||zt}):ye(this.db,t,[this.name],s);return o&&(l._consoleTask=o,l=l.catch((function(t){return console.trace(t),ge(t)}))),l}finally{a&&Gt()}},t.prototype.get=function(t,e){var i=this;return t&&t.constructor===Object?this.where(t).first(e):null==t?ge(new tt.Type("Invalid argument to Table.get()")):this._trans("readonly",(function(e){return i.core.get({trans:e,key:t}).then((function(t){return i.hook.reading.fire(t)}))})).then(e)},t.prototype.where=function(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(s(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=o(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);var i=this.schema.indexes.concat(this.schema.primKey).filter((function(t){if(t.compound&&e.every((function(e){return t.keyPath.indexOf(e)>=0}))){for(var i=0;i<e.length;++i)if(-1===e.indexOf(t.keyPath[i]))return!1;return!0}return!1})).sort((function(t,e){return t.keyPath.length-e.keyPath.length}))[0];if(i&&this.db._maxKey!==ve){var n=i.keyPath.slice(0,e.length);return this.where(n).equals(n.map((function(e){return t[e]})))}!i&&pt&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var r=this.schema.idxByName,a=this.db._deps.indexedDB;function l(t,e){return 0===a.cmp(t,e)}var c=e.reduce((function(e,i){var n=e[0],o=e[1],a=r[i],c=t[i];return[n||a,n||!a?ke(o,a&&a.multi?function(t){var e=S(t,i);return s(e)&&e.some((function(t){return l(c,t)}))}:function(t){return l(c,S(t,i))}):o]}),[null,null]),u=c[0],h=c[1];return u?this.where(u.name).equals(t[u.keyPath]).filter(h):i?this.filter(h):this.where(e).equals("")},t.prototype.filter=function(t){return this.toCollection().and(t)},t.prototype.count=function(t){return this.toCollection().count(t)},t.prototype.offset=function(t){return this.toCollection().offset(t)},t.prototype.limit=function(t){return this.toCollection().limit(t)},t.prototype.each=function(t){return this.toCollection().each(t)},t.prototype.toArray=function(t){return this.toCollection().toArray(t)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,s(t)?"[".concat(t.join("+"),"]"):t))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(t){var i=this,n=i.db,r=i.name;this.schema.mappedClass=t,t.prototype instanceof Ee&&(t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),Object.defineProperty(i.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),i.prototype.table=function(){return r},i}(t));for(var o=new Set,s=t.prototype;s;s=l(s))Object.getOwnPropertyNames(s).forEach((function(t){return o.add(t)}));var a=function(e){if(!e)return e;var i=Object.create(t.prototype);for(var n in e)if(!o.has(n))try{i[n]=e[n]}catch(t){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),t},t.prototype.defineClass=function(){function t(t){a(this,t)}return this.mapToClass(t)},t.prototype.add=function(t,e){var i=this,n=this.schema.primKey,r=n.auto,o=n.keyPath,s=t;return o&&r&&(s=Ae(o)(t)),this._trans("readwrite",(function(t){return i.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[s]})})).then((function(t){return t.numFailures?Bt.reject(t.failures[0]):t.lastResult})).then((function(e){if(o)try{T(t,o,e)}catch(t){}return e}))},t.prototype.update=function(t,e){if("object"!=typeof t||s(t))return this.where(":id").equals(t).modify(e);var i=S(t,this.schema.primKey.keyPath);return void 0===i?ge(new tt.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(i).modify(e)},t.prototype.put=function(t,e){var i=this,n=this.schema.primKey,r=n.auto,o=n.keyPath,s=t;return o&&r&&(s=Ae(o)(t)),this._trans("readwrite",(function(t){return i.core.mutate({trans:t,type:"put",values:[s],keys:null!=e?[e]:null})})).then((function(t){return t.numFailures?Bt.reject(t.failures[0]):t.lastResult})).then((function(e){if(o)try{T(t,o,e)}catch(t){}return e}))},t.prototype.delete=function(t){var e=this;return this._trans("readwrite",(function(i){return e.core.mutate({trans:i,type:"delete",keys:[t]})})).then((function(t){return t.numFailures?Bt.reject(t.failures[0]):void 0}))},t.prototype.clear=function(){var t=this;return this._trans("readwrite",(function(e){return t.core.mutate({trans:e,type:"deleteRange",range:Ce})})).then((function(t){return t.numFailures?Bt.reject(t.failures[0]):void 0}))},t.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",(function(i){return e.core.getMany({keys:t,trans:i}).then((function(t){return t.map((function(t){return e.hook.reading.fire(t)}))}))}))},t.prototype.bulkAdd=function(t,e,i){var n=this,r=Array.isArray(e)?e:void 0,o=(i=i||(r?void 0:e))?i.allKeys:void 0;return this._trans("readwrite",(function(e){var i=n.schema.primKey,s=i.auto,a=i.keyPath;if(a&&r)throw new tt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new tt.InvalidArgument("Arguments objects and keys must have the same length");var l=t.length,c=a&&s?t.map(Ae(a)):t;return n.core.mutate({trans:e,type:"add",keys:r,values:c,wantResults:o}).then((function(t){var e=t.numFailures,i=t.results,r=t.lastResult,s=t.failures;if(0===e)return o?i:r;throw new J("".concat(n.name,".bulkAdd(): ").concat(e," of ").concat(l," operations failed"),s)}))}))},t.prototype.bulkPut=function(t,e,i){var n=this,r=Array.isArray(e)?e:void 0,o=(i=i||(r?void 0:e))?i.allKeys:void 0;return this._trans("readwrite",(function(e){var i=n.schema.primKey,s=i.auto,a=i.keyPath;if(a&&r)throw new tt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new tt.InvalidArgument("Arguments objects and keys must have the same length");var l=t.length,c=a&&s?t.map(Ae(a)):t;return n.core.mutate({trans:e,type:"put",keys:r,values:c,wantResults:o}).then((function(t){var e=t.numFailures,i=t.results,r=t.lastResult,s=t.failures;if(0===e)return o?i:r;throw new J("".concat(n.name,".bulkPut(): ").concat(e," of ").concat(l," operations failed"),s)}))}))},t.prototype.bulkUpdate=function(t){var e=this,i=this.core,n=t.map((function(t){return t.key})),r=t.map((function(t){return t.changes})),o=[];return this._trans("readwrite",(function(s){return i.getMany({trans:s,keys:n,cache:"clone"}).then((function(a){var l=[],c=[];t.forEach((function(t,i){var n=t.key,r=t.changes,s=a[i];if(s){for(var u=0,h=Object.keys(r);u<h.length;u++){var d=h[u],p=r[d];if(d===e.schema.primKey.keyPath){if(0!==Me(p,n))throw new tt.Constraint("Cannot update primary key in bulkUpdate()")}else T(s,d,p)}o.push(i),l.push(n),c.push(s)}}));var u=l.length;return i.mutate({trans:s,type:"put",keys:l,values:c,updates:{keys:n,changeSpecs:r}}).then((function(t){var i=t.numFailures,n=t.failures;if(0===i)return u;for(var r=0,s=Object.keys(n);r<s.length;r++){var a=s[r],l=o[Number(a)];if(null!=l){var c=n[a];delete n[a],n[l]=c}}throw new J("".concat(e.name,".bulkUpdate(): ").concat(i," of ").concat(u," operations failed"),n)}))}))}))},t.prototype.bulkDelete=function(t){var e=this,i=t.length;return this._trans("readwrite",(function(i){return e.core.mutate({trans:i,type:"delete",keys:t})})).then((function(t){var n=t.numFailures,r=t.lastResult,o=t.failures;if(0===n)return r;throw new J("".concat(e.name,".bulkDelete(): ").concat(n," of ").concat(i," operations failed"),o)}))},t}();function Fe(t){var e={},i=function(i,n){if(n){for(var r=arguments.length,o=new Array(r-1);--r;)o[r-1]=arguments[r];return e[i].subscribe.apply(null,o),t}if("string"==typeof i)return e[i]};i.addEventType=a;for(var n=1,r=arguments.length;n<r;++n)a(arguments[n]);return i;function a(t,n,r){if("object"==typeof t)return l(t);n||(n=ht),r||(r=rt);var o={subscribers:[],fire:r,subscribe:function(t){-1===o.subscribers.indexOf(t)&&(o.subscribers.push(t),o.fire=n(o.fire,t))},unsubscribe:function(t){o.subscribers=o.subscribers.filter((function(e){return e!==t})),o.fire=o.subscribers.reduce(n,r)}};return e[t]=i[t]=o,o}function l(t){o(t).forEach((function(e){var i=t[e];if(s(i))a(e,t[e][0],t[e][1]);else{if("asap"!==i)throw new tt.InvalidArgument("Invalid event config");var n=a(e,ot,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];n.subscribers.forEach((function(t){b((function(){t.apply(null,e)}))}))}))}}))}}function Oe(t,e){return f(e).from({prototype:t}),e}function je(t){return Oe(Be.prototype,(function(e,i,n){this.db=t,this._tx=n,this.name=e,this.schema=i,this.hook=t._allTables[e]?t._allTables[e].hook:Fe(null,{creating:[lt,rt],reading:[st,ot],updating:[ut,rt],deleting:[ct,rt]})}))}function Ne(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Ve(t,e){t.filter=ke(t.filter,e)}function $e(t,e,i){var n=t.replayFilter;t.replayFilter=n?function(){return ke(n(),e())}:e,t.justLimit=i&&!n}function Ue(t,e){t.isMatch=ke(t.isMatch,e)}function qe(t,e){if(t.isPrimKey)return e.primaryKey;var i=e.getIndexByKeyPath(t.index);if(!i)throw new tt.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return i}function Ze(t,e,i){var n=qe(t,e.schema);return e.openCursor({trans:i,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:n,range:t.range}})}function Ge(t,e,i,n){var r=t.replayFilter?ke(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},s=function(t,i,n){if(!r||r(i,n,(function(t){return i.stop(t)}),(function(t){return i.fail(t)}))){var s=i.primaryKey,a=""+s;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(s)),u(o,a)||(o[a]=!0,e(t,i,n))}};return Promise.all([t.or._iterate(s,i),Ke(Ze(t,n,i),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}return Ke(Ze(t,n,i),ke(t.algorithm,r),e,!t.keysOnly&&t.valueMapper)}function Ke(t,e,i,n){var r=Yt(n?function(t,e,r){return i(n(t),e,r)}:i);return t.then((function(t){if(t)return t.start((function(){var i=function(){return t.continue()};e&&!e(t,(function(t){return i=t}),(function(e){t.stop(e),i=rt}),(function(e){t.fail(e),i=rt}))||r(t.value,t,(function(t){return i=t})),i()}))}))}var He=Symbol(),We=function(){function t(t){Object.assign(this,t)}return t.prototype.execute=function(t){var e;if(void 0!==this.add){var i=this.add;if(s(i))return n(n([],s(t)?t:[],!0),i,!0).sort();if("number"==typeof i)return(Number(t)||0)+i;if("bigint"==typeof i)try{return BigInt(t)+i}catch(t){return BigInt(0)+i}throw new TypeError("Invalid term ".concat(i))}if(void 0!==this.remove){var r=this.remove;if(s(r))return s(t)?t.filter((function(t){return!r.includes(t)})).sort():[];if("number"==typeof r)return Number(t)-r;if("bigint"==typeof r)try{return BigInt(t)-r}catch(t){return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}var o=null===(e=this.replacePrefix)||void 0===e?void 0:e[0];return o&&"string"==typeof t&&t.startsWith(o)?this.replacePrefix[1]+t.substring(o.length):t},t}(),Xe=function(){function t(){}return t.prototype._read=function(t,e){var i=this._ctx;return i.error?i.table._trans(null,ge.bind(null,i.error)):i.table._trans("readonly",t).then(e)},t.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,ge.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},t.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=ke(e.algorithm,t)},t.prototype._iterate=function(t,e){return Ge(this._ctx,t,e,this._ctx.table.core)},t.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),i=Object.create(this._ctx);return t&&a(i,t),e._ctx=i,e},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(t){var e=this._ctx;return this._read((function(i){return Ge(e,t,i,e.table.core)}))},t.prototype.count=function(t){var e=this;return this._read((function(t){var i=e._ctx,n=i.table.core;if(Ne(i,!0))return n.count({trans:t,query:{index:qe(i,n.schema),range:i.range}}).then((function(t){return Math.min(t,i.limit)}));var r=0;return Ge(i,(function(){return++r,!1}),t,n).then((function(){return r}))})).then(t)},t.prototype.sortBy=function(t,e){var i=t.split(".").reverse(),n=i[0],r=i.length-1;function o(t,e){return e?o(t[i[e]],e-1):t[n]}var s="next"===this._ctx.dir?1:-1;function a(t,e){var i=o(t,r),n=o(e,r);return i<n?-s:i>n?s:0}return this.toArray((function(t){return t.sort(a)})).then(e)},t.prototype.toArray=function(t){var e=this;return this._read((function(t){var i=e._ctx;if("next"===i.dir&&Ne(i,!0)&&i.limit>0){var n=i.valueMapper,r=qe(i,i.table.core.schema);return i.table.core.query({trans:t,limit:i.limit,values:!0,query:{index:r,range:i.range}}).then((function(t){var e=t.result;return n?e.map(n):e}))}var o=[];return Ge(i,(function(t){return o.push(t)}),t,i.table.core).then((function(){return o}))}),t)},t.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,Ne(e)?$e(e,(function(){var e=t;return function(t,i){return 0===e||(1===e?(--e,!1):(i((function(){t.advance(e),e=0})),!1))}})):$e(e,(function(){var e=t;return function(){return--e<0}}))),this},t.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),$e(this._ctx,(function(){var e=t;return function(t,i,n){return--e<=0&&i(n),e>=0}}),!0),this},t.prototype.until=function(t,e){return Ve(this._ctx,(function(i,n,r){return!t(i.value)||(n(r),e)})),this},t.prototype.first=function(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)},t.prototype.last=function(t){return this.reverse().first(t)},t.prototype.filter=function(t){return Ve(this._ctx,(function(e){return t(e.value)})),Ue(this._ctx,t),this},t.prototype.and=function(t){return this.filter(t)},t.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},t.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,i){t(i.key,i)}))},t.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},t.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,i){t(i.primaryKey,i)}))},t.prototype.keys=function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var i=[];return this.each((function(t,e){i.push(e.key)})).then((function(){return i})).then(t)},t.prototype.primaryKeys=function(t){var e=this._ctx;if("next"===e.dir&&Ne(e,!0)&&e.limit>0)return this._read((function(t){var i=qe(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:i,range:e.range}})})).then((function(t){return t.result})).then(t);e.keysOnly=!e.isMatch;var i=[];return this.each((function(t,e){i.push(e.primaryKey)})).then((function(){return i})).then(t)},t.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},t.prototype.firstKey=function(t){return this.limit(1).keys((function(t){return t[0]})).then(t)},t.prototype.lastKey=function(t){return this.reverse().firstKey(t)},t.prototype.distinct=function(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var i={};return Ve(this._ctx,(function(t){var e=t.primaryKey.toString(),n=u(i,e);return i[e]=!0,!n})),this},t.prototype.modify=function(t){var e=this,i=this._ctx;return this._write((function(n){var r;if("function"==typeof t)r=t;else{var s=o(t),a=s.length;r=function(e){for(var i=!1,n=0;n<a;++n){var r=s[n],o=t[r],l=S(e,r);o instanceof We?(T(e,r,o.execute(l)),i=!0):l!==o&&(T(e,r,o),i=!0)}return i}}var l=i.table.core,c=l.schema.primaryKey,u=c.outbound,h=c.extractKey,d=e.db._options.modifyChunkSize||200,p=[],f=0,m=[],g=function(t,e){var i=e.failures,n=e.numFailures;f+=t-n;for(var r=0,s=o(i);r<s.length;r++){var a=s[r];p.push(i[a])}};return e.clone().primaryKeys().then((function(e){var o=Ne(i)&&i.limit===1/0&&("function"!=typeof t||t===Je)&&{index:i.index,range:i.range},s=function(i){var a=Math.min(d,e.length-i);return l.getMany({trans:n,keys:e.slice(i,i+a),cache:"immutable"}).then((function(c){for(var p=[],f=[],m=u?[]:null,y=[],_=0;_<a;++_){var v=c[_],x={value:L(v),primKey:e[i+_]};!1!==r.call(x,x.value,x)&&(null==x.value?y.push(e[i+_]):u||0===Me(h(v),h(x.value))?(f.push(x.value),u&&m.push(e[i+_])):(y.push(e[i+_]),p.push(x.value)))}return Promise.resolve(p.length>0&&l.mutate({trans:n,type:"add",values:p}).then((function(t){for(var e in t.failures)y.splice(parseInt(e),1);g(p.length,t)}))).then((function(){return(f.length>0||o&&"object"==typeof t)&&l.mutate({trans:n,type:"put",keys:m,values:f,criteria:o,changeSpec:"function"!=typeof t&&t,isAdditionalChunk:i>0}).then((function(t){return g(f.length,t)}))})).then((function(){return(y.length>0||o&&t===Je)&&l.mutate({trans:n,type:"delete",keys:y,criteria:o,isAdditionalChunk:i>0}).then((function(t){return g(y.length,t)}))})).then((function(){return e.length>i+a&&s(i+d)}))}))};return s(0).then((function(){if(p.length>0)throw new X("Error modifying one or more objects",p,f,m);return e.length}))}))}))},t.prototype.delete=function(){var t=this._ctx,e=t.range;return Ne(t)&&(t.isPrimKey||3===e.type)?this._write((function(i){var n=t.table.core.schema.primaryKey,r=e;return t.table.core.count({trans:i,query:{index:n,range:r}}).then((function(e){return t.table.core.mutate({trans:i,type:"deleteRange",range:r}).then((function(t){var i=t.failures;t.lastResult,t.results;var n=t.numFailures;if(n)throw new X("Could not delete some values",Object.keys(i).map((function(t){return i[t]})),e-n);return e-n}))}))})):this.modify(Je)},t}(),Je=function(t,e){return e.value=null};function Ye(t){return Oe(Xe.prototype,(function(e,i){this.db=t;var n=Ce,r=null;if(i)try{n=i()}catch(t){r=t}var o=e._ctx,s=o.table,a=s.hook.reading.fire;this._ctx={table:s,index:o.index,isPrimKey:!o.index||s.schema.primKey.keyPath&&o.index===s.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:a!==ot?a:null}}))}function Qe(t,e){return t<e?-1:t===e?0:1}function ti(t,e){return t>e?-1:t===e?0:1}function ei(t,e,i){var n=t instanceof ci?new t.Collection(t):t;return n._ctx.error=i?new i(e):new TypeError(e),n}function ii(t){return new t.Collection(t,(function(){return li("")})).limit(0)}function ni(t){return"next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}function ri(t){return"next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}function oi(t,e,i,n,r,o){for(var s=Math.min(t.length,n.length),a=-1,l=0;l<s;++l){var c=e[l];if(c!==n[l])return r(t[l],i[l])<0?t.substr(0,l)+i[l]+i.substr(l+1):r(t[l],n[l])<0?t.substr(0,l)+n[l]+i.substr(l+1):a>=0?t.substr(0,a)+e[a]+i.substr(a+1):null;r(t[l],c)<0&&(a=l)}return s<n.length&&"next"===o?t+i.substr(t.length):s<t.length&&"prev"===o?t.substr(0,i.length):a<0?null:t.substr(0,a)+n[a]+i.substr(a+1)}function si(t,e,i,n){var r,o,s,a,l,c,u,h=i.length;if(!i.every((function(t){return"string"==typeof t})))return ei(t,we);function d(t){r=ni(t),o=ri(t),s="next"===t?Qe:ti;var e=i.map((function(t){return{lower:o(t),upper:r(t)}})).sort((function(t,e){return s(t.lower,e.lower)}));a=e.map((function(t){return t.upper})),l=e.map((function(t){return t.lower})),c=t,u="next"===t?"":n}d("next");var p=new t.Collection(t,(function(){return ai(a[0],l[h-1]+n)}));p._ondirectionchange=function(t){d(t)};var f=0;return p._addAlgorithm((function(t,i,n){var r=t.key;if("string"!=typeof r)return!1;var d=o(r);if(e(d,l,f))return!0;for(var p=null,m=f;m<h;++m){var g=oi(r,d,a[m],l[m],s,c);null===g&&null===p?f=m+1:(null===p||s(p,g)>0)&&(p=g)}return i(null!==p?function(){t.continue(p+u)}:n),!1})),p}function ai(t,e,i,n){return{type:2,lower:t,upper:e,lowerOpen:i,upperOpen:n}}function li(t){return{type:1,lower:t,upper:t}}var ci=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),t.prototype.between=function(t,e,i,n){i=!1!==i,n=!0===n;try{return this._cmp(t,e)>0||0===this._cmp(t,e)&&(i||n)&&(!i||!n)?ii(this):new this.Collection(this,(function(){return ai(t,e,!i,!n)}))}catch(t){return ei(this,be)}},t.prototype.equals=function(t){return null==t?ei(this,be):new this.Collection(this,(function(){return li(t)}))},t.prototype.above=function(t){return null==t?ei(this,be):new this.Collection(this,(function(){return ai(t,void 0,!0)}))},t.prototype.aboveOrEqual=function(t){return null==t?ei(this,be):new this.Collection(this,(function(){return ai(t,void 0,!1)}))},t.prototype.below=function(t){return null==t?ei(this,be):new this.Collection(this,(function(){return ai(void 0,t,!1,!0)}))},t.prototype.belowOrEqual=function(t){return null==t?ei(this,be):new this.Collection(this,(function(){return ai(void 0,t)}))},t.prototype.startsWith=function(t){return"string"!=typeof t?ei(this,we):this.between(t,t+ve,!0,!0)},t.prototype.startsWithIgnoreCase=function(t){return""===t?this.startsWith(t):si(this,(function(t,e){return 0===t.indexOf(e[0])}),[t],ve)},t.prototype.equalsIgnoreCase=function(t){return si(this,(function(t,e){return t===e[0]}),[t],"")},t.prototype.anyOfIgnoreCase=function(){var t=$.apply(V,arguments);return 0===t.length?ii(this):si(this,(function(t,e){return-1!==e.indexOf(t)}),t,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var t=$.apply(V,arguments);return 0===t.length?ii(this):si(this,(function(t,e){return e.some((function(e){return 0===t.indexOf(e)}))}),t,ve)},t.prototype.anyOf=function(){var t=this,e=$.apply(V,arguments),i=this._cmp;try{e.sort(i)}catch(t){return ei(this,be)}if(0===e.length)return ii(this);var n=new this.Collection(this,(function(){return ai(e[0],e[e.length-1])}));n._ondirectionchange=function(n){i="next"===n?t._ascending:t._descending,e.sort(i)};var r=0;return n._addAlgorithm((function(t,n,o){for(var s=t.key;i(s,e[r])>0;)if(++r===e.length)return n(o),!1;return 0===i(s,e[r])||(n((function(){t.continue(e[r])})),!1)})),n},t.prototype.notEqual=function(t){return this.inAnyRange([[xe,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var t=$.apply(V,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return ei(this,be)}var e=t.reduce((function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[xe,e]]}),null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(t,e){var i=this,n=this._cmp,r=this._ascending,o=this._descending,s=this._min,a=this._max;if(0===t.length)return ii(this);if(!t.every((function(t){return void 0!==t[0]&&void 0!==t[1]&&r(t[0],t[1])<=0})))return ei(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",tt.InvalidArgument);var l=!e||!1!==e.includeLowers,c=e&&!0===e.includeUppers;function u(t,e){for(var i=0,r=t.length;i<r;++i){var o=t[i];if(n(e[0],o[1])<0&&n(e[1],o[0])>0){o[0]=s(o[0],e[0]),o[1]=a(o[1],e[1]);break}}return i===r&&t.push(e),t}var h,d=r;function p(t,e){return d(t[0],e[0])}try{(h=t.reduce(u,[])).sort(p)}catch(t){return ei(this,be)}var f=0,m=c?function(t){return r(t,h[f][1])>0}:function(t){return r(t,h[f][1])>=0},g=l?function(t){return o(t,h[f][0])>0}:function(t){return o(t,h[f][0])>=0};function y(t){return!m(t)&&!g(t)}var _=m,v=new this.Collection(this,(function(){return ai(h[0][0],h[h.length-1][1],!l,!c)}));return v._ondirectionchange=function(t){"next"===t?(_=m,d=r):(_=g,d=o),h.sort(p)},v._addAlgorithm((function(t,e,n){for(var o=t.key;_(o);)if(++f===h.length)return e(n),!1;return!!y(o)||(0===i._cmp(o,h[f][1])||0===i._cmp(o,h[f][0])||e((function(){d===r?t.continue(h[f][0]):t.continue(h[f][1])})),!1)})),v},t.prototype.startsWithAnyOf=function(){var t=$.apply(V,arguments);return t.every((function(t){return"string"==typeof t}))?0===t.length?ii(this):this.inAnyRange(t.map((function(t){return[t,t+ve]}))):ei(this,"startsWithAnyOf() only works with strings")},t}();function ui(t){return Oe(ci.prototype,(function(e,i,n){if(this.db=t,this._ctx={table:e,index:":id"===i?null:i,or:n},this._cmp=this._ascending=Me,this._descending=function(t,e){return Me(e,t)},this._max=function(t,e){return Me(t,e)>0?t:e},this._min=function(t,e){return Me(t,e)<0?t:e},this._IDBKeyRange=t._deps.IDBKeyRange,!this._IDBKeyRange)throw new tt.MissingAPI}))}function hi(t){return Yt((function(e){return di(e),t(e.target.error),!1}))}function di(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var pi="storagemutated",fi="x-storagemutated-1",mi=Fe(null,pi),gi=function(){function t(){}return t.prototype._lock=function(){return x(!zt.global),++this._reculock,1!==this._reculock||zt.global||(zt.lockOwnerFor=this),this},t.prototype._unlock=function(){if(x(!zt.global),0==--this._reculock)for(zt.global||(zt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{pe(t[1],t[0])}catch(t){}}return this},t.prototype._locked=function(){return this._reculock&&zt.lockOwnerFor!==this},t.prototype.create=function(t){var e=this;if(!this.mode)return this;var i=this.db.idbdb,n=this.db._state.dbOpenError;if(x(!this.idbtrans),!t&&!i)switch(n&&n.name){case"DatabaseClosedError":throw new tt.DatabaseClosed(n);case"MissingAPIError":throw new tt.MissingAPI(n.message,n);default:throw new tt.OpenFailed(n)}if(!this.active)throw new tt.TransactionInactive;return x(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):i.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Yt((function(i){di(i),e._reject(t.error)})),t.onabort=Yt((function(i){di(i),e.active&&e._reject(new tt.Abort(t.error)),e.active=!1,e.on("abort").fire(i)})),t.oncomplete=Yt((function(){e.active=!1,e._resolve(),"mutatedParts"in t&&mi.storagemutated.fire(t.mutatedParts)})),this},t.prototype._promise=function(t,e,i){var n=this;if("readwrite"===t&&"readwrite"!==this.mode)return ge(new tt.ReadOnly("Transaction is readonly"));if(!this.active)return ge(new tt.TransactionInactive);if(this._locked())return new Bt((function(r,o){n._blockedFuncs.push([function(){n._promise(t,e,i).then(r,o)},zt])}));if(i)return oe((function(){var t=new Bt((function(t,i){n._lock();var r=e(t,i,n);r&&r.then&&r.then(t,i)}));return t.finally((function(){return n._unlock()})),t._lib=!0,t}));var r=new Bt((function(t,i){var r=e(t,i,n);r&&r.then&&r.then(t,i)}));return r._lib=!0,r},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(t){var e=this._root(),i=Bt.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then((function(){return i}));else{e._waitingFor=i,e._waitingQueue=[];var n=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(n.get(-1/0).onsuccess=t)}()}var r=e._waitingFor;return new Bt((function(t,n){i.then((function(i){return e._waitingQueue.push(Yt(t.bind(null,i)))}),(function(t){return e._waitingQueue.push(Yt(n.bind(null,t)))})).finally((function(){e._waitingFor===r&&(e._waitingFor=null)}))}))},t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new tt.Abort))},t.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(u(e,t))return e[t];var i=this.schema[t];if(!i)throw new tt.NotFound("Table "+t+" not part of transaction");var n=new this.db.Table(t,i,this);return n.core=this.db.core.table(t),e[t]=n,n},t}();function yi(t){return Oe(gi.prototype,(function(e,i,n,r,o){var s=this;this.db=t,this.mode=e,this.storeNames=i,this.schema=n,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=Fe(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Bt((function(t,e){s._resolve=t,s._reject=e})),this._completion.then((function(){s.active=!1,s.on.complete.fire()}),(function(t){var e=s.active;return s.active=!1,s.on.error.fire(t),s.parent?s.parent._reject(t):e&&s.idbtrans&&s.idbtrans.abort(),ge(t)}))}))}function _i(t,e,i,n,r,o,s){return{name:t,keyPath:e,unique:i,multi:n,auto:r,compound:o,src:(i&&!s?"&":"")+(n?"*":"")+(r?"++":"")+vi(e)}}function vi(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function xi(t,e,i){return{name:t,primKey:e,indexes:i,mappedClass:null,idxByName:w(i,(function(t){return[t.name,t]}))}}function bi(t){return 1===t.length?t[0]:t}var wi=function(t){try{return t.only([[]]),wi=function(){return[[]]},[[]]}catch(t){return wi=function(){return ve},ve}};function Si(t){return null==t?function(){}:"string"==typeof t?Ti(t):function(e){return S(e,t)}}function Ti(t){return 1===t.split(".").length?function(e){return e[t]}:function(e){return S(e,t)}}function Ii(t){return[].slice.call(t)}var Pi=0;function ki(t){return null==t?":id":"string"==typeof t?t:"[".concat(t.join("+"),"]")}function Ci(t,e,i){function n(t,e){var i=Ii(t.objectStoreNames);return{schema:{name:t.name,tables:i.map((function(t){return e.objectStore(t)})).map((function(t){var e=t.keyPath,i=t.autoIncrement,n=s(e),r=null==e,o={},a={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:r,compound:n,keyPath:e,autoIncrement:i,unique:!0,extractKey:Si(e)},indexes:Ii(t.indexNames).map((function(e){return t.index(e)})).map((function(t){var e=t.name,i=t.unique,n=t.multiEntry,r=t.keyPath,a={name:e,compound:s(r),keyPath:r,unique:i,multiEntry:n,extractKey:Si(r)};return o[ki(r)]=a,a})),getIndexByKeyPath:function(t){return o[ki(t)]}};return o[":id"]=a.primaryKey,null!=e&&(o[ki(e)]=a.primaryKey),a}))},hasGetAll:i.length>0&&"getAll"in e.objectStore(i[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function r(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");var i=t.lower,n=t.upper,r=t.lowerOpen,o=t.upperOpen;return void 0===i?void 0===n?null:e.upperBound(n,!!o):void 0===n?e.lowerBound(i,!!r):e.bound(i,n,!!r,!!o)}function o(t){var e=t.name;function i(t){var i=t.trans,n=t.type,o=t.keys,s=t.values,a=t.range;return new Promise((function(t,l){t=Yt(t);var c=i.objectStore(e),u=null==c.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);var d,p=(o||s||{length:1}).length;if(o&&s&&o.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===p)return t({numFailures:0,failures:{},results:[],lastResult:void 0});var f=[],m=[],g=0,y=function(t){++g,di(t)};if("deleteRange"===n){if(4===a.type)return t({numFailures:g,failures:m,results:[],lastResult:void 0});3===a.type?f.push(d=c.clear()):f.push(d=c.delete(r(a)))}else{var _=h?u?[s,o]:[s,null]:[o,null],v=_[0],x=_[1];if(h)for(var b=0;b<p;++b)f.push(d=x&&void 0!==x[b]?c[n](v[b],x[b]):c[n](v[b])),d.onerror=y;else for(b=0;b<p;++b)f.push(d=c[n](v[b])),d.onerror=y}var w=function(e){var i=e.target.result;f.forEach((function(t,e){return null!=t.error&&(m[e]=t.error)})),t({numFailures:g,failures:m,results:"delete"===n?o:f.map((function(t){return t.result})),lastResult:i})};d.onerror=function(t){y(t),w(t)},d.onsuccess=w}))}function n(t){var i=t.trans,n=t.values,o=t.query,s=t.reverse,a=t.unique;return new Promise((function(t,l){t=Yt(t);var c=o.index,u=o.range,h=i.objectStore(e),d=c.isPrimaryKey?h:h.index(c.name),p=s?a?"prevunique":"prev":a?"nextunique":"next",f=n||!("openKeyCursor"in d)?d.openCursor(r(u),p):d.openKeyCursor(r(u),p);f.onerror=hi(l),f.onsuccess=Yt((function(e){var n=f.result;if(n){n.___id=++Pi,n.done=!1;var r=n.continue.bind(n),o=n.continuePrimaryKey;o&&(o=o.bind(n));var s=n.advance.bind(n),a=function(){throw new Error("Cursor not started")},c=function(){throw new Error("Cursor not stopped")};n.trans=i,n.stop=n.continue=n.continuePrimaryKey=n.advance=a,n.fail=Yt(l),n.next=function(){var t=this,e=1;return this.start((function(){return e--?t.continue():t.stop()})).then((function(){return t}))},n.start=function(t){var e=new Promise((function(t,e){t=Yt(t),f.onerror=hi(e),n.fail=e,n.stop=function(e){n.stop=n.continue=n.continuePrimaryKey=n.advance=c,t(e)}})),i=function(){if(f.result)try{t()}catch(t){n.fail(t)}else n.done=!0,n.start=function(){throw new Error("Cursor behind last entry")},n.stop()};return f.onsuccess=Yt((function(t){f.onsuccess=i,i()})),n.continue=r,n.continuePrimaryKey=o,n.advance=s,i(),e},t(n)}else t(null)}),l)}))}function o(t){return function(i){return new Promise((function(n,o){n=Yt(n);var s=i.trans,a=i.values,l=i.limit,c=i.query,u=l===1/0?void 0:l,h=c.index,d=c.range,p=s.objectStore(e),f=h.isPrimaryKey?p:p.index(h.name),m=r(d);if(0===l)return n({result:[]});if(t){var g=a?f.getAll(m,u):f.getAllKeys(m,u);g.onsuccess=function(t){return n({result:t.target.result})},g.onerror=hi(o)}else{var y=0,_=a||!("openKeyCursor"in f)?f.openCursor(m):f.openKeyCursor(m),v=[];_.onsuccess=function(t){var e=_.result;return e?(v.push(a?e.value:e.primaryKey),++y===l?n({result:v}):void e.continue()):n({result:v})},_.onerror=hi(o)}}))}}return{name:e,schema:t,mutate:i,getMany:function(t){var i=t.trans,n=t.keys;return new Promise((function(t,r){t=Yt(t);for(var o,s=i.objectStore(e),a=n.length,l=new Array(a),c=0,u=0,h=function(e){var i=e.target;l[i._pos]=i.result,++u===c&&t(l)},d=hi(r),p=0;p<a;++p)null!=n[p]&&((o=s.get(n[p]))._pos=p,o.onsuccess=h,o.onerror=d,++c);0===c&&t(l)}))},get:function(t){var i=t.trans,n=t.key;return new Promise((function(t,r){t=Yt(t);var o=i.objectStore(e).get(n);o.onsuccess=function(e){return t(e.target.result)},o.onerror=hi(r)}))},query:o(c),openCursor:n,count:function(t){var i=t.query,n=t.trans,o=i.index,s=i.range;return new Promise((function(t,i){var a=n.objectStore(e),l=o.isPrimaryKey?a:a.index(o.name),c=r(s),u=c?l.count(c):l.count();u.onsuccess=Yt((function(e){return t(e.target.result)})),u.onerror=hi(i)}))}}}var a=n(t,i),l=a.schema,c=a.hasGetAll,u=l.tables.map((function(t){return o(t)})),h={};return u.forEach((function(t){return h[t.name]=t})),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(t){if(!h[t])throw new Error("Table '".concat(t,"' not found"));return h[t]},MIN_KEY:-1/0,MAX_KEY:wi(e),schema:l}}function Ai(t,e){return e.reduce((function(t,e){var n=e.create;return i(i({},t),n(t))}),t)}function Ei(t,e,i,n){var r=i.IDBKeyRange;return i.indexedDB,{dbcore:Ai(Ci(e,r,n),t.dbcore)}}function Mi(t,e){var i=e.db,n=Ei(t._middlewares,i,t._deps,e);t.core=n.dbcore,t.tables.forEach((function(e){var i=e.name;t.core.schema.tables.some((function(t){return t.name===i}))&&(e.core=t.core.table(i),t[i]instanceof t.Table&&(t[i].core=e.core))}))}function zi(t,e,i,n){i.forEach((function(i){var r=n[i];e.forEach((function(e){var n=g(e,i);(!n||"value"in n&&void 0===n.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?p(e,i,{get:function(){return this.table(i)},set:function(t){d(this,i,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[i]=new t.Table(i,r))}))}))}function Di(t,e){e.forEach((function(e){for(var i in e)e[i]instanceof t.Table&&delete e[i]}))}function Li(t,e){return t._cfg.version-e._cfg.version}function Ri(t,e,i,n){var r=t._dbSchema;i.objectStoreNames.contains("$meta")&&!r.$meta&&(r.$meta=xi("$meta",Hi("")[0],[]),t._storeNames.push("$meta"));var s=t._createTransaction("readwrite",t._storeNames,r);s.create(i),s._completion.catch(n);var a=s._reject.bind(s),l=zt.transless||zt;oe((function(){if(zt.trans=s,zt.transless=l,0!==e)return Mi(t,i),Fi(t,s,e).then((function(e){return Oi(t,e,s,i)})).catch(a);o(r).forEach((function(t){Ni(i,t,r[t].primKey,r[t].indexes)})),Mi(t,i),Bt.follow((function(){return t.on.populate.fire(s)})).catch(a)}))}function Bi(t,e){Vi(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var i=qi(t,t.idbdb,e);Ki(t,t._dbSchema,e);for(var n=function(t){if(t.change.length||t.recreate)return console.warn("Unable to patch indexes of table ".concat(t.name," because it has changes on the type of index or primary key.")),{value:void 0};var i=e.objectStore(t.name);t.add.forEach((function(e){pt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(t.name,".").concat(e.src)),Ui(i,e)}))},r=0,o=ji(i,t._dbSchema).change;r<o.length;r++){var s=n(o[r]);if("object"==typeof s)return s.value}}function Fi(t,e,i){return e.storeNames.includes("$meta")?e.table("$meta").get("version").then((function(t){return null!=t?t:i})):Bt.resolve(i)}function Oi(t,e,i,n){var r=[],s=t._versions,a=t._dbSchema=qi(t,t.idbdb,n),l=s.filter((function(t){return t._cfg.version>=e}));if(0===l.length)return Bt.resolve();function c(){return r.length?Bt.resolve(r.shift()(i.idbtrans)).then(c):Bt.resolve()}return l.forEach((function(s){r.push((function(){var r=a,l=s._cfg.dbschema;Ki(t,r,n),Ki(t,l,n),a=t._dbSchema=l;var c=ji(r,l);c.add.forEach((function(t){Ni(n,t[0],t[1].primKey,t[1].indexes)})),c.change.forEach((function(t){if(t.recreate)throw new tt.Upgrade("Not yet support for changing primary key");var e=n.objectStore(t.name);t.add.forEach((function(t){return Ui(e,t)})),t.change.forEach((function(t){e.deleteIndex(t.name),Ui(e,t)})),t.del.forEach((function(t){return e.deleteIndex(t)}))}));var u=s._cfg.contentUpgrade;if(u&&s._cfg.version>e){Mi(t,n),i._memoizedTables={};var h=P(l);c.del.forEach((function(t){h[t]=r[t]})),Di(t,[t.Transaction.prototype]),zi(t,[t.Transaction.prototype],o(h),h),i.schema=h;var d,p=U(u);p&&se();var f=Bt.follow((function(){if((d=u(i))&&p){var t=ae.bind(null,null);d.then(t,t)}}));return d&&"function"==typeof d.then?Bt.resolve(d):f.then((function(){return d}))}})),r.push((function(e){$i(s._cfg.dbschema,e),Di(t,[t.Transaction.prototype]),zi(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),i.schema=t._dbSchema})),r.push((function(e){t.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(t.idbdb.version/10)===s._cfg.version?(t.idbdb.deleteObjectStore("$meta"),delete t._dbSchema.$meta,t._storeNames=t._storeNames.filter((function(t){return"$meta"!==t}))):e.objectStore("$meta").put(s._cfg.version,"version"))}))})),c().then((function(){Vi(a,n)}))}function ji(t,e){var i,n={del:[],add:[],change:[]};for(i in t)e[i]||n.del.push(i);for(i in e){var r=t[i],o=e[i];if(r){var s={name:i,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(r.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||r.primKey.auto!==o.primKey.auto)s.recreate=!0,n.change.push(s);else{var a=r.idxByName,l=o.idxByName,c=void 0;for(c in a)l[c]||s.del.push(c);for(c in l){var u=a[c],h=l[c];u?u.src!==h.src&&s.change.push(h):s.add.push(h)}(s.del.length>0||s.add.length>0||s.change.length>0)&&n.change.push(s)}}else n.add.push([i,o])}return n}function Ni(t,e,i,n){var r=t.db.createObjectStore(e,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return n.forEach((function(t){return Ui(r,t)})),r}function Vi(t,e){o(t).forEach((function(i){e.db.objectStoreNames.contains(i)||(pt&&console.debug("Dexie: Creating missing table",i),Ni(e,i,t[i].primKey,t[i].indexes))}))}function $i(t,e){[].slice.call(e.db.objectStoreNames).forEach((function(i){return null==t[i]&&e.db.deleteObjectStore(i)}))}function Ui(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function qi(t,e,i){var n={};return _(e.objectStoreNames,0).forEach((function(t){for(var e=i.objectStore(t),r=e.keyPath,o=_i(vi(r),r||"",!0,!1,!!e.autoIncrement,r&&"string"!=typeof r,!0),s=[],a=0;a<e.indexNames.length;++a){var l=e.index(e.indexNames[a]);r=l.keyPath;var c=_i(l.name,r,!!l.unique,!!l.multiEntry,!1,r&&"string"!=typeof r,!1);s.push(c)}n[t]=xi(t,o,s)})),n}function Zi(t,e,i){t.verno=e.version/10;var n=t._dbSchema=qi(t,e,i);t._storeNames=_(e.objectStoreNames,0),zi(t,[t._allTables],o(n),n)}function Gi(t,e){var i=ji(qi(t,t.idbdb,e),t._dbSchema);return!(i.add.length||i.change.some((function(t){return t.add.length||t.change.length})))}function Ki(t,e,i){for(var n=i.db.objectStoreNames,o=0;o<n.length;++o){var s=n[o],a=i.objectStore(s);t._hasGetAll="getAll"in a;for(var l=0;l<a.indexNames.length;++l){var c=a.indexNames[l],u=a.index(c).keyPath,h="string"==typeof u?u:"["+_(u).join("+")+"]";if(e[s]){var d=e[s].idxByName[h];d&&(d.name=c,delete e[s].idxByName[h],e[s].idxByName[c]=d)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Hi(t){return t.split(",").map((function(t,e){var i=(t=t.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split("+"):i;return _i(i,n||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),s(n),0===e)}))}var Wi,Xi=function(){function t(){}return t.prototype._parseStoresSpec=function(t,e){o(t).forEach((function(i){if(null!==t[i]){var n=Hi(t[i]),r=n.shift();if(r.unique=!0,r.multi)throw new tt.Schema("Primary key cannot be multi-valued");n.forEach((function(t){if(t.auto)throw new tt.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new tt.Schema("Index must have a name and cannot be an empty string")})),e[i]=xi(i,r,n)}}))},t.prototype.stores=function(t){var e=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,t):t;var i=e._versions,n={},r={};return i.forEach((function(t){a(n,t._cfg.storesSource),r=t._cfg.dbschema={},t._parseStoresSpec(n,r)})),e._dbSchema=r,Di(e,[e._allTables,e,e.Transaction.prototype]),zi(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],o(r),r),e._storeNames=o(r),this},t.prototype.upgrade=function(t){return this._cfg.contentUpgrade=dt(this._cfg.contentUpgrade||rt,t),this},t}();function Ji(t){return Oe(Xi.prototype,(function(e){this.db=t,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}function Yi(t,e){var i=t._dbNamesDB;return i||(i=t._dbNamesDB=new tr(Te,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),i.table("dbnames")}function Qi(t){return t&&"function"==typeof t.databases}function tn(t){var e=t.indexedDB,i=t.IDBKeyRange;return Qi(e)?Promise.resolve(e.databases()).then((function(t){return t.map((function(t){return t.name})).filter((function(t){return t!==Te}))})):Yi(e,i).toCollection().primaryKeys()}function en(t,e){var i=t.indexedDB,n=t.IDBKeyRange;!Qi(i)&&e!==Te&&Yi(i,n).put({name:e}).catch(rt)}function nn(t,e){var i=t.indexedDB,n=t.IDBKeyRange;!Qi(i)&&e!==Te&&Yi(i,n).delete(e).catch(rt)}function rn(t){return oe((function(){return zt.letThrough=!0,t()}))}function on(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var i=function(){return indexedDB.databases().finally(e)};t=setInterval(i,100),i()})).finally((function(){return clearInterval(t)})):Promise.resolve()}function sn(t){return!("from"in t)}var an=function(t,e){if(!this){var i=new an;return t&&"d"in t&&a(i,t),i}a(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function ln(t,e,i){var n=Me(e,i);if(!isNaN(n)){if(n>0)throw RangeError();if(sn(t))return a(t,{from:e,to:i,d:1});var r=t.l,o=t.r;if(Me(i,t.from)<0)return r?ln(r,e,i):t.l={from:e,to:i,d:1,l:null,r:null},dn(t);if(Me(e,t.to)>0)return o?ln(o,e,i):t.r={from:e,to:i,d:1,l:null,r:null},dn(t);Me(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),Me(i,t.to)>0&&(t.to=i,t.r=null,t.d=t.l?t.l.d+1:1);var s=!t.r;r&&!t.l&&cn(t,r),o&&s&&cn(t,o)}}function cn(t,e){function i(t,e){var n=e.from,r=e.to,o=e.l,s=e.r;ln(t,n,r),o&&i(t,o),s&&i(t,s)}sn(e)||i(t,e)}function un(t,e){var i=hn(e),n=i.next();if(n.done)return!1;for(var r=n.value,o=hn(t),s=o.next(r.from),a=s.value;!n.done&&!s.done;){if(Me(a.from,r.to)<=0&&Me(a.to,r.from)>=0)return!0;Me(r.from,a.from)<0?r=(n=i.next(a.from)).value:a=(s=o.next(r.from)).value}return!1}function hn(t){var e=sn(t)?null:{s:0,n:t};return{next:function(t){for(var i=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,i)for(;e.n.l&&Me(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!i||Me(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function dn(t){var e,n,r=((null===(e=t.r)||void 0===e?void 0:e.d)||0)-((null===(n=t.l)||void 0===n?void 0:n.d)||0),o=r>1?"r":r<-1?"l":"";if(o){var s="r"===o?"l":"r",a=i({},t),l=t[o];t.from=l.from,t.to=l.to,t[o]=l[o],a[o]=l[s],t[s]=a,a.d=pn(a)}t.d=pn(t)}function pn(t){var e=t.r,i=t.l;return(e?i?Math.max(e.d,i.d):e.d:i?i.d:0)+1}function fn(t,e){return o(e).forEach((function(i){t[i]?cn(t[i],e[i]):t[i]=M(e[i])})),t}function mn(t,e){return t.all||e.all||Object.keys(t).some((function(i){return e[i]&&un(e[i],t[i])}))}h(an.prototype,((Wi={add:function(t){return cn(this,t),this},addKey:function(t){return ln(this,t,t),this},addKeys:function(t){var e=this;return t.forEach((function(t){return ln(e,t,t)})),this}})[O]=function(){return hn(this)},Wi));var gn={},yn={},_n=!1;function vn(t,e){fn(yn,t),_n||(_n=!0,setTimeout((function(){_n=!1;var t=yn;yn={},xn(t,!1)}),0))}function xn(t,e){void 0===e&&(e=!1);var i=new Set;if(t.all)for(var n=0,r=Object.values(gn);n<r.length;n++)bn(a=r[n],t,i,e);else for(var o in t){var s=/^idb\:\/\/(.*)\/(.*)\//.exec(o);if(s){var a,l=s[1],c=s[2];(a=gn["idb://".concat(l,"/").concat(c)])&&bn(a,t,i,e)}}i.forEach((function(t){return t()}))}function bn(t,e,i,n){for(var r=[],o=0,s=Object.entries(t.queries.query);o<s.length;o++){for(var a=s[o],l=a[0],c=[],u=0,h=a[1];u<h.length;u++){var d=h[u];mn(e,d.obsSet)?d.subscribers.forEach((function(t){return i.add(t)})):n&&c.push(d)}n&&r.push([l,c])}if(n)for(var p=0,f=r;p<f.length;p++){var m=f[p];l=m[0],c=m[1],t.queries.query[l]=c}}function wn(t){var e=t._state,i=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then((function(){return e.dbOpenError?ge(e.dbOpenError):t}));e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var n=e.openCanceller,r=Math.round(10*t.verno),o=!1;function s(){if(e.openCanceller!==n)throw new tt.DatabaseClosed("db.open() was cancelled")}var a=e.dbReadyResolve,l=null,c=!1,u=function(){return new Bt((function(n,a){if(s(),!i)throw new tt.MissingAPI;var h=t.name,d=e.autoSchema||!r?i.open(h):i.open(h,r);if(!d)throw new tt.MissingAPI;d.onerror=hi(a),d.onblocked=Yt(t._fireOnBlocked),d.onupgradeneeded=Yt((function(n){if(l=d.transaction,e.autoSchema&&!t._options.allowEmptyDB){d.onerror=di,l.abort(),d.result.close();var r=i.deleteDatabase(h);r.onsuccess=r.onerror=Yt((function(){a(new tt.NoSuchDatabase("Database ".concat(h," doesnt exist")))}))}else{l.onerror=hi(a);var s=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;c=s<1,t.idbdb=d.result,o&&Bi(t,l),Ri(t,s/10,l,a)}}),a),d.onsuccess=Yt((function(){l=null;var i=t.idbdb=d.result,s=_(i.objectStoreNames);if(s.length>0)try{var a=i.transaction(bi(s),"readonly");if(e.autoSchema)Zi(t,i,a);else if(Ki(t,t._dbSchema,a),!Gi(t,a)&&!o)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),i.close(),r=i.version+1,o=!0,n(u());Mi(t,a)}catch(t){}Se.push(t),i.onversionchange=Yt((function(i){e.vcFired=!0,t.on("versionchange").fire(i)})),i.onclose=Yt((function(e){t.on("close").fire(e)})),c&&en(t._deps,h),n()}),a)})).catch((function(t){switch(null==t?void 0:t.name){case"UnknownError":if(e.PR1398_maxLoop>0)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u();break;case"VersionError":if(r>0)return r=0,u()}return Bt.reject(t)}))};return Bt.race([n,("undefined"==typeof navigator?Bt.resolve():on()).then(u)]).then((function(){return s(),e.onReadyBeingFired=[],Bt.resolve(rn((function(){return t.on.ready.fire(t.vip)}))).then((function i(){if(e.onReadyBeingFired.length>0){var n=e.onReadyBeingFired.reduce(dt,rt);return e.onReadyBeingFired=[],Bt.resolve(rn((function(){return n(t.vip)}))).then(i)}}))})).finally((function(){e.openCanceller===n&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)})).catch((function(i){e.dbOpenError=i;try{l&&l.abort()}catch(t){}return n===e.openCanceller&&t._close(),ge(i)})).finally((function(){e.openComplete=!0,a()})).then((function(){if(c){var e={};t.tables.forEach((function(i){i.schema.indexes.forEach((function(n){n.name&&(e["idb://".concat(t.name,"/").concat(i.name,"/").concat(n.name)]=new an(-1/0,[[[]]]))})),e["idb://".concat(t.name,"/").concat(i.name,"/")]=e["idb://".concat(t.name,"/").concat(i.name,"/:dels")]=new an(-1/0,[[[]]])})),mi(pi).fire(e),xn(e,!0)}return t}))}function Sn(t){var e=function(e){return t.next(e)},i=function(e){return t.throw(e)},n=o(e),r=o(i);function o(t){return function(e){var i=t(e),o=i.value;return i.done?o:o&&"function"==typeof o.then?o.then(n,r):s(o)?Promise.all(o).then(n,r):n(o)}}return o(e)()}function Tn(t,e,i){var n=arguments.length;if(n<2)throw new tt.InvalidArgument("Too few arguments");for(var r=new Array(n-1);--n;)r[n-1]=arguments[n];return i=r.pop(),[t,C(r),i]}function In(t,e,i,n,r){return Bt.resolve().then((function(){var o=zt.transless||zt,s=t._createTransaction(e,i,t._dbSchema,n);s.explicit=!0;var a={trans:s,transless:o};if(n)s.idbtrans=n.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,t._state.PR1398_maxLoop=3}catch(n){return n.name===Y.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t.close({disableAutoOpen:!1}),t.open().then((function(){return In(t,e,i,null,r)}))):ge(n)}var l,c=U(r);c&&se();var u=Bt.follow((function(){if(l=r.call(s,s))if(c){var t=ae.bind(null,null);l.then(t,t)}else"function"==typeof l.next&&"function"==typeof l.throw&&(l=Sn(l))}),a);return(l&&"function"==typeof l.then?Bt.resolve(l).then((function(t){return s.active?t:ge(new tt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):u.then((function(){return l}))).then((function(t){return n&&s._resolve(),s._completion.then((function(){return t}))})).catch((function(t){return s._reject(t),ge(t)}))}))}function Pn(t,e,i){for(var n=s(t)?t.slice():[t],r=0;r<i;++r)n.push(e);return n}function kn(t){return i(i({},t),{table:function(e){var n=t.table(e),r=n.schema,o={},s=[];function a(t,e,n){var r=ki(t),l=o[r]=o[r]||[],c=null==t?0:"string"==typeof t?1:t.length,u=e>0,h=i(i({},n),{name:u?"".concat(r,"(virtual-from:").concat(n.name,")"):n.name,lowLevelIndex:n,isVirtual:u,keyTail:e,keyLength:c,extractKey:Si(t),unique:!u&&n.unique});return l.push(h),h.isPrimaryKey||s.push(h),c>1&&a(2===c?t[0]:t.slice(0,c-1),e+1,n),l.sort((function(t,e){return t.keyTail-e.keyTail})),h}var l=a(r.primaryKey.keyPath,0,r.primaryKey);o[":id"]=[l];for(var c=0,u=r.indexes;c<u.length;c++){var h=u[c];a(h.keyPath,0,h)}function d(t){var e=o[ki(t)];return e&&e[0]}function p(e,i){return{type:1===e.type?2:e.type,lower:Pn(e.lower,e.lowerOpen?t.MAX_KEY:t.MIN_KEY,i),lowerOpen:!0,upper:Pn(e.upper,e.upperOpen?t.MIN_KEY:t.MAX_KEY,i),upperOpen:!0}}function f(t){var e=t.query.index;return e.isVirtual?i(i({},t),{query:{index:e.lowLevelIndex,range:p(t.query.range,e.keyTail)}}):t}var m=i(i({},n),{schema:i(i({},r),{primaryKey:l,indexes:s,getIndexByKeyPath:d}),count:function(t){return n.count(f(t))},query:function(t){return n.query(f(t))},openCursor:function(e){var i=e.query.index,r=i.keyTail,o=i.isVirtual,s=i.keyLength;if(!o)return n.openCursor(e);function a(i){function n(n){null!=n?i.continue(Pn(n,e.reverse?t.MAX_KEY:t.MIN_KEY,r)):e.unique?i.continue(i.key.slice(0,s).concat(e.reverse?t.MIN_KEY:t.MAX_KEY,r)):i.continue()}var o=Object.create(i,{continue:{value:n},continuePrimaryKey:{value:function(e,n){i.continuePrimaryKey(Pn(e,t.MAX_KEY,r),n)}},primaryKey:{get:function(){return i.primaryKey}},key:{get:function(){var t=i.key;return 1===s?t[0]:t.slice(0,s)}},value:{get:function(){return i.value}}});return o}return n.openCursor(f(e)).then((function(t){return t&&a(t)}))}});return m}})}var Cn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:kn};function An(t,e,i,n){return i=i||{},n=n||"",o(t).forEach((function(r){if(u(e,r)){var o=t[r],s=e[r];if("object"==typeof o&&"object"==typeof s&&o&&s){var a=F(o);a!==F(s)?i[n+r]=e[r]:"Object"===a?An(o,s,i,n+r+"."):o!==s&&(i[n+r]=e[r])}else o!==s&&(i[n+r]=e[r])}else i[n+r]=void 0})),o(e).forEach((function(r){u(t,r)||(i[n+r]=e[r])})),i}function En(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}var Mn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return i(i({},t),{table:function(e){var r=t.table(e),o=r.schema.primaryKey,s=i(i({},r),{mutate:function(t){var s=zt.trans,a=s.table(e).hook,l=a.deleting,c=a.creating,h=a.updating;switch(t.type){case"add":if(c.fire===rt)break;return s._promise("readwrite",(function(){return d(t)}),!0);case"put":if(c.fire===rt&&h.fire===rt)break;return s._promise("readwrite",(function(){return d(t)}),!0);case"delete":if(l.fire===rt)break;return s._promise("readwrite",(function(){return d(t)}),!0);case"deleteRange":if(l.fire===rt)break;return s._promise("readwrite",(function(){return p(t)}),!0)}return r.mutate(t);function d(t){var e=zt.trans,s=t.keys||En(o,t);if(!s)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?i(i({},t),{keys:s}):i({},t)).type&&(t.values=n([],t.values,!0)),t.keys&&(t.keys=n([],t.keys,!0)),zn(r,t,s).then((function(i){var n=s.map((function(n,r){var s=i[r],a={onerror:null,onsuccess:null};if("delete"===t.type)l.fire.call(a,n,s,e);else if("add"===t.type||void 0===s){var d=c.fire.call(a,n,t.values[r],e);null==n&&null!=d&&(n=d,t.keys[r]=n,o.outbound||T(t.values[r],o.keyPath,n))}else{var p=An(s,t.values[r]),f=h.fire.call(a,p,n,s,e);if(f){var m=t.values[r];Object.keys(f).forEach((function(t){u(m,t)?m[t]=f[t]:T(m,t,f[t])}))}}return a}));return r.mutate(t).then((function(e){for(var r=e.failures,o=e.results,a=e.numFailures,l=e.lastResult,c=0;c<s.length;++c){var u=o?o[c]:s[c],h=n[c];null==u?h.onerror&&h.onerror(r[c]):h.onsuccess&&h.onsuccess("put"===t.type&&i[c]?t.values[c]:u)}return{failures:r,results:o,numFailures:a,lastResult:l}})).catch((function(t){return n.forEach((function(e){return e.onerror&&e.onerror(t)})),Promise.reject(t)}))}))}function p(t){return f(t.trans,t.range,1e4)}function f(t,e,n){return r.query({trans:t,values:!1,query:{index:o,range:e},limit:n}).then((function(r){var o=r.result;return d({type:"delete",keys:o,trans:t}).then((function(r){return r.numFailures>0?Promise.reject(r.failures[0]):o.length<n?{failures:[],numFailures:0,lastResult:void 0}:f(t,i(i({},e),{lower:o[o.length-1],lowerOpen:!0}),n)}))}))}}});return s}})}};function zn(t,e,i){return"add"===e.type?Promise.resolve([]):t.getMany({trans:e.trans,keys:i,cache:"immutable"})}function Dn(t,e,i){try{if(!e)return null;if(e.keys.length<t.length)return null;for(var n=[],r=0,o=0;r<e.keys.length&&o<t.length;++r)0===Me(e.keys[r],t[o])&&(n.push(i?L(e.values[r]):e.values[r]),++o);return n.length===t.length?n:null}catch(t){return null}}var Ln={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return i(i({},n),{getMany:function(t){if(!t.cache)return n.getMany(t);var e=Dn(t.keys,t.trans._cache,"clone"===t.cache);return e?Bt.resolve(e):n.getMany(t).then((function(e){return t.trans._cache={keys:t.keys,values:"clone"===t.cache?L(e):e},e}))},mutate:function(t){return"add"!==t.type&&(t.trans._cache=null),n.mutate(t)}})}}}};function Rn(t,e){return"readonly"===t.trans.mode&&!!t.subscr&&!t.trans.explicit&&"disabled"!==t.trans.db._options.cache&&!e.schema.primaryKey.outbound}function Bn(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Fn={stack:"dbcore",level:0,name:"Observability",create:function(t){var e=t.schema.name,n=new an(t.MIN_KEY,t.MAX_KEY);return i(i({},t),{transaction:function(e,i,n){if(zt.subscr&&"readonly"!==i)throw new tt.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(zt.querier));return t.transaction(e,i,n)},table:function(r){var a=t.table(r),l=a.schema,c=l.primaryKey,u=l.indexes,h=c.extractKey,d=c.outbound,p=c.autoIncrement&&u.filter((function(t){return t.compound&&t.keyPath.includes(c.keyPath)})),f=i(i({},a),{mutate:function(t){var i=t.trans,o=t.mutatedParts||(t.mutatedParts={}),u=function(t){var i="idb://".concat(e,"/").concat(r,"/").concat(t);return o[i]||(o[i]=new an)},h=u(""),d=u(":dels"),f=t.type,m="deleteRange"===t.type?[t.range]:"delete"===t.type?[t.keys]:t.values.length<50?[En(c,t).filter((function(t){return t})),t.values]:[],g=m[0],y=m[1],_=t.trans._cache;if(s(g)){h.addKeys(g);var v="delete"===f||g.length===y.length?Dn(g,_):null;v||d.addKeys(g),(v||y)&&On(u,l,v,y)}else if(g){var x={from:g.lower,to:g.upper};d.add(x),h.add(x)}else h.add(n),d.add(n),l.indexes.forEach((function(t){return u(t.name).add(n)}));return a.mutate(t).then((function(e){return!g||"add"!==t.type&&"put"!==t.type||(h.addKeys(e.results),p&&p.forEach((function(i){var n=t.values.map((function(t){return i.extractKey(t)})),r=i.keyPath.findIndex((function(t){return t===c.keyPath}));e.results.forEach((function(t){return n[r]=t})),u(i.name).addKeys(n)}))),i.mutatedParts=fn(i.mutatedParts||{},o),e}))}}),m=function(e){var i,n,r=e.query,o=r.index,s=r.range;return[o,new an(null!==(i=s.lower)&&void 0!==i?i:t.MIN_KEY,null!==(n=s.upper)&&void 0!==n?n:t.MAX_KEY)]},g={get:function(t){return[c,new an(t.key)]},getMany:function(t){return[c,(new an).addKeys(t.keys)]},count:m,query:m,openCursor:m};return o(g).forEach((function(t){f[t]=function(o){var s=zt.subscr,l=!!s,c=Rn(zt,a)&&Bn(t,o)?o.obsSet={}:s;if(l){var u=function(t){var i="idb://".concat(e,"/").concat(r,"/").concat(t);return c[i]||(c[i]=new an)},p=u(""),f=u(":dels"),m=g[t](o),y=m[0],_=m[1];if("query"===t&&y.isPrimaryKey&&!o.values?f.add(_):u(y.name||"").add(_),!y.isPrimaryKey){if("count"!==t){var v="query"===t&&d&&o.values&&a.query(i(i({},o),{values:!1}));return a[t].apply(this,arguments).then((function(e){if("query"===t){if(d&&o.values)return v.then((function(t){var i=t.result;return p.addKeys(i),e}));var i=o.values?e.result.map(h):e.result;o.values?p.addKeys(i):f.addKeys(i)}else if("openCursor"===t){var n=e,r=o.values;return n&&Object.create(n,{key:{get:function(){return f.addKey(n.primaryKey),n.key}},primaryKey:{get:function(){var t=n.primaryKey;return f.addKey(t),t}},value:{get:function(){return r&&p.addKey(n.primaryKey),n.value}}})}return e}))}f.add(n)}}return a[t].apply(this,arguments)}})),f}})}};function On(t,e,i,n){function r(e){var r=t(e.name||"");function o(t){return null!=t?e.extractKey(t):null}var a=function(t){return e.multiEntry&&s(t)?t.forEach((function(t){return r.addKey(t)})):r.addKey(t)};(i||n).forEach((function(t,e){var r=i&&o(i[e]),s=n&&o(n[e]);0!==Me(r,s)&&(null!=r&&a(r),null!=s&&a(s))}))}e.indexes.forEach(r)}function jn(t,e,n){if(0===n.numFailures)return e;if("deleteRange"===e.type)return null;var r=e.keys?e.keys.length:"values"in e&&e.values?e.values.length:1;if(n.numFailures===r)return null;var o=i({},e);return s(o.keys)&&(o.keys=o.keys.filter((function(t,e){return!(e in n.failures)}))),"values"in o&&s(o.values)&&(o.values=o.values.filter((function(t,e){return!(e in n.failures)}))),o}function Nn(t,e){return void 0===e.lower||(e.lowerOpen?Me(t,e.lower)>0:Me(t,e.lower)>=0)}function Vn(t,e){return void 0===e.upper||(e.upperOpen?Me(t,e.upper)<0:Me(t,e.upper)<=0)}function $n(t,e){return Nn(t,e)&&Vn(t,e)}function Un(t,e,i,n,r,o){if(!i||0===i.length)return t;var a=e.query.index,l=a.multiEntry,c=e.query.range,u=n.schema.primaryKey.extractKey,h=a.extractKey,d=(a.lowLevelIndex||a).extractKey,p=i.reduce((function(t,i){var n=t,r="add"===i.type||"put"===i.type?i.values.filter((function(t){var e=h(t);return l&&s(e)?e.some((function(t){return $n(t,c)})):$n(e,c)})).map((function(t){return t=L(t),o&&Object.freeze(t),t})):[];switch(i.type){case"add":n=t.concat(e.values?r:r.map((function(t){return u(t)})));break;case"put":var a=(new an).addKeys(i.values.map((function(t){return u(t)})));n=t.filter((function(t){var i=e.values?u(t):t;return!un(new an(i),a)})).concat(e.values?r:r.map((function(t){return u(t)})));break;case"delete":var d=(new an).addKeys(i.keys);n=t.filter((function(t){var i=e.values?u(t):t;return!un(new an(i),d)}));break;case"deleteRange":var p=i.range;n=t.filter((function(t){return!$n(u(t),p)}))}return n}),t);return p===t?t:(p.sort((function(t,e){return Me(d(t),d(e))||Me(u(t),u(e))})),e.limit&&e.limit<1/0&&(p.length>e.limit?p.length=e.limit:t.length===e.limit&&p.length<e.limit&&(r.dirty=!0)),o?Object.freeze(p):p)}function qn(t,e){return 0===Me(t.lower,e.lower)&&0===Me(t.upper,e.upper)&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Zn(t,e,i,n){if(void 0===t)return void 0!==e?-1:0;if(void 0===e)return 1;var r=Me(t,e);if(0===r){if(i&&n)return 0;if(i)return 1;if(n)return-1}return r}function Gn(t,e,i,n){if(void 0===t)return void 0!==e?1:0;if(void 0===e)return-1;var r=Me(t,e);if(0===r){if(i&&n)return 0;if(i)return-1;if(n)return 1}return r}function Kn(t,e){return Zn(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&Gn(t.upper,e.upper,t.upperOpen,e.upperOpen)>=0}function Hn(t,e,i,n){var r=gn["idb://".concat(t,"/").concat(e)];if(!r)return[];var o=r.queries[i];if(!o)return[null,!1,r,null];var s=o[(n.query?n.query.index.name:null)||""];if(!s)return[null,!1,r,null];switch(i){case"query":var a=s.find((function(t){return t.req.limit===n.limit&&t.req.values===n.values&&qn(t.req.query.range,n.query.range)}));return a?[a,!0,r,s]:[s.find((function(t){return("limit"in t.req?t.req.limit:1/0)>=n.limit&&(!n.values||t.req.values)&&Kn(t.req.query.range,n.query.range)})),!1,r,s];case"count":var l=s.find((function(t){return qn(t.req.query.range,n.query.range)}));return[l,!!l,r,s]}}function Wn(t,e,i,n){t.subscribers.add(i),n.addEventListener("abort",(function(){t.subscribers.delete(i),0===t.subscribers.size&&Xn(t,e)}))}function Xn(t,e){setTimeout((function(){0===t.subscribers.size&&N(e,t)}),3e3)}var Jn={stack:"dbcore",level:0,name:"Cache",create:function(t){var e=t.schema.name,n=i(i({},t),{transaction:function(i,n,r){var o=t.transaction(i,n,r);if("readwrite"===n){var s=new AbortController,a=s.signal,l=function(r){return function(){if(s.abort(),"readwrite"===n){for(var a=new Set,l=0,c=i;l<c.length;l++){var u=c[l],h=gn["idb://".concat(e,"/").concat(u)];if(h){var d=t.table(u),p=h.optimisticOps.filter((function(t){return t.trans===o}));if(o._explicit&&r&&o.mutatedParts)for(var f=0,m=Object.values(h.queries.query);f<m.length;f++)for(var g=0,y=(x=m[f]).slice();g<y.length;g++)mn((S=y[g]).obsSet,o.mutatedParts)&&(N(x,S),S.subscribers.forEach((function(t){return a.add(t)})));else if(p.length>0){h.optimisticOps=h.optimisticOps.filter((function(t){return t.trans!==o}));for(var _=0,v=Object.values(h.queries.query);_<v.length;_++)for(var x,b=0,w=(x=v[_]).slice();b<w.length;b++){var S;if(null!=(S=w[b]).res&&o.mutatedParts)if(r&&!S.dirty){var T=Object.isFrozen(S.res),I=Un(S.res,S.req,p,d,S,T);S.dirty?(N(x,S),S.subscribers.forEach((function(t){return a.add(t)}))):I!==S.res&&(S.res=I,S.promise=Bt.resolve({result:I}))}else S.dirty&&N(x,S),S.subscribers.forEach((function(t){return a.add(t)}))}}}}a.forEach((function(t){return t()}))}}};o.addEventListener("abort",l(!1),{signal:a}),o.addEventListener("error",l(!1),{signal:a}),o.addEventListener("complete",l(!0),{signal:a})}return o},table:function(n){var r=t.table(n),o=r.schema.primaryKey,s=i(i({},r),{mutate:function(t){var s=zt.trans;if(o.outbound||"disabled"===s.db._options.cache||s.explicit)return r.mutate(t);var a=gn["idb://".concat(e,"/").concat(n)];if(!a)return r.mutate(t);var l=r.mutate(t);return"add"!==t.type&&"put"!==t.type||!(t.values.length>=50||En(o,t).some((function(t){return null==t})))?(a.optimisticOps.push(t),t.mutatedParts&&vn(t.mutatedParts),l.then((function(e){if(e.numFailures>0){N(a.optimisticOps,t);var i=jn(a,t,e);i&&a.optimisticOps.push(i),t.mutatedParts&&vn(t.mutatedParts)}})),l.catch((function(){N(a.optimisticOps,t),t.mutatedParts&&vn(t.mutatedParts)}))):l.then((function(e){var n=i(i({},t),{values:t.values.map((function(t,n){var r,s=(null===(r=o.keyPath)||void 0===r?void 0:r.includes("."))?L(t):i({},t);return T(s,o.keyPath,e.results[n]),s}))}),r=jn(a,n,e);a.optimisticOps.push(r),queueMicrotask((function(){return t.mutatedParts&&vn(t.mutatedParts)}))})),l},query:function(t){var i;if(!Rn(zt,r)||!Bn("query",t))return r.query(t);var o="immutable"===(null===(i=zt.trans)||void 0===i?void 0:i.db._options.cache),s=zt,a=s.requery,l=s.signal,c=Hn(e,n,"query",t),u=c[0],h=c[1],d=c[2],p=c[3];if(u&&h)u.obsSet=t.obsSet;else{var f=r.query(t).then((function(t){var e=t.result;if(u&&(u.res=e),o){for(var i=0,n=e.length;i<n;++i)Object.freeze(e[i]);Object.freeze(e)}else t.result=L(e);return t})).catch((function(t){return p&&u&&N(p,u),Promise.reject(t)}));u={obsSet:t.obsSet,promise:f,subscribers:new Set,type:"query",req:t,dirty:!1},p?p.push(u):(p=[u],d||(d=gn["idb://".concat(e,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),d.queries.query[t.query.index.name||""]=p)}return Wn(u,p,a,l),u.promise.then((function(e){return{result:Un(e.result,t,null==d?void 0:d.optimisticOps,r,u,o)}}))}});return s}});return n}};function Yn(t,e){return new Proxy(t,{get:function(t,i,n){return"db"===i?e:Reflect.get(t,i,n)}})}var Qn,tr=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var o=t.dependencies;this._options=n=i({addons:t.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var s=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:rt,dbReadyPromise:null,cancelOpen:rt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};a.dbReadyPromise=new Bt((function(t){a.dbReadyResolve=t})),a.openCanceller=new Bt((function(t,e){a.cancelOpen=e})),this._state=a,this.name=e,this.on=Fe(this,"populate","blocked","versionchange","close",{ready:[dt,rt]}),this.on.ready.subscribe=v(this.on.ready.subscribe,(function(e){return function(i,n){t.vip((function(){var t=r._state;if(t.openComplete)t.dbOpenError||Bt.resolve().then(i),n&&e(i);else if(t.onReadyBeingFired)t.onReadyBeingFired.push(i),n&&e(i);else{e(i);var o=r;n||e((function t(){o.on.ready.unsubscribe(i),o.on.ready.unsubscribe(t)}))}}))}})),this.Collection=Ye(this),this.Table=je(this),this.Transaction=yi(this),this.Version=Ji(this),this.WhereClause=ui(this),this.on("versionchange",(function(t){t.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})})),this.on("blocked",(function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(t.oldVersion/10))})),this._maxKey=wi(n.IDBKeyRange),this._createTransaction=function(t,e,i,n){return new r.Transaction(t,e,i,r._options.chromeTransactionDurability,n)},this._fireOnBlocked=function(t){r.on("blocked").fire(t),Se.filter((function(t){return t.name===r.name&&t!==r&&!t._state.vcFired})).map((function(e){return e.on("versionchange").fire(t)}))},this.use(Ln),this.use(Jn),this.use(Fn),this.use(Cn),this.use(Mn);var l=new Proxy(this,{get:function(t,e,i){if("_vip"===e)return!0;if("table"===e)return function(t){return Yn(r.table(t),l)};var n=Reflect.get(t,e,i);return n instanceof Be?Yn(n,l):"tables"===e?n.map((function(t){return Yn(t,l)})):"_createTransaction"===e?function(){return Yn(n.apply(this,arguments),l)}:n}});this.vip=l,s.forEach((function(t){return t(r)}))}return t.prototype.version=function(t){if(isNaN(t)||t<.1)throw new tt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new tt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,i=e.filter((function(e){return e._cfg.version===t}))[0];return i||(i=new this.Version(t),e.push(i),e.sort(Li),i.stores({}),this._state.autoSchema=!1,i)},t.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||zt.letThrough||this._vip)?t():new Bt((function(t,i){if(e._state.openComplete)return i(new tt.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void i(new tt.DatabaseClosed);e.open().catch(rt)}e._state.dbReadyPromise.then(t,i)})).then(t)},t.prototype.use=function(t){var e=t.stack,i=t.create,n=t.level,r=t.name;r&&this.unuse({stack:e,name:r});var o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:i,level:null==n?10:n,name:r}),o.sort((function(t,e){return t.level-e.level})),this},t.prototype.unuse=function(t){var e=t.stack,i=t.name,n=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((function(t){return n?t.create!==n:!!i&&t.name!==i}))),this},t.prototype.open=function(){var t=this;return pe(Mt,(function(){return wn(t)}))},t.prototype._close=function(){var t=this._state,e=Se.indexOf(this);if(e>=0&&Se.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(t){}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new Bt((function(e){t.dbReadyResolve=e})),t.openCanceller=new Bt((function(e,i){t.cancelOpen=i})))},t.prototype.close=function(t){var e=(void 0===t?{disableAutoOpen:!0}:t).disableAutoOpen,i=this._state;e?(i.isBeingOpened&&i.cancelOpen(new tt.DatabaseClosed),this._close(),i.autoOpen=!1,i.dbOpenError=new tt.DatabaseClosed):(this._close(),i.autoOpen=this._options.autoOpen||i.isBeingOpened,i.openComplete=!1,i.dbOpenError=null)},t.prototype.delete=function(t){var e=this;void 0===t&&(t={disableAutoOpen:!0});var i=arguments.length>0&&"object"!=typeof arguments[0],n=this._state;return new Bt((function(r,o){var s=function(){e.close(t);var i=e._deps.indexedDB.deleteDatabase(e.name);i.onsuccess=Yt((function(){nn(e._deps,e.name),r()})),i.onerror=hi(o),i.onblocked=e._fireOnBlocked};if(i)throw new tt.InvalidArgument("Invalid closeOptions argument to db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()}))},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return null!==this.idbdb},t.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name},t.prototype.hasFailed=function(){return null!==this._state.dbOpenError},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var t=this;return o(this._allTables).map((function(e){return t._allTables[e]}))},enumerable:!1,configurable:!0}),t.prototype.transaction=function(){var t=Tn.apply(this,arguments);return this._transaction.apply(this,t)},t.prototype._transaction=function(t,e,i){var n=this,r=zt.trans;r&&r.db===this&&-1===t.indexOf("!")||(r=null);var o,s,a=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{if(s=e.map((function(t){var e=t instanceof n.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e})),"r"==t||t===Ie)o=Ie;else{if("rw"!=t&&t!=Pe)throw new tt.InvalidArgument("Invalid transaction mode: "+t);o=Pe}if(r){if(r.mode===Ie&&o===Pe){if(!a)throw new tt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach((function(t){if(r&&-1===r.storeNames.indexOf(t)){if(!a)throw new tt.SubTransaction("Table "+t+" not included in parent transaction.");r=null}})),a&&r&&!r.active&&(r=null)}}catch(t){return r?r._promise(null,(function(e,i){i(t)})):ge(t)}var l=In.bind(null,this,o,s,r,i);return r?r._promise(o,l,"lock"):zt.trans?pe(zt.transless,(function(){return n._whenReady(l)})):this._whenReady(l)},t.prototype.table=function(t){if(!u(this._allTables,t))throw new tt.InvalidTable("Table ".concat(t," does not exist"));return this._allTables[t]},t}(),er="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",ir=function(){function t(t){this._subscribe=t}return t.prototype.subscribe=function(t,e,i){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:e,complete:i})},t.prototype[er]=function(){return this},t}();try{Qn={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch(t){Qn={indexedDB:null,IDBKeyRange:null}}function nr(t){var e,i=!1,n=new ir((function(n){var r=U(t);function o(e){var i=Zt();try{r&&se();var n=oe(t,e);return r&&(n=n.finally(ae)),n}finally{i&&Gt()}}var s,a=!1,l={},c={},u={get closed(){return a},unsubscribe:function(){a||(a=!0,s&&s.abort(),h&&mi.storagemutated.unsubscribe(f))}};n.start&&n.start(u);var h=!1,d=function(){return me(m)};function p(){return mn(c,l)}var f=function(t){fn(l,t),p()&&d()},m=function(){if(!a&&Qn.indexedDB){l={};var r={};s&&s.abort(),s=new AbortController;var u={subscr:r,signal:s.signal,requery:d,querier:t,trans:null},p=o(u);Promise.resolve(p).then((function(t){i=!0,e=t,a||u.signal.aborted||(l={},z(c=r)||h||(mi(pi,f),h=!0),me((function(){return!a&&n.next&&n.next(t)})))}),(function(t){i=!1,["DatabaseClosedError","AbortError"].includes(null==t?void 0:t.name)||a||me((function(){a||n.error&&n.error(t)}))}))}};return setTimeout(d,0),u}));return n.hasValue=function(){return i},n.getValue=function(){return e},n}var rr=tr;function or(t){var e=ar;try{ar=!0,mi.storagemutated.fire(t),xn(t,!0)}finally{ar=e}}h(rr,i(i({},nt),{delete:function(t){return new rr(t,{addons:[]}).delete()},exists:function(t){return new rr(t,{addons:[]}).open().then((function(t){return t.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(t){try{return tn(rr.dependencies).then(t)}catch(t){return ge(new tt.MissingAPI)}},defineClass:function(){function t(t){a(this,t)}return t},ignoreTransaction:function(t){return zt.trans?pe(zt.transless,t):t()},vip:rn,async:function(t){return function(){try{var e=Sn(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Bt.resolve(e)}catch(t){return ge(t)}}},spawn:function(t,e,i){try{var n=Sn(t.apply(i,e||[]));return n&&"function"==typeof n.then?n:Bt.resolve(n)}catch(t){return ge(t)}},currentTransaction:{get:function(){return zt.trans||null}},waitFor:function(t,e){var i=Bt.resolve("function"==typeof t?rr.ignoreTransaction(t):t).timeout(e||6e4);return zt.trans?zt.trans.waitFor(i):i},Promise:Bt,debug:{get:function(){return pt},set:function(t){ft(t)}},derive:f,extend:a,props:h,override:v,Events:Fe,on:mi,liveQuery:nr,extendObservabilitySet:fn,getByKeyPath:S,setByKeyPath:T,delByKeyPath:I,shallowClone:P,deepClone:L,getObjectDiff:An,cmp:Me,asap:b,minKey:xe,addons:[],connections:Se,errnames:Y,dependencies:Qn,cache:gn,semVer:_e,version:_e.split(".").map((function(t){return parseInt(t)})).reduce((function(t,e,i){return t+e/Math.pow(10,2*i)}))})),rr.maxKey=wi(rr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(mi(pi,(function(t){var e;ar||(e=new CustomEvent(fi,{detail:t}),ar=!0,dispatchEvent(e),ar=!1)})),addEventListener(fi,(function(t){var e=t.detail;ar||or(e)})));var sr,ar=!1,lr=function(){};function cr(t){return new We({add:t})}function ur(t){return new We({remove:t})}function hr(t,e){return new We({replacePrefix:[t,e]})}return"undefined"!=typeof BroadcastChannel&&((lr=function(){(sr=new BroadcastChannel(fi)).onmessage=function(t){return t.data&&or(t.data)}})(),"function"==typeof sr.unref&&sr.unref(),mi(pi,(function(t){ar||sr.postMessage(t)}))),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",(function(t){if(!tr.disableBfCache&&t.persisted){pt&&console.debug("Dexie: handling persisted pagehide"),null==sr||sr.close();for(var e=0,i=Se;e<i.length;e++)i[e].close({disableAutoOpen:!1})}})),addEventListener("pageshow",(function(t){!tr.disableBfCache&&t.persisted&&(pt&&console.debug("Dexie: handling persisted pageshow"),lr(),or({all:new an(-1/0,[[]])}))}))),Bt.rejectionMapper=it,ft(pt),i(tr,Object.freeze({__proto__:null,Dexie:tr,liveQuery:nr,Entity:Ee,cmp:Me,PropModSymbol:He,PropModification:We,replacePrefix:hr,add:cr,remove:ur,default:tr,RangeSet:an,mergeRanges:cn,rangesOverlap:un}),{default:tr}),tr}();var K=Z(G.exports);const H=Symbol.for("Dexie"),W=globalThis[H]||(globalThis[H]=K);if(K.semVer!==W.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${K.semVer} and ${W.semVer}`);const X=new W("locationsDatabase");X.version(1).stores({locations:"++id, OBJECTID, latitude, longitude, timestamp, note, lname, type, ratings"});const J=U([]),Y=U(!1),Q=U(!1),tt=U([]),et=U(!1),it=U(!1),nt=U(!1),rt=U(""),ot=U("");async function st(t){const e=await X.locations.toArray(),i=e.filter((t=>t.timestamp>=ut)).map((t=>[t.longitude,t.latitude]));i.length>0&&(await async function(t){return new Promise((e=>{t.style.loaded()?e():t.once("load",e)}))}(t),function(t,e){t.getSource("route")?t.getSource("route").setData({type:"Feature",geometry:{type:"LineString",coordinates:e}}):(t.addSource("route",{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:e}}}),t.addLayer({id:"route-points",type:"circle",source:"route",paint:{"circle-radius":6,"circle-color":"#B42222"}}))}(t,i),at(e,t)),J.set(e)}function at(t,e){const i=document.getElementById("locationList");i.innerHTML="";const n=document.createElement("table");n.innerHTML="\n        <thead>\n            <tr>\n                <th>Select</th>\n                <th>Name</th>\n                <th>Type</th>\n                <th>Ratings</th>\n                <th>Note</th>\n                <th>Actions</th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n    ",i.appendChild(n);const r=n.querySelector("tbody");t.forEach((t=>{const e=document.createElement("tr");e.innerHTML=`\n            <td><input type="radio" name="location" class="location-radio" data-lat="${t.latitude}" data-lng="${t.longitude}"></td>\n\n            <td style="display:none">${t.latitude}</td>\n            <td style="display:none">${t.longitude}</td>\n            <td><input type="text" id="lname-${t.id}" value="${t.lname}" /></td>\n            <td>\n                <select id="type-${t.id}">\n                    <option value="" ${""===t.type?"selected":""}></option>\n                    <option value="Restaurant" ${"Restaurant"===t.type?"selected":""}>Restaurant</option>\n                    <option value="Monument" ${"Monument"===t.type?"selected":""}>Monument</option>\n                </select>\n            </td>\n            <td>\n                <select id="ratings-${t.id}">\n                    <option value="0" ${"0"===t.ratings?"selected":""}>0</option>\n                    <option value="1" ${"1"===t.ratings?"selected":""}>1</option>\n                    <option value="2" ${"2"===t.ratings?"selected":""}>2</option>\n                    <option value="3" ${"3"===t.ratings?"selected":""}>3</option>\n                    <option value="4" ${"4"===t.ratings?"selected":""}>4</option>\n                    <option value="5" ${"5"===t.ratings?"selected":""}>5</option>\n                </select>\n            </td>\n            <td><textarea id="note-${t.id}">${t.note}</textarea></td>\n            <td><button class="save-button" data-id="${t.id}">Save</button></td>\n        `,r.appendChild(e)})),function(t){let e=[];document.querySelectorAll(".location-radio").forEach((i=>{i.addEventListener("click",(i=>{const n=parseFloat(i.target.getAttribute("data-lat")),r=parseFloat(i.target.getAttribute("data-lng"));e.forEach((t=>t.remove())),e=[],t.flyTo({center:[r,n],zoom:15});const o=new maplibregl.Marker({color:"red"}).setLngLat([r,n]).addTo(t);e.push(o)}))})),document.querySelectorAll(".save-button").forEach((e=>{e.addEventListener("click",(async i=>{const n=e.dataset.id,r=document.querySelector(`button[data-id="${n}"]`).closest("tr"),o=parseInt(i.target.getAttribute("data-id"),10),s=r.querySelector('input[name="location"]').dataset.lat,a=r.querySelector('input[name="location"]').dataset.lng,l=r.querySelector(`#lname-${n}`).value,c=r.querySelector(`#type-${n}`).value,u=r.querySelector(`#ratings-${n}`).value,h=r.querySelector(`#note-${n}`).value;await async function(t,e,i,n,r,o,s,a){await X.locations.update(t,{lname:e,type:i,ratings:n,note:r}),st(o);const l={latitude:s,longitude:a,note:r,lname:e,type:i,ratings:n};!async function(t,e,i){let n,r;rt.subscribe((t=>{n=t})),ot.subscribe((t=>{r=t})),console.log(n,"::",r);const o={username:n,password:r,client:"referer",referer:"localhost:8080",f:"json"};var s=[];for(var a in o){var l=encodeURIComponent(a),c=encodeURIComponent(o[a]);s.push(l+"="+c)}s=s.join("&");const u=await fetch("https://gistest.twdb.texas.gov/portal/sharing/rest/generateToken",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s}),h=await u.json();console.log("tjson: ",h),async function(t,e,i,n){const r=`https://gistest.twdb.texas.gov/server/rest/services/TxGIO_GIT/Dipak_Test_Collection_Rating/FeatureServer/0/addFeatures?f=pjson&token=${t}`,o={Features:JSON.stringify([{attributes:{Name:e.lname,Type:e.type,Notes:e.note,Rating:e.ratings},geometry:{x:n,y:i,spatialReference:{wkid:4326}}}])};console.log("body: ",o);var s=[];for(var a in o){var l=encodeURIComponent(a),c=encodeURIComponent(o[a]);s.push(l+"="+c)}s=s.join("&");const u=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s});console.log("editr: ",u)}(h.token,t,parseFloat(e),parseFloat(i))}(l,s,a)}(o,l,c,u,h,t,s,a);let d="";switch(c){case"Restaurant":d="https://img.icons8.com/?size=100&id=qvscHBGB7saA&format=png&color=000000";break;case"Monument":d="https://img.icons8.com/?size=100&id=17621&format=png&color=000000"}const p=ht.findIndex((t=>t.newMarker._lngLat.lng==a&&t.newMarker._lngLat.lat==s));if(-1!==p){ht[p].newMarker.remove(),ht.splice(p,1)}if(d){const e=document.createElement("div");e.className="marker",e.style.backgroundImage=`url(${d})`,e.style.backgroundSize="30px 30px",e.style.backgroundRepeat="no-repeat",e.style.width="30px",e.style.height="30px";const i=new maplibregl.Marker({element:e}).setLngLat([a,s]).addTo(t);ht.push({newMarker:i}),i.getElement().addEventListener("click",(()=>{new maplibregl.Popup({closeOnClick:!1}).setLngLat([a,s]).setHTML(`<h3>Rating</h3><p>${u}</p>`).addTo(t)}))}}))}))}(e)}function lt(t,e,i,n,r){!async function(t,e,i,n,r){if(3==r){const n=(await X.locations.toArray()).filter((i=>i.latitude==t&&i.longitude==e));console.log(n),0==n.length&&(await X.locations.add({OBJECTID:ct++,latitude:t,longitude:e,timestamp:(new Date).getTime(),note:"",lname:"",type:"",ratings:0}),await st(i))}n&&n.addWaypoint([e,t],0)}(t,e,i,n,r),i.flyTo({center:[e,t],zoom:15})}let ct=1,ut=Date.now(),ht=[];var dt={exports:{}};
/**
     * MapLibre GL JS
     * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.5.0/LICENSE.txt
     */!function(t,e){t.exports=function(){var t={},e={};function i(i,n,r){if(e[i]=r,"index"===i){var o="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",s={};return e.shared(s),e.index(t,s),"undefined"!=typeof window&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))),t}}i("shared",["exports"],(function(t){function e(t,e,i,n){return new(i||(i=Promise))((function(r,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))}function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}"function"==typeof SuppressedError&&SuppressedError;var n=r;function r(t,e){this.x=t,this.y=e}r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t};var o=i(n),s=a;function a(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var r=this.sampleCurveX(i)-t;if(Math.abs(r)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=r/o}var s=0,a=1;for(i=t,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-t)<e));n++)t>r?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var l=i(s);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function d(){if(null==u&&(u=!1,h())){const t=5,e=new OffscreenCanvas(t,t).getContext("2d",{willReadFrequently:!0});if(e){for(let i=0;i<t*t;i++){const n=4*i;e.fillStyle=`rgb(${n},${n+1},${n+2})`,e.fillRect(i%t,Math.floor(i/t),1,1)}const i=e.getImageData(0,0,t,t).data;for(let e=0;e<t*t*4;e++)if(e%4!=3&&i[e]!==e){u=!0;break}}}return u||!1}function p(t,e,i,n){const r=new l(t,e,i,n);return t=>r.solve(t)}const f=p(.25,.1,.25,1);function m(t,e,i){return Math.min(i,Math.max(e,t))}function g(t,e,i){const n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r}function y(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let _=1;function v(t,e,i){const n={};for(const i in t)n[i]=e.call(this,t[i],i,t);return n}function x(t,e,i){const n={};for(const i in t)e.call(this,t[i],i,t)&&(n[i]=t[i]);return n}function b(t){return Array.isArray(t)?t.map(b):"object"==typeof t&&t?v(t,b):t}const w={};function S(t){w[t]||("undefined"!=typeof console&&console.warn(t),w[t]=!0)}function T(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function I(t){return"undefined"!=typeof WorkerGlobalScope&&void 0!==t&&t instanceof WorkerGlobalScope}let P=null;function k(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}const C="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function A(t,i,n,r,o){return e(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(t,{timestamp:0});try{const s=null==e?void 0:e.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(r*o*4);if(yield e.copyTo(l,function(t,e,i,n,r){const o=4*Math.max(-e,0),s=(Math.max(0,i)-i)*n*4+o,a=4*n,l=Math.max(0,e),c=Math.max(0,i);return{rect:{x:l,y:c,width:Math.min(t.width,e+n)-l,height:Math.min(t.height,i+r)-c},layout:[{offset:s,stride:a}]}}(t,i,n,r,o)),a)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return l}finally{e.close()}}))}let E,M;const z="AbortError";function D(){return new Error(z)}const L={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function R(t){return L.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))]}const B="global-dispatcher";class F extends Error{constructor(t,e,i,n){super(`AJAXError: ${e} (${t}): ${i}`),this.status=t,this.statusText=e,this.url=i,this.body=n}}const O=()=>I(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,j=function(t,i){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){const e=R(t.url);if(e)return e(t,i);if(I(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,targetMapId:B},i)}if(!(/^file:/.test(n=t.url)||/^file:/.test(O())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(t,i){return e(this,void 0,void 0,(function*(){const e=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,cache:t.cache,referrer:O(),signal:i.signal});"json"!==t.type||e.headers.has("Accept")||e.headers.set("Accept","application/json");const n=yield fetch(e);if(!n.ok){const e=yield n.blob();throw new F(n.status,n.statusText,t.url,e)}let r;r="arrayBuffer"===t.type||"image"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text();const o=yield r;if(i.signal.aborted)throw D();return{data:o,cacheControl:n.headers.get("Cache-Control"),expires:n.headers.get("Expires")}}))}(t,i);if(I(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,mustQueue:!0,targetMapId:B},i)}var n;return function(t,e){return new Promise(((i,n)=>{var r;const o=new XMLHttpRequest;o.open(t.method||"GET",t.url,!0),"arrayBuffer"!==t.type&&"image"!==t.type||(o.responseType="arraybuffer");for(const e in t.headers)o.setRequestHeader(e,t.headers[e]);"json"===t.type&&(o.responseType="text",(null===(r=t.headers)||void 0===r?void 0:r.Accept)||o.setRequestHeader("Accept","application/json")),o.withCredentials="include"===t.credentials,o.onerror=()=>{n(new Error(o.statusText))},o.onload=()=>{if(!e.signal.aborted)if((o.status>=200&&o.status<300||0===o.status)&&null!==o.response){let e=o.response;if("json"===t.type)try{e=JSON.parse(o.response)}catch(t){return void n(t)}i({data:e,cacheControl:o.getResponseHeader("Cache-Control"),expires:o.getResponseHeader("Expires")})}else{const e=new Blob([o.response],{type:o.getResponseHeader("Content-Type")});n(new F(o.status,o.statusText,t.url,e))}},e.signal.addEventListener("abort",(()=>{o.abort(),n(D())})),o.send(t.body)}))}(t,i)};function N(t){if(!t||t.indexOf("://")<=0||0===t.indexOf("data:image/")||0===t.indexOf("blob:"))return!0;const e=new URL(t),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function V(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function $(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}class U{constructor(t,e={}){y(this,e),this.type=t}}class q extends U{constructor(t,e={}){super("error",y({error:t},e))}}class Z{on(t,e){return this._listeners=this._listeners||{},V(t,e,this._listeners),this}off(t,e){return $(t,e,this._listeners),$(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},V(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new U(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of n)$(i,e,this._oneTimeListeners),e.call(this,t);const r=this._eventedParent;r&&(y(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof q&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var G={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const K=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function H(t,e){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return K.forEach((t=>{t in e&&(i[t]=e[t])})),i}function W(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!W(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!W(t[i],e[i]))return!1;return!0}return t===e}function X(t,e){t.push(e)}function J(t,e,i){X(i,{command:"addSource",args:[t,e[t]]})}function Y(t,e,i){X(e,{command:"removeSource",args:[t]}),i[t]=!0}function Q(t,e,i,n){Y(t,i,n),J(t,e,i)}function tt(t,e,i){let n;for(n in t[i])if(Object.prototype.hasOwnProperty.call(t[i],n)&&"data"!==n&&!W(t[i][n],e[i][n]))return!1;for(n in e[i])if(Object.prototype.hasOwnProperty.call(e[i],n)&&"data"!==n&&!W(t[i][n],e[i][n]))return!1;return!0}function et(t,e,i,n,r,o){t=t||{},e=e||{};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(W(t[s],e[s])||i.push({command:o,args:[n,s,e[s],r]}));for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&!Object.prototype.hasOwnProperty.call(t,s)&&(W(t[s],e[s])||i.push({command:o,args:[n,s,e[s],r]}))}function it(t){return t.id}function nt(t,e){return t[e.id]=e,t}class rt{constructor(t,e,i,n){this.message=(t?`${t}: `:"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}function ot(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}class st extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class at{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new at(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const lt={kind:"null"},ct={kind:"number"},ut={kind:"string"},ht={kind:"boolean"},dt={kind:"color"},pt={kind:"object"},ft={kind:"value"},mt={kind:"collator"},gt={kind:"formatted"},yt={kind:"padding"},_t={kind:"resolvedImage"},vt={kind:"variableAnchorOffsetCollection"};function xt(t,e){return{kind:"array",itemType:t,N:e}}function bt(t){if("array"===t.kind){const e=bt(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const wt=[lt,ct,ut,ht,dt,gt,pt,xt(ft),yt,_t,vt];function St(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!St(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of wt)if(!St(t,e))return null}return`Expected ${bt(t)} but found ${bt(e)} instead.`}function Tt(t,e){return e.some((e=>e.kind===t.kind))}function It(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}function Pt(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const kt=.96422,Ct=.82521,At=4/29,Et=6/29,Mt=3*Et*Et,zt=Et*Et*Et,Dt=Math.PI/180,Lt=180/Math.PI;function Rt(t){return(t%=360)<0&&(t+=360),t}function Bt([t,e,i,n]){let r,o;const s=Ot((.2225045*(t=Ft(t))+.7168786*(e=Ft(e))+.0606169*(i=Ft(i)))/1);t===e&&e===i?r=o=s:(r=Ot((.4360747*t+.3850649*e+.1430804*i)/kt),o=Ot((.0139322*t+.0971045*e+.7141733*i)/Ct));const a=116*s-16;return[a<0?0:a,500*(r-s),200*(s-o),n]}function Ft(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ot(t){return t>zt?Math.pow(t,1/3):t/Mt+At}function jt([t,e,i,n]){let r=(t+16)/116,o=isNaN(e)?r:r+e/500,s=isNaN(i)?r:r-i/200;return r=1*Vt(r),o=kt*Vt(o),s=Ct*Vt(s),[Nt(3.1338561*o-1.6168667*r-.4906146*s),Nt(-.9787684*o+1.9161415*r+.033454*s),Nt(.0719453*o-.2289914*r+1.4052427*s),n]}function Nt(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function Vt(t){return t>Et?t*t*t:Mt*(t-At)}function $t(t){return parseInt(t.padEnd(2,t),16)/255}function Ut(t,e){return qt(e?t/100:t,0,1)}function qt(t,e,i){return Math.min(Math.max(e,t),i)}function Zt(t){return!t.some(Number.isNaN)}const Gt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Kt{constructor(t,e,i,n=1,r=!0){this.r=t,this.g=e,this.b=i,this.a=n,r||(this.r*=n,this.g*=n,this.b*=n,n||this.overwriteGetter("rgb",[t,e,i,n]))}static parse(t){if(t instanceof Kt)return t;if("string"!=typeof t)return;const e=function(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=Gt[t];if(e){const[t,i,n]=e;return[t/255,i/255,n/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let i=1;return[$t(t.slice(i,i+=e)),$t(t.slice(i,i+=e)),$t(t.slice(i,i+=e)),$t(t.slice(i,i+e)||"ff")]}if(t.startsWith("rgb")){const e=t.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(e){const[t,i,n,r,o,s,a,l,c,u,h,d]=e,p=[r||" ",a||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const t=[n,s,c].join(""),e="%%%"===t?100:""===t?255:0;if(e){const t=[qt(+i/e,0,1),qt(+o/e,0,1),qt(+l/e,0,1),h?Ut(+h,d):1];if(Zt(t))return t}}return}}const i=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(i){const[t,e,n,r,o,s,a,l,c]=i,u=[n||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,qt(+r,0,100),qt(+s,0,100),l?Ut(+l,c):1];if(Zt(t))return function([t,e,i,n]){function r(n){const r=(n+t/30)%12,o=e*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(r-3,9-r,1))}return t=Rt(t),e/=100,i/=100,[r(0),r(8),r(4),n]}(t)}}}(t);return e?new Kt(...e,!1):void 0}get rgb(){const{r:t,g:e,b:i,a:n}=this,r=n||1/0;return this.overwriteGetter("rgb",[t/r,e/r,i/r,n])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,i,n,r]=Bt(t),o=Math.sqrt(i*i+n*n);return[Math.round(1e4*o)?Rt(Math.atan2(n,i)*Lt):NaN,o,e,r]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Bt(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,i,n]=this.rgb;return`rgba(${[t,e,i].map((t=>Math.round(255*t))).join(",")},${n})`}}Kt.black=new Kt(0,0,0,1),Kt.white=new Kt(1,1,1,1),Kt.transparent=new Kt(0,0,0,0),Kt.red=new Kt(1,0,0,1);class Ht{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wt{constructor(t,e,i,n,r){this.text=t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r}}class Xt{constructor(t){this.sections=t}static fromString(t){return new Xt([new Wt(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Xt?t:Xt.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}}class Jt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Jt)return t;if("number"==typeof t)return new Jt([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Jt(t)}}toString(){return JSON.stringify(this.values)}}const Yt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Qt)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){const i=t[e],n=t[e+1];if("string"!=typeof i||!Yt.has(i))return;if(!Array.isArray(n)||2!==n.length||"number"!=typeof n[0]||"number"!=typeof n[1])return}return new Qt(t)}}toString(){return JSON.stringify(this.values)}}class te{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new te({name:t,available:!1}):null}}function ee(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ie(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Kt||t instanceof Ht||t instanceof Xt||t instanceof Jt||t instanceof Qt||t instanceof te)return!0;if(Array.isArray(t)){for(const e of t)if(!ie(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ie(t[e]))return!1;return!0}return!1}function ne(t){if(null===t)return lt;if("string"==typeof t)return ut;if("boolean"==typeof t)return ht;if("number"==typeof t)return ct;if(t instanceof Kt)return dt;if(t instanceof Ht)return mt;if(t instanceof Xt)return gt;if(t instanceof Jt)return yt;if(t instanceof Qt)return vt;if(t instanceof te)return _t;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=ne(e);if(i){if(i===t)continue;i=ft;break}i=t}return xt(i||ft,e)}return pt}function re(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Kt||t instanceof Xt||t instanceof Jt||t instanceof Qt||t instanceof te?t.toString():JSON.stringify(t)}class oe{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ie(t[1]))return e.error("invalid value");const i=t[1];let n=ne(i);const r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new oe(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class se{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ae={string:ut,number:ct,boolean:ht,object:pt};class le{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const r=t[0];if("array"===r){let r,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in ae)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=ae[i],n++}else r=ft;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++}i=xt(r,o)}else{if(!ae[r])throw new Error(`Types doesn't contain name = ${r}`);i=ae[r]}const o=[];for(;n<t.length;n++){const i=e.parse(t[n],n,ft);if(!i)return null;o.push(i)}return new le(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!St(this.type,ne(i)))return i;if(e===this.args.length-1)throw new se(`Expected value to be of type ${bt(this.type)}, but found ${bt(ne(i))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const ce={"to-boolean":ht,"to-color":dt,"to-number":ct,"to-string":ut};class ue{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(!ce[i])throw new Error(`Can't parse ${i} as it is not part of the known types`);if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const n=ce[i],r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],i,ft);if(!n)return null;r.push(n)}return new ue(n,r)}evaluate(t){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(t));case"color":{let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof Kt)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ee(e[0],e[1],e[2],e[3]),!i))return new Kt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new se(i||`Could not parse color from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"padding":{let e;for(const i of this.args){e=i.evaluate(t);const n=Jt.parse(e);if(n)return n}throw new se(`Could not parse padding from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(const i of this.args){e=i.evaluate(t);const n=Qt.parse(e);if(n)return n}throw new se(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new se(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return Xt.fromString(re(this.args[0].evaluate(t)));case"resolvedImage":return te.fromString(re(this.args[0].evaluate(t)));default:return re(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const he=["Unknown","Point","LineString","Polygon"];class de{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?he[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Kt.parse(t)),e}}class pe{constructor(t,e,i=[],n,r=new at,o=[]){this.registry=t,this.path=i,this.key=i.map((t=>`[${t}]`)).join(""),this.scope=r,this.errors=o,this.expectedType=n,this._isConstant=e}parse(t,e,i,n,r={}){return e?this.concat(e,i,n)._parse(t,r):this._parse(t,r)}_parse(t,e){function i(t,e,i){return"assert"===i?new le(e,[t]):"coerce"===i?new ue(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=t[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind)if("padding"!==t.kind||"value"!==r.kind&&"number"!==r.kind&&"array"!==r.kind)if("variableAnchorOffsetCollection"!==t.kind||"value"!==r.kind&&"array"!==r.kind){if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof oe)&&"resolvedImage"!==n.type.kind&&this._isConstant(n)){const e=new de;try{n=new oe(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new pe(this.registry,this._isConstant,n,e||null,r,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new st(i,t))}checkSubtype(t,e){const i=St(t,e);return i&&this.error(i),i}}class fe{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let n=1;n<t.length-1;n+=2){const r=t[n];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=e.parse(t[n+1],n+1);if(!o)return null;i.push([r,o])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new fe(i,n):null}outputDefined(){return this.result.outputDefined()}}class me{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new me(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ge{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ct),n=e.parse(t[2],2,xt(e.expectedType||ft));return i&&n?new ge(n.type.itemType,i,n):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new se(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new se(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new se(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ye{constructor(t,e){this.type=ht,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ft),n=e.parse(t[2],2,ft);return i&&n?Tt(i.type,[ht,ut,ct,lt,ft])?new ye(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${bt(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!It(e,["boolean","string","number","null"]))throw new se(`Expected first argument to be of type boolean, string, number or null, but found ${bt(ne(e))} instead.`);if(!It(i,["string","array"]))throw new se(`Expected second argument to be of type array or string, but found ${bt(ne(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class _e{constructor(t,e,i){this.type=ct,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ft),n=e.parse(t[2],2,ft);if(!i||!n)return null;if(!Tt(i.type,[ht,ut,ct,lt,ft]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${bt(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,ct);return r?new _e(i,n,r):null}return new _e(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!It(e,["boolean","string","number","null"]))throw new se(`Expected first argument to be of type boolean, string, number or null, but found ${bt(ne(e))} instead.`);if(!It(i,["string","array"]))throw new se(`Expected second argument to be of type array or string, but found ${bt(ne(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ve{constructor(t,e,i,n,r,o){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,ne(t)))return null}else i=ne(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=o.length}const u=e.parse(l,s,n);if(!u)return null;n=n||u.type,o.push(u)}const s=e.parse(t[1],1,ft);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new ve(i,n,s,r,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(ne(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class xe{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let r=1;r<t.length-1;r+=2){const o=e.parse(t[r],r,ht);if(!o)return null;const s=e.parse(t[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=e.parse(t[t.length-1],t.length-1,i);if(!r)return null;if(!i)throw new Error("Can't infer output type");return new xe(i,n,r)}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}}class be{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ft),n=e.parse(t[2],2,ct);if(!i||!n)return null;if(!Tt(i.type,[xt(ft),ut,ft]))return e.error(`Expected first argument to be of type array or string, but found ${bt(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,ct);return r?new be(i.type,i,n,r):null}return new be(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!It(e,["string","array"]))throw new se(`Expected first argument to be of type array or string, but found ${bt(ne(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function we(t,e){const i=t.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=t[a],r=t[a+1],n<=e){if(a===i||e<r)return a;o=a+1}else{if(!(n>e))throw new se("Input is not a number.");s=a-1}return 0}class Se{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,ct);if(!i)return null;const n=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new Se(r,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[we(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Te(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ie=Pe;function Pe(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}Pe.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var r=this.sampleCurveX(i)-t;if(Math.abs(r)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=r/o}var s=0,a=1;for(i=t,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-t)<e));n++)t>r?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var ke=Te(Ie);function Ce(t,e,i){return t+i*(e-t)}function Ae(t,e,i){return t.map(((t,n)=>Ce(t,e[n],i)))}const Ee={number:Ce,color:function(t,e,i,n="rgb"){switch(n){case"rgb":{const[n,r,o,s]=Ae(t.rgb,e.rgb,i);return new Kt(n,r,o,s,!1)}case"hcl":{const[n,r,o,s]=t.hcl,[a,l,c,u]=e.hcl;let h,d;if(isNaN(n)||isNaN(a))isNaN(n)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(d=l)):(h=n,1!==c&&0!==c||(d=r));else{let t=a-n;a>n&&t>180?t-=360:a<n&&n-a>180&&(t+=360),h=n+i*t}const[p,f,m,g]=function([t,e,i,n]){return t=isNaN(t)?0:t*Dt,jt([i,Math.cos(t)*e,Math.sin(t)*e,n])}([h,null!=d?d:Ce(r,l,i),Ce(o,c,i),Ce(s,u,i)]);return new Kt(p,f,m,g,!1)}case"lab":{const[n,r,o,s]=jt(Ae(t.lab,e.lab,i));return new Kt(n,r,o,s,!1)}}},array:Ae,padding:function(t,e,i){return new Jt(Ae(t.values,e.values,i))},variableAnchorOffsetCollection:function(t,e,i){const n=t.values,r=e.values;if(n.length!==r.length)throw new se(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${e.toString()}`);const o=[];for(let t=0;t<n.length;t+=2){if(n[t]!==r[t])throw new se(`Cannot interpolate values containing mismatched anchors. from[${t}]: ${n[t]}, to[${t}]: ${r[t]}`);o.push(n[t]);const[e,s]=n[t+1],[a,l]=r[t+1];o.push([Ce(e,a,i),Ce(s,l,i)])}return new Qt(o)}};class Me{constructor(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,n){let r=0;if("exponential"===t.name)r=ze(e,t.base,i,n);else if("linear"===t.name)r=ze(e,1,i,n);else if("cubic-bezier"===t.name){const o=t.controlPoints;r=new ke(o[0],o[1],o[2],o[3]).solve(ze(e,1,i,n))}return r}static parse(t,e){let[i,n,r,...o]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,ct),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=dt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],n=o[t+1],r=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=e.parse(n,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return Pt(a,ct)||Pt(a,dt)||Pt(a,yt)||Pt(a,vt)||Pt(a,xt(ct))?new Me(a,i,n,r,s):e.error(`Type ${bt(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);const o=we(e,n),s=Me.interpolationFactor(this.interpolation,n,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);switch(this.operator){case"interpolate":return Ee[this.type.kind](a,l,s);case"interpolate-hcl":return Ee.color(a,l,s,"hcl");case"interpolate-lab":return Ee.color(a,l,s,"lab")}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function ze(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}class De{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of t.slice(1)){const t=e.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,r.push(t)}if(!i)throw new Error("No output type");const o=n&&r.some((t=>St(n,t.type)));return new De(o?ft:i,r)}evaluate(t){let e,i=null,n=0;for(const r of this.args)if(n++,i=r.evaluate(t),i&&i instanceof te&&!i.available&&(e||(e=i.name),i=null,n===this.args.length&&(i=e)),null!==i)break;return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Le(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Re(t,e,i,n){return 0===n.compare(e,i)}function Be(t,e,i){const n="=="!==t&&"!="!==t;return class r{constructor(t,e,i){this.type=ht,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,ft);if(!o)return null;if(!Le(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${bt(o.type)}'.`);let s=e.parse(t[2],2,ft);if(!s)return null;if(!Le(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${bt(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${bt(o.type)}' and '${bt(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new le(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new le(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,mt),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const e=ne(o),i=ne(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new se(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=ne(o),i=ne(s);if("string"!==t.kind||"string"!==i.kind)return e(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const Fe=Be("==",(function(t,e,i){return e===i}),Re),Oe=Be("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!Re(0,e,i,n)})),je=Be("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),Ne=Be(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),Ve=Be("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),$e=Be(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class Ue{constructor(t,e,i){this.type=mt,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ht);if(!n)return null;const r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ht);if(!r)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,ut),!o)?null:new Ue(n,r,o)}evaluate(t){return new Ht(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class qe{constructor(t,e,i,n,r){this.type=ut,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ct);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=e.parse(n.locale,1,ut),!r))return null;let o=null;if(n.currency&&(o=e.parse(n.currency,1,ut),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=e.parse(n["min-fraction-digits"],1,ct),!s))return null;let a=null;return n["max-fraction-digits"]&&(a=e.parse(n["max-fraction-digits"],1,ct),!a)?null:new qe(i,r,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ze{constructor(t){this.type=gt,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,ct),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,xt(ut)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,dt),!s))return null;const a=n[n.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,ft);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new Ze(n)}evaluate(t){return new Xt(this.sections.map((e=>{const i=e.content.evaluate(t);return ne(i)===_t?new Wt("",i,null,null,null):new Wt(re(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}}class Ge{constructor(t){this.type=_t,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ut);return i?new Ge(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=te.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ke{constructor(t){this.type=ct,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${bt(i.type)} instead.`):new Ke(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new se(`Expected value to be of type string or array, but found ${bt(ne(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const He=8192;function We(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(i*r*He),Math.round(n*r*He)]}function Xe(t,e){const i=Math.pow(2,e.z);return[(r=(t[0]/He+e.x)/i,360*r-180),(n=(t[1]/He+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,r}function Je(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ye(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Qe(t,e,i){const n=t[0]-e[0],r=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function ti(t,e,i,n){return 0!=(r=[n[0]-i[0],n[1]-i[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-r[1]*o[0]&&!(!si(t,e,i,n)||!si(i,n,t,e));var r,o}function ei(t,e,i){for(const n of i)for(let i=0;i<n.length-1;++i)if(ti(t,e,n[i],n[i+1]))return!0;return!1}function ii(t,e,i=!1){let n=!1;for(const a of e)for(let e=0;e<a.length-1;e++){if(Qe(t,a[e],a[e+1]))return i;(o=a[e])[1]>(r=t)[1]!=(s=a[e+1])[1]>r[1]&&r[0]<(s[0]-o[0])*(r[1]-o[1])/(s[1]-o[1])+o[0]&&(n=!n)}var r,o,s;return n}function ni(t,e){for(const i of e)if(ii(t,i))return!0;return!1}function ri(t,e){for(const i of t)if(!ii(i,e))return!1;for(let i=0;i<t.length-1;++i)if(ei(t[i],t[i+1],e))return!1;return!0}function oi(t,e){for(const i of e)if(ri(t,i))return!0;return!1}function si(t,e,i,n){const r=n[0]-i[0],o=n[1]-i[1],s=(t[0]-i[0])*o-r*(t[1]-i[1]),a=(e[0]-i[0])*o-r*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function ai(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=[];for(let n=0;n<t[r].length;n++){const s=We(t[r][n],i);Je(e,s),o.push(s)}n.push(o)}return n}function li(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=ai(t[r],e,i);n.push(o)}return n}function ci(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let r=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===r&&(r=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=r}Je(e,t)}function ui(t,e,i,n){const r=Math.pow(2,n.z)*He,o=[n.x*He,n.y*He],s=[];for(const n of t)for(const t of n){const n=[t.x+o[0],t.y+o[1]];ci(n,e,i,r),s.push(n)}return s}function hi(t,e,i,n){const r=Math.pow(2,n.z)*He,o=[n.x*He,n.y*He],s=[];for(const i of t){const t=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];Je(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const n of t)ci(n,e,i,r)}var a;return s}class di{constructor(t,e){this.type=ht,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ie(t[1])){const e=t[1];if("FeatureCollection"===e.type){const t=[];for(const i of e.features){const{type:e,coordinates:n}=i.geometry;"Polygon"===e&&t.push(n),"MultiPolygon"===e&&t.push(...n)}if(t.length)return new di(e,{type:"MultiPolygon",coordinates:t})}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new di(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new di(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const o=ai(e.coordinates,n,r),s=ui(t.geometry(),i,n,r);if(!Ye(i,n))return!1;for(const t of s)if(!ii(t,o))return!1}if("MultiPolygon"===e.type){const o=li(e.coordinates,n,r),s=ui(t.geometry(),i,n,r);if(!Ye(i,n))return!1;for(const t of s)if(!ni(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const o=ai(e.coordinates,n,r),s=hi(t.geometry(),i,n,r);if(!Ye(i,n))return!1;for(const t of s)if(!ri(t,o))return!1}if("MultiPolygon"===e.type){const o=li(e.coordinates,n,r),s=hi(t.geometry(),i,n,r);if(!Ye(i,n))return!1;for(const t of s)if(!oi(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pi=class{constructor(t=[],e=fi){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1),o=e[n];const s=n+1;if(s<this.length&&i(e[s],o)<0&&(n=s,o=e[s]),i(o,r)>=0)break;e[t]=o,t=n}e[t]=r}};function fi(t,e){return t<e?-1:t>e?1:0}function mi(t,e,i,n,r){gi(t,e,i,n||t.length-1,r||_i)}function gi(t,e,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,s=e-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);gi(t,e,Math.max(i,Math.floor(e-s*l/o+c)),Math.min(n,Math.floor(e+(o-s)*l/o+c)),r)}var u=t[e],h=i,d=n;for(yi(t,i,e),r(t[n],u)>0&&yi(t,i,n);h<d;){for(yi(t,h,d),h++,d--;r(t[h],u)<0;)h++;for(;r(t[d],u)>0;)d--}0===r(t[i],u)?yi(t,i,d):yi(t,++d,n),d<=e&&(i=d+1),e<=d&&(n=d-1)}}function yi(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function _i(t,e){return t<e?-1:t>e?1:0}function vi(t,e){if(t.length<=1)return[t];const i=[];let n,r;for(const e of t){const t=bi(e);0!==t&&(e.area=Math.abs(t),void 0===r&&(r=t<0),r===t<0?(n&&i.push(n),n=[e]):n.push(e))}if(n&&i.push(n),e>1)for(let t=0;t<i.length;t++)i[t].length<=e||(mi(i[t],e,1,i[t].length-1,xi),i[t]=i[t].slice(0,e));return i}function xi(t,e){return e.area-t.area}function bi(t){let e=0;for(let i,n,r=0,o=t.length,s=o-1;r<o;s=r++)i=t[r],n=t[s],e+=(n.x-i.x)*(i.y+n.y);return e}const wi=1/298.257223563,Si=wi*(2-wi),Ti=Math.PI/180;class Ii{constructor(t){const e=6378.137*Ti*1e3,i=Math.cos(t*Ti),n=1/(1-Si*(1-i*i)),r=Math.sqrt(n);this.kx=e*r*i,this.ky=e*r*n*(1-Si)}distance(t,e){const i=this.wrap(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+n*n)}pointOnLine(t,e){let i,n,r,o,s=1/0;for(let a=0;a<t.length-1;a++){let l=t[a][0],c=t[a][1],u=this.wrap(t[a+1][0]-l)*this.kx,h=(t[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(e[0]-l)*this.kx*u+(e[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=t[a+1][0],c=t[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(e[0]-l)*this.kx,h=(e[1]-c)*this.ky;const p=u*u+h*h;p<s&&(s=p,i=l,n=c,r=a,o=d)}return{point:[i,n],index:r,t:Math.max(0,Math.min(1,o))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Pi(t,e){return e[0]-t[0]}function ki(t){return t[1]-t[0]+1}function Ci(t,e){return t[1]>=t[0]&&t[1]<e}function Ai(t,e){if(t[0]>t[1])return[null,null];const i=ki(t);if(e){if(2===i)return[t,null];const e=Math.floor(i/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}if(1===i)return[t,null];const n=Math.floor(i/2)-1;return[[t[0],t[0]+n],[t[0]+n+1,t[1]]]}function Ei(t,e){if(!Ci(e,t.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let n=e[0];n<=e[1];++n)Je(i,t[n]);return i}function Mi(t){const e=[1/0,1/0,-1/0,-1/0];for(const i of t)for(const t of i)Je(e,t);return e}function zi(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function Di(t,e,i){if(!zi(t)||!zi(e))return NaN;let n=0,r=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(r=t[1]-e[3]),t[3]<e[1]&&(r=e[1]-t[3]),i.distance([0,0],[n,r])}function Li(t,e,i){const n=i.pointOnLine(e,t);return i.distance(t,n.point)}function Ri(t,e,i,n,r){const o=Math.min(Li(t,[i,n],r),Li(e,[i,n],r)),s=Math.min(Li(i,[t,e],r),Li(n,[t,e],r));return Math.min(o,s)}function Bi(t,e,i,n,r){if(!Ci(e,t.length)||!Ci(n,i.length))return 1/0;let o=1/0;for(let s=e[0];s<e[1];++s){const e=t[s],a=t[s+1];for(let t=n[0];t<n[1];++t){const n=i[t],s=i[t+1];if(ti(e,a,n,s))return 0;o=Math.min(o,Ri(e,a,n,s,r))}}return o}function Fi(t,e,i,n,r){if(!Ci(e,t.length)||!Ci(n,i.length))return NaN;let o=1/0;for(let s=e[0];s<=e[1];++s)for(let e=n[0];e<=n[1];++e)if(o=Math.min(o,r.distance(t[s],i[e])),0===o)return o;return o}function Oi(t,e,i){if(ii(t,e,!0))return 0;let n=1/0;for(const r of e){const e=r[0],o=r[r.length-1];if(e!==o&&(n=Math.min(n,Li(t,[o,e],i)),0===n))return n;const s=i.pointOnLine(r,t);if(n=Math.min(n,i.distance(t,s.point)),0===n)return n}return n}function ji(t,e,i,n){if(!Ci(e,t.length))return NaN;for(let n=e[0];n<=e[1];++n)if(ii(t[n],i,!0))return 0;let r=1/0;for(let o=e[0];o<e[1];++o){const e=t[o],s=t[o+1];for(const t of i)for(let i=0,o=t.length,a=o-1;i<o;a=i++){const o=t[a],l=t[i];if(ti(e,s,o,l))return 0;r=Math.min(r,Ri(e,s,o,l,n))}}return r}function Ni(t,e){for(const i of t)for(const t of i)if(ii(t,e,!0))return!0;return!1}function Vi(t,e,i,n=1/0){const r=Mi(t),o=Mi(e);if(n!==1/0&&Di(r,o,i)>=n)return n;if(Ye(r,o)){if(Ni(t,e))return 0}else if(Ni(e,t))return 0;let s=1/0;for(const n of t)for(let t=0,r=n.length,o=r-1;t<r;o=t++){const r=n[o],a=n[t];for(const t of e)for(let e=0,n=t.length,o=n-1;e<n;o=e++){const n=t[o],l=t[e];if(ti(r,a,n,l))return 0;s=Math.min(s,Ri(r,a,n,l,i))}}return s}function $i(t,e,i,n,r,o){if(!o)return;const s=Di(Ei(n,o),r,i);s<e&&t.push([s,o,[0,0]])}function Ui(t,e,i,n,r,o,s){if(!o||!s)return;const a=Di(Ei(n,o),Ei(r,s),i);a<e&&t.push([a,o,s])}function qi(t,e,i,n,r=1/0){let o=Math.min(n.distance(t[0],i[0][0]),r);if(0===o)return o;const s=new pi([[0,[0,t.length-1],[0,0]]],Pi),a=Mi(i);for(;s.length>0;){const r=s.pop();if(r[0]>=o)continue;const l=r[1],c=e?50:100;if(ki(l)<=c){if(!Ci(l,t.length))return NaN;if(e){const e=ji(t,l,i,n);if(isNaN(e)||0===e)return e;o=Math.min(o,e)}else for(let e=l[0];e<=l[1];++e){const r=Oi(t[e],i,n);if(o=Math.min(o,r),0===o)return 0}}else{const i=Ai(l,e);$i(s,o,n,t,a,i[0]),$i(s,o,n,t,a,i[1])}}return o}function Zi(t,e,i,n,r,o=1/0){let s=Math.min(o,r.distance(t[0],i[0]));if(0===s)return s;const a=new pi([[0,[0,t.length-1],[0,i.length-1]]],Pi);for(;a.length>0;){const o=a.pop();if(o[0]>=s)continue;const l=o[1],c=o[2],u=e?50:100,h=n?50:100;if(ki(l)<=u&&ki(c)<=h){if(!Ci(l,t.length)&&Ci(c,i.length))return NaN;let o;if(e&&n)o=Bi(t,l,i,c,r),s=Math.min(s,o);else if(e&&!n){const e=t.slice(l[0],l[1]+1);for(let t=c[0];t<=c[1];++t)if(o=Li(i[t],e,r),s=Math.min(s,o),0===s)return s}else if(!e&&n){const e=i.slice(c[0],c[1]+1);for(let i=l[0];i<=l[1];++i)if(o=Li(t[i],e,r),s=Math.min(s,o),0===s)return s}else o=Fi(t,l,i,c,r),s=Math.min(s,o)}else{const o=Ai(l,e),u=Ai(c,n);Ui(a,s,r,t,i,o[0],u[0]),Ui(a,s,r,t,i,o[0],u[1]),Ui(a,s,r,t,i,o[1],u[0]),Ui(a,s,r,t,i,o[1],u[1])}}return s}function Gi(t){return"MultiPolygon"===t.type?t.coordinates.map((t=>({type:"Polygon",coordinates:t}))):"MultiLineString"===t.type?t.coordinates.map((t=>({type:"LineString",coordinates:t}))):"MultiPoint"===t.type?t.coordinates.map((t=>({type:"Point",coordinates:t}))):[t]}class Ki{constructor(t,e){this.type=ct,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ie(t[1])){const e=t[1];if("FeatureCollection"===e.type)return new Ki(e,e.features.map((t=>Gi(t.geometry))).flat());if("Feature"===e.type)return new Ki(e,Gi(e.geometry));if("type"in e&&"coordinates"in e)return new Ki(e,Gi(e))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=t.geometry(),n=i.flat().map((e=>Xe([e.x,e.y],t.canonical)));if(0===i.length)return NaN;const r=new Ii(n[0][1]);let o=1/0;for(const t of e){switch(t.type){case"Point":o=Math.min(o,Zi(n,!1,[t.coordinates],!1,r,o));break;case"LineString":o=Math.min(o,Zi(n,!1,t.coordinates,!0,r,o));break;case"Polygon":o=Math.min(o,qi(n,!1,t.coordinates,r,o))}if(0===o)return o}return o}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=t.geometry(),n=i.flat().map((e=>Xe([e.x,e.y],t.canonical)));if(0===i.length)return NaN;const r=new Ii(n[0][1]);let o=1/0;for(const t of e){switch(t.type){case"Point":o=Math.min(o,Zi(n,!0,[t.coordinates],!1,r,o));break;case"LineString":o=Math.min(o,Zi(n,!0,t.coordinates,!0,r,o));break;case"Polygon":o=Math.min(o,qi(n,!0,t.coordinates,r,o))}if(0===o)return o}return o}(t,this.geometries);if("Polygon"===t.geometryType())return function(t,e){const i=t.geometry();if(0===i.length||0===i[0].length)return NaN;const n=vi(i,0).map((e=>e.map((e=>e.map((e=>Xe([e.x,e.y],t.canonical))))))),r=new Ii(n[0][0][0][1]);let o=1/0;for(const t of e)for(const e of n){switch(t.type){case"Point":o=Math.min(o,qi([t.coordinates],!1,e,r,o));break;case"LineString":o=Math.min(o,qi(t.coordinates,!0,e,r,o));break;case"Polygon":o=Math.min(o,Vi(e,t.coordinates,r,o))}if(0===o)return o}return o}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Hi={"==":Fe,"!=":Oe,">":Ne,"<":je,">=":$e,"<=":Ve,array:le,at:ge,boolean:le,case:xe,coalesce:De,collator:Ue,format:Ze,image:Ge,in:ye,"index-of":_e,interpolate:Me,"interpolate-hcl":Me,"interpolate-lab":Me,length:Ke,let:fe,literal:oe,match:ve,number:le,"number-format":qe,object:le,slice:be,step:Se,string:le,"to-boolean":ue,"to-color":ue,"to-number":ue,"to-string":ue,var:me,within:di,distance:Ki};class Wi{constructor(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const i=t[0],n=Wi.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[n,o]of s){a=new pe(e.registry,tn,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],r=Array.isArray(n)?n[e-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(n)?n[t]:n.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new Wi(i,r,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(bt).join(", ")})`:`(${bt(e.type)}...)`;var e})).join(" | "),n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],1+n.length);if(!r)return null;n.push(bt(r.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){Wi.definitions=e;for(const i in e)t[i]=Wi}}function Xi(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const o=r?r.evaluate(t):1,s=ee(e,i,n,o);if(s)throw new se(s);return new Kt(e/255,i/255,n/255,o,!1)}function Ji(t,e){return t in e}function Yi(t,e){const i=e[t];return void 0===i?null:i}function Qi(t){return{type:t}}function tn(t){if(t instanceof me)return tn(t.boundExpression);if(t instanceof Wi&&"error"===t.name)return!1;if(t instanceof Ue)return!1;if(t instanceof di)return!1;if(t instanceof Ki)return!1;const e=t instanceof ue||t instanceof le;let i=!0;return t.eachChild((t=>{i=e?i&&tn(t):i&&t instanceof oe})),!!i&&en(t)&&rn(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function en(t){if(t instanceof Wi){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof di)return!1;if(t instanceof Ki)return!1;let e=!0;return t.eachChild((t=>{e&&!en(t)&&(e=!1)})),e}function nn(t){if(t instanceof Wi&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!nn(t)&&(e=!1)})),e}function rn(t,e){if(t instanceof Wi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!rn(t,e)&&(i=!1)})),i}function on(t){return{result:"success",value:t}}function sn(t){return{result:"error",value:t}}function an(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function ln(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function cn(t){return!!t.expression&&t.expression.interpolated}function un(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function hn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function dn(t){return t}function pn(t,e){const i="color"===e.type,n=t.stops&&"object"==typeof t.stops[0][0],r=n||!(n||void 0!==t.property),o=t.type||(cn(e)?"exponential":"interval");if(i||"padding"===e.type){const n=i?Kt.parse:Jt.parse;(t=ot({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],n(t[1])]))),t.default=n(t.default?t.default:e.default)}if(t.colorSpace&&"rgb"!==(s=t.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${t.colorSpace}"`);var s;let a,l,c;if("exponential"===o)a=yn;else if("interval"===o)a=gn;else if("categorical"===o){a=mn,l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];c=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=_n}if(n){const i={},n=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]])}const r=[];for(const t of n)r.push([i[t].zoom,pn(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Me.interpolationFactor.bind(void 0,o),zoomStops:r.map((t=>t[0])),evaluate:({zoom:i},n)=>yn({stops:r,base:t.base},e,i).evaluate(i,n)}}if(r){const i="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Me.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>a(t,e,i,l,c)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[t.property]:void 0;return void 0===r?fn(t.default,e.default):a(t,e,r,l,c)}}}function fn(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function mn(t,e,i,n,r){return fn(typeof i===r?n[i]:void 0,t.default,e.default)}function gn(t,e,i){if("number"!==un(i))return fn(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const r=we(t.stops.map((t=>t[0])),i);return t.stops[r][1]}function yn(t,e,i){const n=void 0!==t.base?t.base:1;if("number"!==un(i))return fn(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const o=we(t.stops.map((t=>t[0])),i),s=function(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(i,n,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1],c=Ee[e.type]||dn;return"function"==typeof a.evaluate?{evaluate(...e){const i=a.evaluate.apply(void 0,e),n=l.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==n)return c(i,n,s,t.colorSpace)}}:c(a,l,s,t.colorSpace)}function _n(t,e,i){switch(e.type){case"color":i=Kt.parse(i);break;case"formatted":i=Xt.fromString(i.toString());break;case"resolvedImage":i=te.fromString(i.toString());break;case"padding":i=Jt.parse(i);break;default:un(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0)}return fn(i,t.default,e.default)}Wi.register(Hi,{error:[{kind:"error"},[ut],(t,[e])=>{throw new se(e.evaluate(t))}],typeof:[ut,[ft],(t,[e])=>bt(ne(e.evaluate(t)))],"to-rgba":[xt(ct,4),[dt],(t,[e])=>{const[i,n,r,o]=e.evaluate(t).rgb;return[255*i,255*n,255*r,o]}],rgb:[dt,[ct,ct,ct],Xi],rgba:[dt,[ct,ct,ct,ct],Xi],has:{type:ht,overloads:[[[ut],(t,[e])=>Ji(e.evaluate(t),t.properties())],[[ut,pt],(t,[e,i])=>Ji(e.evaluate(t),i.evaluate(t))]]},get:{type:ft,overloads:[[[ut],(t,[e])=>Yi(e.evaluate(t),t.properties())],[[ut,pt],(t,[e,i])=>Yi(e.evaluate(t),i.evaluate(t))]]},"feature-state":[ft,[ut],(t,[e])=>Yi(e.evaluate(t),t.featureState||{})],properties:[pt,[],t=>t.properties()],"geometry-type":[ut,[],t=>t.geometryType()],id:[ft,[],t=>t.id()],zoom:[ct,[],t=>t.globals.zoom],"heatmap-density":[ct,[],t=>t.globals.heatmapDensity||0],"line-progress":[ct,[],t=>t.globals.lineProgress||0],accumulated:[ft,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[ct,Qi(ct),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[ct,Qi(ct),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:ct,overloads:[[[ct,ct],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[ct],(t,[e])=>-e.evaluate(t)]]},"/":[ct,[ct,ct],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[ct,[ct,ct],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[ct,[ct],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))],log2:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ct,[ct],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ct,[ct],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ct,[ct],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ct,[ct],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ct,[ct],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ct,[ct],(t,[e])=>Math.atan(e.evaluate(t))],min:[ct,Qi(ct),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[ct,Qi(ct),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[ct,[ct],(t,[e])=>Math.abs(e.evaluate(t))],round:[ct,[ct],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[ct,[ct],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ct,[ct],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ht,[ut,ft],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ht,[ft],(t,[e])=>t.id()===e.value],"filter-type-==":[ht,[ut],(t,[e])=>t.geometryType()===e.value],"filter-<":[ht,[ut,ft],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[ht,[ft],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[ht,[ut,ft],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[ht,[ft],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[ht,[ut,ft],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[ht,[ft],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[ht,[ut,ft],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[ht,[ft],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[ht,[ft],(t,[e])=>e.value in t.properties()],"filter-has-id":[ht,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ht,[xt(ut)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ht,[xt(ft)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ht,[ut,xt(ft)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ht,[ut,xt(ft)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ht,overloads:[[[ht,ht],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Qi(ht),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ht,overloads:[[[ht,ht],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Qi(ht),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ht,[ht],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ht,[ut],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ut,[ut],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ut,[ut],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ut,Qi(ft),(t,e)=>e.map((e=>re(e.evaluate(t)))).join("")],"resolved-locale":[ut,[mt],(t,[e])=>e.evaluate(t).resolvedLocale()]});class vn{constructor(t,e){var i;this.expression=t,this._warningHistory={},this._evaluator=new de,this._defaultValue=e?"color"===(i=e).type&&hn(i.default)?new Kt(0,0,0,0):"color"===i.type?Kt.parse(i.default)||null:"padding"===i.type?Jt.parse(i.default)||null:"variableAnchorOffsetCollection"===i.type?Qt.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,n,r,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new se(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function xn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Hi}function bn(t,e){const i=new pe(Hi,tn,[],e?function(t){const e={color:dt,string:ut,number:ct,enum:ut,boolean:ht,formatted:gt,padding:yt,resolvedImage:_t,variableAnchorOffsetCollection:vt};return"array"===t.type?xt(e[t.value]||ft,t.length):e[t.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?on(new vn(n,e)):sn(i.errors)}class wn{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!nn(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}}class Sn{constructor(t,e,i,n){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!nn(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}interpolationFactor(t,e,i){return this.interpolationType?Me.interpolationFactor(this.interpolationType,t,e,i):0}}function Tn(t,e){const i=bn(t,e);if("error"===i.result)return i;const n=i.value.expression,r=en(n);if(!r&&!an(e))return sn([new st("","data expressions not supported")]);const o=rn(n,["zoom"]);if(!o&&!ln(e))return sn([new st("","zoom expressions not supported")]);const s=Pn(n);return s||o?s instanceof st?sn([s]):s instanceof Me&&!cn(e)?sn([new st("",'"interpolate" expressions cannot be used with this property')]):on(s?new Sn(r?"camera":"composite",i.value,s.labels,s instanceof Me?s.interpolation:void 0):new wn(r?"constant":"source",i.value)):sn([new st("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class In{constructor(t,e){this._parameters=t,this._specification=e,ot(this,pn(this._parameters,this._specification))}static deserialize(t){return new In(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Pn(t){let e=null;if(t instanceof fe)e=Pn(t.result);else if(t instanceof De){for(const i of t.args)if(e=Pn(i),e)break}else(t instanceof Se||t instanceof Me)&&t.input instanceof Wi&&"zoom"===t.input.name&&(e=t);return e instanceof st||t.eachChild((t=>{const i=Pn(t);i instanceof st?e=i:!e&&i?e=new st("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new st("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function kn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!kn(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const Cn={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function An(t){if(null==t)return{filter:()=>!0,needGeometry:!1};kn(t)||(t=zn(t));const e=bn(t,Cn);if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return{filter:(t,i,n)=>e.value.evaluate(t,i,{},n),needGeometry:Mn(t)}}function En(t,e){return t<e?-1:t>e?1:0}function Mn(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(Mn(t[e]))return!0;return!1}function zn(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Dn(t[1],t[2],"=="):"!="===e?Bn(Dn(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Dn(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(zn))):"all"===e?["all"].concat(t.slice(1).map(zn)):"none"===e?["all"].concat(t.slice(1).map(zn).map(Bn)):"in"===e?Ln(t[1],t.slice(2)):"!in"===e?Bn(Ln(t[1],t.slice(2))):"has"===e?Rn(t[1]):"!has"!==e||Bn(Rn(t[1]));var i}function Dn(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Ln(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(En)]]:["filter-in-small",t,["literal",e]]}}function Rn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Bn(t){return["!",t]}function Fn(t){const e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const i of t)e+=`${Fn(i)},`;return`${e}]`}const i=Object.keys(t).sort();let n="{";for(let e=0;e<i.length;e++)n+=`${JSON.stringify(i[e])}:${Fn(t[i[e]])},`;return`${n}}`}function On(t){let e="";for(const i of K)e+=`/${Fn(t[i])}`;return e}function jn(t){const e=t.value;return e?[new rt(t.key,e,"constants have been deprecated as of v8")]:[]}function Nn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Vn(t){if(Array.isArray(t))return t.map(Vn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Vn(t[i]);return e}return Nn(t)}function $n(t){const e=t.key,i=t.value,n=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,s=t.styleSpec,a=t.validateSpec;let l=[];const c=un(i);if("object"!==c)return[new rt(e,i,`object expected, ${c} found`)];for(const t in i){const c=t.split(".")[0],u=n[c]||n["*"];let h;if(r[c])h=r[c];else if(n[c])h=a;else if(r["*"])h=r["*"];else{if(!n["*"]){l.push(new rt(e,i[t],`unknown property "${t}"`));continue}h=a}l=l.concat(h({key:(e?`${e}.`:e)+t,value:i[t],valueSpec:u,style:o,styleSpec:s,object:i,objectKey:t,validateSpec:a},i))}for(const t in n)r[t]||n[t].required&&void 0===n[t].default&&void 0===i[t]&&l.push(new rt(e,i,`missing required property "${t}"`));return l}function Un(t){const e=t.value,i=t.valueSpec,n=t.style,r=t.styleSpec,o=t.key,s=t.arrayElementValidator||t.validateSpec;if("array"!==un(e))return[new rt(o,e,`array expected, ${un(e)} found`)];if(i.length&&e.length!==i.length)return[new rt(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new rt(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values};r.$version<7&&(a.function=i.function),"object"===un(i.value)&&(a=i.value);let l=[];for(let i=0;i<e.length;i++)l=l.concat(s({array:e,arrayIndex:i,value:e[i],valueSpec:a,validateSpec:t.validateSpec,style:n,styleSpec:r,key:`${o}[${i}]`}));return l}function qn(t){const e=t.key,i=t.value,n=t.valueSpec;let r=un(i);return"number"===r&&i!=i&&(r="NaN"),"number"!==r?[new rt(e,i,`number expected, ${r} found`)]:"minimum"in n&&i<n.minimum?[new rt(e,i,`${i} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&i>n.maximum?[new rt(e,i,`${i} is greater than the maximum value ${n.maximum}`)]:[]}function Zn(t){const e=t.valueSpec,i=Nn(t.value.type);let n,r,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===un(t.value.stops)&&"array"===un(t.value.stops[0])&&"object"===un(t.value.stops[0][0]),u=$n({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new rt(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const n=t.value;return e=e.concat(Un({key:t.key,value:n,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===un(n)&&0===n.length&&e.push(new rt(t.key,n,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new rt(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new rt(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!cn(t.valueSpec)&&u.push(new rt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!an(t.valueSpec)?u.push(new rt(t.key,t.value,"property functions not supported")):a&&!ln(t.valueSpec)&&u.push(new rt(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new rt(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const n=t.value,a=t.key;if("array"!==un(n))return[new rt(a,n,`array expected, ${un(n)} found`)];if(2!==n.length)return[new rt(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==un(n[0]))return[new rt(a,n,`object expected, ${un(n[0])} found`)];if(void 0===n[0].zoom)return[new rt(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new rt(a,n,"object stop key must have value")];if(o&&o>Nn(n[0].zoom))return[new rt(a,n[0].zoom,"stop zoom values must appear in ascending order")];Nn(n[0].zoom)!==o&&(o=Nn(n[0].zoom),r=void 0,s={}),i=i.concat($n({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:qn,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:n[0],valueSpec:{},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},n));return xn(Vn(n[1]))?i.concat([new rt(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(t.validateSpec({key:`${a}[1]`,value:n[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function d(t,o){const a=un(t.value),l=Nn(t.value),c=null!==t.value?t.value:o;if(n){if(a!==n)return[new rt(t.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new rt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let n=`number expected, ${a} found`;return an(e)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rt(t.key,c,n)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==r&&l<r?[new rt(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in s?[new rt(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new rt(t.key,c,`integer expected, found ${l}`)]}}function Gn(t){const e=("property"===t.expressionContext?Tn:bn)(Vn(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new rt(`${t.key}${e.key}`,t.value,e.message)));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new rt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!nn(i))return[new rt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!nn(i))return[new rt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!rn(i,["zoom","feature-state"]))return[new rt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!en(i))return[new rt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kn(t){const e=t.key,i=t.value,n=t.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(Nn(i))&&r.push(new rt(e,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(Nn(i))&&r.push(new rt(e,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function Hn(t){return kn(Vn(t.value))?Gn(ot({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Wn(t)}function Wn(t){const e=t.value,i=t.key;if("array"!==un(e))return[new rt(i,e,`array expected, ${un(e)} found`)];const n=t.styleSpec;let r,o=[];if(e.length<1)return[new rt(i,e,"filter array must have at least 1 element")];switch(o=o.concat(Kn({key:`${i}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),Nn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Nn(e[1])&&o.push(new rt(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new rt(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=un(e[1]),"string"!==r&&o.push(new rt(`${i}[1]`,e[1],`string expected, ${r} found`)));for(let s=2;s<e.length;s++)r=un(e[s]),"$type"===Nn(e[1])?o=o.concat(Kn({key:`${i}[${s}]`,value:e[s],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new rt(`${i}[${s}]`,e[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<e.length;n++)o=o.concat(Wn({key:`${i}[${n}]`,value:e[n],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=un(e[1]),2!==e.length?o.push(new rt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new rt(`${i}[1]`,e[1],`string expected, ${r} found`))}return o}function Xn(t,e){const i=t.key,n=t.validateSpec,r=t.style,o=t.styleSpec,s=t.value,a=t.objectKey,l=o[`${e}_${t.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return n({key:i,value:s,valueSpec:o.transition,style:r,styleSpec:o});const u=t.valueSpec||l[a];if(!u)return[new rt(i,s,`unknown property "${a}"`)];let h;if("string"===un(s)&&an(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new rt(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&d.push(new rt(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&hn(Vn(s))&&"identity"===Nn(s.type)&&d.push(new rt(i,s,'"text-font" does not support identity functions'))),d.concat(n({key:t.key,value:s,valueSpec:u,style:r,styleSpec:o,expressionContext:"property",propertyType:e,propertyKey:a}))}function Jn(t){return Xn(t,"paint")}function Yn(t){return Xn(t,"layout")}function Qn(t){let e=[];const i=t.value,n=t.key,r=t.style,o=t.styleSpec;i.type||i.ref||e.push(new rt(n,i,'either "type" or "ref" is required'));let s=Nn(i.type);const a=Nn(i.ref);if(i.id){const o=Nn(i.id);for(let s=0;s<t.arrayIndex;s++){const t=r.layers[s];Nn(t.id)===o&&e.push(new rt(n,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in i&&e.push(new rt(n,i[t],`"${t}" is prohibited for ref layers`))})),r.layers.forEach((e=>{Nn(e.id)===a&&(t=e)})),t?t.ref?e.push(new rt(n,i.ref,"ref cannot reference another ref layer")):s=Nn(t.type):e.push(new rt(n,i.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(i.source){const t=r.sources&&r.sources[i.source],o=t&&Nn(t.type);t?"vector"===o&&"raster"===s?e.push(new rt(n,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?e.push(new rt(n,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?e.push(new rt(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new rt(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new rt(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new rt(n,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new rt(n,i.source,`source "${i.source}" not found`))}else e.push(new rt(n,i,'missing required property "source"'));return e=e.concat($n({key:n,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:i,objectKey:"type"}),filter:Hn,layout:t=>$n({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>Yn(ot({layerType:s},t))}}),paint:t=>$n({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>Jn(ot({layerType:s},t))}})}})),e}function tr(t){const e=t.value,i=t.key,n=un(e);return"string"!==n?[new rt(i,e,`string expected, ${n} found`)]:[]}const er={promoteId:function({key:t,value:e}){if("string"===un(e))return tr({key:t,value:e});{const i=[];for(const n in e)i.push(...tr({key:`${t}.${n}`,value:e[n]}));return i}}};function ir(t){const e=t.value,i=t.key,n=t.styleSpec,r=t.style,o=t.validateSpec;if(!e.type)return[new rt(i,e,'"type" is required')];const s=Nn(e.type);let a;switch(s){case"vector":case"raster":return a=$n({key:i,value:e,valueSpec:n[`source_${s.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:er,validateSpec:o}),a;case"raster-dem":return a=function(t){var e;const i=null!==(e=t.sourceName)&&void 0!==e?e:"",n=t.value,r=t.styleSpec,o=r.source_raster_dem,s=t.style;let a=[];const l=un(n);if(void 0===n)return a;if("object"!==l)return a.push(new rt("source_raster_dem",n,`object expected, ${l} found`)),a;const c="custom"===Nn(n.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?`"${t.value.encoding}"`:"Default";for(const e in n)!c&&u.includes(e)?a.push(new rt(e,n[e],`In "${i}": "${e}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[e]?a=a.concat(t.validateSpec({key:e,value:n[e],valueSpec:o[e],validateSpec:t.validateSpec,style:s,styleSpec:r})):a.push(new rt(e,n[e],`unknown property "${e}"`));return a}({sourceName:i,value:e,style:t.style,styleSpec:n,validateSpec:o}),a;case"geojson":if(a=$n({key:i,value:e,valueSpec:n.source_geojson,style:r,styleSpec:n,validateSpec:o,objectElementValidators:er}),e.cluster)for(const t in e.clusterProperties){const[n,r]=e.clusterProperties[t],s="string"==typeof n?[n,["accumulated"],["get",t]]:n;a.push(...Gn({key:`${i}.${t}.map`,value:r,validateSpec:o,expressionContext:"cluster-map"})),a.push(...Gn({key:`${i}.${t}.reduce`,value:s,validateSpec:o,expressionContext:"cluster-reduce"}))}return a;case"video":return $n({key:i,value:e,valueSpec:n.source_video,style:r,validateSpec:o,styleSpec:n});case"image":return $n({key:i,value:e,valueSpec:n.source_image,style:r,validateSpec:o,styleSpec:n});case"canvas":return[new rt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kn({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,validateSpec:o,styleSpec:n})}}function nr(t){const e=t.value,i=t.styleSpec,n=i.light,r=t.style;let o=[];const s=un(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new rt("light",e,`object expected, ${s} found`)]),o;for(const s in e){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&n[a[1]]&&n[a[1]].transition?t.validateSpec({key:s,value:e[s],valueSpec:i.transition,validateSpec:t.validateSpec,style:r,styleSpec:i}):n[s]?t.validateSpec({key:s,value:e[s],valueSpec:n[s],validateSpec:t.validateSpec,style:r,styleSpec:i}):[new rt(s,e[s],`unknown property "${s}"`)])}return o}function rr(t){const e=t.value,i=t.styleSpec,n=i.sky,r=t.style,o=un(e);if(void 0===e)return[];if("object"!==o)return[new rt("sky",e,`object expected, ${o} found`)];let s=[];for(const o in e)s=s.concat(n[o]?t.validateSpec({key:o,value:e[o],valueSpec:n[o],style:r,styleSpec:i}):[new rt(o,e[o],`unknown property "${o}"`)]);return s}function or(t){const e=t.value,i=t.styleSpec,n=i.terrain,r=t.style;let o=[];const s=un(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new rt("terrain",e,`object expected, ${s} found`)]),o;for(const s in e)o=o.concat(n[s]?t.validateSpec({key:s,value:e[s],valueSpec:n[s],validateSpec:t.validateSpec,style:r,styleSpec:i}):[new rt(s,e[s],`unknown property "${s}"`)]);return o}function sr(t){let e=[];const i=t.value,n=t.key;if(Array.isArray(i)){const r=[],o=[];for(const s in i)i[s].id&&r.includes(i[s].id)&&e.push(new rt(n,i,`all the sprites' ids must be unique, but ${i[s].id} is duplicated`)),r.push(i[s].id),i[s].url&&o.includes(i[s].url)&&e.push(new rt(n,i,`all the sprites' URLs must be unique, but ${i[s].url} is duplicated`)),o.push(i[s].url),e=e.concat($n({key:`${n}[${s}]`,value:i[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:t.validateSpec}));return e}return tr({key:n,value:i})}const ar={"*":()=>[],array:Un,boolean:function(t){const e=t.value,i=t.key,n=un(e);return"boolean"!==n?[new rt(i,e,`boolean expected, ${n} found`)]:[]},number:qn,color:function(t){const e=t.key,i=t.value,n=un(i);return"string"!==n?[new rt(e,i,`color expected, ${n} found`)]:Kt.parse(String(i))?[]:[new rt(e,i,`color expected, "${i}" found`)]},constants:jn,enum:Kn,filter:Hn,function:Zn,layer:Qn,object:$n,source:ir,light:nr,sky:rr,terrain:or,projection:function(t){const e=t.value,i=t.styleSpec,n=i.projection,r=t.style,o=un(e);if(void 0===e)return[];if("object"!==o)return[new rt("projection",e,`object expected, ${o} found`)];let s=[];for(const o in e)s=s.concat(n[o]?t.validateSpec({key:o,value:e[o],valueSpec:n[o],style:r,styleSpec:i}):[new rt(o,e[o],`unknown property "${o}"`)]);return s},string:tr,formatted:function(t){return 0===tr(t).length?[]:Gn(t)},resolvedImage:function(t){return 0===tr(t).length?[]:Gn(t)},padding:function(t){const e=t.key,i=t.value;if("array"===un(i)){if(i.length<1||i.length>4)return[new rt(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const n={type:"number"};let r=[];for(let o=0;o<i.length;o++)r=r.concat(t.validateSpec({key:`${e}[${o}]`,value:i[o],validateSpec:t.validateSpec,valueSpec:n}));return r}return qn({key:e,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(t){const e=t.key,i=t.value,n=un(i),r=t.styleSpec;if("array"!==n||i.length<1||i.length%2!=0)return[new rt(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let n=0;n<i.length;n+=2)o=o.concat(Kn({key:`${e}[${n}]`,value:i[n],valueSpec:r.layout_symbol["text-anchor"]})),o=o.concat(Un({key:`${e}[${n+1}]`,value:i[n+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:r}));return o},sprite:sr};function lr(t){const e=t.value,i=t.valueSpec,n=t.styleSpec;return t.validateSpec=lr,i.expression&&hn(Nn(e))?Zn(t):i.expression&&xn(Vn(e))?Gn(t):i.type&&ar[i.type]?ar[i.type](t):$n(ot({},t,{valueSpec:i.type?n[i.type]:i}))}function cr(t){const e=t.value,i=t.key,n=tr(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new rt(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new rt(i,e,'"glyphs" url must include a "{range}" token'))),n}function ur(t,e=G){let i=[];return i=i.concat(lr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:lr,objectElementValidators:{glyphs:cr,"*":()=>[]}})),t.constants&&(i=i.concat(jn({key:"constants",value:t.constants,style:t,styleSpec:e,validateSpec:lr}))),dr(i)}function hr(t){return function(e){return t({...e,validateSpec:lr})}}function dr(t){return[].concat(t).sort(((t,e)=>t.line-e.line))}function pr(t){return function(...e){return dr(t.apply(this,e))}}ur.source=pr(hr(ir)),ur.sprite=pr(hr(sr)),ur.glyphs=pr(hr(cr)),ur.light=pr(hr(nr)),ur.sky=pr(hr(rr)),ur.terrain=pr(hr(or)),ur.layer=pr(hr(Qn)),ur.filter=pr(hr(Hn)),ur.paintProperty=pr(hr(Jn)),ur.layoutProperty=pr(hr(Yn));const fr=ur,mr=fr.light,gr=fr.sky,yr=fr.paintProperty,_r=fr.layoutProperty;function vr(t,e){let i=!1;if(e&&e.length)for(const n of e)t.fire(new q(new Error(n.message))),i=!0;return i}class xr{constructor(t,e,i){const n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(i=r[2]);for(let t=0;t<this.d*this.d;t++){const e=r[3+t],i=r[3+t+1];n.push(e===i?null:r.subarray(e,i))}const o=r[3+n.length+1];this.keys=r.subarray(r[3+n.length],o),this.bboxes=r.subarray(o),this.insert=this._insertReadonly}else{this.d=e+2*i;for(let t=0;t<this.d*this.d;t++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;const r=i/e*t;this.min=-r,this.max=t+r}insert(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,i,n,r,o){this.cells[r].push(o)}query(t,e,i,n,r){const o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=n&&!r)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(t,e,i,n,this._queryCell,o,{},r),o}}_queryCell(t,e,i,n,r,o,s,a){const l=this.cells[r];if(null!==l){const r=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&i>=c[l+0]&&n>=c[l+1])?(s[h]=!0,o.push(r[h])):s[h]=!1}}}}_forEachCell(t,e,i,n,r,o,s,a){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&r.call(this,t,e,i,n,c,o,s,a))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let i=0;for(let t=0;t<this.cells.length;t++)i+=this.cells[t].length;const n=new Int32Array(e+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;let r=e;for(let e=0;e<t.length;e++){const i=t[e];n[3+e]=r,n.set(i,r),r+=i.length}return n[3+t.length]=r,n.set(this.keys,r),r+=this.keys.length,n[3+t.length+1]=r,n.set(this.bboxes,r),r+=this.bboxes.length,n.buffer}static serialize(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}}static deserialize(t){return new xr(t.buffer)}}const br={};function wr(t,e,i={}){if(br[t])throw new Error(`${t} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),br[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}wr("Object",Object),wr("TransferableGridIndex",xr),wr("Color",Kt),wr("Error",Error),wr("AJAXError",F),wr("ResolvedImage",te),wr("StylePropertyFunction",In),wr("StyleExpression",vn,{omit:["_evaluator"]}),wr("ZoomDependentExpression",Sn),wr("ZoomConstantExpression",wn),wr("CompoundExpression",Wi,{omit:["_evaluate"]});for(const t in Hi)Hi[t]._classRegistryKey||wr(`Expression_${t}`,Hi[t]);function Sr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Tr(t){return t.$name||t.constructor._classRegistryKey}function Ir(t){return!function(t){if(null===t||"object"!=typeof t)return!1;const e=Tr(t);return!(!e||"Object"===e)}(t)&&(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||t instanceof Error||Sr(t)||k(t)||ArrayBuffer.isView(t)||t instanceof ImageData)}function Pr(t,e){if(Ir(t))return(Sr(t)||k(t))&&e&&e.push(t),ArrayBuffer.isView(t)&&e&&e.push(t.buffer),t instanceof ImageData&&e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(Pr(n,e));return i}if("object"!=typeof t)throw new Error("can't serialize object of type "+typeof t);const i=Tr(t);if(!i)throw new Error(`can't serialize object of unregistered class ${t.constructor.name}`);if(!br[i])throw new Error(`${i} is not registered.`);const{klass:n}=br[i],r=n.serialize?n.serialize(t,e):{};if(n.serialize){if(e&&r===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const n in t){if(!t.hasOwnProperty(n))continue;if(br[i].omit.indexOf(n)>=0)continue;const o=t[n];r[n]=br[i].shallow.indexOf(n)>=0?o:Pr(o,e)}t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}function kr(t){if(Ir(t))return t;if(Array.isArray(t))return t.map(kr);if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);const e=Tr(t)||"Object";if(!br[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=br[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const i of Object.keys(t)){if("$name"===i)continue;const r=t[i];n[i]=br[e].shallow.indexOf(i)>=0?r:kr(r)}return n}class Cr{constructor(){this.first=!0}update(t,e){const i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))}}const Ar={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Er(t){for(const e of t)if(Dr(e.charCodeAt(0)))return!0;return!1}function Mr(t){for(const e of t)if(!zr(e.charCodeAt(0)))return!1;return!0}function zr(t){return!(Ar.Arabic(t)||Ar["Arabic Supplement"](t)||Ar["Arabic Extended-A"](t)||Ar["Arabic Presentation Forms-A"](t)||Ar["Arabic Presentation Forms-B"](t))}function Dr(t){return!(746!==t&&747!==t&&(t<4352||!(Ar["Bopomofo Extended"](t)||Ar.Bopomofo(t)||Ar["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ar["CJK Compatibility Ideographs"](t)||Ar["CJK Compatibility"](t)||Ar["CJK Radicals Supplement"](t)||Ar["CJK Strokes"](t)||!(!Ar["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ar["CJK Unified Ideographs Extension A"](t)||Ar["CJK Unified Ideographs"](t)||Ar["Enclosed CJK Letters and Months"](t)||Ar["Hangul Compatibility Jamo"](t)||Ar["Hangul Jamo Extended-A"](t)||Ar["Hangul Jamo Extended-B"](t)||Ar["Hangul Jamo"](t)||Ar["Hangul Syllables"](t)||Ar.Hiragana(t)||Ar["Ideographic Description Characters"](t)||Ar.Kanbun(t)||Ar["Kangxi Radicals"](t)||Ar["Katakana Phonetic Extensions"](t)||Ar.Katakana(t)&&12540!==t||!(!Ar["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ar["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ar["Unified Canadian Aboriginal Syllabics"](t)||Ar["Unified Canadian Aboriginal Syllabics Extended"](t)||Ar["Vertical Forms"](t)||Ar["Yijing Hexagram Symbols"](t)||Ar["Yi Syllables"](t)||Ar["Yi Radicals"](t))))}function Lr(t){return!(Dr(t)||function(t){return!!(Ar["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Ar["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Ar["Letterlike Symbols"](t)||Ar["Number Forms"](t)||Ar["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ar["Control Pictures"](t)&&9251!==t||Ar["Optical Character Recognition"](t)||Ar["Enclosed Alphanumerics"](t)||Ar["Geometric Shapes"](t)||Ar["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ar["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ar["CJK Symbols and Punctuation"](t)||Ar.Katakana(t)||Ar["Private Use Area"](t)||Ar["CJK Compatibility Forms"](t)||Ar["Small Form Variants"](t)||Ar["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Rr(t){return t>=1424&&t<=2303||Ar["Arabic Presentation Forms-A"](t)||Ar["Arabic Presentation Forms-B"](t)}function Br(t,e){return!(!e&&Rr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ar.Khmer(t))}function Fr(t){for(const e of t)if(Rr(e.charCodeAt(0)))return!0;return!1}const Or=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(t){this.pluginStatus=t.pluginStatus,this.pluginURL=t.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(t){this.applyArabicShaping=t.applyArabicShaping,this.processBidirectionalText=t.processBidirectionalText,this.processStyledBidirectionalText=t.processStyledBidirectionalText}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class jr{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cr,this.transition={})}isSupportedScript(t){return function(t,e){for(const i of t)if(!Br(i.charCodeAt(0),e))return!1;return!0}(t,"loaded"===Or.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}}}class Nr{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(hn(t))return new In(t,e);if(xn(t)){const i=Tn(t,e);if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return i.value}{let i=t;return"color"===e.type&&"string"==typeof t?i=Kt.parse(t):"padding"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===e.type&&Array.isArray(t)&&(i=Qt.parse(t)):i=Jt.parse(t),{kind:"constant",evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class Vr{constructor(t){this.property=t,this.value=new Nr(t,void 0)}transitioned(t,e){return new Ur(this.property,this.value,e,y({},t.transition,this.transition),t.now)}untransitioned(){return new Ur(this.property,this.value,null,{},0)}}class $r{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return b(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Vr(this._values[t].property)),this._values[t].value=new Nr(this._values[t].property,null===e?void 0:b(e))}getTransition(t){return b(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Vr(this._values[t].property)),this._values[t].transition=b(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n)}return t}transitioned(t,e){const i=new qr(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(t,e._values[n]);return i}untransitioned(){const t=new qr(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class Ur{constructor(t,e,i,n,r){this.property=t,this.value=e,this.begin=r+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const n=t.now||0,r=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),r,function(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}(s))}}return r}}class qr{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const n=new Kr(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Zr{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return void 0!==this._values[t].value}getValue(t){return b(this._values[t].value)}setValue(t,e){this._values[t]=new Nr(this._values[t].property,null===e?void 0:b(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const n=new Kr(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}}class Gr{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,n){return this.property.evaluate(this.value,this.parameters,t,e,i,n)}}class Kr{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Hr{constructor(t){this.specification=t}possiblyEvaluate(t,e){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(e)}interpolate(t,e,i){const n=Ee[this.specification.type];return n?n(t,e,i):t}}class Wr{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,n){return new Gr(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,n)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Gr(this,{kind:"constant",value:void 0},t.parameters);const n=Ee[this.specification.type];if(n){const r=n(t.value.value,e.value.value,i);return new Gr(this,{kind:"constant",value:r},t.parameters)}return t}evaluate(t,e,i,n,r,o){return"constant"===t.kind?t.value:t.evaluate(e,i,n,r,o)}}class Xr extends Wr{possiblyEvaluate(t,e,i,n){if(void 0===t.value)return new Gr(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},i,n),o="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,s=this._calculate(o,o,o,e);return new Gr(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Gr(this,{kind:"constant",value:i},e)}return new Gr(this,t.expression,e)}evaluate(t,e,i,n,r,o){if("source"===t.kind){const s=t.evaluate(e,i,n,r,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,n),t.evaluate({zoom:Math.floor(e.zoom)},i,n),t.evaluate({zoom:Math.floor(e.zoom)+1},i,n),e):t.value}_calculate(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class Jr{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},i,n);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new jr(Math.floor(e.zoom-1),e)),t.expression.evaluate(new jr(Math.floor(e.zoom),e)),t.expression.evaluate(new jr(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class Yr{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){return!!t.expression.evaluate(e,null,{},i,n)}interpolate(){return!1}}class Qr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const i=t[e];i.specification.overridable&&this.overridableProperties.push(e);const n=this.defaultPropertyValues[e]=new Nr(i,void 0),r=this.defaultTransitionablePropertyValues[e]=new Vr(i);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}}}wr("DataDrivenProperty",Wr),wr("DataConstantProperty",Hr),wr("CrossFadedDataDrivenProperty",Xr),wr("CrossFadedProperty",Jr),wr("ColorRampProperty",Yr);const to="-transition";class eo extends Z{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new Zr(e.layout)),e.paint)){this._transitionablePaint=new $r(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Kr(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(_r,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith(to)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(yr,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(t.endsWith(to))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;{const i=this._transitionablePaint._values[t],n="cross-faded-data-driven"===i.property.specification["property-type"],r=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||r||n||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),x(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,i,n,r={}){return(!r||!1!==r.validate)&&vr(this,t.call(fr,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:G,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Gr&&an(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const io={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class no{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ro{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function oo(t,e=1){let i=0,n=0;return{members:t.map((t=>{const r=io[t.type].BYTES_PER_ELEMENT,o=i=so(i,Math.max(e,r)),s=t.components||1;return n=Math.max(n,r),i+=r*s,{name:t.name,type:t.type,components:s,offset:o}})),size:so(i,Math.max(n,e)),alignment:e}}function so(t,e){return Math.ceil(t/e)*e}class ao extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=i,t}}ao.prototype.bytesPerElement=4,wr("StructArrayLayout2i4",ao);class lo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=i,this.int16[r+2]=n,t}}lo.prototype.bytesPerElement=6,wr("StructArrayLayout3i6",lo);class co extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,t}}co.prototype.bytesPerElement=8,wr("StructArrayLayout4i8",co);class uo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,t}}uo.prototype.bytesPerElement=12,wr("StructArrayLayout2i4i12",uo);class ho extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=4*t,l=8*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.uint8[l+4]=n,this.uint8[l+5]=r,this.uint8[l+6]=o,this.uint8[l+7]=s,t}}ho.prototype.bytesPerElement=8,wr("StructArrayLayout2i4ub8",ho);class po extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=i,t}}po.prototype.bytesPerElement=8,wr("StructArrayLayout2f8",po);class fo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,n,r,o,s,a,l,c)}emplace(t,e,i,n,r,o,s,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}fo.prototype.bytesPerElement=20,wr("StructArrayLayout10ui20",fo);class mo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,n,r,o,s,a,l,c,u,h)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}mo.prototype.bytesPerElement=24,wr("StructArrayLayout4i4ui4i24",mo);class go extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,t}}go.prototype.bytesPerElement=12,wr("StructArrayLayout3f12",go);class yo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}yo.prototype.bytesPerElement=4,wr("StructArrayLayout1ul4",yo);class _o extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,i,n,r,o,s,a,l)}emplace(t,e,i,n,r,o,s,a,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=i,this.int16[u+2]=n,this.int16[u+3]=r,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}_o.prototype.bytesPerElement=20,wr("StructArrayLayout6i1ul2ui20",_o);class vo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,t}}vo.prototype.bytesPerElement=12,wr("StructArrayLayout2i2i2i12",vo);class xo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r)}emplace(t,e,i,n,r,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.int16[a+6]=r,this.int16[a+7]=o,t}}xo.prototype.bytesPerElement=16,wr("StructArrayLayout2f1f2i16",xo);class bo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=16*t,l=4*t,c=8*t;return this.uint8[a+0]=e,this.uint8[a+1]=i,this.float32[l+1]=n,this.float32[l+2]=r,this.int16[c+6]=o,this.int16[c+7]=s,t}}bo.prototype.bytesPerElement=16,wr("StructArrayLayout2ub2f2i16",bo);class wo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,this.uint16[r+2]=n,t}}wo.prototype.bytesPerElement=6,wr("StructArrayLayout3ui6",wo);class So extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=24*t,v=12*t,x=48*t;return this.int16[_+0]=e,this.int16[_+1]=i,this.uint16[_+2]=n,this.uint16[_+3]=r,this.uint32[v+2]=o,this.uint32[v+3]=s,this.uint32[v+4]=a,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[v+7]=h,this.float32[v+8]=d,this.uint8[x+36]=p,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[v+10]=g,this.int16[_+22]=y,t}}So.prototype.bytesPerElement=48,wr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",So);class To extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,T,I,P,k){const C=this.length;return this.resize(C+1),this.emplace(C,t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,T,I,P,k)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,T,I,P,k,C){const A=32*t,E=16*t;return this.int16[A+0]=e,this.int16[A+1]=i,this.int16[A+2]=n,this.int16[A+3]=r,this.int16[A+4]=o,this.int16[A+5]=s,this.int16[A+6]=a,this.int16[A+7]=l,this.uint16[A+8]=c,this.uint16[A+9]=u,this.uint16[A+10]=h,this.uint16[A+11]=d,this.uint16[A+12]=p,this.uint16[A+13]=f,this.uint16[A+14]=m,this.uint16[A+15]=g,this.uint16[A+16]=y,this.uint16[A+17]=_,this.uint16[A+18]=v,this.uint16[A+19]=x,this.uint16[A+20]=b,this.uint16[A+21]=w,this.uint16[A+22]=S,this.uint32[E+12]=T,this.float32[E+13]=I,this.float32[E+14]=P,this.uint16[A+30]=k,this.uint16[A+31]=C,t}}To.prototype.bytesPerElement=64,wr("StructArrayLayout8i15ui1ul2f2ui64",To);class Io extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Io.prototype.bytesPerElement=4,wr("StructArrayLayout1f4",Io);class Po extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.uint16[6*t+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,t}}Po.prototype.bytesPerElement=12,wr("StructArrayLayout1ui2f12",Po);class ko extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=4*t;return this.uint32[2*t+0]=e,this.uint16[r+2]=i,this.uint16[r+3]=n,t}}ko.prototype.bytesPerElement=8,wr("StructArrayLayout1ul2ui8",ko);class Co extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,t}}Co.prototype.bytesPerElement=4,wr("StructArrayLayout2ui4",Co);class Ao extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Ao.prototype.bytesPerElement=2,wr("StructArrayLayout1ui2",Ao);class Eo extends ro{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,t}}Eo.prototype.bytesPerElement=16,wr("StructArrayLayout4f16",Eo);class Mo extends no{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new o(this.anchorPointX,this.anchorPointY)}}Mo.prototype.size=20;class zo extends _o{get(t){return new Mo(this,t)}}wr("CollisionBoxArray",zo);class Do extends no{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Do.prototype.size=48;class Lo extends So{get(t){return new Do(this,t)}}wr("PlacedSymbolArray",Lo);class Ro extends no{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ro.prototype.size=64;class Bo extends To{get(t){return new Ro(this,t)}}wr("SymbolInstanceArray",Bo);class Fo extends Io{getoffsetX(t){return this.float32[1*t+0]}}wr("GlyphOffsetArray",Fo);class Oo extends lo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}wr("SymbolLineVertexArray",Oo);class jo extends no{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}jo.prototype.size=12;class No extends Po{get(t){return new jo(this,t)}}wr("TextAnchorOffsetArray",No);class Vo extends no{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Vo.prototype.size=8;class $o extends ko{get(t){return new Vo(this,t)}}wr("FeatureIndexArray",$o);class Uo extends ao{}class qo extends ao{}class Zo extends ao{}class Go extends uo{}class Ko extends ho{}class Ho extends po{}class Wo extends fo{}class Xo extends mo{}class Jo extends go{}class Yo extends yo{}class Qo extends vo{}class ts extends bo{}class es extends wo{}class is extends Co{}const ns=oo([{name:"a_pos",components:2,type:"Int16"}],4),{members:rs}=ns;class os{constructor(t=[]){this.segments=t}prepareSegment(t,e,i,n){let r=this.segments[this.segments.length-1];return t>os.MAX_VERTEX_ARRAY_LENGTH&&S(`Max vertices per segment is ${os.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>os.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,n){return new os([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}function ss(t,e){return 256*(t=m(Math.floor(t),0,255))+m(Math.floor(e),0,255)}os.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wr("SegmentVector",os);const as=oo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ls={exports:{}},cs={exports:{}};cs.exports=function(t,e){var i,n,r,o,s,a,l,c;for(n=t.length-(i=3&t.length),r=e,s=3432918353,a=461845907,c=0;c<n;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0};var us=cs.exports,hs={exports:{}};hs.exports=function(t,e){for(var i,n=t.length,r=e^n,o=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&t.charCodeAt(o+2))<<16;case 2:r^=(255&t.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0};var ds=us,ps=hs.exports;ls.exports=ds,ls.exports.murmur3=ds,ls.exports.murmur2=ps;var fs=i(ls.exports);class ms{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,n){this.ids.push(gs(t)),this.positions.push(e,i,n)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const e=gs(t);let i=0,n=this.ids.length-1;for(;i<n;){const t=i+n>>1;this.ids[t]>=e?n=t:i=t+1}const r=[];for(;this.ids[i]===e;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(t,e){const i=new Float64Array(t.ids),n=new Uint32Array(t.positions);return ys(i,n,0,i.length-1),e&&e.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(t){const e=new ms;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function gs(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:fs(String(t))}function ys(t,e,i,n){for(;i<n;){const r=t[i+n>>1];let o=i-1,s=n+1;for(;;){do{o++}while(t[o]<r);do{s--}while(t[s]>r);if(o>=s)break;_s(t,o,s),_s(e,3*o,3*s),_s(e,3*o+1,3*s+1),_s(e,3*o+2,3*s+2)}s-i<n-s?(ys(t,e,i,s),i=s+1):(ys(t,e,s+1,n),n=s)}}function _s(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}wr("FeaturePositionMap",ms);class vs{constructor(t,e){this.gl=t.gl,this.location=e}}class xs extends vs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class bs extends vs{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ws extends vs{constructor(t,e){super(t,e),this.current=Kt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ss=new Float32Array(16);function Ts(t){return[ss(255*t.r,255*t.g),ss(255*t.b,255*t.a)]}class Is{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i){t.set(i.constantOr(this.value))}getBinding(t,e,i){return"color"===this.type?new ws(t,e):new xs(t,e)}}class Ps{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,i,n){const r="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,i){return"u_pattern"===i.substr(0,9)?new bs(t,e):new xs(t,e)}}class ks{constructor(t,e,i,n){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(t,e,i,n,r){const o=this.paintVertexArray.length,s=this.expression.evaluate(new jr(0),e,{},n,[],r);this.paintVertexArray.resize(t),this._setPaintValue(o,t,s)}updatePaintArray(t,e,i,n){const r=this.expression.evaluate({zoom:0},i,n);this._setPaintValue(t,e,r)}_setPaintValue(t,e,i){if("color"===this.type){const n=Ts(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cs{constructor(t,e,i,n,r,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,n,r){const o=this.expression.evaluate(new jr(this.zoom),e,{},n,[],r),s=this.expression.evaluate(new jr(this.zoom+1),e,{},n,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,o,s)}updatePaintArray(t,e,i,n){const r=this.expression.evaluate({zoom:this.zoom},i,n),o=this.expression.evaluate({zoom:this.zoom+1},i,n);this._setPaintValue(t,e,r,o)}_setPaintValue(t,e,i,n){if("color"===this.type){const r=Ts(i),o=Ts(n);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=m(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(n)}getBinding(t,e,i){return new xs(t,e)}}class As{constructor(t,e,i,n,r,o){this.expression=t,this.type=e,this.useIntegerZoom=i,this.zoom=n,this.layerId=o,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(t,e,i){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,n,r){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],r)}_setPaintValues(t,e,i,n){if(!n||!i)return;const{min:r,mid:o,max:s}=i,a=n[r],l=n[o],c=n[s];if(a&&l&&c)for(let i=t;i<e;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,as.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,as.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Es{constructor(t,e,i){this.binders={},this._buffers=[];const n=[];for(const r in t.paint._values){if(!i(r))continue;const o=t.paint.get(r);if(!(o instanceof Gr&&an(o.property.specification)))continue;const s=zs(r,t.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[r]=h?new Ps(a.value,s):new Is(a.value,s,l),n.push(`/u_${r}`);else if("source"===a.kind||h){const i=Ds(r,l,"source");this.binders[r]=h?new As(a,l,c,e,i,t.id):new ks(a,s,l,i),n.push(`/a_${r}`)}else{const t=Ds(r,l,"composite");this.binders[r]=new Cs(a,s,l,c,e,t),n.push(`/z_${r}`)}}this.cacheKey=n.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof ks||e instanceof Cs?e.maxValue:0}populatePaintArrays(t,e,i,n,r){for(const o in this.binders){const s=this.binders[o];(s instanceof ks||s instanceof Cs||s instanceof As)&&s.populatePaintArray(t,e,i,n,r)}}setConstantPatternPositions(t,e){for(const i in this.binders){const n=this.binders[i];n instanceof Ps&&n.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,i,n,r){let o=!1;for(const s in t){const a=e.getPositions(s);for(const e of a){const a=i.feature(e.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof ks||l instanceof Cs||l instanceof As)&&!0===l.expression.isStateDependent){const c=n.paint.get(i);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[s],r),o=!0}}}}return o}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Is||i instanceof Ps)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof ks||i instanceof Cs)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name);else if(i instanceof As)for(let e=0;e<as.members.length;e++)t.push(as.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Is||i instanceof Ps||i instanceof Cs)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const i=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof Is||r instanceof Ps||r instanceof Cs)for(const o of r.uniformNames)if(e[o]){const s=r.getBinding(t,e[o],o);i.push({name:o,property:n,binding:s})}}return i}setUniforms(t,e,i,n){for(const{name:t,property:r,binding:o}of e)this.binders[r].setUniform(o,n,i.get(r),t)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const i=this.binders[e];if(t&&i instanceof As){const e=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(i instanceof ks||i instanceof Cs)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof ks||i instanceof Cs||i instanceof As)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof ks||e instanceof Cs||e instanceof As)&&e.destroy()}}}class Ms{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new Es(n,e,i);this.needsUpload=!1,this._featureMap=new ms,this._bufferOffset=0}populatePaintArrays(t,e,i,n,r,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,n,r,o);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,n){for(const r of i)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,n)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function zs(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}function Ds(t,e,i){const n={color:{source:po,composite:Eo},number:{source:Io,composite:po}},r=function(t){return{"line-pattern":{source:Wo,composite:Wo},"fill-pattern":{source:Wo,composite:Wo},"fill-extrusion-pattern":{source:Wo,composite:Wo}}[t]}(t);return r&&r[i]||n[e][i]}wr("ConstantBinder",Is),wr("CrossFadedConstantBinder",Ps),wr("SourceExpressionBinder",ks),wr("CrossFadedCompositeBinder",As),wr("CompositeExpressionBinder",Cs),wr("ProgramConfiguration",Es,{omit:["_buffers"]}),wr("ProgramConfigurationSet",Ms);const Ls=8192,Rs=Math.pow(2,14)-1,Bs=-Rs-1;function Fs(t){const e=Ls/t.extent,i=t.loadGeometry();for(let t=0;t<i.length;t++){const n=i[t];for(let t=0;t<n.length;t++){const i=n[t],r=Math.round(i.x*e),o=Math.round(i.y*e);i.x=m(r,Bs,Rs),i.y=m(o,Bs,Rs),(r<i.x||r>i.x+1||o<i.y||o>i.y+1)&&S("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Os(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Fs(t):[]}}function js(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}class Ns{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new qo,this.indexArray=new es,this.segments=new os,this.programConfigurations=new Ms(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){const n=this.layers[0],r=[];let o=null,s=!1;"circle"===n.type&&(o=n.layout.get("circle-sort-key"),s=!o.isConstant());for(const{feature:e,id:n,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Os(e,t);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom),c,i))continue;const u=s?o.evaluate(c,{},i):void 0,h={id:n,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Fs(e),patterns:{},sortKey:u};r.push(h)}s&&r.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of r){const{geometry:r,index:o,sourceLayerIndex:s}=n,a=t[o].feature;this.addFeature(n,r,o,i),e.featureIndex.insert(a,r,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,n){for(const i of e)for(const e of i){const i=e.x,n=e.y;if(i<0||i>=Ls||n<0||n>=Ls)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),o=r.vertexLength;js(this.layoutVertexArray,i,n,-1,-1),js(this.layoutVertexArray,i,n,1,-1),js(this.layoutVertexArray,i,n,1,1),js(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),r.vertexLength+=4,r.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},n)}}function Vs(t,e){for(let i=0;i<t.length;i++)if(Xs(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Xs(t,e[i]))return!0;return!!Zs(t,e)}function $s(t,e,i){return!!Xs(t,e)||!!Ks(e,t,i)}function Us(t,e){if(1===t.length)return Ws(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++)if(Xs(t,n[e]))return!0}for(let i=0;i<t.length;i++)if(Ws(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Zs(t,e[i]))return!0;return!1}function qs(t,e,i){if(t.length>1){if(Zs(t,e))return!0;for(let n=0;n<e.length;n++)if(Ks(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(Ks(t[n],e,i))return!0;return!1}function Zs(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1];for(let t=0;t<e.length-1;t++)if(Gs(n,r,e[t],e[t+1]))return!0}return!1}function Gs(t,e,i,n){return T(t,i,n)!==T(e,i,n)&&T(t,e,i)!==T(t,e,n)}function Ks(t,e,i){const n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(Hs(t,e[i-1],e[i])<n)return!0;return!1}function Hs(t,e,i){const n=e.distSqr(i);if(0===n)return t.distSqr(e);const r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(r<0?e:r>1?i:i.sub(e)._mult(r)._add(e))}function Ws(t,e){let i,n,r,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)n=i[t],r=i[s],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(o=!o)}return o}function Xs(t,e){let i=!1;for(let n=0,r=t.length-1;n<t.length;r=n++){const o=t[n],s=t[r];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function Js(t,e,i){const n=i[0],r=i[2];if(t.x<n.x&&e.x<n.x||t.x>r.x&&e.x>r.x||t.y<n.y&&e.y<n.y||t.y>r.y&&e.y>r.y)return!1;const o=T(t,e,i[0]);return o!==T(t,e,i[1])||o!==T(t,e,i[2])||o!==T(t,e,i[3])}function Ys(t,e,i){const n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Qs(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ta(t,e,i,n,r){if(!e[0]&&!e[1])return t;const s=o.convert(e)._mult(r);"viewport"===i&&s._rotate(-n);const a=[];for(let e=0;e<t.length;e++)a.push(t[e].sub(s));return a}let ea,ia;wr("CircleBucket",Ns,{omit:["layers"]});var na={get paint(){return ia=ia||new Qr({"circle-radius":new Wr(G.paint_circle["circle-radius"]),"circle-color":new Wr(G.paint_circle["circle-color"]),"circle-blur":new Wr(G.paint_circle["circle-blur"]),"circle-opacity":new Wr(G.paint_circle["circle-opacity"]),"circle-translate":new Hr(G.paint_circle["circle-translate"]),"circle-translate-anchor":new Hr(G.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Hr(G.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Hr(G.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wr(G.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wr(G.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wr(G.paint_circle["circle-stroke-opacity"])})},get layout(){return ea=ea||new Qr({"circle-sort-key":new Wr(G.layout_circle["circle-sort-key"])})}},ra=1e-6,oa="undefined"!=typeof Float32Array?Float32Array:Array;function sa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function aa(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*n+x*a+b*h+w*m,t[1]=v*r+x*l+b*d+w*g,t[2]=v*o+x*c+b*p+w*y,t[3]=v*s+x*u+b*f+w*_,t[4]=(v=i[4])*n+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,t[5]=v*r+x*l+b*d+w*g,t[6]=v*o+x*c+b*p+w*y,t[7]=v*s+x*u+b*f+w*_,t[8]=(v=i[8])*n+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,t[9]=v*r+x*l+b*d+w*g,t[10]=v*o+x*c+b*p+w*y,t[11]=v*s+x*u+b*f+w*_,t[12]=(v=i[12])*n+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,t[13]=v*r+x*l+b*d+w*g,t[14]=v*o+x*c+b*p+w*y,t[15]=v*s+x*u+b*f+w*_,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var la,ca=aa;function ua(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,t}la=new oa(4),oa!=Float32Array&&(la[0]=0,la[1]=0,la[2]=0,la[3]=0);class ha extends eo{constructor(t){super(t,na)}createBucket(t){return new Ns(t)}queryRadius(t){const e=t;return Ys("circle-radius",this,e)+Ys("circle-stroke-width",this,e)+Qs(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,r,o,s,a){const l=ta(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,s),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e){return t.map((t=>da(t,e)))}(l,a),d=u?c*s:c;for(const t of n)for(const e of t){const t=u?e:da(e,a);let i=d;const n=ua([],[e.x,e.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=n[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=o.cameraToCenterDistance/n[3]),$s(h,t,i))return!0}return!1}}function da(t,e){const i=ua([],[t.x,t.y,0,1],e);return new o(i[0]/i[3],i[1]/i[3])}class pa extends Ns{}let fa;wr("HeatmapBucket",pa,{omit:["layers"]});var ma={get paint(){return fa=fa||new Qr({"heatmap-radius":new Wr(G.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wr(G.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Hr(G.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yr(G.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Hr(G.paint_heatmap["heatmap-opacity"])})}};function ga(t,{width:e,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*i*n)throw new RangeError(`mismatched image size. expected: ${r.length} but got: ${e*i*n}`)}else r=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=r,t}function ya(t,{width:e,height:i},n){if(e===t.width&&i===t.height)return;const r=ga({},{width:e,height:i},n);_a(t,r,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},n),t.width=e,t.height=i,t.data=r.data}function _a(t,e,i,n,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<r.height;l++){const c=((i.y+l)*t.width+i.x)*o,u=((n.y+l)*e.width+n.x)*o;for(let t=0;t<r.width*o;t++)a[u+t]=s[c+t]}return e}class va{constructor(t,e){ga(this,t,1,e)}resize(t){ya(this,t,1)}clone(){return new va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){_a(t,e,i,n,r,1)}}class xa{constructor(t,e){ga(this,t,4,e)}resize(t){ya(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new xa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){_a(t,e,i,n,r,4)}}function ba(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,r=t.image||new xa({width:i,height:n});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const o=(i,n,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);r.data[i+n+0]=Math.floor(255*s.r/s.a),r.data[i+n+1]=Math.floor(255*s.g/s.a),r.data[i+n+2]=Math.floor(255*s.b/s.a),r.data[i+n+3]=Math.floor(255*s.a)};if(t.clips)for(let e=0,r=0;e<n;++e,r+=4*i)for(let n=0,s=0;n<i;n++,s+=4){const a=n/(i-1),{start:l,end:c}=t.clips[e];o(r,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return r}wr("AlphaImage",va),wr("RGBAImage",xa);class wa extends eo{createBucket(t){return new pa(t)}constructor(t){super(t,ma),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ba({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let Sa;var Ta={get paint(){return Sa=Sa||new Qr({"hillshade-illumination-direction":new Hr(G.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Hr(G.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Hr(G.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Hr(G.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Hr(G.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Hr(G.paint_hillshade["hillshade-accent-color"])})}};class Ia extends eo{constructor(t){super(t,Ta)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const Pa=oo([{name:"a_pos",components:2,type:"Int16"}],4),{members:ka}=Pa;var Ca={exports:{}};function Aa(t,e,i){i=i||2;var n,r,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,d=Ea(t,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,n){var r,o,s,a=[];for(r=0,o=e.length;r<o;r++)(s=Ea(t,e[r]*n,r<o-1?e[r+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(Va(s));for(a.sort(Fa),r=0;r<a.length;r++)i=Oa(a[r],i);return i}(t,e,d,i)),t.length>80*i){n=o=t[0],r=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<n&&(n=a),(l=t[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-r))?32767/c:0}return za(d,p,i,n,r,c,0),p}function Ea(t,e,i,n,r){var o,s;if(r===tl(t,e,i,n)>0)for(o=e;o<i;o+=n)s=Ja(o,t[o],t[o+1],s);else for(o=i-n;o>=e;o-=n)s=Ja(o,t[o],t[o+1],s);return s&&Za(s,s.next)&&(Ya(s),s=s.next),s}function Ma(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!Za(n,n.next)&&0!==qa(n.prev,n,n.next))n=n.next;else{if(Ya(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function za(t,e,i,n,r,o,s){if(t){!s&&o&&function(t,e,i,n){var r=t;do{0===r.z&&(r.z=Na(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(s>1)}(r)}(t,n,r,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?La(t,n,r,o):Da(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),Ya(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?za(t=Ra(Ma(t),e,i),e,i,n,r,o,2):2===s&&Ba(t,e,i,n,r,o):za(Ma(t),e,i,n,r,o,1);break}}}function Da(t){var e=t.prev,i=t,n=t.next;if(qa(e,i,n)>=0)return!1;for(var r=e.x,o=i.x,s=n.x,a=e.y,l=i.y,c=n.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=n.next;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&$a(r,a,o,l,s,c,f.x,f.y)&&qa(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function La(t,e,i,n){var r=t.prev,o=t,s=t.next;if(qa(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,y=Na(p,f,e,i,n),_=Na(m,g,e,i,n),v=t.prevZ,x=t.nextZ;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&$a(a,u,l,h,c,d,v.x,v.y)&&qa(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&$a(a,u,l,h,c,d,x.x,x.y)&&qa(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&$a(a,u,l,h,c,d,v.x,v.y)&&qa(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&$a(a,u,l,h,c,d,x.x,x.y)&&qa(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Ra(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!Za(r,o)&&Ga(r,n,n.next,o)&&Wa(r,o)&&Wa(o,r)&&(e.push(r.i/i|0),e.push(n.i/i|0),e.push(o.i/i|0),Ya(n),Ya(n.next),n=t=o),n=n.next}while(n!==t);return Ma(n)}function Ba(t,e,i,n,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Ua(s,a)){var l=Xa(s,a);return s=Ma(s,s.next),l=Ma(l,l.next),za(s,e,i,n,r,o,0),void za(l,e,i,n,r,o,0)}a=a.next}s=s.next}while(s!==t)}function Fa(t,e){return t.x-e.x}function Oa(t,e){var i=function(t,e){var i,n=e,r=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,i=n.x<n.next.x?n:n.next,a===r))return i}n=n.next}while(n!==e);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&$a(o<h?r:s,o,u,h,o<h?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),Wa(n,t)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&ja(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(t,e);if(!i)return e;var n=Xa(i,t);return Ma(n,n.next),Ma(i,i.next)}function ja(t,e){return qa(t.prev,t,e.prev)<0&&qa(e.next,t,t.next)<0}function Na(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Va(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function $a(t,e,i,n,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(n-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(r-s)*(n-a)}function Ua(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ga(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Wa(t,e)&&Wa(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(qa(t.prev,t,e.prev)||qa(t,e.prev,e))||Za(t,e)&&qa(t.prev,t,t.next)>0&&qa(e.prev,e,e.next)>0)}function qa(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Za(t,e){return t.x===e.x&&t.y===e.y}function Ga(t,e,i,n){var r=Ha(qa(t,e,i)),o=Ha(qa(t,e,n)),s=Ha(qa(i,n,t)),a=Ha(qa(i,n,e));return r!==o&&s!==a||!(0!==r||!Ka(t,i,e))||!(0!==o||!Ka(t,n,e))||!(0!==s||!Ka(i,t,n))||!(0!==a||!Ka(i,e,n))}function Ka(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Ha(t){return t>0?1:t<0?-1:0}function Wa(t,e){return qa(t.prev,t,t.next)<0?qa(t,e,t.next)>=0&&qa(t,t.prev,e)>=0:qa(t,e,t.prev)<0||qa(t,t.next,e)<0}function Xa(t,e){var i=new Qa(t.i,t.x,t.y),n=new Qa(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Ja(t,e,i,n){var r=new Qa(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Ya(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Qa(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tl(t,e,i,n){for(var r=0,o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}Ca.exports=Aa,Ca.exports.default=Aa,Aa.deviation=function(t,e,i,n){var r=e&&e.length,o=Math.abs(tl(t,0,r?e[0]*i:t.length,i));if(r)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(tl(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));var l=0;for(s=0;s<n.length;s+=3){var c=n[s]*i,u=n[s+1]*i,h=n[s+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Aa.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[r][o][s]);r>0&&i.holes.push(n+=t[r-1].length)}return i};var el=i(Ca.exports);function il(t,e,i){const n=i.patternDependencies;let r=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);const o=e.constantOr(null);o&&(r=!0,n[o.to]=!0,n[o.from]=!0)}return r}function nl(t,e,i,n,r){const o=r.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n-1},i,{},r.availableImages),a=e.evaluate({zoom:n},i,{},r.availableImages),l=e.evaluate({zoom:n+1},i,{},r.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[t]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:t,mid:a,max:l}}}return i}class rl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Zo,this.indexArray=new es,this.indexArray2=new is,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new os,this.segments2=new os,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=il("fill",this.layers,e);const n=this.layers[0].layout.get("fill-sort-key"),r=!n.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Os(s,t);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom),u,i))continue;const h=r?n.evaluate(u,{},i,e.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Fs(s),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const t=nl("fill",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,r,o,i,{});e.featureIndex.insert(t[o].feature,r,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ka),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,n,r){for(const t of vi(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=i.vertexLength,r=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(r.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(n+e.length-1,n),r.push(e[0].x),r.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(n+t-1,n+t),r.push(e[t].x),r.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=el(r,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(n+s[t],n+s[t+1],n+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}}let ol,sl;wr("FillBucket",rl,{omit:["layers","patternFeatures"]});var al={get paint(){return sl=sl||new Qr({"fill-antialias":new Hr(G.paint_fill["fill-antialias"]),"fill-opacity":new Wr(G.paint_fill["fill-opacity"]),"fill-color":new Wr(G.paint_fill["fill-color"]),"fill-outline-color":new Wr(G.paint_fill["fill-outline-color"]),"fill-translate":new Hr(G.paint_fill["fill-translate"]),"fill-translate-anchor":new Hr(G.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xr(G.paint_fill["fill-pattern"])})},get layout(){return ol=ol||new Qr({"fill-sort-key":new Wr(G.layout_fill["fill-sort-key"])})}};class ll extends eo{constructor(t){super(t,al)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new rl(t)}queryRadius(){return Qs(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,r,o,s){return Us(ta(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,s),n)}isTileClipped(){return!0}}const cl=oo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ul=oo([{name:"a_centroid",components:2,type:"Int16"}],4),{members:hl}=cl;var dl={},pl=n,fl=ml;function ml(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(gl,this,e)}function gl(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function yl(t){for(var e,i,n=0,r=0,o=t.length,s=o-1;r<o;s=r++)n+=((i=t[s]).x-(e=t[r]).x)*(e.y+i.y);return n}ml.types=["Unknown","Point","LineString","Polygon"],ml.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,r=0,o=0,s=0,a=[];t.pos<i;){if(r<=0){var l=t.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)o+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&a.push(e),e=[]),e.push(new pl(o,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&a.push(e),a},ml.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(n<=0){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},ml.prototype.toGeoJSON=function(t,e,i){var n,r,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=ml.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],o=0;o<e;o++){var s=yl(t[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(i&&r.push(i),i=[t[o]]):i.push(t[o]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var _l=fl,vl=xl;function xl(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(bl,this,e),this.length=this._features.length}function bl(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}xl.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new _l(this._pbf,e,this.extent,this._keys,this._values)};var wl=vl;function Sl(t,e,i){if(3===t){var n=new wl(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}dl.VectorTile=function(t,e){this.layers=t.readFields(Sl,{},e)},dl.VectorTileFeature=fl,dl.VectorTileLayer=vl;const Tl=dl.VectorTileFeature.types,Il=Math.pow(2,13);function Pl(t,e,i,n,r,o,s,a){t.emplaceBack(e,i,2*Math.floor(n*Il)+s,r*Il*2,o*Il*2,Math.round(a))}class kl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Go,this.centroidVertexArray=new Uo,this.indexArray=new es,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new os,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.features=[],this.hasPattern=il("fill-extrusion",this.layers,e);for(const{feature:n,id:r,index:o,sourceLayerIndex:s}of t){const t=this.layers[0]._featureFilter.needGeometry,a=Os(n,t);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom),a,i))continue;const l={id:r,sourceLayerIndex:s,index:o,geometry:t?a.geometry:Fs(n),properties:n.properties,type:n.type,patterns:{}};this.hasPattern?this.features.push(nl("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,o,i,{}),e.featureIndex.insert(n,l.geometry,o,s,this.index,!0)}}addFeatures(t,e,i){for(const t of this.features){const{geometry:n}=t;this.addFeature(t,n,t.index,e,i)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hl),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ul.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,e,i,n,r){for(const i of vi(e,500)){const e={x:0,y:0,vertexCount:0};let n=0;for(const t of i)n+=t.length;let r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const t of i){if(0===t.length)continue;if(Al(t))continue;let i=0;for(let n=0;n<t.length;n++){const o=t[n];if(n>=1){const s=t[n-1];if(!Cl(o,s)){r.vertexLength+4>os.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=o.sub(s)._perp()._unit(),n=s.dist(o);i+n>32768&&(i=0),Pl(this.layoutVertexArray,o.x,o.y,t.x,t.y,0,0,i),Pl(this.layoutVertexArray,o.x,o.y,t.x,t.y,0,1,i),e.x+=2*o.x,e.y+=2*o.y,e.vertexCount+=2,i+=n,Pl(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,0,i),Pl(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,1,i),e.x+=2*s.x,e.y+=2*s.y,e.vertexCount+=2;const a=r.vertexLength;this.indexArray.emplaceBack(a,a+2,a+1),this.indexArray.emplaceBack(a+1,a+2,a+3),r.vertexLength+=4,r.primitiveLength+=2}}}}if(r.vertexLength+n>os.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(n,this.layoutVertexArray,this.indexArray)),"Polygon"!==Tl[t.type])continue;const o=[],s=[],a=r.vertexLength;for(const t of i)if(0!==t.length){t!==i[0]&&s.push(o.length/2);for(let i=0;i<t.length;i++){const n=t[i];Pl(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),e.x+=n.x,e.y+=n.y,e.vertexCount+=1,o.push(n.x),o.push(n.y)}}const l=el(o,s);for(let t=0;t<l.length;t+=3)this.indexArray.emplaceBack(a+l[t],a+l[t+2],a+l[t+1]);r.primitiveLength+=l.length/3,r.vertexLength+=n;for(let t=0;t<e.vertexCount;t++){const t=Math.floor(e.x/e.vertexCount),i=Math.floor(e.y/e.vertexCount);this.centroidVertexArray.emplaceBack(t,i)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}}function Cl(t,e){return t.x===e.x&&(t.x<0||t.x>Ls)||t.y===e.y&&(t.y<0||t.y>Ls)}function Al(t){return t.every((t=>t.x<0))||t.every((t=>t.x>Ls))||t.every((t=>t.y<0))||t.every((t=>t.y>Ls))}let El;wr("FillExtrusionBucket",kl,{omit:["layers","features"]});var Ml={get paint(){return El=El||new Qr({"fill-extrusion-opacity":new Hr(G["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wr(G["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Hr(G["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Hr(G["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xr(G["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wr(G["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wr(G["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Hr(G["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class zl extends eo{constructor(t){super(t,Ml)}createBucket(t){return new kl(t)}queryRadius(){return Qs(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,e,i,n,r,s,a,l){const c=ta(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,a),u=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),d=function(t,e,i,n){const r=[];for(const i of t){const t=[i.x,i.y,0,1];ua(t,t,e),r.push(new o(t[0]/t[3],t[1]/t[3]))}return r}(c,l),p=function(t,e,i,n){const r=[],s=[],a=n[8]*e,l=n[9]*e,c=n[10]*e,u=n[11]*e,h=n[8]*i,d=n[9]*i,p=n[10]*i,f=n[11]*i;for(const e of t){const t=[],i=[];for(const r of e){const e=r.x,s=r.y,m=n[0]*e+n[4]*s+n[12],g=n[1]*e+n[5]*s+n[13],y=n[2]*e+n[6]*s+n[14],_=n[3]*e+n[7]*s+n[15],v=y+c,x=_+u,b=m+h,w=g+d,S=y+p,T=_+f,I=new o((m+a)/x,(g+l)/x);I.z=v/x,t.push(I);const P=new o(b/T,w/T);P.z=S/T,i.push(P)}r.push(t),s.push(i)}return[r,s]}(n,h,u,l);return function(t,e,i){let n=1/0;Us(i,e)&&(n=Ll(i,e[0]));for(let r=0;r<e.length;r++){const o=e[r],s=t[r];for(let t=0;t<o.length-1;t++){const e=o[t],r=[e,o[t+1],s[t+1],s[t],e];Vs(i,r)&&(n=Math.min(n,Ll(i,r)))}}return n!==1/0&&n}(p[0],p[1],d)}}function Dl(t,e){return t.x*e.x+t.y*e.y}function Ll(t,e){if(1===t.length){let i=0;const n=e[i++];let r;for(;!r||n.equals(r);)if(r=e[i++],!r)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=r.sub(n),l=o.sub(n),c=s.sub(n),u=Dl(a,a),h=Dl(a,l),d=Dl(l,l),p=Dl(c,a),f=Dl(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=n.z*(1-g-y)+r.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}const Rl=oo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Bl}=Rl,Fl=oo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ol}=Fl,jl=dl.VectorTileFeature.types,Nl=Math.cos(Math.PI/180*37.5),Vl=Math.pow(2,14)/.5;class $l{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new Ko,this.layoutVertexArray2=new Ho,this.indexArray=new es,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new os,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=il("line",this.layers,e);const n=this.layers[0].layout.get("line-sort-key"),r=!n.isConstant(),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Os(e,t);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom),c,i))continue;const u=r?n.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Fs(e),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const t=nl("line",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,r,o,i,{});e.featureIndex.insert(t[o].feature,r,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ol)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,n,r){const o=this.layers[0].layout,s=o.get("line-join").evaluate(t,{}),a=o.get("line-cap"),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,s,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}addLine(t,e,i,n,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===jl[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?15*Ls/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(p=e===a-1?s?t[l+1]:void 0:t[e+1],p&&t[e].equals(p))continue;m&&(f=m),h&&(d=h),h=t[e],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const y=f.x*m.x+f.y*m.y,_=g.x*m.x+g.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Nl&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&e>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const S=d&&p;let T=S?i:s?"butt":n;if(S&&"round"===T&&(v<o?T="miter":v<=2&&(T="fakeround")),"miter"===T&&v>r&&(T="bevel"),"bevel"===T&&(v>2&&(T="flipbevel"),v<r&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)g._mult(v),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===T){if(v>100)g=m.mult(-1);else{const t=v*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const t=-Math.sqrt(v*v-1),e=w?t:0,i=w?0:t;if(d&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===T){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*t*t+(.848013+y*(.215638*y-1.06021)))}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-e,-i,u)}else if("butt"===T)this.addCurrentVertex(h,g,0,0,u);else if("square"===T){const t=d?1:-1;this.addCurrentVertex(h,g,t,t,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&e<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,i,n,r,o=!1){const s=e.y*n-e.x,a=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,r),this.addHalfVertex(t,s,a,o,!0,-n,r),this.distance>Vl/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,i,n,r,o))}addHalfVertex({x:t,y:e},i,n,r,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(Vl-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}let Ul,ql;wr("LineBucket",$l,{omit:["layers","patternFeatures"]});var Zl={get paint(){return ql=ql||new Qr({"line-opacity":new Wr(G.paint_line["line-opacity"]),"line-color":new Wr(G.paint_line["line-color"]),"line-translate":new Hr(G.paint_line["line-translate"]),"line-translate-anchor":new Hr(G.paint_line["line-translate-anchor"]),"line-width":new Wr(G.paint_line["line-width"]),"line-gap-width":new Wr(G.paint_line["line-gap-width"]),"line-offset":new Wr(G.paint_line["line-offset"]),"line-blur":new Wr(G.paint_line["line-blur"]),"line-dasharray":new Jr(G.paint_line["line-dasharray"]),"line-pattern":new Xr(G.paint_line["line-pattern"]),"line-gradient":new Yr(G.paint_line["line-gradient"])})},get layout(){return Ul=Ul||new Qr({"line-cap":new Hr(G.layout_line["line-cap"]),"line-join":new Wr(G.layout_line["line-join"]),"line-miter-limit":new Hr(G.layout_line["line-miter-limit"]),"line-round-limit":new Hr(G.layout_line["line-round-limit"]),"line-sort-key":new Wr(G.layout_line["line-sort-key"])})}};class Gl extends Wr{possiblyEvaluate(t,e){return e=new jr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=y({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}let Kl;class Hl extends eo{constructor(t){super(t,Zl),this.gradientVersion=0,Kl||(Kl=new Gl(Zl.paint.properties["line-width"].specification),Kl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this.gradientExpression();this.stepInterpolant=!!function(t){return void 0!==t._styleExpression}(t)&&t._styleExpression.expression instanceof Se,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Kl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new $l(t)}queryRadius(t){const e=t,i=Wl(Ys("line-width",this,e),Ys("line-gap-width",this,e)),n=Ys("line-offset",this,e);return i/2+Math.abs(n)+Qs(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,r,s,a){const l=ta(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,a),c=a/2*Wl(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),u=this.paint.get("line-offset").evaluate(e,i);return u&&(n=function(t,e){const i=[];for(let n=0;n<t.length;n++){const r=t[n],s=[];for(let t=0;t<r.length;t++){const i=r[t-1],n=r[t],a=r[t+1],l=0===t?new o(0,0):n.sub(i)._unit()._perp(),c=t===r.length-1?new o(0,0):a.sub(n)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),s.push(u._mult(e)._add(n))}i.push(s)}return i}(n,u*a)),function(t,e,i){for(let n=0;n<e.length;n++){const r=e[n];if(t.length>=3)for(let e=0;e<r.length;e++)if(Xs(t,r[e]))return!0;if(qs(t,r,i))return!0}return!1}(l,n,c)}isTileClipped(){return!0}}function Wl(t,e){return e>0?e+2*t:t}const Xl=oo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Jl=oo([{name:"a_projected_pos",components:3,type:"Float32"}],4);oo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Yl=oo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);oo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ql=oo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tc=oo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ec(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const n=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Or.applyArabicShaping&&(t=Or.applyArabicShaping(t)),t}(t.text,e,i)})),t}oo([{name:"triangle",components:3,type:"Uint16"}]),oo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),oo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),oo([{type:"Float32",name:"offsetX"}]),oo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),oo([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ic={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var nc=24,rc=ac,oc=function(t,e,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},sc=function(t,e,i,n,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[i+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*m};function ac(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ac.Varint=0,ac.Fixed64=1,ac.Bytes=2,ac.Fixed32=5;var lc=4294967296,cc=1/lc,uc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function hc(t){return t.type===ac.Bytes?t.readVarint()+t.pos:t.pos+1}function dc(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function pc(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function fc(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function mc(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function gc(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function yc(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function _c(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function vc(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function xc(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function bc(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function wc(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Sc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Tc(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Ic(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ac.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Sc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ic(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Sc(this.buf,this.pos)+Sc(this.buf,this.pos+4)*lc;return this.pos+=8,t},readSFixed64:function(){var t=Sc(this.buf,this.pos)+Ic(this.buf,this.pos+4)*lc;return this.pos+=8,t},readFloat:function(){var t=oc(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=oc(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return dc(t,n,e);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return dc(t,n,e);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return dc(t,n,e);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return dc(t,n,e);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return dc(t,n,e);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return dc(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&uc?function(t,e,i){return uc.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",r=e;r<i;){var o,s,a,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[r+2],128==(192&(o=t[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[r+2],a=t[r+3],128==(192&(o=t[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ac.Bytes)return t.push(this.readVarint(e));var i=hc(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ac.Bytes)return t.push(this.readSVarint());var e=hc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ac.Bytes)return t.push(this.readBoolean());var e=hc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ac.Bytes)return t.push(this.readFloat());var e=hc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ac.Bytes)return t.push(this.readDouble());var e=hc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ac.Bytes)return t.push(this.readFixed32());var e=hc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ac.Bytes)return t.push(this.readSFixed32());var e=hc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ac.Bytes)return t.push(this.readFixed64());var e=hc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ac.Bytes)return t.push(this.readSFixed64());var e=hc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ac.Varint)for(;this.buf[this.pos++]>127;);else if(e===ac.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ac.Fixed32)this.pos+=4;else{if(e!==ac.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Tc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Tc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Tc(this.buf,-1&t,this.pos),Tc(this.buf,Math.floor(t*cc),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Tc(this.buf,-1&t,this.pos),Tc(this.buf,Math.floor(t*cc),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&pc(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),sc(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),sc(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&pc(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,ac.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,fc,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,mc,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,_c,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,gc,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,yc,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,vc,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,xc,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,bc,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,wc,e)},writeBytesField:function(t,e){this.writeTag(t,ac.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ac.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ac.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ac.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ac.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ac.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ac.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ac.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ac.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ac.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Pc=i(rc);const kc=3;function Cc(t,e,i){1===t&&i.readMessage(Ac,e)}function Ac(t,e,i){if(3===t){const{id:t,bitmap:n,width:r,height:o,left:s,top:a,advance:l}=i.readMessage(Ec,{});e.push({id:t,bitmap:new va({width:r+2*kc,height:o+2*kc},n),metrics:{width:r,height:o,left:s,top:a,advance:l}})}}function Ec(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const Mc=kc;function zc(t){let e=0,i=0;for(const n of t)e+=n.w*n.h,i=Math.max(i,n.w);t.sort(((t,e)=>e.h-t.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let r=0,o=0;for(const e of t)for(let t=n.length-1;t>=0;t--){const i=n[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),r=Math.max(r,e.x+e.w),e.w===i.w&&e.h===i.h){const e=n.pop();t<n.length&&(n[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(n.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:r,h:o,fill:e/(r*o)||0}}const Dc=1;class Lc{constructor(t,{pixelRatio:e,version:i,stretchX:n,stretchY:r,content:o,textFitWidth:s,textFitHeight:a}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i,this.textFitWidth=s,this.textFitHeight=a}get tl(){return[this.paddedRect.x+Dc,this.paddedRect.y+Dc]}get br(){return[this.paddedRect.x+this.paddedRect.w-Dc,this.paddedRect.y+this.paddedRect.h-Dc]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Dc)/this.pixelRatio,(this.paddedRect.h-2*Dc)/this.pixelRatio]}}class Rc{constructor(t,e){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,i,r),this.addImages(e,n,r);const{w:o,h:s}=zc(r),a=new xa({width:o||1,height:s||1});for(const e in t){const n=t[e],r=i[e].paddedRect;xa.copy(n.data,a,{x:0,y:0},{x:r.x+Dc,y:r.y+Dc},n.data)}for(const t in e){const i=e[t],r=n[t].paddedRect,o=r.x+Dc,s=r.y+Dc,l=i.data.width,c=i.data.height;xa.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),xa.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),xa.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),xa.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),xa.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=n}addImages(t,e,i){for(const n in t){const r=t[n],o={x:0,y:0,w:r.data.width+2*Dc,h:r.data.height+2*Dc};i.push(o),e[n]=new Lc(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,r]=t.tl;i.update(e.data,void 0,{x:n,y:r})}}var Bc;wr("ImagePosition",Lc),wr("ImageAtlas",Rc),t.ai=void 0,(Bc=t.ai||(t.ai={}))[Bc.none=0]="none",Bc[Bc.horizontal=1]="horizontal",Bc[Bc.vertical=2]="vertical",Bc[Bc.horizontalOnly=3]="horizontalOnly";const Fc=-17;class Oc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new Oc;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new Oc;return e.imageName=t,e}}class jc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new jc;for(let n=0;n<t.sections.length;n++){const r=t.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let i=0;i<t.length;i++){const n=t.charCodeAt(i+1)||null,r=t.charCodeAt(i-1)||null;e+=n&&Lr(n)&&!ic[t[i+1]]||r&&Lr(r)&&!ic[t[i-1]]||!ic[t[i]]?t[i]:ic[t[i]]}return e}(this.text)}trim(){let t=0;for(let e=0;e<this.text.length&&Vc[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&Vc[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new jc;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Oc.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void S("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Oc.forImage(e)),this.sectionIndex.push(this.sections.length-1)):S("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Nc(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=jc.fromFeature(e,o);let y;d===t.ai.vertical&&g.verticalizePunctuation();const{processBidirectionalText:_,processStyledBidirectionalText:v}=Or;if(_&&1===g.sections.length){y=[];const t=_(g.toString(),Wc(g,u,s,i,r,f));for(const e of t){const t=new jc;t.text=e,t.sections=g.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);y.push(t)}}else if(v){y=[];const t=v(g.text,g.sectionIndex,Wc(g,u,s,i,r,f));for(const e of t){const t=new jc;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const i=[],n=t.text;let r=0;for(const n of e)i.push(t.substring(r,n)),r=n;return r<n.length&&i.push(t.substring(r,n.length)),i}(g,Wc(g,u,s,i,r,f));const x=[],b={positionedLines:x,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,i,n,r,o,s,a,l,c,u,h,d){let p=0,f=Fc,m=0,g=0;const y="right"===l?1:"left"===l?0:.5;let _=0;for(const a of o){a.trim();const o=a.getMaxScale(),l=(o-1)*nc,x={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=x;const b=x.positionedGlyphs;let w=0;if(!a.length()){f+=s,++_;continue}for(let s=0;s<a.length();s++){const m=a.getSection(s),g=a.getSectionIndex(s),y=a.getCharCode(s);let _=0,x=null,S=null,T=null,I=nc;const P=!(c===t.ai.horizontal||!h&&!Dr(y)||h&&(Vc[y]||(v=y,Ar.Arabic(v)||Ar["Arabic Supplement"](v)||Ar["Arabic Extended-A"](v)||Ar["Arabic Presentation Forms-A"](v)||Ar["Arabic Presentation Forms-B"](v))));if(m.imageName){const t=r[m.imageName];if(!t)continue;T=m.imageName,e.iconsInText=e.iconsInText||!0,S=t.paddedRect;const i=t.displaySize;m.scale=m.scale*nc/d,x={width:i[0],height:i[1],left:Dc,top:-Mc,advance:P?i[1]:i[0]},_=l+(nc-i[1]*m.scale),I=x.advance;const n=P?i[0]*m.scale-nc*o:i[1]*m.scale-nc*o;n>0&&n>w&&(w=n)}else{const t=n[m.fontStack],e=t&&t[y];if(e&&e.rect)S=e.rect,x=e.metrics;else{const t=i[m.fontStack],e=t&&t[y];if(!e)continue;x=e.metrics}_=(o-m.scale)*nc}P?(e.verticalizable=!0,b.push({glyph:y,imageName:T,x:p,y:f+_,vertical:P,scale:m.scale,fontStack:m.fontStack,sectionIndex:g,metrics:x,rect:S}),p+=I*m.scale+u):(b.push({glyph:y,imageName:T,x:p,y:f+_,vertical:P,scale:m.scale,fontStack:m.fontStack,sectionIndex:g,metrics:x,rect:S}),p+=x.advance*m.scale+u)}0!==b.length&&(m=Math.max(p-u,m),Jc(b,0,b.length-1,y,w)),p=0;const S=s*o+w;x.lineOffset=Math.max(w,l),f+=S,g=Math.max(S,g),++_}var v;const x=f-Fc,{horizontalAlign:b,verticalAlign:w}=Xc(a);(function(t,e,i,n,r,o,s,a,l){const c=(e-i)*r;let u=0;u=o!==s?-a*n-Fc:(-n*l+.5)*s;for(const e of t)for(const t of e.positionedGlyphs)t.x+=c,t.y+=u})(e.positionedLines,y,b,w,m,g,s,x,o.length),e.top+=-w*x,e.bottom=e.top+x,e.left+=-b*m,e.right=e.left+m}(b,i,n,r,y,a,l,c,d,u,p,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const Vc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$c={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Uc={40:!0};function qc(t,e,i,n,r,o){if(e.imageName){const t=n[e.imageName];return t?t.displaySize[0]*e.scale*nc/o+r:0}{const n=i[e.fontStack],o=n&&n[t];return o?o.metrics.advance*e.scale+r:0}}function Zc(t,e,i,n){const r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function Gc(t,e,i){let n=0;return 10===t&&(n-=1e4),i&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function Kc(t,e,i,n,r,o){let s=null,a=Zc(e,i,r,o);for(const t of n){const n=Zc(e-t.x,i,r,o)+t.badness;n<=a&&(s=t,a=n)}return{index:t,x:e,priorBreak:s,badness:a}}function Hc(t){return t?Hc(t.priorBreak).concat(t.index):[]}function Wc(t,e,i,n,r,o){if(!t)return[];const s=[],a=function(t,e,i,n,r,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=qc(t.getCharCode(i),a,n,r,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,n,r,o),l=t.text.indexOf("")>=0;let c=0;for(let i=0;i<t.length();i++){const h=t.getSection(i),d=t.getCharCode(i);if(Vc[d]||(c+=qc(d,h,n,r,e,o)),i<t.length()-1){const e=!((u=d)<11904||!(Ar["Bopomofo Extended"](u)||Ar.Bopomofo(u)||Ar["CJK Compatibility Forms"](u)||Ar["CJK Compatibility Ideographs"](u)||Ar["CJK Compatibility"](u)||Ar["CJK Radicals Supplement"](u)||Ar["CJK Strokes"](u)||Ar["CJK Symbols and Punctuation"](u)||Ar["CJK Unified Ideographs Extension A"](u)||Ar["CJK Unified Ideographs"](u)||Ar["Enclosed CJK Letters and Months"](u)||Ar["Halfwidth and Fullwidth Forms"](u)||Ar.Hiragana(u)||Ar["Ideographic Description Characters"](u)||Ar["Kangxi Radicals"](u)||Ar["Katakana Phonetic Extensions"](u)||Ar.Katakana(u)||Ar["Vertical Forms"](u)||Ar["Yi Radicals"](u)||Ar["Yi Syllables"](u)));($c[d]||e||h.imageName||i!==t.length()-2&&Uc[t.getCharCode(i+1)])&&s.push(Kc(i+1,c,a,s,Gc(d,t.getCharCode(i+1),e&&l),!1))}}var u;return Hc(Kc(t.length(),c,a,s,0,!0))}function Xc(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Jc(t,e,i,n,r){if(!n&&!r)return;const o=t[i],s=(t[i].x+o.metrics.advance*o.scale)*n;for(let n=e;n<=i;n++)t[n].x-=s,t[n].y+=r}function Yc(t,e,i){const{horizontalAlign:n,verticalAlign:r}=Xc(i),o=e[0]-t.displaySize[0]*n,s=e[1]-t.displaySize[1]*r;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function Qc(t){var e,i;let n=t.left,r=t.top,o=t.right-n,s=t.bottom-r;const a=null!==(e=t.image.textFitWidth)&&void 0!==e?e:"stretchOrShrink",l=null!==(i=t.image.textFitHeight)&&void 0!==i?i:"stretchOrShrink",c=(t.image.content[2]-t.image.content[0])/(t.image.content[3]-t.image.content[1]);if("proportional"===l){if("stretchOnly"===a&&o/s<c||"proportional"===a){const t=Math.ceil(s*c);n*=t/o,o=t}}else if("proportional"===a&&"stretchOnly"===l&&0!==c&&o/s>c){const t=Math.ceil(o/c);r*=t/s,s=t}return{x1:n,y1:r,x2:n+o,y2:r+s}}function tu(t,e,i,n,r,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,d,p;"width"===i||"both"===i?(p=r[0]+l-n[3],h=r[0]+c+n[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===i||"both"===i?(u=r[1]+f-n[0],d=r[1]+m+n[2]):(u=r[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const eu=255,iu=128,nu=eu*iu;function ru(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new jr(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:n}=i;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let o=r;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[r],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new jr(s)),maxSize:i.evaluate(new jr(a)),interpolationType:n}}}function ou(t,e,i){let n="never";const r=t.get(e);return r?n=r:t.get(i)&&(n="always"),n}const su=dl.VectorTileFeature.types,au=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lu(t,e,i,n,r,o,s,a,l,c,u,h,d){const p=a?Math.min(nu,Math.round(a[0])):0,f=a?Math.min(nu,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function cu(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function uu(t){for(const e of t.sections)if(Fr(e.text))return!0;return!1}class hu{constructor(t){this.layoutVertexArray=new Xo,this.indexArray=new es,this.programConfigurations=t,this.segments=new os,this.dynamicLayoutVertexArray=new Jo,this.opacityVertexArray=new Yo,this.hasVisibleVertices=!1,this.placedSymbolArray=new Lo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Jl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,au,!0),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wr("SymbolBuffers",hu);class du{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new os,this.collisionVertexArray=new ts}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Yl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wr("CollisionBuffers",du);class pu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sa([]),this.placementViewportMatrix=sa([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ru(this.zoom,i["text-size"]),this.iconSizeData=ru(this.zoom,i["icon-size"]);const n=this.layers[0].layout,r=n.get("symbol-sort-key"),o=n.get("symbol-z-order");this.canOverlap="never"!==ou(n,"text-overlap","text-allow-overlap")||"never"!==ou(n,"icon-overlap","icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!r.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((e=>t.ai[e]))),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID}createArrays(){this.text=new hu(new Ms(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new hu(new Ms(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Fo,this.lineVertexArray=new Oo,this.symbolInstances=new Bo,this.textAnchorOffsets=new No}calculateGlyphDependencies(t,e,i,n,r){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(i||n)&&r){const i=ic[t.charAt(o)];i&&(e[i.charCodeAt(0)]=!0)}}populate(e,i,n){const r=this.layers[0],o=r.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Xt&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=i.iconDependencies,p=i.glyphDependencies,f=i.availableImages,m=new jr(this.zoom);for(const{feature:i,id:a,index:l,sourceLayerIndex:g}of e){const e=r._featureFilter.needGeometry,y=Os(i,e);if(!r._featureFilter.filter(m,y,n))continue;let _,v;if(e||(y.geometry=Fs(i)),c){const t=r.getValueAndResolveTokens("text-field",y,n,f),e=Xt.factory(t),i=this.hasRTLText=this.hasRTLText||uu(e);(!i||"unavailable"===Or.getRTLTextPluginStatus()||i&&Or.isParsed())&&(_=ec(e,r,y))}if(u){const t=r.getValueAndResolveTokens("icon-image",y,n,f);v=t instanceof te?t:te.fromString(t)}if(!_&&!v)continue;const x=this.sortFeaturesByKey?h.evaluate(y,{},n):void 0;if(this.features.push({id:a,text:_,icon:v,index:l,sourceLayerIndex:g,geometry:y.geometry,properties:i.properties,type:su[i.type],sortKey:x}),v&&(d[v.name]=!0),_){const e=s.evaluate(y,{},n).join(","),i="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(t.ai.vertical)>=0;for(const t of _.sections)if(t.image)d[t.image.name]=!0;else{const n=Er(_.toString()),r=t.fontStack||e,o=p[r]=p[r]||{};this.calculateGlyphDependencies(t.text,o,i,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},n=[];let r=0;function o(e){n.push(t[e]),r++}function s(t,e,r){const o=i[t];return delete i[t],i[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function a(t,i,r){const o=e[i];return delete e[i],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(t,e,i){const n=i?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in e&&i[p]!==e[f]){const t=a(p,f,h),r=s(p,f,n[t].geometry);delete e[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[t].geometry=null}else p in i?s(p,f,h):f in e?a(p,f,h):(o(c),e[p]=r-1,i[f]=r-1)}return n.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment){let i=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]);const r={};for(let n=t.segment+1;n<e.length;n++)r[n]={x:e[n].x,y:e[n].y,tileUnitDistanceFromAnchor:i},n<e.length-1&&(i+=e[n+1].dist(e[n]));for(let i=t.segment||0;i>=0;i--)r[i]={x:e[i].x,y:e[i].y,tileUnitDistanceFromAnchor:n},i>0&&(n+=e[i-1].dist(e[i]));for(let t=0;t<e.length;t++){const e=r[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,i,n,r,o,s,a,l,c,u,h,d){const p=e.indexArray,f=e.layoutVertexArray,m=e.segments.prepareSegment(4*i.length,f,p,this.canOverlap?s.sortKey:void 0),g=this.glyphOffsetArray.length,y=m.vertexLength,_=this.allowVerticalPlacement&&a===t.ai.vertical?Math.PI/2:0,v=s.text&&s.text.sections;for(let t=0;t<i.length;t++){const{tl:r,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:y,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:S}=i[t],T=m.vertexLength,I=b[1];lu(f,l.x,l.y,r.x,I+r.y,u.x,u.y,n,w,h.x,h.y,y,x),lu(f,l.x,l.y,o.x,I+o.y,u.x+u.w,u.y,n,w,g.x,h.y,y,x),lu(f,l.x,l.y,a.x,I+a.y,u.x,u.y+u.h,n,w,h.x,g.y,y,x),lu(f,l.x,l.y,c.x,I+c.y,u.x+u.w,u.y+u.h,n,w,g.x,g.y,y,x),cu(e.dynamicLayoutVertexArray,l,_),p.emplaceBack(T,T+1,T+2),p.emplaceBack(T+1,T+2,T+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),t!==i.length-1&&S===i[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,s,s.index,{},d,v&&v[S])}e.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,y,c,u,l.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,h)}_addCollisionDebugVertex(t,e,i,n,r,o){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,n,r,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(t,e,i,n,r,s,a){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),c=l.vertexLength,u=r.layoutVertexArray,h=r.collisionVertexArray,d=a.anchorX,p=a.anchorY;this._addCollisionDebugVertex(u,h,s,d,p,new o(t,e)),this._addCollisionDebugVertex(u,h,s,d,p,new o(i,e)),this._addCollisionDebugVertex(u,h,s,d,p,new o(i,n)),this._addCollisionDebugVertex(u,h,s,d,p,new o(t,n)),l.vertexLength+=4;const f=r.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(t,e,i,n){for(let r=t;r<e;r++){const t=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,n?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,i)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new du(Qo,Ql.members,is),this.iconCollisionBox=new du(Qo,Ql.members,is);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,i,n,r,o,s,a,l){const c={};for(let n=e;n<i;n++){const e=t.get(n);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let e=n;e<r;e++){const i=t.get(e);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let e=o;e<s;e++){const i=t.get(e);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.iconFeatureIndex=i.featureIndex;break}for(let e=a;e<l;e++){const i=t.get(e);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),n=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<n;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),n=[],r=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);n.push(0|Math.round(e*s.anchorX+i*s.anchorY)),r.push(s.featureIndex)}return o.sort(((t,e)=>n[t]-n[e]||r[e]-r[t])),o}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(((t,e,i)=>{t>=0&&i.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)})),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let fu,mu;wr("SymbolBucket",pu,{omit:["layers","collisionBoxArray","features","compareText"]}),pu.MAX_GLYPHS=65535,pu.addDynamicAttributes=cu;var gu={get paint(){return mu=mu||new Qr({"icon-opacity":new Wr(G.paint_symbol["icon-opacity"]),"icon-color":new Wr(G.paint_symbol["icon-color"]),"icon-halo-color":new Wr(G.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wr(G.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wr(G.paint_symbol["icon-halo-blur"]),"icon-translate":new Hr(G.paint_symbol["icon-translate"]),"icon-translate-anchor":new Hr(G.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wr(G.paint_symbol["text-opacity"]),"text-color":new Wr(G.paint_symbol["text-color"],{runtimeType:dt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Wr(G.paint_symbol["text-halo-color"]),"text-halo-width":new Wr(G.paint_symbol["text-halo-width"]),"text-halo-blur":new Wr(G.paint_symbol["text-halo-blur"]),"text-translate":new Hr(G.paint_symbol["text-translate"]),"text-translate-anchor":new Hr(G.paint_symbol["text-translate-anchor"])})},get layout(){return fu=fu||new Qr({"symbol-placement":new Hr(G.layout_symbol["symbol-placement"]),"symbol-spacing":new Hr(G.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Hr(G.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wr(G.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Hr(G.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Hr(G.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Hr(G.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Hr(G.layout_symbol["icon-ignore-placement"]),"icon-optional":new Hr(G.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Hr(G.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wr(G.layout_symbol["icon-size"]),"icon-text-fit":new Hr(G.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Hr(G.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wr(G.layout_symbol["icon-image"]),"icon-rotate":new Wr(G.layout_symbol["icon-rotate"]),"icon-padding":new Wr(G.layout_symbol["icon-padding"]),"icon-keep-upright":new Hr(G.layout_symbol["icon-keep-upright"]),"icon-offset":new Wr(G.layout_symbol["icon-offset"]),"icon-anchor":new Wr(G.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Hr(G.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Hr(G.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Hr(G.layout_symbol["text-rotation-alignment"]),"text-field":new Wr(G.layout_symbol["text-field"]),"text-font":new Wr(G.layout_symbol["text-font"]),"text-size":new Wr(G.layout_symbol["text-size"]),"text-max-width":new Wr(G.layout_symbol["text-max-width"]),"text-line-height":new Hr(G.layout_symbol["text-line-height"]),"text-letter-spacing":new Wr(G.layout_symbol["text-letter-spacing"]),"text-justify":new Wr(G.layout_symbol["text-justify"]),"text-radial-offset":new Wr(G.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Hr(G.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wr(G.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wr(G.layout_symbol["text-anchor"]),"text-max-angle":new Hr(G.layout_symbol["text-max-angle"]),"text-writing-mode":new Hr(G.layout_symbol["text-writing-mode"]),"text-rotate":new Wr(G.layout_symbol["text-rotate"]),"text-padding":new Hr(G.layout_symbol["text-padding"]),"text-keep-upright":new Hr(G.layout_symbol["text-keep-upright"]),"text-transform":new Wr(G.layout_symbol["text-transform"]),"text-offset":new Wr(G.layout_symbol["text-offset"]),"text-allow-overlap":new Hr(G.layout_symbol["text-allow-overlap"]),"text-overlap":new Hr(G.layout_symbol["text-overlap"]),"text-ignore-placement":new Hr(G.layout_symbol["text-ignore-placement"]),"text-optional":new Hr(G.layout_symbol["text-optional"])})}};class yu{constructor(t){if(void 0===t.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:lt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wr("FormatSectionOverride",yu,{omit:["defaultValue"]});class _u extends eo{constructor(t){super(t,gu)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const i of t)e.indexOf(i)<0&&e.push(i);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,n){const r=this.layout.get(t).evaluate(e,{},i,n),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||xn(o.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>t&&i in t?String(t[i]):""))}(e.properties,r)}createBucket(t){return new pu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of gu.paint.overridableProperties){if(!_u.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new yu(e),n=new vn(i,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new wn("source",n):new Sn("composite",n,e.value.zoomStops),this.paint._values[t]=new Gr(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&_u.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),n=gu.paint.properties[e];let r=!1;const o=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof Xt)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{r||(e instanceof oe&&ne(e.value)===gt?o(e.value.sections):e instanceof Ze?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return r}}let vu;var xu={get paint(){return vu=vu||new Qr({"background-color":new Hr(G.paint_background["background-color"]),"background-pattern":new Jr(G.paint_background["background-pattern"]),"background-opacity":new Hr(G.paint_background["background-opacity"])})}};class bu extends eo{constructor(t){super(t,xu)}}let wu;var Su={get paint(){return wu=wu||new Qr({"raster-opacity":new Hr(G.paint_raster["raster-opacity"]),"raster-hue-rotate":new Hr(G.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Hr(G.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Hr(G.paint_raster["raster-brightness-max"]),"raster-saturation":new Hr(G.paint_raster["raster-saturation"]),"raster-contrast":new Hr(G.paint_raster["raster-contrast"]),"raster-resampling":new Hr(G.paint_raster["raster-resampling"]),"raster-fade-duration":new Hr(G.paint_raster["raster-fade-duration"])})}};class Tu extends eo{constructor(t){super(t,Su)}}class Iu extends eo{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Pu{constructor(t){this._methodToThrottle=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ku=6371008.8;class Cu{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Cu(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return ku*Math.acos(Math.min(r,1))}static convert(t){if(t instanceof Cu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Cu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Cu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Au=2*Math.PI*ku;function Eu(t){return Au*Math.cos(t*Math.PI/180)}function Mu(t){return(180+t)/360}function zu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Du(t,e){return t/Eu(e)}function Lu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}class Ru{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=Cu.convert(t);return new Ru(Mu(i.lng),zu(i.lat),Du(e,i.lat))}toLngLat(){return new Cu(360*this.x-180,Lu(this.y))}toAltitude(){return this.z*Eu(Lu(this.y))}meterInMercatorCoordinateUnits(){return 1/Au*(t=Lu(this.y),1/Math.cos(t*Math.PI/180));var t}}function Bu(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Fu{constructor(t,e,i){if(t<0||t>25||i<0||i>=Math.pow(2,t)||e<0||e>=Math.pow(2,t))throw new Error(`x=${e}, y=${i}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=e,this.y=i,this.key=Nu(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,i){const n=(o=this.y,s=this.z,a=Bu(256*(r=this.x),256*(o=Math.pow(2,s)-o-1),s),l=Bu(256*(r+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var r,o,s,a,l;const c=function(t,e,i){let n,r="";for(let o=t;o>0;o--)n=1<<o-1,r+=(e&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,n)}isChildOf(t){const e=this.z-t.z;return e>0&&t.x===this.x>>e&&t.y===this.y>>e}getTilePoint(t){const e=Math.pow(2,this.z);return new o((t.x*e-this.x)*Ls,(t.y*e-this.y)*Ls)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ou{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Nu(t,e.z,e.z,e.x,e.y)}}class ju{constructor(t,e,i,n,r){if(t<i)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${i}`);this.overscaledZ=t,this.wrap=e,this.canonical=new Fu(i,+n,+r),this.key=Nu(e,t,i,n,r)}clone(){return new ju(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const e=this.canonical.z-t;return t>this.canonical.z?new ju(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ju(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?Nu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Nu(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new ju(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new ju(e,this.wrap,e,i,n),new ju(e,this.wrap,e,i+1,n),new ju(e,this.wrap,e,i,n+1),new ju(e,this.wrap,e,i+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ju(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ju(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ou(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ru(t.x-this.wrap,t.y))}}function Nu(t,e,i,n,r){(t*=2)<0&&(t=-1*t-1);const o=1<<i;return(o*o*t+o*r+n).toString(36)+i.toString(36)+e.toString(36)}wr("CanonicalTileID",Fu),wr("OverscaledTileID",ju,{omit:["posMatrix"]});class Vu{constructor(t,e,i,n=1,r=1,o=1,s=0){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&!["mapbox","terrarium","custom"].includes(i))return void S(`"${i}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=e.height;const a=this.dim=e.height-2;switch(this.data=new Uint32Array(e.data.buffer),i){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=n,this.greenFactor=r,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let t=0;t<a;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(a,t)]=this.data[this._idx(a-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,a)]=this.data[this._idx(t,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let t=0;t<a;t++)for(let e=0;e<a;e++){const i=this.get(t,e);i>this.max&&(this.max=i),i<this.min&&(this.min=i)}}get(t,e){const i=new Uint8Array(this.data.buffer),n=4*this._idx(t,e);return this.unpack(i[n],i[n+1],i[n+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}unpack(t,e,i){return t*this.redFactor+e*this.greenFactor+i*this.blueFactor-this.baseShift}getPixels(){return new xa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,r=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=n;i<r;i++)this.data[this._idx(i,e)]=t.data[this._idx(i+a,e+l)]}}wr("DEMData",Vu);class $u{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Uu{constructor(t,e,i,n,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=n,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class qu{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xr(Ls,16,0),this.grid3D=new xr(Ls,16,0),this.featureIndexArray=new $o,this.promoteId=e}insert(t,e,i,n,r,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r);const a=o?this.grid3D:this.grid;for(let t=0;t<e.length;t++){const i=e[t],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];n[0]=Math.min(n[0],e.x),n[1]=Math.min(n[1],e.y),n[2]=Math.max(n[2],e.x),n[3]=Math.max(n[3],e.y)}n[0]<Ls&&n[1]<Ls&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new dl.VectorTile(new Pc(this.rawTileData)).layers,this.sourceLayerCoder=new $u(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,i,n){this.loadVTLayers();const r=t.params||{},s=Ls/t.tileSize/t.scale,a=An(r.filter),l=t.queryGeometry,c=t.queryPadding*s,u=Gu(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Gu(t.cameraQueryGeometry),p=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,((e,i,n,r)=>function(t,e,i,n,r){for(const o of t)if(e<=o.x&&i<=o.y&&n>=o.x&&r>=o.y)return!0;const s=[new o(e,i),new o(e,r),new o(n,r),new o(n,i)];if(t.length>2)for(const e of s)if(Xs(t,e))return!0;for(let e=0;e<t.length-1;e++)if(Js(t[e],t[e+1],s))return!0;return!1}(t.cameraQueryGeometry,e-c,i-c,n+c,r+c)));for(const t of p)h.push(t);h.sort(Ku);const f={};let m;for(let o=0;o<h.length;o++){const c=h[o];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,a,r.layers,r.availableImages,e,i,n,((e,i,n)=>(d||(d=Fs(e)),i.queryIntersectsFeature(l,e,n,d,this.z,t.transform,s,t.pixelPosMatrix))))}return f}loadMatchingFeature(t,e,i,n,r,o,s,a,l,c,u){const h=this.bucketLayerIDs[e];if(o&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(o,h))return;const d=this.sourceLayerCoder.decode(i),p=this.vtLayers[d].feature(n);if(r.needGeometry){const t=Os(p,!0);if(!r.filter(new jr(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new jr(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let e=0;e<h.length;e++){const i=h[e];if(o&&o.indexOf(i)<0)continue;const r=a[i];if(!r)continue;let d={};f&&c&&(d=c.getState(r.sourceLayer||"_geojsonTileLayer",f));const m=y({},l[i]);m.paint=Zu(m.paint,r.paint,p,d,s),m.layout=Zu(m.layout,r.layout,p,d,s);const g=!u||u(p,r,d);if(!g)continue;const _=new Uu(p,this.z,this.x,this.y,f);_.layer=m;let v=t[i];void 0===v&&(v=t[i]=[]),v.push({featureIndex:n,feature:_,intersectionZ:g})}}lookupSymbolFeatures(t,e,i,n,r,o,s,a){const l={};this.loadVTLayers();const c=An(r);for(const r of t)this.loadMatchingFeature(l,i,n,r,c,o,s,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i))),i}}function Zu(t,e,i,n,r){return v(t,((t,o)=>{const s=e instanceof Kr?e.get(o):null;return s&&s.evaluate?s.evaluate(i,n,r):s}))}function Gu(t){let e=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return{minX:e,minY:i,maxX:n,maxY:r}}function Ku(t,e){return e-t}function Hu(t,e,i,n,r){const s=[];for(let a=0;a<t.length;a++){const l=t[a];let c;for(let t=0;t<l.length-1;t++){let a=l[t],u=l[t+1];a.x<e&&u.x<e||(a.x<e?a=new o(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<e&&(u=new o(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new o(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new o(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=n&&u.x>=n||(a.x>=n?a=new o(n,a.y+(n-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=n&&(u=new o(n,a.y+(n-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=r&&u.y>=r||(a.y>=r?a=new o(a.x+(r-a.y)/(u.y-a.y)*(u.x-a.x),r)._round():u.y>=r&&(u=new o(a.x+(r-a.y)/(u.y-a.y)*(u.x-a.x),r)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}wr("FeatureIndex",qu,{omit:["rawTileData","sourceLayerCoder"]});class Wu extends o{constructor(t,e,i,n){super(t,e),this.angle=i,void 0!==n&&(this.segment=n)}clone(){return new Wu(this.x,this.y,this.angle,this.segment)}}function Xu(t,e,i,n,r){if(void 0===e.segment||0===i)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=e.dist(i)}return!0}function Ju(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Yu(t,e,i){return t?.6*e*i:0}function Qu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function th(t,e,i,n,r,o){const s=Yu(i,r,o),a=Qu(i,n)*o;let l=0;const c=Ju(t)/2;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1],o=n.dist(r);if(l+o>c){const u=(c-l)/o,h=Ee.number(n.x,r.x,u),d=Ee.number(n.y,r.y,u),p=new Wu(h,d,r.angleTo(n),i);return p._round(),!s||Xu(t,p,a,s,e)?p:void 0}l+=o}}function eh(t,e,i,n,r,o,s,a,l){const c=Yu(n,o,s),u=Qu(n,r),h=u*s,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),ih(t,d?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,d,!1,l)}function ih(t,e,i,n,r,o,s,a,l){const c=o/2,u=Ju(t);let h=0,d=e-i,p=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),m=a.angleTo(s);for(;d+i<h+f;){d+=i;const g=(d-h)/f,y=Ee.number(s.x,a.x,g),_=Ee.number(s.y,a.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new Wu(y,_,m,e);i._round(),n&&!Xu(t,i,o,n,r)||p.push(i)}}h+=f}return a||p.length||s||(p=ih(t,h/2,i,n,r,o,s,!0,l)),p}wr("Anchor",Wu);const nh=Dc;function rh(t,e,i,n){const r=[],s=t.image,a=s.pixelRatio,l=s.paddedRect.w-2*nh,c=s.paddedRect.h-2*nh;let u={x1:t.left,y1:t.top,x2:t.right,y2:t.bottom};const h=s.stretchX||[[0,l]],d=s.stretchY||[[0,c]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),m=d.reduce(p,0),g=l-f,y=c-m;let _=0,v=f,x=0,b=m,w=0,S=g,T=0,I=y;if(s.content&&n){const e=s.content,i=e[2]-e[0],n=e[3]-e[1];(s.textFitWidth||s.textFitHeight)&&(u=Qc(t)),_=oh(h,0,e[0]),x=oh(d,0,e[1]),v=oh(h,e[0],e[2]),b=oh(d,e[1],e[3]),w=e[0]-_,T=e[1]-x,S=i-v,I=n-b}const P=u.x1,k=u.y1,C=u.x2-P,A=u.y2-k,E=(t,n,r,l)=>{const c=ah(t.stretch-_,v,C,P),u=lh(t.fixed-w,S,t.stretch,f),h=ah(n.stretch-x,b,A,k),d=lh(n.fixed-T,I,n.stretch,m),p=ah(r.stretch-_,v,C,P),g=lh(r.fixed-w,S,r.stretch,f),y=ah(l.stretch-x,b,A,k),E=lh(l.fixed-T,I,l.stretch,m),M=new o(c,h),z=new o(p,h),D=new o(p,y),L=new o(c,y),R=new o(u/a,d/a),B=new o(g/a,E/a),F=e*Math.PI/180;if(F){const t=Math.sin(F),e=Math.cos(F),i=[e,-t,t,e];M._matMult(i),z._matMult(i),L._matMult(i),D._matMult(i)}const O=t.stretch+t.fixed,j=n.stretch+n.fixed;return{tl:M,tr:z,bl:L,br:D,tex:{x:s.paddedRect.x+nh+O,y:s.paddedRect.y+nh+j,w:r.stretch+r.fixed-O,h:l.stretch+l.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:B,minFontScaleX:S/a/C,minFontScaleY:I/a/A,isSDF:i}};if(n&&(s.stretchX||s.stretchY)){const t=sh(h,g,f),e=sh(d,y,m);for(let i=0;i<t.length-1;i++){const n=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)r.push(E(n,e[t],o,e[t+1]))}}else r.push(E({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return r}function oh(t,e,i){let n=0;for(const r of t)n+=Math.max(e,Math.min(i,r[1]))-Math.max(e,Math.min(i,r[0]));return n}function sh(t,e,i){const n=[{fixed:-nh,stretch:0}];for(const[e,i]of t){const t=n[n.length-1];n.push({fixed:e-t.stretch,stretch:t.stretch}),n.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return n.push({fixed:e+nh,stretch:i}),n}function ah(t,e,i,n){return t/e*i+n}function lh(t,e,i,n){return t-e*i/n}class ch{constructor(t,e,i,n,r,s,a,l,c,u){var h;if(this.boxStartIndex=t.length,c){let t=s.top,e=s.bottom;const i=s.collisionPadding;i&&(t-=i[1],e+=i[3]);let n=e-t;n>0&&(n=Math.max(10,n),this.circleDiameter=n)}else{const c=(null===(h=s.image)||void 0===h?void 0:h.content)&&(s.image.textFitWidth||s.image.textFitHeight)?Qc(s):{x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};c.y1=c.y1*a-l[0],c.y2=c.y2*a+l[2],c.x1=c.x1*a-l[3],c.x2=c.x2*a+l[1];const d=s.collisionPadding;if(d&&(c.x1-=d[0]*a,c.y1-=d[1]*a,c.x2+=d[2]*a,c.y2+=d[3]*a),u){const t=new o(c.x1,c.y1),e=new o(c.x2,c.y1),i=new o(c.x1,c.y2),n=new o(c.x2,c.y2),r=u*Math.PI/180;t._rotate(r),e._rotate(r),i._rotate(r),n._rotate(r),c.x1=Math.min(t.x,e.x,i.x,n.x),c.x2=Math.max(t.x,e.x,i.x,n.x),c.y1=Math.min(t.y,e.y,i.y,n.y),c.y2=Math.max(t.y,e.y,i.y,n.y)}t.emplaceBack(e.x,e.y,c.x1,c.y1,c.x2,c.y2,i,n,r)}this.boxEndIndex=t.length}}class uh{constructor(t=[],e=hh){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1),o=e[n];const s=n+1;if(s<this.length&&i(e[s],o)<0&&(n=s,o=e[s]),i(o,r)>=0)break;e[t]=o,t=n}e[t]=r}}function hh(t,e){return t<e?-1:t>e?1:0}function dh(t,e=1,i=!1){let n=1/0,r=1/0,s=-1/0,a=-1/0;const l=t[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>a)&&(a=e.y)}const c=Math.min(s-n,a-r);let u=c/2;const h=new uh([],ph);if(0===c)return new o(n,r);for(let e=n;e<s;e+=c)for(let i=r;i<a;i+=c)h.push(new fh(e+u,i+u,u,t));let d=function(t){let e=0,i=0,n=0;const r=t[0];for(let t=0,o=r.length,s=o-1;t<o;s=t++){const o=r[t],a=r[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,n+=(o.y+a.y)*l,e+=3*l}return new fh(i/e,n/e,0,t)}(t),p=h.length;for(;h.length;){const n=h.pop();(n.d>d.d||!d.d)&&(d=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-d.d<=e||(u=n.h/2,h.push(new fh(n.p.x-u,n.p.y-u,u,t)),h.push(new fh(n.p.x+u,n.p.y-u,u,t)),h.push(new fh(n.p.x-u,n.p.y+u,u,t)),h.push(new fh(n.p.x+u,n.p.y+u,u,t)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function ph(t,e){return e.max-t.max}function fh(t,e,i,n){this.p=new o(t,e),this.h=i,this.d=function(t,e){let i=!1,n=1/0;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0,r=o.length,s=r-1;e<r;s=e++){const r=o[e],a=o[s];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,Hs(t,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var mh;t.ar=void 0,(mh=t.ar||(t.ar={}))[mh.center=1]="center",mh[mh.left=2]="left",mh[mh.right=3]="right",mh[mh.top=4]="top",mh[mh.bottom=5]="bottom",mh[mh["top-left"]=6]="top-left",mh[mh["top-right"]=7]="top-right",mh[mh["bottom-left"]=8]="bottom-left",mh[mh["bottom-right"]=9]="bottom-right";const gh=7,yh=Number.POSITIVE_INFINITY;function _h(t,e){return e[1]!==yh?function(t,e,i){let n=0,r=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":r=i-gh;break;case"bottom-right":case"bottom-left":case"bottom":r=-i+gh}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,r]}(t,e[0],e[1]):function(t,e){let i=0,n=0;e<0&&(e=0);const r=e/Math.SQRT2;switch(t){case"top-right":case"top-left":n=r-gh;break;case"bottom-right":case"bottom-left":n=-r+gh;break;case"bottom":n=-e+gh;break;case"top":n=e-gh}switch(t){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=e;break;case"right":i=-e}return[i,n]}(t,e[0])}function vh(t,e,i){var n;const r=t.layout,o=null===(n=r.get("text-variable-anchor-offset"))||void 0===n?void 0:n.evaluate(e,{},i);if(o){const t=o.values,e=[];for(let i=0;i<t.length;i+=2){const n=e[i]=t[i],r=t[i+1].map((t=>t*nc));n.startsWith("top")?r[1]-=gh:n.startsWith("bottom")&&(r[1]+=gh),e[i+1]=r}return new Qt(e)}const s=r.get("text-variable-anchor");if(s){let n;n=void 0!==t._unevaluatedLayout.getValue("text-radial-offset")?[r.get("text-radial-offset").evaluate(e,{},i)*nc,yh]:r.get("text-offset").evaluate(e,{},i).map((t=>t*nc));const o=[];for(const t of s)o.push(t,_h(t,n));return new Qt(o)}return null}function xh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bh(e,i,n,r,o,s,a,l,c,u,h){let d=s.textMaxSize.evaluate(i,{});void 0===d&&(d=a);const p=e.layers[0].layout,f=p.get("icon-offset").evaluate(i,{},h),m=Sh(n.horizontal),g=a/24,y=e.tilePixelRatio*g,_=e.tilePixelRatio*d/24,v=e.tilePixelRatio*l,x=e.tilePixelRatio*p.get("symbol-spacing"),b=p.get("text-padding")*e.tilePixelRatio,w=function(t,e,i,n=1){const r=t.get("icon-padding").evaluate(e,{},i),o=r&&r.values;return[o[0]*n,o[1]*n,o[2]*n,o[3]*n]}(p,i,h,e.tilePixelRatio),T=p.get("text-max-angle")/180*Math.PI,I="viewport"!==p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),P="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),k=p.get("symbol-placement"),C=x/2,A=p.get("icon-text-fit");let E;r&&"none"!==A&&(e.allowVerticalPlacement&&n.vertical&&(E=tu(r,n.vertical,A,p.get("icon-text-fit-padding"),f,g)),m&&(r=tu(r,m,A,p.get("icon-text-fit-padding"),f,g)));const M=(l,d)=>{d.x<0||d.x>=Ls||d.y<0||d.y>=Ls||function(e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,I,P){const k=e.addToLineVertexArray(i,n);let C,A,E,M,z=0,D=0,L=0,R=0,B=-1,F=-1;const O={};let j=fs("");if(e.allowVerticalPlacement&&r.vertical){const t=l.layout.get("text-rotate").evaluate(b,{},I)+90;E=new ch(c,i,u,h,d,r.vertical,p,f,m,t),a&&(M=new ch(c,i,u,h,d,a,y,_,m,t))}if(o){const n=l.layout.get("icon-rotate").evaluate(b,{}),r="none"!==l.layout.get("icon-text-fit"),s=rh(o,n,T,r),p=a?rh(a,n,T,r):void 0;A=new ch(c,i,u,h,d,o,y,_,!1,n),z=4*s.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[iu*l.layout.get("icon-size").evaluate(b,{})],m[0]>nu&&S(`${e.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[iu*w.compositeIconSizes[0].evaluate(b,{},I),iu*w.compositeIconSizes[1].evaluate(b,{},I)],(m[0]>nu||m[1]>nu)&&S(`${e.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,m,x,v,b,t.ai.none,i,k.lineStartIndex,k.lineLength,-1,I),B=e.icon.placedSymbolArray.length-1,p&&(D=4*p.length,e.addSymbols(e.icon,p,m,x,v,b,t.ai.vertical,i,k.lineStartIndex,k.lineLength,-1,I),F=e.icon.placedSymbolArray.length-1)}const N=Object.keys(r.horizontal);for(const n of N){const o=r.horizontal[n];if(!C){j=fs(o.text);const t=l.layout.get("text-rotate").evaluate(b,{},I);C=new ch(c,i,u,h,d,o,p,f,m,t)}const a=1===o.positionedLines.length;if(L+=wh(e,i,o,s,l,m,b,g,k,r.vertical?t.ai.horizontal:t.ai.horizontalOnly,a?N:[n],O,B,w,I),a)break}r.vertical&&(R+=wh(e,i,r.vertical,s,l,m,b,g,k,t.ai.vertical,["vertical"],O,F,w,I));const V=C?C.boxStartIndex:e.collisionBoxArray.length,$=C?C.boxEndIndex:e.collisionBoxArray.length,U=E?E.boxStartIndex:e.collisionBoxArray.length,q=E?E.boxEndIndex:e.collisionBoxArray.length,Z=A?A.boxStartIndex:e.collisionBoxArray.length,G=A?A.boxEndIndex:e.collisionBoxArray.length,K=M?M.boxStartIndex:e.collisionBoxArray.length,H=M?M.boxEndIndex:e.collisionBoxArray.length;let W=-1;const X=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;W=X(C,W),W=X(E,W),W=X(A,W),W=X(M,W);const J=W>-1?1:0;J&&(W*=P/nc),e.glyphOffsetArray.length>=pu.MAX_GLYPHS&&S("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,b.sortKey);const Y=vh(l,b,I),[Q,tt]=function(e,i){const n=e.length,r=null==i?void 0:i.values;if((null==r?void 0:r.length)>0)for(let i=0;i<r.length;i+=2){const n=r[i+1];e.emplaceBack(t.ar[r[i]],n[0],n[1])}return[n,e.length]}(e.textAnchorOffsets,Y);e.symbolInstances.emplaceBack(i.x,i.y,O.right>=0?O.right:-1,O.center>=0?O.center:-1,O.left>=0?O.left:-1,O.vertical||-1,B,F,j,V,$,U,q,Z,G,K,H,u,L,R,z,D,J,0,p,W,Q,tt)}(e,d,l,n,r,o,E,e.layers[0],e.collisionBoxArray,i.index,i.sourceLayerIndex,e.index,y,[b,b,b,b],I,c,v,w,P,f,i,s,u,h,a)};if("line"===k)for(const t of Hu(i.geometry,0,0,Ls,Ls)){const i=eh(t,x,T,n.vertical||m,r,24,_,e.overscaling,Ls);for(const n of i)m&&Th(e,m.text,C,n)||M(t,n)}else if("line-center"===k){for(const t of i.geometry)if(t.length>1){const e=th(t,T,n.vertical||m,r,24,_);e&&M(t,e)}}else if("Polygon"===i.type)for(const t of vi(i.geometry,0)){const e=dh(t,16);M(t[0],new Wu(e.x,e.y,0))}else if("LineString"===i.type)for(const t of i.geometry)M(t,new Wu(t[0].x,t[0].y,0));else if("Point"===i.type)for(const t of i.geometry)for(const e of t)M([e],new Wu(e.x,e.y,0))}function wh(t,e,i,n,r,s,a,l,c,u,h,d,p,f,m){const g=function(t,e,i,n,r,s,a,l){const c=n.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=[];for(const t of e.positionedLines)for(const n of t.positionedGlyphs){if(!n.rect)continue;const s=n.rect||{};let h=Mc+1,d=!0,p=1,f=0;const m=(r||l)&&n.vertical,g=n.metrics.advance*n.scale/2;if(l&&e.verticalizable&&(f=t.lineOffset/2-(n.imageName?-(nc-n.metrics.width*n.scale)/2:(n.scale-1)*nc)),n.imageName){const t=a[n.imageName];d=t.sdf,p=t.pixelRatio,h=Dc/p}const y=r?[n.x+g,n.y]:[0,0];let _=r?[0,0]:[n.x+g+i[0],n.y+i[1]-f],v=[0,0];m&&(v=_,_=[0,0]);const x=n.metrics.isDoubleResolution?2:1,b=(n.metrics.left-h)*n.scale-g+_[0],w=(-n.metrics.top-h)*n.scale+_[1],S=b+s.w/x*n.scale/p,T=w+s.h/x*n.scale/p,I=new o(b,w),P=new o(S,w),k=new o(b,T),C=new o(S,T);if(m){const t=new o(-g,g-Fc),e=-Math.PI/2,i=nc/2-g,r=new o(5-Fc-i,-(n.imageName?i:0)),s=new o(...v);I._rotateAround(e,t)._add(r)._add(s),P._rotateAround(e,t)._add(r)._add(s),k._rotateAround(e,t)._add(r)._add(s),C._rotateAround(e,t)._add(r)._add(s)}if(c){const t=Math.sin(c),e=Math.cos(c),i=[e,-t,t,e];I._matMult(i),P._matMult(i),k._matMult(i),C._matMult(i)}const A=new o(0,0),E=new o(0,0);u.push({tl:I,tr:P,bl:k,br:C,tex:s,writingMode:e.writingMode,glyphOffset:y,sectionIndex:n.sectionIndex,isSDF:d,pixelOffsetTL:A,pixelOffsetBR:E,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,l,r,s,a,n,t.allowVerticalPlacement),y=t.textSizeData;let _=null;"source"===y.kind?(_=[iu*r.layout.get("text-size").evaluate(a,{})],_[0]>nu&&S(`${t.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)):"composite"===y.kind&&(_=[iu*f.compositeTextSizes[0].evaluate(a,{},m),iu*f.compositeTextSizes[1].evaluate(a,{},m)],(_[0]>nu||_[1]>nu)&&S(`${t.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)),t.addSymbols(t.text,g,_,l,s,a,u,e,c.lineStartIndex,c.lineLength,p,m);for(const e of h)d[e]=t.text.placedSymbolArray.length-1;return 4*g.length}function Sh(t){for(const e in t)return t[e];return null}function Th(t,e,i,n){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<i)return!0}else r[e]=[];return r[e].push(n),!1}const Ih=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ph{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const r=Ih[15&i];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new Ph(s,o,r,t)}constructor(t,e=64,i=Float64Array,n){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const r=Ih.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return kh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=n&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=t&&p<=i&&f>=e&&f<=n&&l.push(r[d]),(0===c?t<=p:e<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:n>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:o}=this,s=[0,n.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)Mh(r[2*i],r[2*i+1],t,e)<=l&&a.push(n[i]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];Mh(p,f,t,e)<=l&&a.push(n[d]),(0===c?t-i<=p:e-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?t+i>=p:e+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function kh(t,e,i,n,r,o){if(r-n<=i)return;const s=n+r>>1;Ch(t,e,s,n,r,o),kh(t,e,i,n,s-1,1-o),kh(t,e,i,s+1,r,1-o)}function Ch(t,e,i,n,r,o){for(;r>n;){if(r-n>600){const s=r-n+1,a=i-n+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);Ch(t,e,i,Math.max(n,Math.floor(i-a*c/s+u)),Math.min(r,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=n,l=r;for(Ah(t,e,n,i),e[2*r+o]>s&&Ah(t,e,n,r);a<l;){for(Ah(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*n+o]===s?Ah(t,e,n,l):(l++,Ah(t,e,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function Ah(t,e,i,n){Eh(t,i,n),Eh(e,2*i,2*n),Eh(e,2*i+1,2*n+1)}function Eh(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function Mh(t,e,i,n){const r=t-i,o=e-n;return r*r+o*o}var zh;t.bf=void 0,(zh=t.bf||(t.bf={})).create="create",zh.load="load",zh.fullLoad="fullLoad";let Dh=null,Lh=[];const Rh=1e3/60,Bh="loadTime",Fh="fullLoadTime",Oh={mark(t){performance.mark(t)},frame(t){const e=t;null!=Dh&&Lh.push(e-Dh),Dh=e},clearMetrics(){Dh=null,Lh=[],performance.clearMeasures(Bh),performance.clearMeasures(Fh);for(const e in t.bf)performance.clearMarks(t.bf[e])},getPerformanceMetrics(){performance.measure(Bh,t.bf.create,t.bf.load),performance.measure(Fh,t.bf.create,t.bf.fullLoad);const e=performance.getEntriesByName(Bh)[0].duration,i=performance.getEntriesByName(Fh)[0].duration,n=Lh.length,r=1/(Lh.reduce(((t,e)=>t+e),0)/n/1e3),o=Lh.filter((t=>t>Rh)).reduce(((t,e)=>t+(e-Rh)/Rh),0);return{loadTime:e,fullLoadTime:i,fps:r,percentDroppedFrames:o/(n+o)*100,totalFrames:n}}};t.$=class extends co{},t.A=oa,t.B=gr,t.C=function(t){if(null==P){const e=t.navigator?t.navigator.userAgent:null;P=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return P},t.D=Hr,t.E=Z,t.F=class{constructor(t,e){this.target=t,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Pu((()=>this.process())),this.subscription=function(t,e,i,n){return t.addEventListener(e,i,!1),{unsubscribe:()=>{t.removeEventListener(e,i,!1)}}}(this.target,"message",(t=>this.receive(t))),this.globalScope=I(self)?t:window}registerMessageHandler(t,e){this.messageHandlers[t]=e}sendAsync(t,e){return new Promise(((i,n)=>{const r=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[r]={resolve:i,reject:n},e&&e.signal.addEventListener("abort",(()=>{delete this.resolveRejects[r];const e={id:r,type:"<cancel>",origin:location.origin,targetMapId:t.targetMapId,sourceMapId:this.mapId};this.target.postMessage(e)}),{once:!0});const o=[],s=Object.assign(Object.assign({},t),{id:r,sourceMapId:this.mapId,origin:location.origin,data:Pr(t.data,o)});this.target.postMessage(s,{transfer:o})}))}receive(t){const e=t.data,i=e.id;if(!("file://"!==e.origin&&"file://"!==location.origin&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if("<cancel>"===e.type){delete this.tasks[i];const t=this.abortControllers[i];return delete this.abortControllers[i],void(t&&t.abort())}if(I(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(0===this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(t,e)}processTask(t,i){return e(this,void 0,void 0,(function*(){if("<response>"===i.type){const e=this.resolveRejects[t];if(delete this.resolveRejects[t],!e)return;return void(i.error?e.reject(kr(i.error)):e.resolve(kr(i.data)))}if(!this.messageHandlers[i.type])return void this.completeTask(t,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const e=kr(i.data),n=new AbortController;this.abortControllers[t]=n;try{const r=yield this.messageHandlers[i.type](i.sourceMapId,e,n);this.completeTask(t,null,r)}catch(e){this.completeTask(t,e)}}))}completeTask(t,e,i){const n=[];delete this.abortControllers[t];const r={id:t,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Pr(e):null,data:Pr(i,n)};this.target.postMessage(r,{transfer:n})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},t.G=B,t.H=function(){var t=new oa(16);return oa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.I=Lc,t.J=function(t,e,i){var n,r,o,s,a,l,c,u,h,d,p,f,m=i[0],g=i[1],y=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=n=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=n*m+a*g+h*y+e[12],t[13]=r*m+l*g+d*y+e[13],t[14]=o*m+c*g+p*y+e[14],t[15]=s*m+u*g+f*y+e[15]),t},t.K=function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.L=aa,t.M=function(t,e){const i={};for(let n=0;n<e.length;n++){const r=e[n];r in t&&(i[r]=t[r])}return i},t.N=Cu,t.O=Mu,t.P=o,t.Q=zu,t.R=xa,t.S=ju,t.T=$r,t.U=h,t.V=d,t.W=A,t.X=Ls,t.Y=oo,t.Z=Ru,t._=e,t.a=L,t.a$=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=e[0],v=e[1],x=e[2],b=e[3],w=e[4],S=e[5],T=e[6],I=e[7],P=e[8],k=e[9],C=e[10],A=e[11],E=e[12],M=e[13],z=e[14],D=e[15];return Math.abs(i-_)<=ra*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(n-v)<=ra*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-x)<=ra*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-b)<=ra*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=ra*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-S)<=ra*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-T)<=ra*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-I)<=ra*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(u-P)<=ra*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-k)<=ra*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(d-C)<=ra*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-A)<=ra*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(f-E)<=ra*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(m-M)<=ra*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(g-z)<=ra*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(y-D)<=ra*Math.max(1,Math.abs(y),Math.abs(D))},t.a0=os,t.a1=Fu,t.a2=rt,t.a3=t=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const i of t){const t=window.document.createElement("source");N(i)||(e.crossOrigin="Anonymous"),t.src=i,e.appendChild(t)}}))},t.a4=function(){return _++},t.a5=zo,t.a6=pu,t.a7=An,t.a8=Os,t.a9=jr,t.aA=function(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=H(t[i],e[t[i].ref]));return t},t.aB=function(t){if("custom"===t.type)return new Iu(t);switch(t.type){case"background":return new bu(t);case"circle":return new ha(t);case"fill":return new ll(t);case"fill-extrusion":return new zl(t);case"heatmap":return new wa(t);case"hillshade":return new Ia(t);case"line":return new Hl(t);case"raster":return new Tu(t);case"symbol":return new _u(t)}},t.aC=b,t.aD=function(t,e){if(!t)return[{command:"setStyle",args:[e]}];let i=[];try{if(!W(t.version,e.version))return[{command:"setStyle",args:[e]}];W(t.center,e.center)||i.push({command:"setCenter",args:[e.center]}),W(t.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),W(t.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),W(t.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),W(t.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),W(t.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),W(t.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),W(t.light,e.light)||i.push({command:"setLight",args:[e.light]}),W(t.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),W(t.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),W(t.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const n={},r=[];!function(t,e,i,n){let r;for(r in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)||Y(r,i,n));for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)?W(t[r],e[r])||("geojson"===t[r].type&&"geojson"===e[r].type&&tt(t,e,r)?X(i,{command:"setGeoJSONSourceData",args:[r,e[r].data]}):Q(r,e,i,n)):J(r,e,i))}(t.sources,e.sources,r,n);const o=[];t.layers&&t.layers.forEach((t=>{"source"in t&&n[t.source]?i.push({command:"removeLayer",args:[t.id]}):o.push(t)})),i=i.concat(r),function(t,e,i){e=e||[];const n=(t=t||[]).map(it),r=e.map(it),o=t.reduce(nt,{}),s=e.reduce(nt,{}),a=n.slice(),l=Object.create(null);let c,u,h,d,p;for(let t=0,e=0;t<n.length;t++)c=n[t],Object.prototype.hasOwnProperty.call(s,c)?e++:(X(i,{command:"removeLayer",args:[c]}),a.splice(a.indexOf(c,e),1));for(let t=0,e=0;t<r.length;t++)c=r[r.length-1-t],a[a.length-1-t]!==c&&(Object.prototype.hasOwnProperty.call(o,c)?(X(i,{command:"removeLayer",args:[c]}),a.splice(a.lastIndexOf(c,a.length-e),1)):e++,d=a[a.length-t],X(i,{command:"addLayer",args:[s[c],d]}),a.splice(a.length-t,0,c),l[c]=!0);for(let t=0;t<r.length;t++)if(c=r[t],u=o[c],h=s[c],!l[c]&&!W(u,h))if(W(u.source,h.source)&&W(u["source-layer"],h["source-layer"])&&W(u.type,h.type)){for(p in et(u.layout,h.layout,i,c,null,"setLayoutProperty"),et(u.paint,h.paint,i,c,null,"setPaintProperty"),W(u.filter,h.filter)||X(i,{command:"setFilter",args:[c,h.filter]}),W(u.minzoom,h.minzoom)&&W(u.maxzoom,h.maxzoom)||X(i,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?et(u[p],h[p],i,c,p.slice(6),"setPaintProperty"):W(u[p],h[p])||X(i,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?et(u[p],h[p],i,c,p.slice(6),"setPaintProperty"):W(u[p],h[p])||X(i,{command:"setLayerProperty",args:[c,p,h[p]]}))}else X(i,{command:"removeLayer",args:[c]}),d=a[a.lastIndexOf(c)+1],X(i,{command:"addLayer",args:[h,d]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:"setStyle",args:[e]}]}return i},t.aE=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.aF=function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(!t(e[n],i[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const n in e)if(!t(e[n],i[n]))return!1;return!0}return e===i},t.aG=v,t.aH=x,t.aI=class extends vs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.aJ=xs,t.aK=class extends vs{constructor(t,e){super(t,e),this.current=Ss}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.aL=bs,t.aM=ws,t.aN=Kt,t.aO=class extends vs{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.aP=class extends vs{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.aQ=function(t,e,i,n,r,o,s){var a=1/(e-i),l=1/(n-r),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=(s+o)*c,t[15]=1,t},t.aR=ca,t.aS=class extends xo{},t.aT=tc,t.aU=class extends wo{},t.aV=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.aW=ba,t.aX=Uo,t.aY=es,t.aZ=class extends Ao{},t.a_=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},t.aa=Uu,t.ab=function(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,n,r)=>{const o=n||r;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e},t.ac=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i},t.ad=m,t.ae=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*n,t[1]=s*r+u*n,t[2]=a*r+h*n,t[3]=l*r+d*n,t[4]=c*r-o*n,t[5]=u*r-s*n,t[6]=h*r-a*n,t[7]=d*r-l*n,t},t.af=function(t){var e=new oa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.ag=ua,t.ah=function(t,e){let i=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=t,a=r?m(Me.interpolationFactor(r,e,o,s),0,1):0;"camera"===t.kind?n=Ee.number(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:n}},t.aj=function(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===t.kind?n/iu:"composite"===t.kind?Ee.number(n/iu,r/iu,i):e},t.ak=cu,t.al=function(t,e,i,n){const r=e.y-t.y,s=e.x-t.x,a=n.y-i.y,l=n.x-i.x,c=a*s-l*r;if(0===c)return null;const u=(l*(t.y-i.y)-a*(t.x-i.x))/c;return new o(t.x+u*s,t.y+u*r)},t.am=Hu,t.an=Vs,t.ao=sa,t.ap=function(t){let e=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return[e,i,n,r]},t.aq=nc,t.as=ou,t.at=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=i*a-n*s,v=i*l-r*s,x=i*c-o*s,b=n*l-r*a,w=n*c-o*a,S=r*c-o*l,T=u*m-h*f,I=u*g-d*f,P=u*y-p*f,k=h*g-d*m,C=h*y-p*m,A=d*y-p*g,E=_*A-v*C+x*k+b*P-w*I+S*T;return E?(t[0]=(a*A-l*C+c*k)*(E=1/E),t[1]=(r*C-n*A-o*k)*E,t[2]=(m*S-g*w+y*b)*E,t[3]=(d*w-h*S-p*b)*E,t[4]=(l*P-s*A-c*I)*E,t[5]=(i*A-r*P+o*I)*E,t[6]=(g*x-f*S-y*v)*E,t[7]=(u*S-d*x+p*v)*E,t[8]=(s*C-a*P+c*T)*E,t[9]=(n*P-i*C-o*T)*E,t[10]=(f*w-m*x+y*_)*E,t[11]=(h*x-u*w-p*_)*E,t[12]=(a*I-s*k-l*T)*E,t[13]=(i*k-n*I+r*T)*E,t[14]=(m*v-f*b-g*_)*E,t[15]=(u*b-h*v+d*_)*E,t):null},t.au=xh,t.av=Xc,t.aw=Ph,t.ax=function(){const t={},e=G.$version;for(const i in G.$root){const n=G.$root[i];if(n.required){let r=null;r="version"===i?e:"array"===n.type?[]:{},null!=r&&(t[i]=r)}}return t},t.ay=Cr,t.az=O,t.b=k,t.b0=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.b1=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},t.b2=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.b3=g,t.b4=Ou,t.b5=Du,t.b6=function(t,e,i,n,r){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+n)*(o=1/(n-r)),t[14]=2*r*n*o):(t[10]=-1,t[14]=-2*n),t},t.b7=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+c*n,t[5]=s*r+u*n,t[6]=a*r+h*n,t[7]=l*r+d*n,t[8]=c*r-o*n,t[9]=u*r-s*n,t[10]=h*r-a*n,t[11]=d*r-l*n,t},t.b8=p,t.b9=f,t.bA=function(t){return t.message===z},t.bB=bn,t.bC=Or,t.ba=function(t){return t*Math.PI/180},t.bb=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.bc=class extends lo{},t.bd=ku,t.be=Oh,t.bg=F,t.bh=function(t,e){L.REGISTERED_PROTOCOLS[t]=e},t.bi=function(t){delete L.REGISTERED_PROTOCOLS[t]},t.bj=function(t,e){const i={};for(let n=0;n<t.length;n++){const r=e&&e[t[n].id]||On(t[n]);e&&(e[t[n].id]=r);let o=i[r];o||(o=i[r]=[]),o.push(t[n])}const n=[];for(const t in i)n.push(i[t]);return n},t.bk=wr,t.bl=$u,t.bm=qu,t.bn=Rc,t.bo=function(e){e.bucket.createArrays(),e.bucket.tilePixelRatio=Ls/(512*e.bucket.overscaling),e.bucket.compareText={},e.bucket.iconsNeedLinear=!1;const i=e.bucket.layers[0],n=i.layout,r=i._unevaluatedLayout._values,o={layoutIconSize:r["icon-size"].possiblyEvaluate(new jr(e.bucket.zoom+1),e.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new jr(e.bucket.zoom+1),e.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new jr(18))};if("composite"===e.bucket.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.textSizeData;o.compositeTextSizes=[r["text-size"].possiblyEvaluate(new jr(t),e.canonical),r["text-size"].possiblyEvaluate(new jr(i),e.canonical)]}if("composite"===e.bucket.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.iconSizeData;o.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new jr(t),e.canonical),r["icon-size"].possiblyEvaluate(new jr(i),e.canonical)]}const s=n.get("text-line-height")*nc,a="viewport"!==n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement"),l=n.get("text-keep-upright"),c=n.get("text-size");for(const r of e.bucket.features){const u=n.get("text-font").evaluate(r,{},e.canonical).join(","),h=c.evaluate(r,{},e.canonical),d=o.layoutTextSize.evaluate(r,{},e.canonical),p=o.layoutIconSize.evaluate(r,{},e.canonical),f={horizontal:{},vertical:void 0},m=r.text;let g,y=[0,0];if(m){const o=m.toString(),c=n.get("text-letter-spacing").evaluate(r,{},e.canonical)*nc,p=Mr(o)?c:0,g=n.get("text-anchor").evaluate(r,{},e.canonical),_=vh(i,r,e.canonical);if(!_){const t=n.get("text-radial-offset").evaluate(r,{},e.canonical);y=t?_h(g,[t*nc,yh]):n.get("text-offset").evaluate(r,{},e.canonical).map((t=>t*nc))}let v=a?"center":n.get("text-justify").evaluate(r,{},e.canonical);const x="point"===n.get("symbol-placement")?n.get("text-max-width").evaluate(r,{},e.canonical)*nc:1/0,b=()=>{e.bucket.allowVerticalPlacement&&Er(o)&&(f.vertical=Nc(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,"left",p,y,t.ai.vertical,!0,d,h))};if(!a&&_){const i=new Set;if("auto"===v)for(let t=0;t<_.values.length;t+=2)i.add(xh(_.values[t]));else i.add(v);let n=!1;for(const r of i)if(!f.horizontal[r])if(n)f.horizontal[r]=f.horizontal[0];else{const i=Nc(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,"center",r,p,y,t.ai.horizontal,!1,d,h);i&&(f.horizontal[r]=i,n=1===i.positionedLines.length)}b()}else{"auto"===v&&(v=xh(g));const i=Nc(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,v,p,y,t.ai.horizontal,!1,d,h);i&&(f.horizontal[v]=i),b(),Er(o)&&a&&l&&(f.vertical=Nc(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,v,p,y,t.ai.vertical,!1,d,h))}}let _=!1;if(r.icon&&r.icon.name){const t=e.imageMap[r.icon.name];t&&(g=Yc(e.imagePositions[r.icon.name],n.get("icon-offset").evaluate(r,{},e.canonical),n.get("icon-anchor").evaluate(r,{},e.canonical)),_=!!t.sdf,void 0===e.bucket.sdfIcons?e.bucket.sdfIcons=_:e.bucket.sdfIcons!==_&&S("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.bucket.pixelRatio||0!==n.get("icon-rotate").constantOr(1))&&(e.bucket.iconsNeedLinear=!0))}const v=Sh(f.horizontal)||f.vertical;e.bucket.iconsInText=!!v&&v.iconsInText,(v||g)&&bh(e.bucket,r,f,g,e.imageMap,o,d,p,y,_,e.canonical)}e.showCollisionBoxes&&e.bucket.generateCollisionDebugBuffers()},t.bp=$l,t.bq=rl,t.br=kl,t.bs=dl,t.bt=Pc,t.bu=class{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}},t.bv=function(t,i,n,r,o){return e(this,void 0,void 0,(function*(){if(d())try{return yield A(t,i,n,r,o)}catch(t){}return function(t,e,i,n,r){const o=t.width,s=t.height;E&&M||(E=new OffscreenCanvas(o,s),M=E.getContext("2d",{willReadFrequently:!0})),E.width=o,E.height=s,M.drawImage(t,0,0,o,s);const a=M.getImageData(e,i,n,r);return M.clearRect(0,0,o,s),a.data}(t,i,n,r,o)}))},t.bw=Vu,t.bx=i,t.by=n,t.bz=rc,t.c=D,t.d=t=>e(void 0,void 0,void 0,(function*(){if(0===t.byteLength)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(t)],{type:"image/png"});try{return createImageBitmap(e)}catch(t){throw new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),t.e=y,t.f=t=>new Promise(((e,i)=>{const n=new Image;n.onload=()=>{e(n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((()=>{n.src=C}))},n.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?URL.createObjectURL(r):C})),t.g=R,t.h=(t,e)=>j(y(t,{type:"json"}),e),t.i=I,t.j=q,t.k=U,t.l=(t,e)=>j(y(t,{type:"arrayBuffer"}),e),t.m=j,t.n=function(t){return new Pc(t).readFields(Cc,[])},t.o=va,t.p=zc,t.q=Qr,t.r=mr,t.s=N,t.t=vr,t.u=Ar,t.v=G,t.w=S,t.x=fr,t.y=function([t,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:t*Math.cos(e)*Math.sin(i),y:t*Math.sin(e)*Math.sin(i),z:t*Math.cos(i)}},t.z=Ee})),i("worker",["./shared"],(function(t){class e{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,i){for(const i of e){this._layerConfigs[i.id]=i;const e=this._layers[i.id]=t.aB(i);e._featureFilter=t.a7(e.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const n=t.bj(Object.values(this._layerConfigs),this.keyCache);for(const t of n){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(e)}}}class i{constructor(e){const i={},n=[];for(const t in e){const r=e[t],o=i[t]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};n.push(i),o[t]={rect:i,metrics:e.metrics}}}const{w:r,h:o}=t.p(n),s=new t.o({width:r||1,height:o||1});for(const n in e){const r=e[n];for(const e in r){const o=r[+e];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=i[n][e].rect;t.o.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=i}}t.bk("GlyphAtlas",i);class n{constructor(e){this.tileID=new t.S(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[]}parse(e,n,o,s){return t._(this,void 0,void 0,(function*(){this.status="parsing",this.data=e,this.collisionBoxArray=new t.a5;const a=new t.bl(Object.keys(e.layers).sort()),l=new t.bm(this.tileID,this.promoteId);l.bucketLayerIDs=[];const c={},u={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o},h=n.familiesBySource[this.source];for(const i in h){const n=e.layers[i];if(!n)continue;1===n.version&&t.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=a.encode(i),d=[];for(let t=0;t<n.length;t++){const e=n.feature(t),r=l.getId(e,i);d.push({feature:e,id:r,index:t,sourceLayerIndex:s})}for(const e of h[i]){const i=e[0];i.source!==this.source&&t.w(`layer.source = ${i.source} does not equal this.source = ${this.source}`),i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(r(e,this.zoom,o),(c[i.id]=i.createBucket({index:l.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(d,u,this.tileID.canonical),l.bucketLayerIDs.push(e.map((t=>t.id))))}}const d=t.aG(u.glyphDependencies,(t=>Object.keys(t).map(Number)));this.inFlightDependencies.forEach((t=>null==t?void 0:t.abort())),this.inFlightDependencies=[];let p=Promise.resolve({});if(Object.keys(d).length){const t=new AbortController;this.inFlightDependencies.push(t),p=s.sendAsync({type:"GG",data:{stacks:d,source:this.source,tileID:this.tileID,type:"glyphs"}},t)}const f=Object.keys(u.iconDependencies);let m=Promise.resolve({});if(f.length){const t=new AbortController;this.inFlightDependencies.push(t),m=s.sendAsync({type:"GI",data:{icons:f,source:this.source,tileID:this.tileID,type:"icons"}},t)}const g=Object.keys(u.patternDependencies);let y=Promise.resolve({});if(g.length){const t=new AbortController;this.inFlightDependencies.push(t),y=s.sendAsync({type:"GI",data:{icons:g,source:this.source,tileID:this.tileID,type:"patterns"}},t)}const[_,v,x]=yield Promise.all([p,m,y]),b=new i(_),w=new t.bn(v,x);for(const e in c){const i=c[e];i instanceof t.a6?(r(i.layers,this.zoom,o),t.bo({bucket:i,glyphMap:_,glyphPositions:b.positions,imageMap:v,imagePositions:w.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):i.hasPattern&&(i instanceof t.bp||i instanceof t.bq||i instanceof t.br)&&(r(i.layers,this.zoom,o),i.addFeatures(u,this.tileID.canonical,w.patternPositions))}return this.status="done",{buckets:Object.values(c).filter((t=>!t.isEmpty())),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:b.image,imageAtlas:w,glyphMap:this.returnDependencies?_:null,iconMap:this.returnDependencies?v:null,glyphPositions:this.returnDependencies?b.positions:null}}))}}function r(e,i,n){const r=new t.a9(i);for(const t of e)t.recalculate(r,n)}class o{constructor(t,e,i){this.actor=t,this.layerIndex=e,this.availableImages=i,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(e,i){return t._(this,void 0,void 0,(function*(){const n=yield t.l(e.request,i);try{return{vectorTile:new t.bs.VectorTile(new t.bt(n.data)),rawData:n.data,cacheControl:n.cacheControl,expires:n.expires}}catch(t){const i=new Uint8Array(n.data);let r=`Unable to parse the tile at ${e.request.url}, `;throw r+=31===i[0]&&139===i[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${t.message}`,new Error(r)}}))}loadTile(e){return t._(this,void 0,void 0,(function*(){const i=e.uid,r=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.bu(e.request),o=new n(e);this.loading[i]=o;const s=new AbortController;o.abort=s;try{const n=yield this.loadVectorTile(e,s);if(delete this.loading[i],!n)return null;const a=n.rawData,l={};n.expires&&(l.expires=n.expires),n.cacheControl&&(l.cacheControl=n.cacheControl);const c={};if(r){const t=r.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}o.vectorTile=n.vectorTile;const u=o.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[i]=o,this.fetching[i]={rawTileData:a,cacheControl:l,resourceTiming:c};try{const e=yield u;return t.e({rawTileData:a.slice(0)},e,l,c)}finally{delete this.fetching[i]}}catch(t){throw delete this.loading[i],o.status="done",this.loaded[i]=o,t}}))}reloadTile(e){return t._(this,void 0,void 0,(function*(){const i=e.uid;if(!this.loaded||!this.loaded[i])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const n=this.loaded[i];if(n.showCollisionBoxes=e.showCollisionBoxes,"parsing"===n.status){const e=yield n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor);let r;if(this.fetching[i]){const{rawTileData:n,cacheControl:o,resourceTiming:s}=this.fetching[i];delete this.fetching[i],r=t.e({rawTileData:n.slice(0)},e,o,s)}else r=e;return r}if("done"===n.status&&n.vectorTile)return n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(e){return t._(this,void 0,void 0,(function*(){const t=this.loading,i=e.uid;t&&t[i]&&t[i].abort&&(t[i].abort.abort(),delete t[i])}))}removeTile(e){return t._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]}))}}class s{constructor(){this.loaded={}}loadTile(e){return t._(this,void 0,void 0,(function*(){const{uid:i,encoding:n,rawImageData:r,redFactor:o,greenFactor:s,blueFactor:a,baseShift:l}=e,c=r.width+2,u=r.height+2,h=t.b(r)?new t.R({width:c,height:u},yield t.bv(r,-1,-1,c,u)):r,d=new t.bw(i,h,n,o,s,a,l);return this.loaded=this.loaded||{},this.loaded[i]=d,d}))}removeTile(t){const e=this.loaded,i=t.uid;e&&e[i]&&delete e[i]}}function a(t,e){if(0!==t.length){l(t[0],e);for(var i=1;i<t.length;i++)l(t[i],!e)}}function l(t,e){for(var i=0,n=0,r=0,o=t.length,s=o-1;r<o;s=r++){var a=(t[r][0]-t[s][0])*(t[s][1]+t[r][1]),l=i+a;n+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+n>=0!=!!e&&t.reverse()}var c=t.bx((function t(e,i){var n,r=e&&e.type;if("FeatureCollection"===r)for(n=0;n<e.features.length;n++)t(e.features[n],i);else if("GeometryCollection"===r)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],i);else if("Feature"===r)t(e.geometry,i);else if("Polygon"===r)a(e.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<e.coordinates.length;n++)a(e.coordinates[n],i);return e}));const u=t.bs.VectorTileFeature.prototype.toGeoJSON;var h={exports:{}},d=t.by,p=t.bs.VectorTileFeature,f=m;function m(t,e){this.options=e||{},this.features=t,this.length=t.length}function g(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}m.prototype.feature=function(t){return new g(this.features[t],this.options.extent)},g.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],r=0;r<i.length;r++)n.push(new d(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},g.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},g.prototype.toGeoJSON=p.prototype.toGeoJSON;var y=t.bz,_=f;function v(t){var e=new y;return function(t,e){for(var i in t.layers)e.writeMessage(3,x,t.layers[i])}(t,e),e.finish()}function x(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,b,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var o=n.values;for(i=0;i<o.length;i++)e.writeMessage(4,P,o[i])}function b(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,w,t),e.writeVarintField(3,i.type),e.writeMessage(4,I,i)}function w(t,e){var i=t.feature,n=t.keys,r=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(n.push(a),o[a]=c=n.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(r.push(l),s[h]=d=r.length-1),e.writeVarint(d)}}}function S(t,e){return(e<<3)+(7&t)}function T(t){return t<<1^t>>31}function I(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===n&&(c=l.length),e.writeVarint(S(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&e.writeVarint(S(2,u-1));var d=l[h].x-r,p=l[h].y-o;e.writeVarint(T(d)),e.writeVarint(T(p)),r+=d,o+=p}3===n&&e.writeVarint(S(7,1))}}function P(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}h.exports=v,h.exports.fromVectorTileJs=v,h.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var n in t)i[n]=new _(t[n].features,e),i[n].name=n,i[n].version=e.version,i[n].extent=e.extent;return v({layers:i})},h.exports.GeoJSONWrapper=_;var k=t.bx(h.exports);const C={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},A=Math.fround||(E=new Float32Array(1),t=>(E[0]=+t,E[0]));var E;const M=3,z=5,D=6;class L{constructor(t){this.options=Object.assign(Object.create(C),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:n}=this.options;e&&console.time("total time");const r=`prepare ${t.length} points`;e&&console.time(r),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[n,r]=i.geometry.coordinates,s=A(F(n)),a=A(O(r));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[n+1]=this._createTree(o);e&&console.timeEnd(r);for(let t=n;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,r=180;else if(i>r){const t=this.getClusters([i,n,180,o],e),s=this.getClusters([-180,n,r,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(F(i),O(o),F(r),O(n)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+z]>1?R(l,e,this.clusterProps):this.points[l[e+M]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const o=r.data;if(e*this.stride>=o.length)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+z]>1?R(o,i,this.clusterProps):this.points[o[i+M]])}if(0===l.length)throw new Error(n);return l}getLeaves(t,e,i){const n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n}getTile(t,e,i){const n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/r,c=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((e-a)/r,l,(e+1+a)/r,c),n.data,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-a/r,l,1,c),n.data,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,l,a/r,c),n.data,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,n,r){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?r+o.point_count<=n?r+=o.point_count:r=this._appendLeaves(t,o.cluster_id,i,n,r):r<n?r++:t.push(e),t.length===i)break}return r}_createTree(e){const i=new t.aw(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,n,r,o){for(const s of t){const t=s*this.stride,a=e[t+z]>1;let l,c,u;if(a)l=B(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+M]];l=i.properties;const[n,r]=i.geometry.coordinates;c=F(n),u=O(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let d;d=a||this.options.generateId?e[t+M]:this.points[e[t+M]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:n,reduce:r,minPoints:o}=this.options,s=i/(n*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const n=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),d=a[i+z];let p=d;for(const t of h){const i=t*c;a[i+2]>e&&(p+=a[i+z])}if(p>d&&p>=o){let t,o=n*d,s=u*d,f=-1;const m=(i/c<<5)+(e+1)+this.points.length;for(const n of h){const l=n*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+z];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,r&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),r(t,this._map(a,l)))}a[i+4]=m,l.push(o/p,s/p,1/0,m,-1,p),r&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(p>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+z]>1){const n=this.clusterProps[t[e+D]];return i?Object.assign({},n):n}const n=this.points[t[e+M]].properties,r=this.options.map(n);return i&&r===n?Object.assign({},r):r}}function R(t,e,i){return{type:"Feature",id:t[e+M],properties:B(t,e,i),geometry:{type:"Point",coordinates:[(n=t[e],360*(n-.5)),j(t[e+1])]}};var n}function B(t,e,i){const n=t[e+z],r=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,o=t[e+D],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+M],point_count:n,point_count_abbreviated:r})}function F(t){return t/360+.5}function O(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function j(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function N(t,e,i,n){let r=n;const o=e+(i-e>>1);let s,a=i-e;const l=t[e],c=t[e+1],u=t[i],h=t[i+1];for(let n=e+3;n<i;n+=3){const e=V(t[n],t[n+1],l,c,u,h);if(e>r)s=n,r=e;else if(e===r){const t=Math.abs(n-o);t<a&&(s=n,a=t)}}r>n&&(s-e>3&&N(t,e,s,n),t[s+2]=r,i-s>3&&N(t,s,i,n))}function V(t,e,i,n,r,o){let s=r-i,a=o-n;if(0!==s||0!==a){const l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return s=t-i,a=e-n,s*s+a*a}function $(t,e,i,n){const r={id:null==t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)U(r,i);else if("Polygon"===e)U(r,i[0]);else if("MultiLineString"===e)for(const t of i)U(r,t);else if("MultiPolygon"===e)for(const t of i)U(r,t[0]);return r}function U(t,e){for(let i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function q(t,e,i,n){if(!e.geometry)return;const r=e.geometry.coordinates;if(r&&0===r.length)return;const o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===o)Z(r,a);else if("MultiPoint"===o)for(const t of r)Z(t,a);else if("LineString"===o)G(r,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(const i of r)a=[],G(i,a,s,!1),t.push($(l,"LineString",a,e.properties));return}K(r,a,s,!1)}else if("Polygon"===o)K(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const r of e.geometry.geometries)q(t,{id:l,geometry:r,properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of r){const e=[];K(t,e,s,!0),a.push(e)}}t.push($(l,o,a,e.properties))}function Z(t,e){e.push(H(t[0]),W(t[1]),0)}function G(t,e,i,n){let r,o,s=0;for(let i=0;i<t.length;i++){const a=H(t[i][0]),l=W(t[i][1]);e.push(a,l,0),i>0&&(s+=n?(r*l-a*o)/2:Math.sqrt(Math.pow(a-r,2)+Math.pow(l-o,2))),r=a,o=l}const a=e.length-3;e[2]=1,N(e,0,a,i),e[a+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function K(t,e,i,n){for(let r=0;r<t.length;r++){const o=[];G(t[r],o,i,n),e.push(o)}}function H(t){return t/360+.5}function W(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function X(t,e,i,n,r,o,s,a){if(n/=e,o>=(i/=e)&&s<n)return t;if(s<i||o>=n)return null;const l=[];for(const e of t){const t=e.geometry;let o=e.type;const s=0===r?e.minX:e.minY,c=0===r?e.maxX:e.maxY;if(s>=i&&c<n){l.push(e);continue}if(c<i||s>=n)continue;let u=[];if("Point"===o||"MultiPoint"===o)J(t,u,i,n,r);else if("LineString"===o)Y(t,u,i,n,r,!1,a.lineMetrics);else if("MultiLineString"===o)tt(t,u,i,n,r,!1);else if("Polygon"===o)tt(t,u,i,n,r,!0);else if("MultiPolygon"===o)for(const e of t){const t=[];tt(e,t,i,n,r,!0),t.length&&u.push(t)}if(u.length){if(a.lineMetrics&&"LineString"===o){for(const t of u)l.push($(e.id,o,t,e.tags));continue}"LineString"!==o&&"MultiLineString"!==o||(1===u.length?(o="LineString",u=u[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===u.length?"Point":"MultiPoint"),l.push($(e.id,o,u,e.tags))}}return l.length?l:null}function J(t,e,i,n,r){for(let o=0;o<t.length;o+=3){const s=t[o+r];s>=i&&s<=n&&et(e,t[o],t[o+1],t[o+2])}}function Y(t,e,i,n,r,o,s){let a=Q(t);const l=0===r?it:nt;let c,u,h=t.start;for(let d=0;d<t.length-3;d+=3){const p=t[d],f=t[d+1],m=t[d+2],g=t[d+3],y=t[d+4],_=0===r?p:f,v=0===r?g:y;let x=!1;s&&(c=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),_<i?v>i&&(u=l(a,p,f,g,y,i),s&&(a.start=h+c*u)):_>n?v<n&&(u=l(a,p,f,g,y,n),s&&(a.start=h+c*u)):et(a,p,f,m),v<i&&_>=i&&(u=l(a,p,f,g,y,i),x=!0),v>n&&_<=n&&(u=l(a,p,f,g,y,n),x=!0),!o&&x&&(s&&(a.end=h+c*u),e.push(a),a=Q(t)),s&&(h+=c)}let d=t.length-3;const p=t[d],f=t[d+1],m=0===r?p:f;m>=i&&m<=n&&et(a,p,f,t[d+2]),d=a.length-3,o&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&et(a,a[0],a[1],a[2]),a.length&&e.push(a)}function Q(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function tt(t,e,i,n,r,o){for(const s of t)Y(s,e,i,n,r,o,!1)}function et(t,e,i,n){t.push(e,i,n)}function it(t,e,i,n,r,o){const s=(o-e)/(n-e);return et(t,o,i+(r-i)*s,1),s}function nt(t,e,i,n,r,o){const s=(o-i)/(r-i);return et(t,e+(n-e)*s,o,1),s}function rt(t,e){const i=[];for(let n=0;n<t.length;n++){const r=t[n],o=r.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=ot(r.geometry,e);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const t of r.geometry)s.push(ot(t,e))}else if("MultiPolygon"===o){s=[];for(const t of r.geometry){const i=[];for(const n of t)i.push(ot(n,e));s.push(i)}}i.push($(r.id,o,s,r.tags))}return i}function ot(t,e){const i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(let n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function st(t,e){if(t.transformed)return t;const i=1<<t.z,n=t.x,r=t.y;for(const o of t.features){const t=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let s=0;s<t.length;s+=2)o.geometry.push(at(t[s],t[s+1],e,i,n,r));else for(let s=0;s<t.length;s++){const a=[];for(let o=0;o<t[s].length;o+=2)a.push(at(t[s][o],t[s][o+1],e,i,n,r));o.geometry.push(a)}}return t.transformed=!0,t}function at(t,e,i,n,r,o){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-o))]}function lt(t,e,i,n,r){const o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)ct(s,e,o,r);return s}function ct(t,e,i,n){const r=e.geometry,o=e.type,s=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===o||"MultiPoint"===o)for(let e=0;e<r.length;e+=3)s.push(r[e],r[e+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)ut(s,r,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let e=0;e<r.length;e++)ut(s,r[e],t,i,"Polygon"===o,0===e);else if("MultiPolygon"===o)for(let e=0;e<r.length;e++){const n=r[e];for(let e=0;e<n.length;e++)ut(s,n[e],t,i,!0,0===e)}if(s.length){let i=e.tags||null;if("LineString"===o&&n.lineMetrics){i={};for(const t in e.tags)i[t]=e.tags[t];i.mapbox_clip_start=r.start/r.size,i.mapbox_clip_end=r.end/r.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:i};null!==e.id&&(a.id=e.id),t.features.push(a)}}function ut(t,e,i,n,r,o){const s=n*n;if(n>0&&e.size<(r?s:n))return void(i.numPoints+=e.length/3);const a=[];for(let t=0;t<e.length;t+=3)(0===n||e[t+2]>s)&&(i.numSimplified++,a.push(e[t],e[t+1])),i.numPoints++;r&&function(t,e){let i=0;for(let e=0,n=t.length,r=n-2;e<n;r=e,e+=2)i+=(t[e]-t[r])*(t[e+1]+t[r+1]);if(i>0===e)for(let e=0,i=t.length;e<i/2;e+=2){const n=t[e],r=t[e+1];t[e]=t[i-2-e],t[e+1]=t[i-1-e],t[i-2-e]=n,t[i-1-e]=r}}(a,o),t.push(a)}const ht={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class dt{constructor(t,e){const i=(e=this.options=function(t,e){for(const i in e)t[i]=e[i];return t}(Object.create(ht),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let n=function(t,e){const i=[];if("FeatureCollection"===t.type)for(let n=0;n<t.features.length;n++)q(i,t.features[n],e,n);else q(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(t,e){const i=e.buffer/e.extent;let n=t;const r=X(t,1,-1-i,i,0,-1,2,e),o=X(t,1,1-i,2+i,0,-1,2,e);return(r||o)&&(n=X(t,1,-i,1+i,0,-1,2,e)||[],r&&(n=rt(r,1).concat(n)),o&&(n=n.concat(rt(o,-1)))),n}(n,e),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,i,n,r,o,s){const a=[t,e,i,n],l=this.options,c=l.debug;for(;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();const u=1<<e,h=pt(e,i,n);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=lt(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(d.source=t,null==r){if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===r)continue;if(null!=r){const t=r-e;if(i!==o>>t||n!==s>>t)continue}}if(d.source=null,0===t.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,m=.5+p,g=1+p;let y=null,_=null,v=null,x=null,b=X(t,u,i-p,i+m,0,d.minX,d.maxX,l),w=X(t,u,i+f,i+g,0,d.minX,d.maxX,l);t=null,b&&(y=X(b,u,n-p,n+m,1,d.minY,d.maxY,l),_=X(b,u,n+f,n+g,1,d.minY,d.maxY,l),b=null),w&&(v=X(w,u,n-p,n+m,1,d.minY,d.maxY,l),x=X(w,u,n+f,n+g,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(y||[],e+1,2*i,2*n),a.push(_||[],e+1,2*i,2*n+1),a.push(v||[],e+1,2*i+1,2*n),a.push(x||[],e+1,2*i+1,2*n+1)}}getTile(t,e,i){t=+t,e=+e,i=+i;const n=this.options,{extent:r,debug:o}=n;if(t<0||t>24)return null;const s=1<<t,a=pt(t,e=e+s&s-1,i);if(this.tiles[a])return st(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);let l,c=t,u=e,h=i;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[pt(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?st(this.tiles[a],r):null):null}}function pt(t,e,i){return 32*((1<<t)*i+e)+t}function ft(t,e){return e?t.properties[e]:t.id}function mt(t,e){if(null==t)return!0;if("Feature"===t.type)return null!=ft(t,e);if("FeatureCollection"===t.type){const i=new Set;for(const n of t.features){const t=ft(n,e);if(null==t)return!1;if(i.has(t))return!1;i.add(t)}return!0}return!1}function gt(t,e){const i=new Map;if(null==t);else if("Feature"===t.type)i.set(ft(t,e),t);else for(const n of t.features)i.set(ft(n,e),n);return i}class yt extends o{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(e,i){return t._(this,void 0,void 0,(function*(){const i=e.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return null;const r=new class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.X,this.length=e.length,this._features=e}feature(e){return new class{constructor(e){this._feature=e,this.extent=t.X,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const n=[];for(const e of i)n.push(new t.P(e[0],e[1]));e.push(n)}return e}}toGeoJSON(t,e,i){return u.call(this,t,e,i)}}(this._features[e])}}(n.features);let o=k(r);return 0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),{vectorTile:r,rawData:o.buffer}}))}loadData(e){return t._(this,void 0,void 0,(function*(){var i;null===(i=this._pendingRequest)||void 0===i||i.abort();const n=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.bu(e.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(e,this._pendingRequest),this._geoJSONIndex=e.cluster?new L(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const n={},r={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const e of a){const[o,s]=i[e],a=t.bB(s),l=t.bB("string"==typeof o?[o,["accumulated"],["get",e]]:o);n[e]=a.value,r[e]=l.value}return e.map=t=>{s.properties=t;const e={};for(const t of a)e[t]=n[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=r[e].evaluate(o,s)},e}(e)).load((yield this._pendingData).features):(r=yield this._pendingData,new dt(r,e.geojsonVtOptions)),this.loaded={};const i={};if(n){const t=n.finish();t&&(i.resourceTiming={},i.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}return i}catch(e){if(delete this._pendingRequest,t.bA(e))return{abandoned:!0};throw e}var r}))}getData(){return t._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(t){const e=this.loaded;return e&&e[t.uid]?super.reloadTile(t):this.loadTile(t)}loadAndProcessGeoJSON(e,i){return t._(this,void 0,void 0,(function*(){let n=yield this.loadGeoJSON(e,i);if(delete this._pendingRequest,"object"!=typeof n)throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(c(n,!0),e.filter){const i=t.bB(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const r=n.features.filter((t=>i.value.evaluate({zoom:0},t)));n={type:"FeatureCollection",features:r}}return n}))}loadGeoJSON(e,i){return t._(this,void 0,void 0,(function*(){const{promoteId:n}=e;if(e.request){const r=yield t.h(e.request,i);return this._dataUpdateable=mt(r.data,n)?gt(r.data,n):void 0,r.data}if("string"==typeof e.data)try{const t=JSON.parse(e.data);return this._dataUpdateable=mt(t,n)?gt(t,n):void 0,t}catch(t){throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`)}if(!e.dataDiff)throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${e.source}`);return function(t,e,i){var n,r,o,s;if(e.removeAll&&t.clear(),e.remove)for(const i of e.remove)t.delete(i);if(e.add)for(const n of e.add){const e=ft(n,i);null!=e&&t.set(e,n)}if(e.update)for(const i of e.update){let e=t.get(i.id);if(null==e)continue;const a=!i.removeAllProperties&&((null===(n=i.removeProperties)||void 0===n?void 0:n.length)>0||(null===(r=i.addOrUpdateProperties)||void 0===r?void 0:r.length)>0);if((i.newGeometry||i.removeAllProperties||a)&&(e=Object.assign({},e),t.set(i.id,e),a&&(e.properties=Object.assign({},e.properties))),i.newGeometry&&(e.geometry=i.newGeometry),i.removeAllProperties)e.properties={};else if((null===(o=i.removeProperties)||void 0===o?void 0:o.length)>0)for(const t of i.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,t)&&delete e.properties[t];if((null===(s=i.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:t,value:n}of i.addOrUpdateProperties)e.properties[t]=n}}(this._dataUpdateable,e.dataDiff,n),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(e){return t._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(t){return this._geoJSONIndex.getClusterExpansionZoom(t.clusterId)}getClusterChildren(t){return this._geoJSONIndex.getChildren(t.clusterId)}getClusterLeaves(t){return this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset)}}class _t{constructor(e){this.self=e,this.actor=new t.F(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(t,e)=>{if(this.externalWorkerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.externalWorkerSourceTypes[t]=e},this.self.addProtocol=t.bh,this.self.removeProtocol=t.bi,this.self.registerRTLTextPlugin=e=>{if(t.bC.isParsed())throw new Error("RTL text plugin already registered.");t.bC.setMethods(e)},this.actor.registerMessageHandler("LDT",((t,e)=>this._getDEMWorkerSource(t,e.source).loadTile(e))),this.actor.registerMessageHandler("RDT",((e,i)=>t._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(e,i.source).removeTile(i)})))),this.actor.registerMessageHandler("GCEZ",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterExpansionZoom(i)})))),this.actor.registerMessageHandler("GCC",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterChildren(i)})))),this.actor.registerMessageHandler("GCL",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterLeaves(i)})))),this.actor.registerMessageHandler("LD",((t,e)=>this._getWorkerSource(t,e.type,e.source).loadData(e))),this.actor.registerMessageHandler("GD",((t,e)=>this._getWorkerSource(t,e.type,e.source).getData())),this.actor.registerMessageHandler("LT",((t,e)=>this._getWorkerSource(t,e.type,e.source).loadTile(e))),this.actor.registerMessageHandler("RT",((t,e)=>this._getWorkerSource(t,e.type,e.source).reloadTile(e))),this.actor.registerMessageHandler("AT",((t,e)=>this._getWorkerSource(t,e.type,e.source).abortTile(e))),this.actor.registerMessageHandler("RMT",((t,e)=>this._getWorkerSource(t,e.type,e.source).removeTile(e))),this.actor.registerMessageHandler("RS",((e,i)=>t._(this,void 0,void 0,(function*(){if(!this.workerSources[e]||!this.workerSources[e][i.type]||!this.workerSources[e][i.type][i.source])return;const t=this.workerSources[e][i.type][i.source];delete this.workerSources[e][i.type][i.source],void 0!==t.removeSource&&t.removeSource(i)})))),this.actor.registerMessageHandler("RM",(e=>t._(this,void 0,void 0,(function*(){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e]})))),this.actor.registerMessageHandler("SR",((e,i)=>t._(this,void 0,void 0,(function*(){this.referrer=i})))),this.actor.registerMessageHandler("SRPS",((t,e)=>this._syncRTLPluginState(t,e))),this.actor.registerMessageHandler("IS",((e,i)=>t._(this,void 0,void 0,(function*(){this.self.importScripts(i)})))),this.actor.registerMessageHandler("SI",((t,e)=>this._setImages(t,e))),this.actor.registerMessageHandler("UL",((e,i)=>t._(this,void 0,void 0,(function*(){this._getLayerIndex(e).update(i.layers,i.removedIds)})))),this.actor.registerMessageHandler("SL",((e,i)=>t._(this,void 0,void 0,(function*(){this._getLayerIndex(e).replace(i)}))))}_setImages(e,i){return t._(this,void 0,void 0,(function*(){this.availableImages[e]=i;for(const t in this.workerSources[e]){const n=this.workerSources[e][t];for(const t in n)n[t].availableImages=i}}))}_syncRTLPluginState(e,i){return t._(this,void 0,void 0,(function*(){if(t.bC.isParsed())return t.bC.getState();if("loading"!==i.pluginStatus)return t.bC.setState(i),i;const e=i.pluginURL;if(this.self.importScripts(e),t.bC.isParsed()){const i={pluginStatus:"loaded",pluginURL:e};return t.bC.setState(i),i}throw t.bC.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${e}`)}))}_getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}_getLayerIndex(t){let i=this.layerIndexes[t];return i||(i=this.layerIndexes[t]=new e),i}_getWorkerSource(t,e,i){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][i]){const n={sendAsync:(e,i)=>(e.targetMapId=t,this.actor.sendAsync(e,i))};switch(e){case"vector":this.workerSources[t][e][i]=new o(n,this._getLayerIndex(t),this._getAvailableImages(t));break;case"geojson":this.workerSources[t][e][i]=new yt(n,this._getLayerIndex(t),this._getAvailableImages(t));break;default:this.workerSources[t][e][i]=new this.externalWorkerSourceTypes[e](n,this._getLayerIndex(t),this._getAvailableImages(t))}}return this.workerSources[t][e][i]}_getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new s),this.demWorkerSources[t][e]}}return t.i(self)&&(self.worker=new _t(self)),_t})),i("index",["exports","./shared"],(function(t,e){var i="4.5.0";let n,r;const o={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:t=>new Promise(((i,n)=>{const r=requestAnimationFrame(i);t.signal.addEventListener("abort",(()=>{cancelAnimationFrame(r),n(e.c())}))})),getImageData(t,e=0){return this.getImageCanvasContext(t).getImageData(-e,-e,t.width+2*e,t.height+2*e)},getImageCanvasContext(t){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i},resolveURL:t=>(n||(n=document.createElement("a")),n.href=t,n.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==r&&(r=matchMedia("(prefers-reduced-motion: reduce)")),r.matches)}};class s{static testProp(t){if(!s.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in s.docStyle)return t[e];return t[0]}static create(t,e,i){const n=window.document.createElement(t);return void 0!==e&&(n.className=e),i&&i.appendChild(n),n}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){s.docStyle&&s.selectProp&&(s.userSelect=s.docStyle[s.selectProp],s.docStyle[s.selectProp]="none")}static enableDrag(){s.docStyle&&s.selectProp&&(s.docStyle[s.selectProp]=s.userSelect)}static setTransform(t,e){t.style[s.transformProp]=e}static addEventListener(t,e,i,n={}){t.addEventListener(e,i,"passive"in n?n:n.capture)}static removeEventListener(t,e,i,n={}){t.removeEventListener(e,i,"passive"in n?n:n.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",s.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",s.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",s.suppressClickInternal,!0)}),0)}static getScale(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}static getPoint(t,i,n){const r=i.boundingClientRect;return new e.P((n.clientX-r.left)/i.x-t.clientLeft,(n.clientY-r.top)/i.y-t.clientTop)}static mousePos(t,e){const i=s.getScale(t);return s.getPoint(t,i,e)}static touchPos(t,e){const i=[],n=s.getScale(t);for(let r=0;r<e.length;r++)i.push(s.getPoint(t,n,e[r]));return i}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}s.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,s.selectProp=s.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),s.transformProp=s.testProp(["transform","WebkitTransform"]);const a={supported:!1,testSupport:function(t){!u&&c&&(h?d(t):l=t)}};let l,c,u=!1,h=!1;function d(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,c),t.isContextLost())return;a.supported=!0}catch(t){}t.deleteTexture(e),u=!0}var p;"undefined"!=typeof document&&(c=document.createElement("img"),c.onload=()=>{l&&d(l),l=null,h=!0},c.onerror=()=>{u=!0,l=null},c.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(t){let i,n,r,o;t.resetRequestQueue=()=>{i=[],n=0,r=0,o={}},t.addThrottleControl=t=>{const e=r++;return o[e]=t,e},t.removeThrottleControl=t=>{delete o[t],l()},t.getImage=(t,n,r=!0)=>new Promise(((o,s)=>{a.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),e.e(t,{type:"image"}),i.push({abortController:n,requestParameters:t,supportImageRefresh:r,state:"queued",onError:t=>{s(t)},onSuccess:t=>{o(t)}}),l()}));const s=t=>e._(this,void 0,void 0,(function*(){t.state="running";const{requestParameters:i,supportImageRefresh:r,onError:o,onSuccess:s,abortController:a}=t,u=!1===r&&!e.i(self)&&!e.g(i.url)&&(!i.headers||Object.keys(i.headers).reduce(((t,e)=>t&&"accept"===e),!0));n++;const h=u?c(i,a):e.m(i,a);try{const i=yield h;delete t.abortController,t.state="completed",i.data instanceof HTMLImageElement||e.b(i.data)?s(i):i.data&&s({data:yield(d=i.data,"function"==typeof createImageBitmap?e.d(d):e.f(d)),cacheControl:i.cacheControl,expires:i.expires})}catch(e){delete t.abortController,o(e)}finally{n--,l()}var d})),l=()=>{const t=(()=>{for(const t of Object.keys(o))if(o[t]())return!0;return!1})()?e.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:e.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let e=n;e<t&&i.length>0;e++){const t=i.shift();t.abortController.signal.aborted?e--:s(t)}},c=(t,i)=>new Promise(((n,r)=>{const o=new Image,s=t.url,a=t.credentials;a&&"include"===a?o.crossOrigin="use-credentials":(a&&"same-origin"===a||!e.s(s))&&(o.crossOrigin="anonymous"),i.signal.addEventListener("abort",(()=>{o.src="",r(e.c())})),o.fetchPriority="high",o.onload=()=>{o.onerror=o.onload=null,n({data:o})},o.onerror=()=>{o.onerror=o.onload=null,i.signal.aborted||r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},o.src=s}))}(p||(p={})),p.resetRequestQueue();class f{constructor(t){this._transformRequestFn=t}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function m(t){var i=new e.A(3);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}var g,y=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t};g=new e.A(3),e.A!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0);var _=function(t){var e=t[0],i=t[1];return e*e+i*i};function v(t){const e=[];if("string"==typeof t)e.push({id:"default",url:t});else if(t&&t.length>0){const i=[];for(const{id:n,url:r}of t){const t=`${n}${r}`;-1===i.indexOf(t)&&(i.push(t),e.push({id:n,url:r}))}}return e}function x(t,e,i){const n=t.split("?");return n[0]+=`${e}${i}`,n.join("?")}!function(){var t=new e.A(2);e.A!=Float32Array&&(t[0]=0,t[1]=0)}();class b{constructor(t,e,i,n){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)}update(t,i,n){const{width:r,height:o}=t,s=!(this.size&&this.size[0]===r&&this.size[1]===o||n),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(i&&i.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!i||!1!==i.premultiply)),s)this.size=[r,o],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.b(t)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,t):l.texImage2D(l.TEXTURE_2D,0,this.format,r,o,0,this.format,l.UNSIGNED_BYTE,t.data);else{const{x:i,y:s}=n||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.b(t)?l.texSubImage2D(l.TEXTURE_2D,0,i,s,l.RGBA,l.UNSIGNED_BYTE,t):l.texSubImage2D(l.TEXTURE_2D,0,i,s,r,o,l.RGBA,l.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D)}bind(t,e,i){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),i!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function w(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class S extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,promiseResolve:e}of this.requestors)e(this._getImagesForIds(t));this.requestors=[]}}getImage(t){const i=this.images[t];if(i&&!i.data&&i.spriteData){const t=i.spriteData;i.data=new e.R({width:t.width,height:t.height},t.context.getImageData(t.x,t.y,t.width,t.height).data),i.spriteData=null}return i}addImage(t,e){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,e)&&(this.images[t]=e)}_validate(t,i){let n=!0;const r=i.data||i.spriteData;return this._validateStretch(i.stretchX,r&&r.width)||(this.fire(new e.j(new Error(`Image "${t}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,r&&r.height)||(this.fire(new e.j(new Error(`Image "${t}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new e.j(new Error(`Image "${t}" has invalid "content" value`))),n=!1),n}_validateStretch(t,e){if(!t)return!0;let i=0;for(const n of t){if(n[0]<i||n[1]<n[0]||e<n[1])return!1;i=n[1]}return!0}_validateContent(t,e){if(!t)return!0;if(4!==t.length)return!1;const i=e.spriteData,n=i&&i.width||e.data.width,r=i&&i.height||e.data.height;return!(t[0]<0||n<t[0]||t[1]<0||r<t[1]||t[2]<0||n<t[2]||t[3]<0||r<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,e,i=!0){const n=this.getImage(t);if(i&&(n.data.width!==e.data.width||n.data.height!==e.data.height))throw new Error(`size mismatch between old image (${n.data.width}x${n.data.height}) and new image (${e.data.width}x${e.data.height}).`);e.version=n.version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((e,i)=>{let n=!0;if(!this.isLoaded())for(const e of t)this.images[e]||(n=!1);this.isLoaded()||n?e(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:e})}))}_getImagesForIds(t){const i={};for(const n of t){let t=this.getImage(n);t||(this.fire(new e.k("styleimagemissing",{id:n})),t=this.getImage(n)),t?i[n]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,textFitWidth:t.textFitWidth,textFitHeight:t.textFitHeight,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(t){const i=this.patterns[t],n=this.getImage(t);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{const i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},r=new e.I(i,n);this.patterns[t]={bin:i,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new b(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:n}=e.p(t),r=this.atlasImage;r.resize({width:i||1,height:n||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],n=i.x+1,o=i.y+1,s=this.getImage(t).data,a=s.width,l=s.height;e.R.copy(s,r,{x:0,y:0},{x:n,y:o},{width:a,height:l}),e.R.copy(s,r,{x:0,y:l-1},{x:n,y:o-1},{width:a,height:1}),e.R.copy(s,r,{x:0,y:0},{x:n,y:o+l},{width:a,height:1}),e.R.copy(s,r,{x:a-1,y:0},{x:n-1,y:o},{width:1,height:l}),e.R.copy(s,r,{x:0,y:0},{x:n+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const i of t){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const t=this.getImage(i);t||e.w(`Image with ID: "${i}" was not found`),w(t)&&this.updateImage(i,t)}}}const T=1e20;function I(t,e,i,n,r,o,s,a,l){for(let c=e;c<e+n;c++)P(t,i*o+c,o,r,s,a,l);for(let c=i;c<i+r;c++)P(t,c*o+e,1,n,s,a,l)}function P(t,e,i,n,r,o,s){o[0]=0,s[0]=-T,s[1]=T,r[0]=t[e];for(let a=1,l=0,c=0;a<n;a++){r[a]=t[e+a*i];const n=a*a;do{const t=o[l];c=(r[a]-r[t]+n-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=T}for(let a=0,l=0;a<n;a++){for(;s[l+1]<a;)l++;const n=o[l],c=a-n;t[e+a*i]=r[n]+c*c}}class k{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return e._(this,void 0,void 0,(function*(){const e=[];for(const i in t)for(const n of t[i])e.push(this._getAndCacheGlyphsPromise(i,n));const i=yield Promise.all(e),n={};for(const{stack:t,id:e,glyph:r}of i)n[t]||(n[t]={}),n[t][e]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};return n}))}_getAndCacheGlyphsPromise(t,i){return e._(this,void 0,void 0,(function*(){let e=this.entries[t];e||(e=this.entries[t]={glyphs:{},requests:{},ranges:{}});let n=e.glyphs[i];if(void 0!==n)return{stack:t,id:i,glyph:n};if(n=this._tinySDF(e,t,i),n)return e.glyphs[i]=n,{stack:t,id:i,glyph:n};const r=Math.floor(i/256);if(256*r>65535)throw new Error("glyphs > 65535 not supported");if(e.ranges[r])return{stack:t,id:i,glyph:n};if(!this.url)throw new Error("glyphsUrl is not set");if(!e.requests[r]){const i=k.loadGlyphRange(t,r,this.url,this.requestManager);e.requests[r]=i}const o=yield e.requests[r];for(const t in o)this._doesCharSupportLocalGlyph(+t)||(e.glyphs[+t]=o[+t]);return e.ranges[r]=!0,{stack:t,id:i,glyph:o[i]||null}}))}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(e.u["CJK Unified Ideographs"](t)||e.u["Hangul Syllables"](t)||e.u.Hiragana(t)||e.u.Katakana(t))}_tinySDF(t,i,n){const r=this.localIdeographFontFamily;if(!r)return;if(!this._doesCharSupportLocalGlyph(n))return;let o=t.tinySDF;if(!o){let e="400";/bold/i.test(i)?e="900":/medium/i.test(i)?e="500":/light/i.test(i)&&(e="200"),o=t.tinySDF=new k.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:r,fontWeight:e})}const s=o.draw(String.fromCharCode(n));return{id:n,bitmap:new e.o({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}k.loadGlyphRange=function(t,i,n,r){return e._(this,void 0,void 0,(function*(){const o=256*i,s=o+255,a=r.transformRequest(n.replace("{fontstack}",t).replace("{range}",`${o}-${s}`),"Glyphs"),l=yield e.l(a,new AbortController);if(!l||!l.data)throw new Error(`Could not load glyph range. range: ${i}, ${o}-${s}`);const c={};for(const t of e.n(l.data))c[t.id]=t;return c}))},k.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(n)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,a,l),f.fillText(t,m,m+s);const _=f.getImageData(m,m,a,l);y.fill(T,0,h),g.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=_.data[4*(t*a+e)+3]/255;if(0===i)continue;const n=(t+m)*c+e+m;if(1===i)y[n]=0,g[n]=T;else{const t=.5-i;y[n]=t>0?t*t:0,g[n]=t<0?t*t:0}}I(y,0,0,c,u,c,this.f,this.v,this.z),I(g,m,m,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(y[t])-Math.sqrt(g[t]);d[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};class C{constructor(){this.specification=e.v.light.position}possiblyEvaluate(t,i){return e.y(t.expression.evaluate(i))}interpolate(t,i,n){return{x:e.z.number(t.x,i.x,n),y:e.z.number(t.y,i.y,n),z:e.z.number(t.z,i.z,n)}}}let A;class E extends e.E{constructor(t){super(),A=A||new e.q({anchor:new e.D(e.v.light.anchor),position:new C,color:new e.D(e.v.light.color),intensity:new e.D(e.v.light.intensity)}),this._transitionable=new e.T(A),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.r,t,i))for(const e in t){const i=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),i):this._transitionable.setValue(e,i)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,n){return(!n||!1!==n.validate)&&e.t(this,t.call(e.x,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.v}))}}const M=new e.q({"sky-color":new e.D(e.v.sky["sky-color"]),"horizon-color":new e.D(e.v.sky["horizon-color"]),"fog-color":new e.D(e.v.sky["fog-color"]),"fog-ground-blend":new e.D(e.v.sky["fog-ground-blend"]),"horizon-fog-blend":new e.D(e.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new e.D(e.v.sky["sky-horizon-blend"]),"atmosphere-blend":new e.D(e.v.sky["atmosphere-blend"])});class z extends e.E{constructor(t){super(),this._transitionable=new e.T(M),this.setSky(t),this._transitioning=this._transitionable.untransitioned()}setSky(t,i={}){if(!this._validate(e.B,t,i))for(const e in t){const i=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),i):this._transitionable.setValue(e,i)}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,n={}){return!1!==(null==n?void 0:n.validate)&&e.t(this,t.call(e.x,e.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class D{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const i=t.join(",")+String(e);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(t,e)),this.dashEntry[i]}getDashRanges(t,e,i){const n=[];let r=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;n.push({left:r,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];r=a*i,a+=l,o=a*i,n.push({left:r,right:o,isDash:s,zeroLength:0===l})}return n}addRoundDash(t,e,i){const n=e/2;for(let e=-i;e<=i;e++){const r=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=e/i*(n+1);if(s.isDash){const t=n-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=n-Math.sqrt(u*u+d*d);this.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let e=t.length-1;e>=0;--e){const i=t[e],n=t[e+1];i.zeroLength?t.splice(e,1):n&&n.isDash===i.isDash&&(n.left=i.left,t.splice(e,1))}const e=t[0],i=t[t.length-1];e.isDash===i.isDash&&(e.left=i.left-this.width,i.right=e.right+this.width);const n=this.width*this.nextRow;let r=0,o=t[r];for(let e=0;e<this.width;e++){e/o.right>1&&(o=t[++r]);const i=Math.abs(e-o.left),s=Math.abs(e-o.right),a=Math.min(i,s);this.data[n+e]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(t,i){const n=i?7:0,r=2*n+1;if(this.nextRow+r>this.height)return e.w("LineAtlas out of space"),null;let o=0;for(let e=0;e<t.length;e++)o+=t[e];if(0!==o){const e=this.width/o,r=this.getDashRanges(t,this.width,e);i?this.addRoundDash(r,e,n):this.addRegularDash(r)}const s={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:o};return this.nextRow+=r,this.dirty=!0,s}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}const L="maplibre_preloaded_worker_pool";class R{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<R.workerCount;)this.workers.push(new Worker(e.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[L]}numActive(){return Object.keys(this.active).length}}const B=Math.floor(o.hardwareConcurrency/2);let F,O;function j(){return F||(F=new R),F}R.workerCount=e.C(globalThis)?Math.max(Math.min(B,3),1):1;class N{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=i;const n=this.workerPool.acquire(i);for(let t=0;t<n.length;t++){const r=new e.F(n[t],i);r.name=`Worker ${t}`,this.actors.push(r)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,e){const i=[];for(const n of this.actors)i.push(n.sendAsync({type:t,data:e}));return Promise.all(i)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((t=>{t.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,e){for(const i of this.actors)i.registerMessageHandler(t,e)}}function V(){return O||(O=new N(j(),e.G),O.registerMessageHandler("GR",((t,i,n)=>e.m(i,n)))),O}function $(t,i){const n=e.H();return e.J(n,n,[1,1,0]),e.K(n,n,[.5*t.width,.5*t.height,1]),e.L(n,n,t.calculatePosMatrix(i.toUnwrapped()))}function U(t,e,i,n,r,o){const s=function(t,e,i){if(t)for(const n of t){const t=e[n];if(t&&t.source===i&&"fill-extrusion"===t.type)return!0}else for(const t in e){const n=e[t];if(n.source===i&&"fill-extrusion"===n.type)return!0}return!1}(r&&r.layers,e,t.id),a=o.maxPitchScaleFactor(),l=t.tilesIn(n,a,s);l.sort(q);const c=[];for(const n of l)c.push({wrappedTileID:n.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(e,i,t._state,n.queryGeometry,n.cameraQueryGeometry,n.scale,r,o,a,$(t.transform,n.tileID))});const u=function(t){const e={},i={};for(const n of t){const t=n.queryResults,r=n.wrappedTileID,o=i[r]=i[r]||{};for(const i in t){const n=t[i],r=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of n)r[t.featureIndex]||(r[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,n=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=n}));return u}function q(t,e){const i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}function Z(t,i,n){return e._(this,void 0,void 0,(function*(){let r=t;if(t.url?r=(yield e.h(i.transformRequest(t.url,"Source"),n)).data:yield o.frameAsync(n),!r)return null;const s=e.M(e.e(r,t),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in r&&r.vector_layers&&(s.vectorLayerIds=r.vector_layers.map((t=>t.id))),s}))}class G{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof e.N?new e.N(t.lng,t.lat):e.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof e.N?new e.N(t.lng,t.lat):e.N.convert(t),this}extend(t){const i=this._sw,n=this._ne;let r,o;if(t instanceof e.N)r=t,o=t;else{if(!(t instanceof G))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(G.convert(t)):this.extend(e.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(e.N.convert(t)):this;if(r=t._sw,o=t._ne,!r||!o)return this}return i||n?(i.lng=Math.min(r.lng,i.lng),i.lat=Math.min(r.lat,i.lat),n.lng=Math.max(o.lng,n.lng),n.lat=Math.max(o.lat,n.lat)):(this._sw=new e.N(r.lng,r.lat),this._ne=new e.N(o.lng,o.lat)),this}getCenter(){return new e.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new e.N(this.getWest(),this.getNorth())}getSouthEast(){return new e.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:n}=e.N.convert(t);let r=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&r}static convert(t){return t instanceof G?t:t?new G(t):t}static fromLngLat(t,i=0){const n=360*i/40075017,r=n/Math.cos(Math.PI/180*t.lat);return new G(new e.N(t.lng-r,t.lat-n),new e.N(t.lng+r,t.lat+n))}}class K{constructor(t,e,i){this.bounds=G.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),n=Math.floor(e.O(this.bounds.getWest())*i),r=Math.floor(e.Q(this.bounds.getNorth())*i),o=Math.ceil(e.O(this.bounds.getEast())*i),s=Math.ceil(e.Q(this.bounds.getSouth())*i);return t.x>=n&&t.x<o&&t.y>=r&&t.y<s}}class H extends e.E{constructor(t,i,n,r){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.M(i,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Z(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(e.e(this,t),t.bounds&&(this.tileBounds=new K(t.bounds,this.minzoom,this.maxzoom)),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new e.j(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return e.e({},this._options)}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i={request:this.map._requestManager.transformRequest(e,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.request.collectResourceTiming=this._collectResourceTiming;let n="RT";if(t.actor&&"expired"!==t.state){if("loading"===t.state)return new Promise(((e,i)=>{t.reloadPromise={resolve:e,reject:i}}))}else t.actor=this.dispatcher.getActor(),n="LT";t.abortController=new AbortController;try{const e=yield t.actor.sendAsync({type:n,data:i},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,e)}catch(e){if(delete t.abortController,t.aborted)return;if(e&&404!==e.status)throw e;this._afterTileLoadWorkerResponse(t,null)}}))}_afterTileLoadWorkerResponse(t,e){if(e&&e.resourceTiming&&(t.resourceTiming=e.resourceTiming),e&&this.map._refreshExpiredTiles&&t.setExpiryData(e),t.loadVectorData(e,this.map.painter),t.reloadPromise){const e=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(e.resolve).catch(e.reject)}}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class W extends e.E{constructor(t,i,n,r){super(),this.id=t,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},i),e.e(this,e.M(i,["url","scheme","tileSize"]))}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Z(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(e.e(this,t),t.bounds&&(this.tileBounds=new K(t.bounds,this.minzoom,this.maxzoom)),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new e.j(t))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return e.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const i=yield p.getImage(this.map._requestManager.transformRequest(e,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(i&&i.data){this.map._refreshExpiredTiles&&i.cacheControl&&i.expires&&t.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const e=this.map.painter.context,n=e.gl,r=i.data;t.texture=this.map.painter.getTileTexture(r.width),t.texture?t.texture.update(r,{useMipmap:!0}):(t.texture=new b(e,r,n.RGBA,{useMipmap:!0}),t.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE,n.LINEAR_MIPMAP_NEAREST),e.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}}))}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class X extends W{constructor(t,i,n,r){super(t,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(t){return e._(this,void 0,void 0,(function*(){const i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n=this.map._requestManager.transformRequest(i,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const i=yield p.getImage(n,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(i&&i.data){const n=i.data;this.map._refreshExpiredTiles&&i.cacheControl&&i.expires&&t.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const r=e.b(n)&&e.U()?n:yield this.readImageNow(n),o={type:this.type,uid:t.uid,source:this.id,rawImageData:r,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||"expired"===t.state){t.actor=this.dispatcher.getActor();const e=yield t.actor.sendAsync({type:"LDT",data:o});t.dem=e,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}}))}readImageNow(t){return e._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&e.V()){const i=t.width+2,n=t.height+2;try{return new e.R({width:i,height:n},yield e.W(t,-1,-1,i,n))}catch(t){}}return o.getImageData(t,1)}))}_getNeighboringTiles(t){const i=t.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,o=0===i.x?t.wrap-1:t.wrap,s=(i.x+1+n)%n,a=i.x+1===n?t.wrap+1:t.wrap,l={};return l[new e.S(t.overscaledZ,o,i.z,r,i.y).key]={backfilled:!1},l[new e.S(t.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new e.S(t.overscaledZ,o,i.z,r,i.y-1).key]={backfilled:!1},l[new e.S(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.S(t.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new e.S(t.overscaledZ,o,i.z,r,i.y+1).key]={backfilled:!1},l[new e.S(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.S(t.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}class J extends e.E{constructor(t,i,n,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=e.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=e.X/this.tileSize;this.workerOptions=e.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:e.X,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.X,radius:(i.clusterRadius||50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}load(){return e._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return e._(this,void 0,void 0,(function*(){const t=e.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(void 0!==t.clusterRadius&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),void 0!==t.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,e,i){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:e,offset:i}})}_updateWorkerData(t){return e._(this,void 0,void 0,(function*(){const i=e.e({type:this.type},this.workerOptions);t?i.dataDiff=t:"string"==typeof this._data?(i.request=this.map._requestManager.transformRequest(o.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new e.k("dataloading",{dataType:"source"}));try{const t=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||t.abandoned)return void this.fire(new e.k("dataabort",{dataType:"source"}));let n=null;t.resourceTiming&&t.resourceTiming[this.id]&&(n=t.resourceTiming[this.id].slice(0));const r={dataType:"source"};this._collectResourceTiming&&n&&n.length>0&&e.e(r,{resourceTiming:n}),this.fire(new e.k("data",Object.assign(Object.assign({},r),{sourceDataType:"metadata"}))),this.fire(new e.k("data",Object.assign(Object.assign({},r),{sourceDataType:"content"})))}catch(t){if(this._pendingLoads--,this._removed)return void this.fire(new e.k("dataabort",{dataType:"source"}));this.fire(new e.j(t))}}))}loaded(){return 0===this._pendingLoads}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.actor?"RT":"LT";t.actor=this.actor;const i={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const n=yield this.actor.sendAsync({type:e,data:i},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(n,this.map.painter,"RT"===e)}))}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Y=e.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Q extends e.E{constructor(t,e,i,n){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=e}load(t){return e._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const e=yield p.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,e&&e.data&&(this.image=e.data,t&&(this.coordinates=t),this._finishLoading())}catch(t){this._request=null,this._loaded=!0,this.fire(new e.j(t))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const i=t.map(e.Z.fromLngLat);this.tileID=function(t){let i=1/0,n=1/0,r=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y);const s=Math.max(r-i,o-n),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new e.a1(a,Math.floor((i+r)/2*l),Math.floor((n+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z;const n=i.map((t=>this.tileID.getTilePoint(t)._round()));return this._boundsArray=new e.$,this._boundsArray.emplaceBack(n[0].x,n[0].y,0,0),this._boundsArray.emplaceBack(n[1].x,n[1].y,e.X,0),this._boundsArray.emplaceBack(n[3].x,n[3].y,0,e.X),this._boundsArray.emplaceBack(n[2].x,n[2].y,e.X,e.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=e.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new b(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let n=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,n=!0)}n&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return e._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class tt extends Q{constructor(t,e,i,n){super(t,e,i,n),this.roundZoom=!0,this.type="video",this.options=e}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,"Source").url);try{const t=yield e.a3(this.urls);if(this._loaded=!0,!t)return;this.video=t,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(t){this.fire(new e.j(t))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.j(new e.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=e.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new b(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let n=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,n=!0)}n&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class et extends Q{constructor(t,i,n,r){super(t,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new e.j(new e.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.j(new e.a2(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.j(new e.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new e.j(new e.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.j(new e.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,n=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=e.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new b(i,this.canvas,n.RGBA,{premultiply:!0});let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const it={},nt=t=>{switch(t){case"geojson":return J;case"image":return Q;case"raster":return W;case"raster-dem":return X;case"vector":return H;case"video":return tt;case"canvas":return et}return it[t]},rt="RTLPluginLoaded";class ot extends e.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=V()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((t=>{throw this.status="error",t}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return e._(this,arguments,void 0,(function*(t,e=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=o.resolveURL(t),!this.url)throw new Error(`requested url ${t} is invalid`);if("unavailable"===this.status){if(!e)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return e._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new e.k(rt))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let st=null;function at(){return st||(st=new ot),st}class lt{constructor(t,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=e.a4(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,i,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const n of t){const t=n.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){n.layers=t,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.id]=n}}return i}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.a6){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.a6&&i.hasRTLText){this.hasRTLText=!0,at().lazyLoad();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(t).queryRadius(e))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new e.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new b(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new b(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,n,r,o,s,a,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:r,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l},t,e,i):{}}querySourceFeatures(t,i){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const r=n.loadVTLayers(),o=i&&i.sourceLayer?i.sourceLayer:"",s=r._geojsonTileLayer||r[o];if(!s)return;const a=e.a7(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const r=s.feature(i);if(a.needGeometry){const t=e.a8(r,!0);if(!a.filter(new e.a9(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!a.filter(new e.a9(this.tileID.overscaledZ),r))continue;const d=n.getId(r,o),p=new e.aa(r,l,c,u,d);p.tile=h,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.ab(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(i)if(this.expirationTime<i)e=!0;else{const n=this.expirationTime-i;n?this.expirationTime=t+Math.max(n,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const n in this.buckets){if(!e.style.hasLayer(n))continue;const r=this.buckets[n],o=r.layers[0].sourceLayer||"_geojsonTileLayer",s=i[o],a=t[o];if(!s||!a||0===Object.keys(a).length)continue;r.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(n);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.now()+t}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}}class ct{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:e,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(t,r)}),i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const n of this.data[i])t(n.value)||e.push(n);for(const t of e)this.remove(t.value.tileID,t)}}class ut{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,n){const r=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.e(this.stateChanges[t][r],n),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])n[e]||(this.deletedStates[t][r][e]=null)}else for(const e in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(i in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][i]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}getState(t,i){const n=String(i),r=e.e({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][i];if(null===e)return{};for(const t in e)delete r[t]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,i){const n={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const n in this.stateChanges[t])this.state[t][n]||(this.state[t][n]={}),e.e(this.state[t][n],this.stateChanges[t][n]),i[n]=this.state[t][n];n[t]=i}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e]}n[t]=n[t]||{},e.e(n[t],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const e in t)t[e].setFeatureState(n,i)}}class ht extends e.E{constructor(t,e,i){super(),this.id=t,this.dispatcher=i,this.on("data",(t=>this._dataHandler(t))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((t,e,i,n)=>{const r=new(nt(e.type))(t,e,i,n);if(r.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${r.id}`);return r})(t,e,i,this),this._tiles={},this._cache=new ct(0,(t=>this._unloadTile(t))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ut,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,i,n){return e._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,i,n)}catch(i){t.state="errored",404!==i.status?this._source.fire(new e.j(i,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new e.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(dt).map((t=>t.key))}getRenderableIds(t){const i=[];for(const e in this._tiles)this._isIdRenderable(e,t)&&i.push(this._tiles[e]);return t?i.sort(((t,i)=>{const n=t.tileID,r=i.tileID,o=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),s=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-r.overscaledZ||s.y-o.y||s.x-o.x})).map((t=>t.tileID.key)):i.map((t=>t.tileID)).sort(dt).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")}}_reloadTile(t,i){return e._(this,void 0,void 0,(function*(){const e=this._tiles[t];e&&("loading"!==e.state&&(e.state=i),yield this._loadTile(e,t,i))}))}_tileLoaded(t,i,n){t.timeAdded=o.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new e.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const e=this.getRenderableIds();for(let n=0;n<e.length;n++){const r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);i(t,e),i(e,t)}}function i(t,e){t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const n=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,n){for(const r in this._tiles){let o=this._tiles[r];if(n[r]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){n[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),n=this._getLoadedTile(e);if(n)return n}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const i=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(i*n*(null===this._maxTileCacheZoomLevels?e.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(o)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),t[n.tileID.key]=n}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(t,this._tiles[t])}}_updateCoveredAndRetainedTiles(t,e,i,n,r,s){const a={},l={},c=Object.keys(t),u=o.now();for(const i of c){const n=t[i],r=this._tiles[i];if(!r||0!==r.fadeEndTime&&r.fadeEndTime<=u)continue;const o=this.findLoadedParent(n,e),s=this.findLoadedSibling(n),c=o||s||null;c&&(this._addTile(c.tileID),a[c.tileID.key]=c.tileID),l[i]=n}this._retainLoadedChildren(l,n,i,t);for(const e in a)t[e]||(this._coveredTiles[e]=!0,t[e]=a[e]);if(s){const e={},i={};for(const t of r)this._tiles[t.key].hasData()?e[t.key]=t:i[t.key]=t;for(const n in i){const r=i[n].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(e[r[0].key]=t[r[0].key]=r[0],e[r[1].key]=t[r[1].key]=r[1],e[r[2].key]=t[r[2].key]=r[2],e[r[3].key]=t[r[3].key]=r[3],delete i[n])}for(const n in i){const r=i[n],o=this.findLoadedParent(r,this._source.minzoom),s=this.findLoadedSibling(r),a=o||s||null;if(a){e[a.tileID.key]=t[a.tileID.key]=a.tileID;for(const t in e)e[t].isChildOf(a.tileID)&&delete e[t]}}for(const t in this._tiles)e[t]||(this._coveredTiles[t]=!0)}}update(t,i){if(!this._sourceLoaded||this._paused)return;let n;this.transform=t,this.terrain=i,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.S(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y))):(n=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i}),this._source.hasTile&&(n=n.filter((t=>this._source.hasTile(t))))):n=[];const r=t.coveringZoomLevel(this._source),o=Math.max(r-ht.maxOverzooming,this._source.minzoom),s=Math.max(r+ht.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const t={};for(const e of n)if(e.canonical.z>this._source.minzoom){const i=e.scaledTo(e.canonical.z-1);t[i.key]=i;const n=e.scaledTo(Math.max(this._source.minzoom,Math.min(e.canonical.z,5)));t[n.key]=n}n=n.concat(Object.values(t))}const a=0===n.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new e.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(n,r);pt(this._source.type)&&this._updateCoveredAndRetainedTiles(l,o,s,r,n,i);for(const t in l)this._tiles[t].clearFadeHold();const c=e.ac(this._tiles,l);for(const t of c){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(t)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,e){var i;const n={},r={},o=Math.max(e-ht.maxOverzooming,this._source.minzoom),s=Math.max(e+ht.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);n[i.key]=i,t.hasData()||e<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,e,s,n);for(const s of t){let t=this._tiles[s.key];if(t.hasData())continue;if(e+1>this._source.maxzoom){const t=s.children(this._source.maxzoom)[0],e=this.getTile(t);if(e&&e.hasData()){n[t.key]=t;continue}}else{const t=s.children(this._source.maxzoom);if(n[t[0].key]&&n[t[1].key]&&n[t[2].key]&&n[t[3].key])continue}let a=t.wasRequested();for(let e=s.overscaledZ-1;e>=o;--e){const o=s.scaledTo(e);if(r[o.key])break;if(r[o.key]=!0,t=this.getTile(o),!t&&a&&(t=this._addTile(o)),t){const e=t.hasData();if((e||!(null===(i=this.map)||void 0===i?void 0:i.cancelPendingTileRequestsWhileZooming)||a)&&(n[o.key]=o),a=t.wasRequested(),e)break}}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,n=this._tiles[t].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}e.push(n.key);const t=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;n=t}for(const t of e)this._loadedParentTiles[t]=i}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const e=this._tiles[t].tileID,i=this._getLoadedTile(e);this._loadedSiblingTiles[e.key]=i}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const n=i;return i||(i=new lt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(i,t.key,i.state)),i.uses++,this._tiles[t.key]=i,n||this._source.fire(new e.k("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}_dataHandler(t){const e=t.sourceDataType;"source"===t.dataType&&"metadata"===e&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===e&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,i,n){const r=[],o=this.transform;if(!o)return r;const s=n?o.getCameraQueryGeometry(t):t,a=t.map((t=>o.pointCoordinate(t,this.terrain))),l=s.map((t=>o.pointCoordinate(t,this.terrain))),c=this.getIds();let u=1/0,h=1/0,d=-1/0,p=-1/0;for(const t of l)u=Math.min(u,t.x),h=Math.min(h,t.y),d=Math.max(d,t.x),p=Math.max(p,t.y);for(let t=0;t<c.length;t++){const n=this._tiles[c[t]];if(n.holdingForFade())continue;const s=n.tileID,f=Math.pow(2,o.zoom-n.tileID.overscaledZ),m=i*n.queryPadding*e.X/n.tileSize/f,g=[s.getTilePoint(new e.Z(u,h)),s.getTilePoint(new e.Z(d,p))];if(g[0].x-m<e.X&&g[0].y-m<e.X&&g[1].x+m>=0&&g[1].y+m>=0){const t=a.map((t=>s.getTilePoint(t))),e=l.map((t=>s.getTilePoint(t)));r.push({tile:n,tileID:s,queryGeometry:t,cameraQueryGeometry:e,scale:f})}}return r}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map((t=>this._tiles[t].tileID));for(const t of e)t.posMatrix=this.transform.calculatePosMatrix(t.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(pt(this._source.type)){const t=o.now();for(const e in this._tiles)if(this._tiles[e].fadeEndTime>=t)return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const n=this._tiles[t];n&&n.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}}function dt(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function pt(t){return"raster"===t||"image"===t||"video"===t}ht.maxOverzooming=10,ht.maxUnderzooming=3;class ft{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ad(t,0,1);let i=1,n=this._distances[i];const r=t*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const o=i-1,s=this._distances[o],a=n-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}function mt(t,e){let i=!0;return"always"===t||"never"!==t&&"never"!==e||(i=!1),i}class gt{constructor(t,e,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)}_insertBoxCell(t,e,i,n,r,o){this.boxCells[r].push(o)}_insertCircleCell(t,e,i,n,r,o){this.circleCells[r].push(o)}_query(t,e,i,n,r,o,s){if(i<0||t>this.width||n<0||e>this.height)return[];const a=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(r)return[{key:null,x1:t,y1:e,x2:i,y2:n}];for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],n=this.circles[3*t+2];a.push({key:this.circleKeys[t],x1:e-n,y1:i-n,x2:e+n,y2:i+n})}}else this._forEachCell(t,e,i,n,this._queryCell,a,{hitTest:r,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(t,e,i,n){return this._query(t,e,i,n,!1,null)}hitTest(t,e,i,n,r,o){return this._query(t,e,i,n,!0,r,o).length>0}hitTestCircle(t,e,i,n,r){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),c.length>0}_queryCell(t,e,i,n,r,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,d=this.boxKeys[s];if(t<=r[h+2]&&e<=r[h+3]&&i>=r[h+0]&&n>=r[h+1]&&(!a||a(d))&&(!c||!mt(u,d.overlapMode))&&(o.push({key:d,x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]}),c))return!0}}const d=this.circleCells[r];if(null!==d){const r=this.circles;for(const s of d)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],t,e,i,n)&&(!a||a(d))&&(!c||!mt(u,d.overlapMode))){const t=r[h],e=r[h+1],i=r[h+2];if(o.push({key:d,x1:t-i,y1:e-i,x2:t+i,y2:e+i}),c)return!0}}}return!1}_queryCellCircle(t,e,i,n,r,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[r];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const i=4*e,n=this.boxKeys[e];if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(n))&&!mt(u,n.overlapMode))return o.push(!0),!0}}const d=this.circleCells[r];if(null!==d){const t=this.circles;for(const e of d)if(!c.circle[e]){c.circle[e]=!0;const i=3*e,n=this.circleKeys[e];if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(n))&&!mt(u,n.overlapMode))return o.push(!0),!0}}}_forEachCell(t,e,i,n,r,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,t,e,i,n,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,n,r,o){const s=n-t,a=r-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,n,r,o,s){const a=(o-n)/2,l=Math.abs(t-(n+a));if(l>a+i)return!1;const c=(s-r)/2,u=Math.abs(e-(r+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}function yt(t,i,n,r,o){const s=e.H();return i?(e.K(s,s,[1/o,1/o,1]),n||e.ae(s,s,r.angle)):e.L(s,r.labelPlaneMatrix,t),s}function _t(t,i,n,r,o){if(i){const i=e.af(t);return e.K(i,i,[o,o,1]),n||e.ae(i,i,-r.angle),i}return r.glCoordMatrix}function vt(t,i,n){let r;n?(r=[t.x,t.y,n(t.x,t.y),1],e.ag(r,r,i)):(r=[t.x,t.y,0,1],function(t,e,i){const n=e[0],r=e[1];t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t[3]=i[3]*n+i[7]*r+i[15]}(r,r,i));const o=r[3];return{point:new e.P(r[0]/o,r[1]/o),signedDistanceFromCamera:o,isOccluded:!1}}function xt(t,e){return.5+t/e*.5}function bt(t,e){return t.x>=-e[0]&&t.x<=e[0]&&t.y>=-e[1]&&t.y<=e[1]}function wt(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=r?t.textSizeData:t.iconSizeData,y=e.ah(g,n.transform.zoom),_=[256/n.width*2+1,256/n.height*2+1],v=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;v.clear();const x=t.lineVertexArray,b=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,w=n.transform.width/n.transform.height;let S=!1;for(let r=0;r<b.length;r++){const T=b.get(r);if(T.hidden||T.writingMode===e.ai.vertical&&!S){Dt(T.numGlyphs,v);continue}S=!1;const I=vt(new e.P(T.anchorX,T.anchorY),i,m);if(!bt(I.point,_)){Dt(T.numGlyphs,v);continue}const P=xt(n.transform.cameraToCenterDistance,I.signedDistanceFromCamera),k=e.aj(g,y,T),C=a?k/P:k*P,A={getElevation:m,labelPlaneMatrix:o,lineVertexArray:x,pitchWithMap:a,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:u,tileAnchorPoint:new e.P(T.anchorX,T.anchorY),unwrappedTileID:h,width:d,height:p,translation:f},E=It(A,T,C,!1,l,i,s,t.glyphOffsetArray,v,w,c);S=E.useVertical,(E.notEnoughRoom||S||E.needsFlipping&&It(A,T,C,!0,l,i,s,t.glyphOffsetArray,v,w,c).notEnoughRoom)&&Dt(T.numGlyphs,v)}r?t.text.dynamicLayoutVertexBuffer.updateData(v):t.icon.dynamicLayoutVertexBuffer.updateData(v)}function St(t,e,i,n,r,o,s,a){const l=o.glyphStartIndex+o.numGlyphs,c=o.lineStartIndex,u=o.lineStartIndex+o.lineLength,h=e.getoffsetX(o.glyphStartIndex),d=e.getoffsetX(l-1),p=Mt(t*h,i,n,r,o.segment,c,u,a,s);if(!p)return null;const f=Mt(t*d,i,n,r,o.segment,c,u,a,s);return f?a.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function Tt(t,i,n,r){return t===e.ai.horizontal&&Math.abs(n.y-i.y)>Math.abs(n.x-i.x)*r?{useVertical:!0}:(t===e.ai.vertical?i.y<n.y:i.x>n.x)?{needsFlipping:!0}:null}function It(t,i,n,r,o,s,a,l,c,u,h){const d=n/24,p=i.lineOffsetX*d,f=i.lineOffsetY*d;let m;if(i.numGlyphs>1){const e=i.glyphStartIndex+i.numGlyphs,n=i.lineStartIndex,s=i.lineStartIndex+i.lineLength,c=St(d,l,p,f,r,i,h,t);if(!c)return{notEnoughRoom:!0};const g=vt(c.first.point,a,t.getElevation).point,y=vt(c.last.point,a,t.getElevation).point;if(o&&!r){const t=Tt(i.writingMode,g,y,u);if(t)return t}m=[c.first];for(let o=i.glyphStartIndex+1;o<e-1;o++)m.push(Mt(d*l.getoffsetX(o),p,f,r,i.segment,n,s,t,h));m.push(c.last)}else{if(o&&!r){const n=vt(t.tileAnchorPoint,s,t.getElevation).point,r=i.lineStartIndex+i.segment+1,o=new e.P(t.lineVertexArray.getx(r),t.lineVertexArray.gety(r)),a=vt(o,s,t.getElevation),l=a.signedDistanceFromCamera>0?a.point:function(t,e,i,n,r,o){return Pt(t,e,i,1,r,o)}(t.tileAnchorPoint,o,n,0,s,t),c=Tt(i.writingMode,n,l,u);if(c)return c}const n=Mt(d*l.getoffsetX(i.glyphStartIndex),p,f,r,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,t,h);if(!n||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};m=[n]}for(const t of m)e.ak(c,t.point,t.angle);return{}}function Pt(t,e,i,n,r,o){const s=t.add(t.sub(e)._unit()),a=void 0!==r?vt(s,r,o.getElevation).point:Ct(s.x,s.y,o).point,l=i.sub(a);return i.add(l._mult(n/l.mag()))}function kt(t,i,n){const r=i.projectionCache;if(r.projections[t])return r.projections[t];const o=new e.P(i.lineVertexArray.getx(t),i.lineVertexArray.gety(t)),s=Ct(o.x,o.y,i);if(s.signedDistanceFromCamera>0)return r.projections[t]=s.point,r.anyProjectionOccluded=r.anyProjectionOccluded||s.isOccluded,s.point;const a=t-n.direction;return function(t,e,i,n,r){return Pt(t,e,i,n,void 0,r)}(0===n.distanceFromAnchor?i.tileAnchorPoint:new e.P(i.lineVertexArray.getx(a),i.lineVertexArray.gety(a)),o,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,i)}function Ct(t,i,n){const r=t+n.translation[0],o=i+n.translation[1];let s;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(s=n.projection.projectTileCoordinates(r,o,n.unwrappedTileID,n.getElevation),s.point.x=(.5*s.point.x+.5)*n.width,s.point.y=(.5*-s.point.y+.5)*n.height):(s=vt(new e.P(r,o),n.labelPlaneMatrix,n.getElevation),s.isOccluded=!1),s}function At(t,e,i){return t._unit()._perp()._mult(e*i)}function Et(t,i,n,r,o,s,a,l,c){if(l.projectionCache.offsets[t])return l.projectionCache.offsets[t];const u=n.add(i);if(t+c.direction<r||t+c.direction>=o)return l.projectionCache.offsets[t]=u,u;const h=kt(t+c.direction,l,c),d=At(h.sub(n),a,c.direction),p=n.add(d),f=h.add(d);return l.projectionCache.offsets[t]=e.al(s,u,p,f)||u,l.projectionCache.offsets[t]}function Mt(t,e,i,n,r,o,s,a,l){const c=n?t-e:t+e;let u=c>0?1:-1,h=0;n&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?o+r:o+r+1;a.projectionCache.cachedAnchorPoint?d=a.projectionCache.cachedAnchorPoint:(d=Ct(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,a.projectionCache.cachedAnchorPoint=d);let f,m,g=d,y=d,_=0,v=0;const x=Math.abs(c),b=[];let w;for(;_+v<=x;){if(p+=u,p<o||p>=s)return null;_+=v,y=g,m=f;const t={absOffsetX:x,direction:u,distanceFromAnchor:_,previousVertex:y};if(g=kt(p,a,t),0===i)b.push(y),w=g.sub(y);else{let e;const n=g.sub(y);e=0===n.mag()?At(kt(p+u,a,t).sub(g),i,u):At(n,i,u),m||(m=y.add(e)),f=Et(p,e,g,o,s,m,i,a,t),b.push(m),w=f.sub(m)}v=w.mag()}const S=w._mult((x-_)/v)._add(m||y),T=h+Math.atan2(g.y-y.y,g.x-y.x);return b.push(S),{point:S,angle:l?T:0,path:b}}const zt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Dt(t,e){for(let i=0;i<t;i++){const t=e.length;e.resize(t+4),e.float32.set(zt,3*t)}}const Lt=100;class Rt{constructor(t,e,i=new gt(t.width+200,t.height+200,25),n=new gt(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=e,this.grid=i,this.ignoredGrid=n,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Lt,this.screenBottomBoundary=t.height+Lt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,e,i,n,r,o,s,a,l,c,u){const h=t.anchorPointX+a[0],d=t.anchorPointY+a[1],p=this.projectAndGetPerspectiveRatio(n,h,d,r,c),f=this._projectCollisionBox(t,i,n,r,o,s,a,p,c,u),[m,g,y,_]=f.box;return this.mapProjection.useSpecialProjectionForSymbols&&(o?f.allPointsOccluded:this.mapProjection.isOccluded(h,d,r))||p.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(m,g,y,_)||"always"!==e&&this.grid.hitTest(m,g,y,_,e,l)?{box:[m,g,y,_],placeable:!1,offscreen:!1}:{box:[m,g,y,_],placeable:!0,offscreen:this.isOffscreen(m,g,y,_)}}placeCollisionCircles(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g){const y=[],_=new e.P(i.anchorX,i.anchorY),v=this.getPerspectiveRatio(s,_.x,_.y,a,g),x=(h?o/v:o*v)/e.aq,b={getElevation:g,labelPlaneMatrix:l,lineVertexArray:n,pitchWithMap:h,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:_,unwrappedTileID:a,width:this.transform.width,height:this.transform.height,translation:m},w=St(x,r,i.lineOffsetX*x,i.lineOffsetY*x,!1,i,!1,b);let S=!1,T=!1,I=!0;if(w){const i=.5*p*v+f,n=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new ft,s=w.first,a=w.last;let l=[];for(let t=s.path.length-1;t>=1;t--)l.push(s.path[t]);for(let t=1;t<a.path.length;t++)l.push(a.path[t]);const h=2.5*i;if(c){const t=this.projectPathToScreenSpace(l,b,c);l=t.some((t=>t.signedDistanceFromCamera<=0))?[]:t.map((t=>t.point))}let m=[];if(l.length>0){const t=l[0].clone(),i=l[0].clone();for(let e=1;e<l.length;e++)t.x=Math.min(t.x,l[e].x),t.y=Math.min(t.y,l[e].y),i.x=Math.max(i.x,l[e].x),i.y=Math.max(i.y,l[e].y);m=t.x>=n.x&&i.x<=r.x&&t.y>=n.y&&i.y<=r.y?[l]:i.x<n.x||t.x>r.x||i.y<n.y||t.y>r.y?[]:e.am([l],n.x,n.y,r.x,r.y)}for(const e of m){o.reset(e,.25*i);let n=0;n=o.length<=.5*i?1:Math.ceil(o.paddedLength/h)+1;for(let e=0;e<n;e++){const r=e/Math.max(n-1,1),s=o.lerp(r),a=s.x+Lt,l=s.y+Lt;y.push(a,l,i,0);const c=a-i,h=l-i,p=a+i,f=l+i;if(I=I&&this.isOffscreen(c,h,p,f),T=T||this.isInsideGrid(c,h,p,f),"always"!==t&&this.grid.hitTestCircle(a,l,i,t,d)&&(S=!0,!u))return{circles:[],offscreen:!1,collisionDetected:S}}}}return{circles:!u&&S||!T||v<this.perspectiveRatioCutoff?[]:y,offscreen:I,collisionDetected:S}}projectPathToScreenSpace(t,e,i){return t.map((t=>vt(t,i,e.getElevation)))}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,o=-1/0,s=-1/0;for(const a of t){const t=new e.P(a.x+Lt,a.y+Lt);n=Math.min(n,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),i.push(t)}const a=this.grid.query(n,r,o,s).concat(this.ignoredGrid.query(n,r,o,s)),l={},c={};for(const t of a){const n=t.key;if(void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]={}),l[n.bucketInstanceId][n.featureIndex])continue;const r=[new e.P(t.x1,t.y1),new e.P(t.x2,t.y1),new e.P(t.x2,t.y2),new e.P(t.x1,t.y2)];e.an(i,r)&&(l[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(t,e,i,n,r,o){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:o,overlapMode:e},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,n,r,o){const s=i?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:o,overlapMode:e};for(let e=0;e<t.length;e+=4)s.insertCircle(a,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(t,i,n,r,o){const s=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(i,n,r,o):vt(new e.P(i,n),t,o);return{point:new e.P((s.point.x+1)/2*this.transform.width+Lt,(1-s.point.y)/2*this.transform.height+Lt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/s.signedDistanceFromCamera*.5,isOccluded:s.isOccluded,signedDistanceFromCamera:s.signedDistanceFromCamera}}getPerspectiveRatio(t,i,n,r,o){const s=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(i,n,r,o):vt(new e.P(i,n),t,o);return.5+this.transform.cameraToCenterDistance/s.signedDistanceFromCamera*.5}isOffscreen(t,e,i,n){return i<Lt||t>=this.screenRightBoundary||n<Lt||e>this.screenBottomBoundary}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const t=e.ao([]);return e.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,i,n,r,o,s,a,l,c,u){const h=i*l.perspectiveRatio;let d=new e.P(1,0),p=new e.P(0,1);const f=new e.P(t.anchorPointX+a[0],t.anchorPointY+a[1]);if(s&&!o){const t=this.projectAndGetPerspectiveRatio(n,f.x+1,f.y,r,c).point.sub(l.point).unit(),i=Math.atan(t.y/t.x)+(t.x<0?Math.PI:0),o=Math.sin(i),s=Math.cos(i);d=new e.P(s,o),p=new e.P(-o,s)}else if(!s&&o){const t=-this.transform.angle,i=Math.sin(t),n=Math.cos(t);d=new e.P(n,i),p=new e.P(-i,n)}let m=l.point,g=h;if(o){m=f;const t=this.transform.zoom-Math.floor(this.transform.zoom);g=Math.pow(2,-t),g*=this.mapProjection.getPitchedTextCorrection(this.transform,f,r),u||(g*=e.ad(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}u&&(m=m.add(d.mult(u.x*g)).add(p.mult(u.y*g)));const y=t.x1*g,_=t.x2*g,v=(y+_)/2,x=t.y1*g,b=t.y2*g,w=(x+b)/2,S=[{offsetX:y,offsetY:x},{offsetX:v,offsetY:x},{offsetX:_,offsetY:x},{offsetX:_,offsetY:w},{offsetX:_,offsetY:b},{offsetX:v,offsetY:b},{offsetX:y,offsetY:b},{offsetX:y,offsetY:w}];let T=[];for(const{offsetX:t,offsetY:i}of S)T.push(new e.P(m.x+d.x*t+p.x*i,m.y+d.y*t+p.y*i));let I=!1;if(o){const t=T.map((t=>this.projectAndGetPerspectiveRatio(n,t.x,t.y,r,c)));I=t.some((t=>!t.isOccluded)),T=t.map((t=>t.point))}else I=!0;return{box:e.ap(T),allPointsOccluded:!I}}}function Bt(t,i,n){return i*(e.X/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}class Ft{constructor(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Ot{constructor(t,e,i,n,r){this.text=new Ft(t?t.text:null,e,i,r),this.icon=new Ft(t?t.icon:null,e,n,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jt{constructor(t,e,i){this.text=t,this.icon=e,this.skipFade=i}}class Nt{constructor(){this.invProjMatrix=e.H(),this.viewportMatrix=e.H(),this.circles=[]}}class Vt{constructor(t,e,i,n,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class $t{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Ut(t,i,n,r,o){const{horizontalAlign:s,verticalAlign:a}=e.av(t);return new e.P(-(s-.5)*i+r[0]*o,-(a-.5)*n+r[1]*o)}class qt{constructor(t,e,i,n,r,o){this.transform=t.clone(),this.terrain=i,this.collisionIndex=new Rt(this.transform,e),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new $t(r),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=o,o&&(o.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const e=this.terrain;return e?(i,n)=>e.getElevation(t,i,n):null}getBucketParts(t,i,n,r){const o=n.getBucket(i),s=n.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=n.collisionBoxArray,l=o.layers[0].layout,c=o.layers[0].paint,u=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),h=n.tileSize/e.X,d=n.tileID.toUnwrapped(),p=this.transform.calculatePosMatrix(d),f="map"===l.get("text-pitch-alignment"),m="map"===l.get("text-rotation-alignment"),g=Bt(n,1,this.transform.zoom),y=this.collisionIndex.mapProjection.translatePosition(this.transform,n,c.get("text-translate"),c.get("text-translate-anchor")),_=this.collisionIndex.mapProjection.translatePosition(this.transform,n,c.get("icon-translate"),c.get("icon-translate-anchor")),v=yt(p,f,m,this.transform,g);let x=null;if(f){const t=_t(p,f,m,this.transform,g);x=e.L([],this.transform.labelPlaneMatrix,t)}this.retainedQueryData[o.bucketInstanceId]=new Vt(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,n.tileID);const b={bucket:o,layout:l,translationText:y,translationIcon:_,posMatrix:p,unwrappedTileID:d,textLabelPlaneMatrix:v,labelToScreenMatrix:x,scale:u,textPixelRatio:h,holdingForFade:n.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:e.ah(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const e of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=e;t.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:b})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:b})}attemptAnchorPlacement(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v){const x=e.ar[t.textAnchor],b=[t.textOffset0,t.textOffset1],w=Ut(x,n,r,b,o),S=this.collisionIndex.placeCollisionBox(i,d,l,c,u,a,s,g,h.predicate,v,w);if((!_||this.collisionIndex.placeCollisionBox(_,d,l,c,u,a,s,y,h.predicate,v,w).placeable)&&S.placeable){let t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(t=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:b,width:n,height:r,anchor:x,textBoxScale:o,prevAnchor:t},this.markUsedJustification(f,x,p,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,p),this.placedOrientations[p.crossTileID]=m),{shift:w,placedGlyphBoxes:S}}}placeLayerBucketPart(t,i,n){const{bucket:r,layout:o,translationText:s,translationIcon:a,posMatrix:l,unwrappedTileID:c,textLabelPlaneMatrix:u,labelToScreenMatrix:h,textPixelRatio:d,holdingForFade:p,collisionBoxArray:f,partiallyEvaluatedTextSize:m,collisionGroup:g}=t.parameters,y=o.get("text-optional"),_=o.get("icon-optional"),v=e.as(o,"text-overlap","text-allow-overlap"),x="always"===v,b=e.as(o,"icon-overlap","icon-allow-overlap"),w="always"===b,S="map"===o.get("text-rotation-alignment"),T="map"===o.get("text-pitch-alignment"),I="none"!==o.get("icon-text-fit"),P="viewport-y"===o.get("symbol-z-order"),k=x&&(w||!r.hasIconData()||_),C=w&&(x||!r.hasTextData()||y);!r.collisionArrays&&f&&r.deserializeCollisionBoxes(f);const A=this._getTerrainElevationFunc(this.retainedQueryData[r.bucketInstanceId].tileID),E=(t,f,w)=>{var P,E;if(i[t.crossTileID])return;if(p)return void(this.placements[t.crossTileID]=new jt(!1,!1,!1));let M=!1,z=!1,D=!0,L=null,R={box:null,placeable:!1,offscreen:null},B={box:null,placeable:!1,offscreen:null},F=null,O=null,j=null,N=0,V=0,$=0;f.textFeatureIndex?N=f.textFeatureIndex:t.useRuntimeCollisionCircles&&(N=t.featureIndex),f.verticalTextFeatureIndex&&(V=f.verticalTextFeatureIndex);const U=f.textBox;if(U){const i=i=>{let n=e.ai.horizontal;if(r.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,n=e,this.markUsedOrientation(r,n,t))}return n},o=(i,n)=>{if(r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&f.verticalTextBox){for(const t of r.writingModes)if(t===e.ai.vertical?(R=n(),B=R):R=i(),R&&R.placeable)break}else R=i()},u=t.textAnchorOffsetStartIndex,h=t.textAnchorOffsetEndIndex;if(h===u){const n=(e,i)=>{const n=this.collisionIndex.placeCollisionBox(e,v,d,l,c,T,S,s,g.predicate,A);return n&&n.placeable&&(this.markUsedOrientation(r,i,t),this.placedOrientations[t.crossTileID]=i),n};o((()=>n(U,e.ai.horizontal)),(()=>{const i=f.verticalTextBox;return r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&i?n(i,e.ai.vertical):{box:null,offscreen:null}})),i(R&&R.placeable)}else{let p=e.ar[null===(E=null===(P=this.prevPlacement)||void 0===P?void 0:P.variableOffsets[t.crossTileID])||void 0===E?void 0:E.anchor];const m=(i,o,f)=>{const m=i.x2-i.x1,y=i.y2-i.y1,_=t.textBoxScale,x=I&&"never"===b?o:null;let w=null,P="never"===v?1:2,k="never";p&&P++;for(let e=0;e<P;e++){for(let e=u;e<h;e++){const n=r.textAnchorOffsets.get(e);if(p&&n.textAnchor!==p)continue;const o=this.attemptAnchorPlacement(n,i,m,y,_,S,T,d,l,c,g,k,t,r,f,s,a,x,A);if(o&&(w=o.placedGlyphBoxes,w&&w.placeable))return M=!0,L=o.shift,w}p?p=null:k=v}return n&&!w&&(w={box:this.collisionIndex.placeCollisionBox(U,"always",d,l,c,T,S,s,g.predicate,A,new e.P(0,0)).box,offscreen:!1,placeable:!1}),w};o((()=>m(U,f.iconBox,e.ai.horizontal)),(()=>{const i=f.verticalTextBox;return r.allowVerticalPlacement&&(!R||!R.placeable)&&t.numVerticalGlyphVertices>0&&i?m(i,f.verticalIconBox,e.ai.vertical):{box:null,occluded:!0,offscreen:null}})),R&&(M=R.placeable,D=R.offscreen);const y=i(R&&R.placeable);if(!M&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(r,e.anchor,t,y))}}}if(F=R,M=F&&F.placeable,D=F&&F.offscreen,t.useRuntimeCollisionCircles){const i=r.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),a=e.aj(r.textSizeData,m,i),d=o.get("text-padding");O=this.collisionIndex.placeCollisionCircles(v,i,r.lineVertexArray,r.glyphOffsetArray,a,l,c,u,h,n,T,g.predicate,t.collisionCircleDiameter,d,s,A),O.circles.length&&O.collisionDetected&&!n&&e.w("Collisions detected, but collision boxes are not shown"),M=x||O.circles.length>0&&!O.collisionDetected,D=D&&O.offscreen}if(f.iconFeatureIndex&&($=f.iconFeatureIndex),f.iconBox){const t=t=>this.collisionIndex.placeCollisionBox(t,b,d,l,c,T,S,a,g.predicate,A,I&&L?L:void 0);B&&B.placeable&&f.verticalIconBox?(j=t(f.verticalIconBox),z=j.placeable):(j=t(f.iconBox),z=j.placeable),D=D&&j.offscreen}const q=y||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,Z=_||0===t.numIconVertices;q||Z?Z?q||(z=z&&M):M=z&&M:z=M=z&&M;const G=z&&j.placeable;if(M&&F.placeable&&this.collisionIndex.insertCollisionBox(F.box,v,o.get("text-ignore-placement"),r.bucketInstanceId,B&&B.placeable&&V?V:N,g.ID),G&&this.collisionIndex.insertCollisionBox(j.box,b,o.get("icon-ignore-placement"),r.bucketInstanceId,$,g.ID),O&&M&&this.collisionIndex.insertCollisionCircles(O.circles,v,o.get("text-ignore-placement"),r.bucketInstanceId,N,g.ID),n&&this.storeCollisionData(r.bucketInstanceId,w,f,F,j,O),0===t.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===r.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[t.crossTileID]=new jt(M||k,z||C,D||r.justReloaded),i[t.crossTileID]=!0};if(P){if(0!==t.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const e=r.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];E(r.symbolInstances.get(i),r.collisionArrays[i],i)}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)E(r.symbolInstances.get(e),r.collisionArrays[e],e);if(n&&r.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[r.bucketInstanceId];e.at(t.invProjMatrix,l),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}storeCollisionData(t,e,i,n,r,o){if(i.textBox||i.iconBox){let o,s;this.collisionBoxArrays.has(t)?o=this.collisionBoxArrays.get(t):(o=new Map,this.collisionBoxArrays.set(t,o)),o.has(e)?s=o.get(e):(s={text:null,icon:null},o.set(e,s)),i.textBox&&(s.text=n.box),i.iconBox&&(s.icon=r.box)}if(o){let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new Nt);for(let t=0;t<o.circles.length;t+=4)e.circles.push(o.circles[t+0]),e.circles.push(o.circles[t+1]),e.circles.push(o.circles[t+2]),e.circles.push(o.collisionDetected?1:0)}}markUsedJustification(t,i,n,r){let o;o=r===e.ai.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[e.au(i)];const s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];for(const e of s)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=o>=0&&e!==o?0:n.crossTileID)}markUsedOrientation(t,i,n){const r=i===e.ai.horizontal||i===e.ai.horizontalOnly?i:0,o=i===e.ai.vertical?i:0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];for(const e of s)t.text.placedSymbolArray.get(e).placedOrientation=r;n.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const n=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=r[t];o?(this.opacities[t]=new Ot(o,n,e.text,e.icon),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new Ot(null,n,e.text,e.icon,e.skipFade),i=i||e.text||e.icon)}for(const t in r){const e=r[t];if(!this.opacities[t]){const r=new Ot(e,n,!1,!1);r.isHidden()||(this.opacities[t]=r,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);if(e&&void 0===e.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i={};for(const n of e){const e=n.getBucket(t);e&&n.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,n.tileID,i,n.collisionBoxArray)}}updateBucketOpacities(t,i,n,r){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const o=t.layers[0],s=o.layout,a=new Ot(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),c=s.get("icon-allow-overlap"),u=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===s.get("text-rotation-alignment"),d="map"===s.get("text-pitch-alignment"),p="none"!==s.get("icon-text-fit"),f=new Ot(null,0,l&&(c||!t.hasIconData()||s.get("icon-optional")),c&&(l||!t.hasTextData()||s.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const m=(t,e,i)=>{for(let n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(i);t.hasVisibleVertices=t.hasVisibleVertices||i!==te},g=this.collisionBoxArrays.get(t.bucketInstanceId);for(let i=0;i<t.symbolInstances.length;i++){const r=t.symbolInstances.get(i),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:l}=r;let c=this.opacities[l];n[l]?c=a:c||(c=f,this.opacities[l]=c),n[l]=!0;const y=r.numIconVertices>0,_=this.placedOrientations[r.crossTileID],v=_===e.ai.vertical,x=_===e.ai.horizontal||_===e.ai.horizontalOnly;if(o>0||s>0){const e=Qt(c.text);m(t.text,o,v?te:e),m(t.text,s,x?te:e);const i=c.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||v?1:0)})),r.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=i||x?1:0);const n=this.variableOffsets[r.crossTileID];n&&this.markUsedJustification(t,n.anchor,r,_);const a=this.placedOrientations[r.crossTileID];a&&(this.markUsedJustification(t,"left",r,a),this.markUsedOrientation(t,a,r))}if(y){const e=Qt(c.icon),i=!(p&&r.verticalPlacedIconSymbolIndex&&v);r.placedIconSymbolIndex>=0&&(m(t.icon,r.numIconVertices,i?e:te),t.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=c.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(m(t.icon,r.numVerticalIconVertices,i?te:e),t.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=c.icon.isHidden())}const b=g&&g.has(i)?g.get(i):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[i];if(n){let i=new e.P(0,0);if(n.textBox||n.verticalTextBox){let e=!0;if(u){const t=this.variableOffsets[l];t?(i=Ut(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),h&&i._rotate(d?this.transform.angle:-this.transform.angle)):e=!1}if(n.textBox||n.verticalTextBox){let r;n.textBox&&(r=v),n.verticalTextBox&&(r=x),Zt(t.textCollisionBox.collisionVertexArray,c.text.placed,!e||r,b.text,i.x,i.y)}}if(n.iconBox||n.verticalIconBox){const e=Boolean(!x&&n.verticalIconBox);let r;n.iconBox&&(r=e),n.verticalIconBox&&(r=!e),Zt(t.iconCollisionBox.collisionVertexArray,c.icon.placed,r,b.icon,p?i.x:0,p?i.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function Zt(t,e,i,n,r,o){n&&0!==n.length||(n=[0,0,0,0]);const s=n[0]-Lt,a=n[1]-Lt,l=n[2]-Lt,c=n[3]-Lt;t.emplaceBack(e?1:0,i?1:0,r||0,o||0,s,a),t.emplaceBack(e?1:0,i?1:0,r||0,o||0,l,a),t.emplaceBack(e?1:0,i?1:0,r||0,o||0,l,c),t.emplaceBack(e?1:0,i?1:0,r||0,o||0,s,c)}const Gt=Math.pow(2,25),Kt=Math.pow(2,24),Ht=Math.pow(2,17),Wt=Math.pow(2,16),Xt=Math.pow(2,9),Jt=Math.pow(2,8),Yt=Math.pow(2,1);function Qt(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*Gt+e*Kt+i*Ht+e*Wt+i*Xt+e*Jt+i*Yt+e}const te=0;function ee(){return{isOccluded:(t,e,i)=>!1,getPitchedTextCorrection:(t,e,i)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(t,e,i,n){throw new Error("Not implemented.")},translatePosition:(t,e,i,n)=>function(t,e,i,n,r=!1){if(!i[0]&&!i[1])return[0,0];const o=r?"map"===n?t.angle:0:"viewport"===n?-t.angle:0;if(o){const t=Math.sin(o),e=Math.cos(o);i=[i[0]*e-i[1]*t,i[0]*t+i[1]*e]}return[r?i[0]:Bt(e,i[0],t.zoom),r?i[1]:Bt(e,i[1],t.zoom)]}(t,e,i,n),getCircleRadiusCorrection:t=>1}}class ie{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,i,n,r){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,r())return!0;return!1}}class ne{constructor(t,e,i,n,r,o,s,a){this.placement=new qt(t,ee(),e,o,s,a),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,e,i){const n=o.now(),r=()=>!this._forceFullPlacement&&o.now()-n>2;for(;this._currentPlacementIndex>=0;){const n=e[t[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===n.type&&(!n.minzoom||n.minzoom<=o)&&(!n.maxzoom||n.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new ie(n)),this._inProgressLayer.continuePlacement(i[n.source],this.placement,this._showCollisionBoxes,n,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const re=512/e.X/2;class oe{constructor(t,i,n){this.tileID=t,this.bucketInstanceId=n,this._symbolsByKey={};const r=new Map;for(let t=0;t<i.length;t++){const e=i.get(t),n=e.key,o=r.get(n);o?o.push(e):r.set(n,[e])}for(const[t,i]of r){const n={positions:i.map((t=>({x:Math.floor(t.anchorX*re),y:Math.floor(t.anchorY*re)}))),crossTileIDs:i.map((t=>t.crossTileID))};if(n.positions.length>128){const t=new e.aw(n.positions.length,16,Uint16Array);for(const{x:e,y:i}of n.positions)t.add(e,i);t.finish(),delete n.positions,n.index=t}this._symbolsByKey[t]=n}}getScaledCoordinates(t,i){const{x:n,y:r,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=i.canonical,c=re/Math.pow(2,l-o),u=(a*e.X+t.anchorY)*c,h=r*e.X*re;return{x:Math.floor((s*e.X+t.anchorX)*c-n*e.X*re),y:Math.floor(u-h)}}findMatches(t,e,i){const n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let r=0;r<t.length;r++){const o=t.get(r);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);if(s.index){const t=s.index.range(a.x-n,a.y-n,a.x+n,a.y+n).sort();for(const e of t){const t=s.crossTileIDs[e];if(!i[t]){i[t]=!0,o.crossTileID=t;break}}}else if(s.positions)for(let t=0;t<s.positions.length;t++){const e=s.positions[t],r=s.crossTileIDs[t];if(Math.abs(e.x-a.x)<=n&&Math.abs(e.y-a.y)<=n&&!i[r]){i[r]=!0,o.crossTileID=r;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class se{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ae{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],n={};for(const t in i){const r=i[t];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),n[r.tileID.key]=r}this.indexes[t]=n}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const n=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,n)}else{const o=r[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,n)}}for(let t=0;t<e.symbolInstances.length;t++){const r=e.symbolInstances.get(t);r.crossTileID||(r.crossTileID=i.generate(),n[r.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new oe(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.getCrossTileIDsLists())for(const e of i)delete this.usedCrossTileIDs[t][e]}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)t[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],e=!0)}return e}}class le{constructor(){this.layerIndexes={},this.crossTileIDs=new se,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i){let n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new ae);let r=!1;const o={};n.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,e,this.crossTileIDs)&&(r=!0),o[e.bucketInstanceId]=!0)}return n.removeStaleBuckets(o)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const ce=(t,i)=>e.t(t,i&&i.filter((t=>"source.canvas"!==t.identifier))),ue=e.ax();class he extends e.E{constructor(t,i={}){super(),this._rtlPluginLoaded=()=>{for(const t in this.sourceCaches){const e=this.sourceCaches[t].getSource().type;"vector"!==e&&"geojson"!==e||this.sourceCaches[t].reload()}},this.map=t,this.dispatcher=new N(j(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((t,e)=>this.getGlyphs(t,e))),this.dispatcher.registerMessageHandler("GI",((t,e)=>this.getImages(t,e))),this.imageManager=new S,this.imageManager.setEventedParent(this),this.glyphManager=new k(t._requestManager,i.localIdeographFontFamily),this.lineAtlas=new D(256,512),this.crossTileSymbolIndex=new le,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",e.az()),at().on(rt,this._rtlPluginLoaded),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.sourceCaches[t.sourceId];if(!e)return;const i=e.getSource();if(i&&i.vectorLayerIds)for(const t in this._layers){const e=this._layers[t];e.source===i.id&&this._validateLayer(e)}}))}loadURL(t,i={},n){this.fire(new e.k("dataloading",{dataType:"style"})),i.validate="boolean"!=typeof i.validate||i.validate;const r=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController,e.h(r,this._loadStyleRequest).then((t=>{this._loadStyleRequest=null,this._load(t.data,i,n)})).catch((t=>{this._loadStyleRequest=null,t&&this.fire(new e.j(t))}))}loadJSON(t,i={},n){this.fire(new e.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,o.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,i.validate=!1!==i.validate,this._load(t,i,n)})).catch((()=>{}))}loadEmpty(){this.fire(new e.k("dataloading",{dataType:"style"})),this._load(ue,{validate:!1})}_load(t,i,n){var r;const o=i.transformStyle?i.transformStyle(n,t):t;if(!i.validate||!ce(this,e.x(o))){this._loaded=!0,this.stylesheet=o;for(const t in o.sources)this.addSource(t,o.sources[t],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs),this._createLayers(),this.light=new E(this.stylesheet.light),this.sky=new z(this.stylesheet.sky),this.map.setTerrain(null!==(r=this.stylesheet.terrain)&&void 0!==r?r:null),this.fire(new e.k("data",{dataType:"style"})),this.fire(new e.k("style.load"))}}_createLayers(){const t=e.aA(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map((t=>t.id)),this._layers={},this._serializedLayers=null;for(const i of t){const t=e.aB(i);t.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=t}}_loadSprite(t,i=!1,n=void 0){let r;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(t,i,n,r){return e._(this,void 0,void 0,(function*(){const s=v(t),a=n>1?"@2x":"",l={},c={};for(const{id:t,url:n}of s){const o=i.transformRequest(x(n,a,".json"),"SpriteJSON");l[t]=e.h(o,r);const s=i.transformRequest(x(n,a,".png"),"SpriteImage");c[t]=p.getImage(s,r)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(t,i){return e._(this,void 0,void 0,(function*(){const e={};for(const n in t){e[n]={};const r=o.getImageCanvasContext((yield i[n]).data),s=(yield t[n]).data;for(const t in s){const{width:i,height:o,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m}=s[t];e[n][t]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m,spriteData:{width:i,height:o,x:a,y:l,context:r}}}}return e}))}(l,c)}))}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((t=>{if(this._spriteRequest=null,t)for(const e in t){this._spritesImagesIds[e]=[];const n=this._spritesImagesIds[e]?this._spritesImagesIds[e].filter((e=>!(e in t))):[];for(const t of n)this.imageManager.removeImage(t),this._changedImages[t]=!0;for(const n in t[e]){const r="default"===e?n:`${e}:${n}`;this._spritesImagesIds[e].push(r),r in this.imageManager.images?this.imageManager.updateImage(r,t[e][n],!1):this.imageManager.addImage(r,t[e][n]),i&&(this._changedImages[r]=!0)}}})).catch((t=>{this._spriteRequest=null,r=t,this.fire(new e.j(r))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.k("data",{dataType:"style"})),n&&n(r)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}_validateLayer(t){const i=this.sourceCaches[t.source];if(!i)return;const n=t.sourceLayer;if(!n)return;const r=i.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(n))&&this.fire(new e.j(new Error(`Source layer "${n}" does not exist on source "${r.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const e=this._serializedAllLayers();if(!t||0===t.length)return Object.values(e);const i=[];for(const n of t)e[n]&&i.push(e[n]);return i}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const e=Object.keys(this._layers);for(const i of e){const e=this._layers[i];"custom"!==e.type&&(t[i]=e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const i=this._changed;if(i){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const t in this._updatedSources){const e=this._updatedSources[t];if("reload"===e)this._reloadSource(t);else{if("clear"!==e)throw new Error(`Invalid action ${e}`);this._clearSource(t)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const n={};for(const t in this.sourceCaches){const e=this.sourceCaches[t];n[t]=e.used,e.used=!1}for(const e of this._order){const i=this._layers[e];i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)&&i.source&&(this.sourceCaches[i.source].used=!0)}for(const t in n){const i=this.sourceCaches[t];!!n[t]!=!!i.used&&i.fire(new e.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:t}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,i&&this.fire(new e.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,i={}){var n;this._checkLoaded();const r=this.serialize();if(t=i.transformStyle?i.transformStyle(r,t):t,(null===(n=i.validate)||void 0===n||n)&&ce(this,e.x(t)))return!1;(t=e.aC(t)).layers=e.aA(t.layers);const o=e.aD(r,t),s=this._getOperationsToPerform(o);if(s.unimplemented.length>0)throw new Error(`Unimplemented: ${s.unimplemented.join(", ")}.`);if(0===s.operations.length)return!1;for(const t of s.operations)t();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const e=[],i=[];for(const n of t)switch(n.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":e.push((()=>this.addLayer.apply(this,n.args)));break;case"removeLayer":e.push((()=>this.removeLayer.apply(this,n.args)));break;case"setPaintProperty":e.push((()=>this.setPaintProperty.apply(this,n.args)));break;case"setLayoutProperty":e.push((()=>this.setLayoutProperty.apply(this,n.args)));break;case"setFilter":e.push((()=>this.setFilter.apply(this,n.args)));break;case"addSource":e.push((()=>this.addSource.apply(this,n.args)));break;case"removeSource":e.push((()=>this.removeSource.apply(this,n.args)));break;case"setLayerZoomRange":e.push((()=>this.setLayerZoomRange.apply(this,n.args)));break;case"setLight":e.push((()=>this.setLight.apply(this,n.args)));break;case"setGeoJSONSourceData":e.push((()=>this.setGeoJSONSourceData.apply(this,n.args)));break;case"setGlyphs":e.push((()=>this.setGlyphs.apply(this,n.args)));break;case"setSprite":e.push((()=>this.setSprite.apply(this,n.args)));break;case"setSky":e.push((()=>this.setSky.apply(this,n.args)));break;case"setTerrain":e.push((()=>this.map.setTerrain.apply(this,n.args)));break;case"setTransition":e.push((()=>{}));break;default:i.push(n.command)}return{operations:e,unimplemented:i}}addImage(t,i){if(this.getImage(t))return this.fire(new e.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,i),this._afterImageUpdated(t)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new e.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,i,n={}){if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error(`Source "${t}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.x.source,`sources.${t}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=this.sourceCaches[t]=new ht(t,i,this.dispatcher);r.style=this,r.setEventedParent(this,(()=>({isSourceLoaded:r.loaded(),source:r.serialize(),sourceId:t}))),r.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.j(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));const i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire(new e.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error(`There is no source with this ID=${t}`);const i=this.sourceCaches[t].getSource();if("geojson"!==i.type)throw new Error(`geojsonSource.type is ${i.type}, which is !== 'geojson`);i.setData(e),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,i,n={}){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.j(new Error(`Layer "${r}" already exists on this map.`)));let o;if("custom"===t.type){if(ce(this,e.aE(t)))return;o=e.aB(t)}else{if("source"in t&&"object"==typeof t.source&&(this.addSource(r,t.source),t=e.aC(t),t=e.e(t,{source:r})),this._validate(e.x.layer,`layers.${r}`,t,{arrayIndex:-1},n))return;o=e.aB(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}})}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)this.fire(new e.j(new Error(`Cannot add layer "${r}" before non-existing layer "${i}".`)));else{if(this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o,this._removedLayers[r]&&o.source&&"custom"!==o.type){const t=this._removedLayers[r];delete this._removedLayers[r],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const n=this._order.indexOf(t);this._order.splice(n,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.j(new Error(`Cannot move layer "${t}" before non-existing layer "${i}".`))):(this._order.splice(r,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.j(new Error(`Cannot remove non-existing layer "${t}".`)));i.setEventedParent(null);const n=this._order.indexOf(t);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,i,n){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===i&&r.maxzoom===n||(null!=i&&(r.minzoom=i),null!=n&&(r.maxzoom=n),this._updateLayer(r)):this.fire(new e.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,i,n={}){this._checkLoaded();const r=this.getLayer(t);if(r){if(!e.aF(r.filter,i))return null==i?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(e.x.filter,`layers.${r.id}.filter`,i,null,n)||(r.filter=e.aC(i),this._updateLayer(r)))}else this.fire(new e.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return e.aC(this.getLayer(t).filter)}setLayoutProperty(t,i,n,r={}){this._checkLoaded();const o=this.getLayer(t);o?e.aF(o.getLayoutProperty(i),n)||(o.setLayoutProperty(i,n,r),this._updateLayer(o)):this.fire(new e.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,i){const n=this.getLayer(t);if(n)return n.getLayoutProperty(i);this.fire(new e.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,i,n,r={}){this._checkLoaded();const o=this.getLayer(t);o?e.aF(o.getPaintProperty(i),n)||(o.setPaintProperty(i,n,r)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new e.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(t,i){this._checkLoaded();const n=t.source,r=t.sourceLayer,o=this.sourceCaches[n];if(void 0===o)return void this.fire(new e.j(new Error(`The source '${n}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&r?this.fire(new e.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||r?(void 0===t.id&&this.fire(new e.j(new Error("The feature id parameter must be provided."))),o.setFeatureState(r,t.id,i)):this.fire(new e.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,i){this._checkLoaded();const n=t.source,r=this.sourceCaches[n];if(void 0===r)return void this.fire(new e.j(new Error(`The source '${n}' does not exist in the map's style.`)));const o=r.getSource().type,s="vector"===o?t.sourceLayer:void 0;"vector"!==o||s?i&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.j(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(s,t.id,i):this.fire(new e.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const i=t.source,n=t.sourceLayer,r=this.sourceCaches[i];if(void 0!==r)return"vector"!==r.getSource().type||n?(void 0===t.id&&this.fire(new e.j(new Error("The feature id parameter must be provided."))),r.getFeatureState(n,t.id)):void this.fire(new e.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new e.j(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=e.aG(this.sourceCaches,(t=>t.serialize())),i=this._serializeByIds(this._order),n=this.map.getTerrain()||void 0,r=this.stylesheet;return e.aH({version:r.version,name:r.name,metadata:r.metadata,light:r.light,sky:r.sky,center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,sprite:r.sprite,glyphs:r.glyphs,transition:r.transition,sources:t,layers:i,terrain:n},(t=>void 0!==t))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,i={},n=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(e(o)){i[o]=r;for(const e of t){const t=e[o];if(t)for(const e of t)n.push(e)}}}n.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=n.length-1;t>=0;t--){const e=n[t].feature;if(i[e.layer.id]<o)break;r.push(e),n.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(t,i,n){i&&i.filter&&this._validate(e.x.filter,"queryRenderedFeatures.filter",i.filter,null,i);const r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.j(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=this._serializedAllLayers();for(const e in this.sourceCaches)i.layers&&!r[e]||o.push(U(this.sourceCaches[e],this._layers,s,t,i,n));return this.placement&&o.push(function(t,e,i,n,r,o,s){const a={},l=o.queryRenderedSymbols(n),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort(q);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in n){const e=a[t]=a[t]||[],r=n[t];r.sort(((t,e)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of r)e.push(t)}}for(const e in a)a[e].forEach((n=>{const r=n.feature,o=i[t[e].source].getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o}));return a}(this._layers,s,this.sourceCaches,t,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.x.filter,"querySourceFeatures.filter",i.filter,null,i);const n=this.sourceCaches[t];return n?function(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),n=[],r={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(n,e))}return n}(n,i):[]}getLight(){return this.light.getLight()}setLight(t,i={}){this._checkLoaded();const n=this.light.getLight();let r=!1;for(const i in t)if(!e.aF(t[i],n[i])){r=!0;break}if(!r)return;const s={now:o.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,i),this.light.updateTransitions(s)}getSky(){var t;return null===(t=this.stylesheet)||void 0===t?void 0:t.sky}setSky(t,i={}){const n=this.sky.getSky();let r=!1;t||n&&(r=!0);for(const i in t)if(!e.aF(t[i],n[i])){r=!0;break}if(!r)return;const s={now:o.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,i),this.sky.updateTransitions(s)}_validate(t,i,n,r,o={}){return(!o||!1!==o.validate)&&ce(this,t.call(e.x,e.e({key:i,style:this.serialize(),value:n,styleSpec:e.v},r)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),at().off(rt,this._rtlPluginLoaded);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const e=this.sourceCaches[t];e.setEventedParent(null),e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const e in this.sourceCaches)this.sourceCaches[e].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,e,i,n,r=!1){let s=!1,a=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const t=this.sourceCaches[i.source];l[i.source]=t.getRenderableIds(!0).map((e=>t.getTileByID(e))).sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const n=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng);s=s||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((r=r||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.now(),t.zoom))&&(this.pauseablePlacement=new ne(t,this.map.terrain,this._order,r,e,i,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,i){return e._(this,void 0,void 0,(function*(){const t=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const e=this.sourceCaches[i.source];return e&&e.setDependencies(i.tileID.key,i.type,i.icons),t}))}getGlyphs(t,i){return e._(this,void 0,void 0,(function*(){const t=yield this.glyphManager.getGlyphs(i.stacks),e=this.sourceCaches[i.source];return e&&e.setDependencies(i.tileID.key,i.type,[""]),t}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,i={}){this._checkLoaded(),t&&this._validate(e.x.glyphs,"glyphs",t,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,i,n={},r){this._checkLoaded();const o=[{id:t,url:i}],s=[...v(this.stylesheet.sprite),...o];this._validate(e.x.sprite,"sprite",s,null,n)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,r))}removeSprite(t){this._checkLoaded();const i=v(this.stylesheet.sprite);if(i.find((e=>e.id===t))){if(this._spritesImagesIds[t])for(const e of this._spritesImagesIds[t])this.imageManager.removeImage(e),this._changedImages[e]=!0;i.splice(i.findIndex((e=>e.id===t)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}else this.fire(new e.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return v(this.stylesheet.sprite)}setSprite(t,i={},n){this._checkLoaded(),t&&this._validate(e.x.sprite,"sprite",t,null,i)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,n):(this._unloadSprite(),n&&n(null)))}}var de=e.Y([{name:"a_pos",type:"Int16",components:2}]);const pe={prelude:fe("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:fe("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:fe("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:fe("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:fe("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fe("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:fe("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:fe("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:fe("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:fe("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:fe("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:fe("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:fe("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:fe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:fe("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:fe("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:fe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fe("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:fe("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:fe("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:fe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:fe("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:fe("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:fe("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:fe("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:fe("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:fe("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:fe("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:fe("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:fe("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function fe(t,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=e.match(/attribute ([\w]+) ([\w]+)/g),r=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(r):r,a={};return{fragmentSource:t=t.replace(i,((t,e,i,n,r)=>(a[r]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = u_${r};\n#endif\n`))),vertexSource:e=e.replace(i,((t,e,i,n,r)=>{const o="float"===n?"vec2":"vec4",s=r.match(/color/)?"color":o;return a[r]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${o} a_${r};\nvarying ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${o} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`})),staticAttributes:n,staticUniforms:s}}class me{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,i,n,r,o,s,a,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==n.length;for(let t=0;!c&&t<n.length;t++)this.boundPaintVertexBuffers[t]!==n[t]&&(c=!0);!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(e,i,n,r,o,s,a,l):(t.bindVertexArray.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind(),l&&l.bind())}freshBind(t,e,i,n,r,o,s,a){const l=t.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,e.enableAttributes(u,t);for(const e of i)e.enableAttributes(u,t);o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),a&&a.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(const e of i)e.bind(),e.setVertexAttribPointers(u,t,r);o&&(o.bind(),o.setVertexAttribPointers(u,t,r)),n&&n.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,t,r)),a&&(a.bind(),a.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ge=(t,i,n,r,o)=>({u_matrix:t,u_texture:0,u_ele_delta:i,u_fog_matrix:n,u_fog_color:r?r.properties.get("fog-color"):e.aN.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:r?r.calculateFogBlendOpacity(o):0,u_horizon_color:r?r.properties.get("horizon-color"):e.aN.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1});function ye(t){const e=[];for(let i=0;i<t.length;i++){if(null===t[i])continue;const n=t[i].split(" ");e.push(n.pop())}return e}class _e{constructor(t,i,n,r,o,s){const a=t.gl;this.program=a.createProgram();const l=ye(i.staticAttributes),c=n?n.getBinderAttributes():[],u=l.concat(c),h=pe.prelude.staticUniforms?ye(pe.prelude.staticUniforms):[],d=i.staticUniforms?ye(i.staticUniforms):[],p=n?n.getBinderUniforms():[],f=h.concat(d).concat(p),m=[];for(const t of f)m.indexOf(t)<0&&m.push(t);const g=n?n.defines():[];o&&g.push("#define OVERDRAW_INSPECTOR;"),s&&g.push("#define TERRAIN3D;");const y=g.concat(pe.prelude.fragmentSource,i.fragmentSource).join("\n"),_=g.concat(pe.prelude.vertexSource,i.vertexSource).join("\n"),v=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(v,y),a.compileShader(v),!a.getShaderParameter(v,a.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${a.getShaderInfoLog(v)}`);a.attachShader(this.program,v);const x=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(x,_),a.compileShader(x),!a.getShaderParameter(x,a.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${a.getShaderInfoLog(x)}`);a.attachShader(this.program,x),this.attributes={};const b={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);if(a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))throw new Error(`Program failed to link: ${a.getProgramInfoLog(this.program)}`);a.deleteShader(x),a.deleteShader(v);for(let t=0;t<m.length;t++){const e=m[t];if(e&&!b[e]){const t=a.getUniformLocation(this.program,e);t&&(b[e]=t)}}this.fixedUniforms=r(t,b),this.terrainUniforms=((t,i)=>({u_depth:new e.aI(t,i.u_depth),u_terrain:new e.aI(t,i.u_terrain),u_terrain_dim:new e.aJ(t,i.u_terrain_dim),u_terrain_matrix:new e.aK(t,i.u_terrain_matrix),u_terrain_unpack:new e.aL(t,i.u_terrain_unpack),u_terrain_exaggeration:new e.aJ(t,i.u_terrain_exaggeration)}))(t,b),this.binderUniforms=n?n.getUniforms(t,b):[]}draw(t,e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(n),t.setColorMode(r),t.setCullFace(o),a){t.activeTexture.set(_.TEXTURE2),_.bindTexture(_.TEXTURE_2D,a.depthTexture),t.activeTexture.set(_.TEXTURE3),_.bindTexture(_.TEXTURE_2D,a.texture);for(const t in this.terrainUniforms)this.terrainUniforms[t].set(a[t])}for(const t in this.fixedUniforms)this.fixedUniforms[t].set(s[t]);f&&f.setUniforms(t,this.binderUniforms,d,{zoom:p});let v=0;switch(e){case _.LINES:v=2;break;case _.TRIANGLES:v=3;break;case _.LINE_STRIP:v=1}for(const i of h.get()){const n=i.vaos||(i.vaos={});(n[l]||(n[l]=new me)).bind(t,this,c,f?f.getPaintVertexBuffers():[],u,i.vertexOffset,m,g,y),_.drawElements(e,i.primitiveLength*v,_.UNSIGNED_SHORT,i.primitiveOffset*v*2)}}}function ve(t,e,i){const n=1/Bt(i,1,e.transform.tileZoom),r=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,e.transform.tileZoom)/r,s=o*(i.tileID.canonical.x+i.tileID.wrap*r),a=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[n,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const xe=(t,i,n,r)=>{const o=i.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=function(){var t=new e.A(9);return e.A!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();"viewport"===o.properties.get("anchor")&&function(t,e){var i=Math.sin(e),n=Math.cos(e);t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(l,-i.transform.angle),function(t,e,i){var n=e[0],r=e[1],o=e[2];t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8]}(a,a,l);const c=o.properties.get("color");return{u_matrix:t,u_lightpos:a,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+n,u_opacity:r}},be=(t,i,n,r,o,s,a)=>e.e(xe(t,i,n,r),ve(s,i,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),we=t=>({u_matrix:t}),Se=(t,i,n,r)=>e.e(we(t),ve(n,i,r)),Te=(t,e)=>({u_matrix:t,u_world:e}),Ie=(t,i,n,r,o)=>e.e(Se(t,i,n,r),{u_world:o}),Pe=(t,e,i,n)=>{const r=t.transform;let o,s;if("map"===n.paint.get("circle-pitch-alignment")){const t=Bt(i,1,r.zoom);o=!0,s=[t,t]}else o=!1,s=r.pixelsToGLUnits;return{u_camera_to_center_distance:r.cameraToCenterDistance,u_scale_with_map:+("map"===n.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,i,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.pixelRatio,u_extrude_scale:s}},ke=(t,e,i)=>({u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:i.cameraToCenterDistance,u_viewport_size:[i.width,i.height]}),Ce=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),Ae=t=>({u_matrix:t}),Ee=(t,e,i,n)=>({u_matrix:t,u_extrude_scale:Bt(e,1,i),u_intensity:n});function Me(t,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new e.Z(0,r/n).toLngLat().lat,new e.Z(0,(r+1)/n).toLngLat().lat]}const ze=(t,e,i,n)=>{const r=t.transform;return{u_matrix:Fe(t,e,i,n),u_ratio:1/Bt(e,1,r.zoom),u_device_pixel_ratio:t.pixelRatio,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},De=(t,i,n,r,o)=>e.e(ze(t,i,n,o),{u_image:0,u_image_height:r}),Le=(t,e,i,n,r)=>{const o=t.transform,s=Be(e,o);return{u_matrix:Fe(t,e,i,r),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Bt(e,1,o.zoom),u_device_pixel_ratio:t.pixelRatio,u_image:0,u_scale:[s,n.fromScale,n.toScale],u_fade:n.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Re=(t,i,n,r,o,s)=>{const a=t.lineAtlas,l=Be(i,t.transform),c="round"===n.layout.get("line-cap"),u=a.getDash(r.from,c),h=a.getDash(r.to,c),d=u.width*o.fromScale,p=h.width*o.toScale;return e.e(ze(t,i,n,s),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:a.width/(256*Math.min(d,p)*t.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:o.t})};function Be(t,e){return 1/Bt(t,1,e.tileZoom)}function Fe(t,e,i,n){return t.translatePosMatrix(n?n.posMatrix:e.tileID.posMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Oe=(t,e,i,n,r)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:je(r.paint.get("raster-hue-rotate"))};var o,s};function je(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Ne=(t,e,i,n,r,o,s,a,l,c,u,h,d,p)=>{const f=s.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:f.cameraToCenterDistance,u_pitch:f.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:f.width/f.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:l,u_coord_matrix:c,u_is_text:+h,u_pitch_with_map:+n,u_is_along_line:r,u_is_variable_anchor:o,u_texsize:d,u_texture:0,u_translation:u,u_pitched_scale:p}},Ve=(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m)=>{const g=a.transform;return e.e(Ne(t,i,n,r,o,s,a,l,c,u,h,d,p,m),{u_gamma_scale:r?Math.cos(g._pitch)*g.cameraToCenterDistance:1,u_device_pixel_ratio:a.pixelRatio,u_is_halo:+f})},$e=(t,i,n,r,o,s,a,l,c,u,h,d,p,f)=>e.e(Ve(t,i,n,r,o,s,a,l,c,u,h,!0,d,!0,f),{u_texsize_icon:p,u_texture_icon:1}),Ue=(t,e,i)=>({u_matrix:t,u_opacity:e,u_color:i}),qe=(t,i,n,r,o,s)=>e.e(function(t,e,i,n){const r=i.imageManager.getPattern(t.from.toString()),o=i.imageManager.getPattern(t.to.toString()),{width:s,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(n.tileID.canonical.x+n.tileID.wrap*l),h=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/Bt(n,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,s,n,o),{u_matrix:t,u_opacity:i}),Ze={fillExtrusion:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_lightpos:new e.aO(t,i.u_lightpos),u_lightintensity:new e.aJ(t,i.u_lightintensity),u_lightcolor:new e.aO(t,i.u_lightcolor),u_vertical_gradient:new e.aJ(t,i.u_vertical_gradient),u_opacity:new e.aJ(t,i.u_opacity)}),fillExtrusionPattern:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_lightpos:new e.aO(t,i.u_lightpos),u_lightintensity:new e.aJ(t,i.u_lightintensity),u_lightcolor:new e.aO(t,i.u_lightcolor),u_vertical_gradient:new e.aJ(t,i.u_vertical_gradient),u_height_factor:new e.aJ(t,i.u_height_factor),u_image:new e.aI(t,i.u_image),u_texsize:new e.aP(t,i.u_texsize),u_pixel_coord_upper:new e.aP(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.aP(t,i.u_pixel_coord_lower),u_scale:new e.aO(t,i.u_scale),u_fade:new e.aJ(t,i.u_fade),u_opacity:new e.aJ(t,i.u_opacity)}),fill:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix)}),fillPattern:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_image:new e.aI(t,i.u_image),u_texsize:new e.aP(t,i.u_texsize),u_pixel_coord_upper:new e.aP(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.aP(t,i.u_pixel_coord_lower),u_scale:new e.aO(t,i.u_scale),u_fade:new e.aJ(t,i.u_fade)}),fillOutline:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_world:new e.aP(t,i.u_world)}),fillOutlinePattern:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_world:new e.aP(t,i.u_world),u_image:new e.aI(t,i.u_image),u_texsize:new e.aP(t,i.u_texsize),u_pixel_coord_upper:new e.aP(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.aP(t,i.u_pixel_coord_lower),u_scale:new e.aO(t,i.u_scale),u_fade:new e.aJ(t,i.u_fade)}),circle:(t,i)=>({u_camera_to_center_distance:new e.aJ(t,i.u_camera_to_center_distance),u_scale_with_map:new e.aI(t,i.u_scale_with_map),u_pitch_with_map:new e.aI(t,i.u_pitch_with_map),u_extrude_scale:new e.aP(t,i.u_extrude_scale),u_device_pixel_ratio:new e.aJ(t,i.u_device_pixel_ratio),u_matrix:new e.aK(t,i.u_matrix)}),collisionBox:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_pixel_extrude_scale:new e.aP(t,i.u_pixel_extrude_scale)}),collisionCircle:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_inv_matrix:new e.aK(t,i.u_inv_matrix),u_camera_to_center_distance:new e.aJ(t,i.u_camera_to_center_distance),u_viewport_size:new e.aP(t,i.u_viewport_size)}),debug:(t,i)=>({u_color:new e.aM(t,i.u_color),u_matrix:new e.aK(t,i.u_matrix),u_overlay:new e.aI(t,i.u_overlay),u_overlay_scale:new e.aJ(t,i.u_overlay_scale)}),clippingMask:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix)}),heatmap:(t,i)=>({u_extrude_scale:new e.aJ(t,i.u_extrude_scale),u_intensity:new e.aJ(t,i.u_intensity),u_matrix:new e.aK(t,i.u_matrix)}),heatmapTexture:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_world:new e.aP(t,i.u_world),u_image:new e.aI(t,i.u_image),u_color_ramp:new e.aI(t,i.u_color_ramp),u_opacity:new e.aJ(t,i.u_opacity)}),hillshade:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_image:new e.aI(t,i.u_image),u_latrange:new e.aP(t,i.u_latrange),u_light:new e.aP(t,i.u_light),u_shadow:new e.aM(t,i.u_shadow),u_highlight:new e.aM(t,i.u_highlight),u_accent:new e.aM(t,i.u_accent)}),hillshadePrepare:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_image:new e.aI(t,i.u_image),u_dimension:new e.aP(t,i.u_dimension),u_zoom:new e.aJ(t,i.u_zoom),u_unpack:new e.aL(t,i.u_unpack)}),line:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_ratio:new e.aJ(t,i.u_ratio),u_device_pixel_ratio:new e.aJ(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.aP(t,i.u_units_to_pixels)}),lineGradient:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_ratio:new e.aJ(t,i.u_ratio),u_device_pixel_ratio:new e.aJ(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.aP(t,i.u_units_to_pixels),u_image:new e.aI(t,i.u_image),u_image_height:new e.aJ(t,i.u_image_height)}),linePattern:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_texsize:new e.aP(t,i.u_texsize),u_ratio:new e.aJ(t,i.u_ratio),u_device_pixel_ratio:new e.aJ(t,i.u_device_pixel_ratio),u_image:new e.aI(t,i.u_image),u_units_to_pixels:new e.aP(t,i.u_units_to_pixels),u_scale:new e.aO(t,i.u_scale),u_fade:new e.aJ(t,i.u_fade)}),lineSDF:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_ratio:new e.aJ(t,i.u_ratio),u_device_pixel_ratio:new e.aJ(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.aP(t,i.u_units_to_pixels),u_patternscale_a:new e.aP(t,i.u_patternscale_a),u_patternscale_b:new e.aP(t,i.u_patternscale_b),u_sdfgamma:new e.aJ(t,i.u_sdfgamma),u_image:new e.aI(t,i.u_image),u_tex_y_a:new e.aJ(t,i.u_tex_y_a),u_tex_y_b:new e.aJ(t,i.u_tex_y_b),u_mix:new e.aJ(t,i.u_mix)}),raster:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_tl_parent:new e.aP(t,i.u_tl_parent),u_scale_parent:new e.aJ(t,i.u_scale_parent),u_buffer_scale:new e.aJ(t,i.u_buffer_scale),u_fade_t:new e.aJ(t,i.u_fade_t),u_opacity:new e.aJ(t,i.u_opacity),u_image0:new e.aI(t,i.u_image0),u_image1:new e.aI(t,i.u_image1),u_brightness_low:new e.aJ(t,i.u_brightness_low),u_brightness_high:new e.aJ(t,i.u_brightness_high),u_saturation_factor:new e.aJ(t,i.u_saturation_factor),u_contrast_factor:new e.aJ(t,i.u_contrast_factor),u_spin_weights:new e.aO(t,i.u_spin_weights)}),symbolIcon:(t,i)=>({u_is_size_zoom_constant:new e.aI(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aI(t,i.u_is_size_feature_constant),u_size_t:new e.aJ(t,i.u_size_t),u_size:new e.aJ(t,i.u_size),u_camera_to_center_distance:new e.aJ(t,i.u_camera_to_center_distance),u_pitch:new e.aJ(t,i.u_pitch),u_rotate_symbol:new e.aI(t,i.u_rotate_symbol),u_aspect_ratio:new e.aJ(t,i.u_aspect_ratio),u_fade_change:new e.aJ(t,i.u_fade_change),u_matrix:new e.aK(t,i.u_matrix),u_label_plane_matrix:new e.aK(t,i.u_label_plane_matrix),u_coord_matrix:new e.aK(t,i.u_coord_matrix),u_is_text:new e.aI(t,i.u_is_text),u_pitch_with_map:new e.aI(t,i.u_pitch_with_map),u_is_along_line:new e.aI(t,i.u_is_along_line),u_is_variable_anchor:new e.aI(t,i.u_is_variable_anchor),u_texsize:new e.aP(t,i.u_texsize),u_texture:new e.aI(t,i.u_texture),u_translation:new e.aP(t,i.u_translation),u_pitched_scale:new e.aJ(t,i.u_pitched_scale)}),symbolSDF:(t,i)=>({u_is_size_zoom_constant:new e.aI(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aI(t,i.u_is_size_feature_constant),u_size_t:new e.aJ(t,i.u_size_t),u_size:new e.aJ(t,i.u_size),u_camera_to_center_distance:new e.aJ(t,i.u_camera_to_center_distance),u_pitch:new e.aJ(t,i.u_pitch),u_rotate_symbol:new e.aI(t,i.u_rotate_symbol),u_aspect_ratio:new e.aJ(t,i.u_aspect_ratio),u_fade_change:new e.aJ(t,i.u_fade_change),u_matrix:new e.aK(t,i.u_matrix),u_label_plane_matrix:new e.aK(t,i.u_label_plane_matrix),u_coord_matrix:new e.aK(t,i.u_coord_matrix),u_is_text:new e.aI(t,i.u_is_text),u_pitch_with_map:new e.aI(t,i.u_pitch_with_map),u_is_along_line:new e.aI(t,i.u_is_along_line),u_is_variable_anchor:new e.aI(t,i.u_is_variable_anchor),u_texsize:new e.aP(t,i.u_texsize),u_texture:new e.aI(t,i.u_texture),u_gamma_scale:new e.aJ(t,i.u_gamma_scale),u_device_pixel_ratio:new e.aJ(t,i.u_device_pixel_ratio),u_is_halo:new e.aI(t,i.u_is_halo),u_translation:new e.aP(t,i.u_translation),u_pitched_scale:new e.aJ(t,i.u_pitched_scale)}),symbolTextAndIcon:(t,i)=>({u_is_size_zoom_constant:new e.aI(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aI(t,i.u_is_size_feature_constant),u_size_t:new e.aJ(t,i.u_size_t),u_size:new e.aJ(t,i.u_size),u_camera_to_center_distance:new e.aJ(t,i.u_camera_to_center_distance),u_pitch:new e.aJ(t,i.u_pitch),u_rotate_symbol:new e.aI(t,i.u_rotate_symbol),u_aspect_ratio:new e.aJ(t,i.u_aspect_ratio),u_fade_change:new e.aJ(t,i.u_fade_change),u_matrix:new e.aK(t,i.u_matrix),u_label_plane_matrix:new e.aK(t,i.u_label_plane_matrix),u_coord_matrix:new e.aK(t,i.u_coord_matrix),u_is_text:new e.aI(t,i.u_is_text),u_pitch_with_map:new e.aI(t,i.u_pitch_with_map),u_is_along_line:new e.aI(t,i.u_is_along_line),u_is_variable_anchor:new e.aI(t,i.u_is_variable_anchor),u_texsize:new e.aP(t,i.u_texsize),u_texsize_icon:new e.aP(t,i.u_texsize_icon),u_texture:new e.aI(t,i.u_texture),u_texture_icon:new e.aI(t,i.u_texture_icon),u_gamma_scale:new e.aJ(t,i.u_gamma_scale),u_device_pixel_ratio:new e.aJ(t,i.u_device_pixel_ratio),u_is_halo:new e.aI(t,i.u_is_halo),u_translation:new e.aP(t,i.u_translation),u_pitched_scale:new e.aJ(t,i.u_pitched_scale)}),background:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_opacity:new e.aJ(t,i.u_opacity),u_color:new e.aM(t,i.u_color)}),backgroundPattern:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_opacity:new e.aJ(t,i.u_opacity),u_image:new e.aI(t,i.u_image),u_pattern_tl_a:new e.aP(t,i.u_pattern_tl_a),u_pattern_br_a:new e.aP(t,i.u_pattern_br_a),u_pattern_tl_b:new e.aP(t,i.u_pattern_tl_b),u_pattern_br_b:new e.aP(t,i.u_pattern_br_b),u_texsize:new e.aP(t,i.u_texsize),u_mix:new e.aJ(t,i.u_mix),u_pattern_size_a:new e.aP(t,i.u_pattern_size_a),u_pattern_size_b:new e.aP(t,i.u_pattern_size_b),u_scale_a:new e.aJ(t,i.u_scale_a),u_scale_b:new e.aJ(t,i.u_scale_b),u_pixel_coord_upper:new e.aP(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.aP(t,i.u_pixel_coord_lower),u_tile_units_to_pixels:new e.aJ(t,i.u_tile_units_to_pixels)}),terrain:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_texture:new e.aI(t,i.u_texture),u_ele_delta:new e.aJ(t,i.u_ele_delta),u_fog_matrix:new e.aK(t,i.u_fog_matrix),u_fog_color:new e.aM(t,i.u_fog_color),u_fog_ground_blend:new e.aJ(t,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new e.aJ(t,i.u_fog_ground_blend_opacity),u_horizon_color:new e.aM(t,i.u_horizon_color),u_horizon_fog_blend:new e.aJ(t,i.u_horizon_fog_blend)}),terrainDepth:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_ele_delta:new e.aJ(t,i.u_ele_delta)}),terrainCoords:(t,i)=>({u_matrix:new e.aK(t,i.u_matrix),u_texture:new e.aI(t,i.u_texture),u_terrain_coords_id:new e.aJ(t,i.u_terrain_coords_id),u_ele_delta:new e.aJ(t,i.u_ele_delta)}),sky:(t,i)=>({u_sky_color:new e.aM(t,i.u_sky_color),u_horizon_color:new e.aM(t,i.u_horizon_color),u_horizon:new e.aJ(t,i.u_horizon),u_sky_horizon_blend:new e.aJ(t,i.u_sky_horizon_blend)})};class Ge{constructor(t,e,i){this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ke={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class He{constructor(t,e,i,n){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const n=e.attributes[this.attributes[i].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,e,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[Ke[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const We=new WeakMap;function Xe(t){var e;if(We.has(t))return We.get(t);{const i=null===(e=t.getParameter(t.VERSION))||void 0===e?void 0:e.startsWith("WebGL 2.0");return We.set(t,i),i}}class Je{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ye extends Je{getDefault(){return e.aN.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Qe extends Je{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ti extends Je{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ei extends Je{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ii extends Je{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ni extends Je{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ri extends Je{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class oi extends Je{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class si extends Je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class ai extends Je{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class li extends Je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class ci extends Je{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ui extends Je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class hi extends Je{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class di extends Je{getDefault(){return e.aN.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class pi extends Je{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class fi extends Je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class mi extends Je{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class gi extends Je{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class yi extends Je{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class _i extends Je{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class vi extends Je{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class xi extends Je{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class bi extends Je{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wi extends Je{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Si extends Je{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ti extends Je{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ii extends Je{getDefault(){return null}set(t){var e;if(t===this.current&&!this.dirty)return;const i=this.gl;Xe(i)?i.bindVertexArray(t):null===(e=i.getExtension("OES_vertex_array_object"))||void 0===e||e.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Pi extends Je{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ki extends Je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ci extends Je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ai extends Je{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Ei extends Ai{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Mi extends Ai{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zi extends Ai{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Di{constructor(t,e,i,n,r){this.context=t,this.width=e,this.height=i;const o=t.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new Ei(t,s),n)this.depthAttachment=r?new zi(t,s):new Mi(t,s);else if(r)throw new Error("Stencil cannot be set without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Li{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}Li.Replace=[1,0],Li.disabled=new Li(Li.Replace,e.aN.transparent,[!1,!1,!1,!1]),Li.unblended=new Li(Li.Replace,e.aN.transparent,[!0,!0,!0,!0]),Li.alphaBlended=new Li([1,771],e.aN.transparent,[!0,!0,!0,!0]);class Ri{constructor(t){var e,i;if(this.gl=t,this.clearColor=new Ye(this),this.clearDepth=new Qe(this),this.clearStencil=new ti(this),this.colorMask=new ei(this),this.depthMask=new ii(this),this.stencilMask=new ni(this),this.stencilFunc=new ri(this),this.stencilOp=new oi(this),this.stencilTest=new si(this),this.depthRange=new ai(this),this.depthTest=new li(this),this.depthFunc=new ci(this),this.blend=new ui(this),this.blendFunc=new hi(this),this.blendColor=new di(this),this.blendEquation=new pi(this),this.cullFace=new fi(this),this.cullFaceSide=new mi(this),this.frontFace=new gi(this),this.program=new yi(this),this.activeTexture=new _i(this),this.viewport=new vi(this),this.bindFramebuffer=new xi(this),this.bindRenderbuffer=new bi(this),this.bindTexture=new wi(this),this.bindVertexBuffer=new Si(this),this.bindElementBuffer=new Ti(this),this.bindVertexArray=new Ii(this),this.pixelStoreUnpack=new Pi(this),this.pixelStoreUnpackPremultiplyAlpha=new ki(this),this.pixelStoreUnpackFlipY=new Ci(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Xe(t)){this.HALF_FLOAT=t.HALF_FLOAT;const n=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(e=t.RGBA16F)&&void 0!==e?e:null==n?void 0:n.RGBA16F_EXT,this.RGB16F=null!==(i=t.RGB16F)&&void 0!==i?i:null==n?void 0:n.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const e=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==e?void 0:e.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new Ge(this,t,e)}createVertexBuffer(t,e,i){return new He(this,t,e,i)}createRenderbuffer(t,e,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,i,n){return new Di(this,t,e,i,n)}clear({color:t,depth:e,stencil:i}){const n=this.gl;let r=0;t&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(r|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(r|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(r)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.aF(t.blendFunction,Li.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Xe(this.gl)?this.gl.createVertexArray():null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var e;return Xe(this.gl)?this.gl.deleteVertexArray(t):null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Bi{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Bi.ReadOnly=!1,Bi.ReadWrite=!0,Bi.disabled=new Bi(519,Bi.ReadOnly,[0,1]);const Fi=7680;class Oi{constructor(t,e,i,n,r,o){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o}}Oi.disabled=new Oi({func:519,mask:0},0,0,Fi,Fi,Fi);class ji{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}let Ni;function Vi(t,i,n,r,o){const s=t.context,a=s.gl,l=t.useProgram("collisionBox"),c=[];let u=0,h=0;for(let p=0;p<r.length;p++){const f=r[p],m=i.getTile(f).getBucket(n);if(!m)continue;const g=o?m.textCollisionBox:m.iconCollisionBox,y=m.collisionCircleArray;if(y.length>0){const i=e.H();e.aR(i,m.placementInvProjMatrix,t.transform.glCoordMatrix),e.aR(i,i,m.placementViewportMatrix),c.push({circleArray:y,circleOffset:h,transform:f.posMatrix,invTransform:i,coord:f}),u+=y.length/4,h=u}g&&l.draw(s,a.LINES,Bi.disabled,Oi.disabled,t.colorModeForRenderPass(),ji.disabled,{u_matrix:f.posMatrix,u_pixel_extrude_scale:[1/(d=t.transform).width,1/d.height]},t.style.map.terrain&&t.style.map.terrain.getTerrainData(f),n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,null,t.transform.zoom,null,null,g.collisionVertexBuffer)}var d;if(!o||!c.length)return;const p=t.useProgram("collisionCircle"),f=new e.aS;f.resize(4*u),f._trim();let m=0;for(const t of c)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,n=t.circleArray[i+0],r=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];f.emplace(m++,n,r,o,s,0),f.emplace(m++,n,r,o,s,1),f.emplace(m++,n,r,o,s,2),f.emplace(m++,n,r,o,s,3)}(!Ni||Ni.length<2*u)&&(Ni=function(t){const i=2*t,n=new e.aU;n.resize(i),n._trim();for(let t=0;t<i;t++){const e=6*t;n.uint16[e+0]=4*t+0,n.uint16[e+1]=4*t+1,n.uint16[e+2]=4*t+2,n.uint16[e+3]=4*t+2,n.uint16[e+4]=4*t+3,n.uint16[e+5]=4*t+0}return n}(u));const g=s.createIndexBuffer(Ni,!0),y=s.createVertexBuffer(f,e.aT.members,!0);for(const i of c){const r=ke(i.transform,i.invTransform,t.transform);p.draw(s,a.TRIANGLES,Bi.disabled,Oi.disabled,t.colorModeForRenderPass(),ji.disabled,r,t.style.map.terrain&&t.style.map.terrain.getTerrainData(i.coord),n.id,y,g,e.a0.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,t.transform.zoom,null,null,null)}y.destroy(),g.destroy()}ji.disabled=new ji(!1,1029,2305),ji.backCCW=new ji(!0,1029,2305);const $i=e.ao(new Float32Array(16));function Ui(t,i,n,r,o,s){const{horizontalAlign:a,verticalAlign:l}=e.av(t);return new e.P((-(a-.5)*i/o+r[0])*s,(-(l-.5)*n/o+r[1])*s)}function qi(t,i,n,r,o,s){const a=i.tileAnchorPoint.add(new e.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let t=r.mult(s);return n||(t=t.rotate(-o)),vt(a.add(t),i.labelPlaneMatrix,i.getElevation).point}if(n){const e=Ct(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(t),n=Math.atan(e.y/e.x)+(e.x<0?Math.PI:0);return t.add(r.rotate(n))}return t.add(r)}function Zi(t,i,n,r,o,s,a,l,c,u,h,d,p,f){const m=t.text.placedSymbolArray,g=t.text.dynamicLayoutVertexArray,y=t.icon.dynamicLayoutVertexArray,_={};g.clear();for(let y=0;y<m.length;y++){const v=m.get(y),x=v.hidden||!v.crossTileID||t.allowVerticalPlacement&&!v.placedOrientation?null:r[v.crossTileID];if(x){const r=new e.P(v.anchorX,v.anchorY),m={getElevation:f,width:o.width,height:o.height,labelPlaneMatrix:s,lineVertexArray:null,pitchWithMap:n,projection:h,projectionCache:null,tileAnchorPoint:r,translation:d,unwrappedTileID:p},y=n?vt(r,a,f):Ct(r.x,r.y,m),b=xt(o.cameraToCenterDistance,y.signedDistanceFromCamera);let w=e.aj(t.textSizeData,c,v)*b/e.aq;n&&(w*=t.tilePixelRatio/l);const{width:S,height:T,anchor:I,textOffset:P,textBoxScale:k}=x,C=Ui(I,S,T,P,k,w),A=h.getPitchedTextCorrection(o,r.add(new e.P(d[0],d[1])),p),E=qi(y.point,m,i,C,o.angle,A),M=t.allowVerticalPlacement&&v.placedOrientation===e.ai.vertical?Math.PI/2:0;for(let t=0;t<v.numGlyphs;t++)e.ak(g,E,M);u&&v.associatedIconIndex>=0&&(_[v.associatedIconIndex]={shiftedAnchor:E,angle:M})}else Dt(v.numGlyphs,g)}if(u){y.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const n=i.get(t);if(n.hidden)Dt(n.numGlyphs,y);else{const i=_[t];if(i)for(let t=0;t<n.numGlyphs;t++)e.ak(y,i.shiftedAnchor,i.angle);else Dt(n.numGlyphs,y)}}t.icon.dynamicLayoutVertexBuffer.updateData(y)}t.text.dynamicLayoutVertexBuffer.updateData(g)}function Gi(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Ki(t,i,n,r,o,s,a,l,c,u,h,d){const p=t.context,f=p.gl,m=t.transform,g=ee(),y="map"===l,_="map"===c,v="viewport"!==l&&"point"!==n.layout.get("symbol-placement"),x=y&&!_&&!v,b=!_&&v,w=!n.layout.get("symbol-sort-key").isConstant();let S=!1;const T=t.depthModeForSublayer(0,Bi.ReadOnly),I=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),P=[],k=g.getCircleRadiusCorrection(m);for(const l of r){const r=i.getTile(l),c=r.getBucket(n);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const d=h.programConfigurations.get(n.id),p=o||c.sdfIcons,T=o?c.textSizeData:c.iconSizeData,C=_||0!==m.pitch,A=t.useProgram(Gi(p,o,c),d),E=e.ah(T,m.zoom),M=t.style.map.terrain&&t.style.map.terrain.getTerrainData(l);let z,D,L,R,B=[0,0],F=null;if(o)D=r.glyphAtlasTexture,L=f.LINEAR,z=r.glyphAtlasTexture.size,c.iconsInText&&(B=r.imageAtlasTexture.size,F=r.imageAtlasTexture,R=C||t.options.rotating||t.options.zooming||"composite"===T.kind||"camera"===T.kind?f.LINEAR:f.NEAREST);else{const e=1!==n.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;D=r.imageAtlasTexture,L=p||t.options.rotating||t.options.zooming||e||C?f.LINEAR:f.NEAREST,z=r.imageAtlasTexture.size}const O=Bt(r,1,t.transform.zoom),j=b?l.posMatrix:$i,N=yt(j,_,y,t.transform,O),V=_t(j,_,y,t.transform,O),$=_t(l.posMatrix,_,y,t.transform,O),U=g.translatePosition(t.transform,r,s,a),q=I&&c.hasTextData(),Z="none"!==n.layout.get("icon-text-fit")&&q&&c.hasIconData();if(v){const e=t.style.map.terrain?(e,i)=>t.style.map.terrain.getElevation(l,e,i):null,i="map"===n.layout.get("text-rotation-alignment");wt(c,l.posMatrix,t,o,N,$,_,u,i,g,l.toUnwrapped(),m.width,m.height,U,e)}const G=l.posMatrix,K=o&&I||Z,H=v||K?$i:N,W=V,X=p&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let J;J=p?c.iconsInText?$e(T.kind,E,x,_,v,K,t,G,H,W,U,z,B,k):Ve(T.kind,E,x,_,v,K,t,G,H,W,U,o,z,!0,k):Ne(T.kind,E,x,_,v,K,t,G,H,W,U,o,z,k);const Y={program:A,buffers:h,uniformValues:J,atlasTexture:D,atlasTextureIcon:F,atlasInterpolation:L,atlasInterpolationIcon:R,isSDF:p,hasHalo:X};if(w&&c.canOverlap){S=!0;const t=h.segments.get();for(const i of t)P.push({segments:new e.a0([i]),sortKey:i.sortKey,state:Y,terrainData:M})}else P.push({segments:h.segments,sortKey:0,state:Y,terrainData:M})}S&&P.sort(((t,e)=>t.sortKey-e.sortKey));for(const e of P){const i=e.state;if(p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,Hi(i.buffers,e.segments,n,t,i.program,T,h,d,r,e.terrainData)),r.u_is_halo=0}Hi(i.buffers,e.segments,n,t,i.program,T,h,d,i.uniformValues,e.terrainData)}}function Hi(t,e,i,n,r,o,s,a,l,c){const u=n.context;r.draw(u,u.gl.TRIANGLES,o,s,a,ji.disabled,l,c,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,n.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Wi(t,e,i,n,r){if(!i||!n||!n.imageAtlas)return;const o=n.imageAtlas.patternPositions;let s=o[i.to.toString()],a=o[i.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const t=r.getPaintProperty(e);s=o[t],a=o[t]}s&&a&&t.setConstantPatternPositions(s,a)}function Xi(t,e,i,n,r,o,s){const a=t.context.gl,l="fill-pattern",c=i.paint.get(l),u=c&&c.constantOr(1),h=i.getCrossfadeParameters();let d,p,f,m,g;s?(p=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=a.LINES):(p=u?"fillPattern":"fill",d=a.TRIANGLES);const y=c.constantOr(null);for(const c of n){const n=e.getTile(c);if(u&&!n.patternsLoaded())continue;const _=n.getBucket(i);if(!_)continue;const v=_.programConfigurations.get(i.id),x=t.useProgram(p,v),b=t.style.map.terrain&&t.style.map.terrain.getTerrainData(c);u&&(t.context.activeTexture.set(a.TEXTURE0),n.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),v.updatePaintBuffers(h)),Wi(v,l,y,n,i);const w=b?c:null,S=t.translatePosMatrix(w?w.posMatrix:c.posMatrix,n,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(s){m=_.indexBuffer2,g=_.segments2;const e=[a.drawingBufferWidth,a.drawingBufferHeight];f="fillOutlinePattern"===p&&u?Ie(S,t,h,n,e):Te(S,e)}else m=_.indexBuffer,g=_.segments,f=u?Se(S,t,h,n):we(S);x.draw(t.context,d,r,t.stencilModeForClipping(c),o,ji.disabled,f,b,i.id,_.layoutVertexBuffer,m,g,i.paint,t.transform.zoom,v)}}function Ji(t,e,i,n,r,o,s){const a=t.context,l=a.gl,c="fill-extrusion-pattern",u=i.paint.get(c),h=u.constantOr(1),d=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity"),f=u.constantOr(null);for(const u of n){const n=e.getTile(u),m=n.getBucket(i);if(!m)continue;const g=t.style.map.terrain&&t.style.map.terrain.getTerrainData(u),y=m.programConfigurations.get(i.id),_=t.useProgram(h?"fillExtrusionPattern":"fillExtrusion",y);h&&(t.context.activeTexture.set(l.TEXTURE0),n.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers(d)),Wi(y,c,f,n,i);const v=t.translatePosMatrix(u.posMatrix,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),x=i.paint.get("fill-extrusion-vertical-gradient"),b=h?be(v,t,x,p,u,d,n):xe(v,t,x,p);_.draw(a,a.gl.TRIANGLES,r,o,s,ji.backCCW,b,g,i.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,i.paint,t.transform.zoom,y,t.style.map.terrain&&m.centroidVertexBuffer)}}function Yi(t,e,i,n,r,o,s){const a=t.context,l=a.gl,c=i.fbo;if(!c)return;const u=t.useProgram("hillshade"),h=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get()),u.draw(a,l.TRIANGLES,r,o,s,ji.disabled,((t,e,i,n)=>{const r=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:n?n.posMatrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:Me(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:o,u_accent:s}})(t,i,n,h?e:null),h,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}function Qi(t,i,n,r,o,s){const a=t.context,l=a.gl,c=i.dem;if(c&&c.data){const u=c.dim,h=c.stride,d=c.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(h),i.demTexture){const t=i.demTexture;t.update(d,{premultiply:!1}),t.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new b(a,d,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let p=i.fbo;if(!p){const t=new b(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),p=i.fbo=a.createFramebuffer(u,u,!0,!1),p.colorAttachment.set(t.texture)}a.bindFramebuffer.set(p.framebuffer),a.viewport.set([0,0,u,u]),t.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,o,s,ji.disabled,((t,i)=>{const n=i.stride,r=e.H();return e.aQ(r,0,e.X,-e.X,0,0,1),e.J(r,r,[0,-e.X,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ,u_unpack:i.getUnpackVector()}})(i.tileID,c),null,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function tn(t,i,n,r,s,a){const l=r.paint.get("raster-fade-duration");if(!a&&l>0){const r=o.now(),a=(r-t.timeAdded)/l,c=i?(r-i.timeAdded)/l:-1,u=n.getSource(),h=s.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),p=d&&t.refreshedUponExpiration?1:e.ad(d?a:1-c,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const en=new e.aN(1,0,0,1),nn=new e.aN(0,1,0,1),rn=new e.aN(0,0,1,1),on=new e.aN(1,0,1,1),sn=new e.aN(0,1,1,1);function an(t,e,i,n){cn(t,0,e+i/2,t.transform.width,i,n)}function ln(t,e,i,n){cn(t,e-i/2,0,i,t.transform.height,n)}function cn(t,e,i,n,r,o){const s=t.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(e*t.pixelRatio,i*t.pixelRatio,n*t.pixelRatio,r*t.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function un(t,i,n){const r=t.context,o=r.gl,s=n.posMatrix,a=t.useProgram("debug"),l=Bi.disabled,c=Oi.disabled,u=t.colorModeForRenderPass(),h="$debug",d=t.style.map.terrain&&t.style.map.terrain.getTerrainData(n);r.activeTexture.set(o.TEXTURE0);const p=i.getTileByID(n.key).latestRawTileData,f=Math.floor((p&&p.byteLength||0)/1024),m=i.getTile(n).tileSize,g=512/Math.min(m,512)*(n.overscaledZ/t.transform.zoom)*.5;let y=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(y+=` => ${n.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,n=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,`${y} ${f}kB`),a.draw(r,o.TRIANGLES,l,c,Li.alphaBlended,ji.disabled,Ce(s,e.aN.transparent,g),null,h,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments),a.draw(r,o.LINE_STRIP,l,c,u,ji.disabled,Ce(s,e.aN.red),d,h,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments)}function hn(t,e,i){const n=t.context,r=n.gl,o=t.colorModeForRenderPass(),s=new Bi(r.LEQUAL,Bi.ReadWrite,t.depthRangeFor3D),a=t.useProgram("terrain"),l=e.getTerrainMesh();n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height]);for(const c of i){const i=t.renderToTexture.getTexture(c),u=e.getTerrainData(c.tileID);n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,i.texture);const h=t.transform.calculatePosMatrix(c.tileID.toUnwrapped()),d=e.getMeshFrameDelta(t.transform.zoom),p=t.transform.calculateFogMatrix(c.tileID.toUnwrapped()),f=ge(h,d,p,t.style.sky,t.transform.pitch);a.draw(n,r.TRIANGLES,s,Oi.disabled,o,ji.backCCW,f,u,"terrain",l.vertexBuffer,l.indexBuffer,l.segments)}}class dn{constructor(t,e,i){this.vertexBuffer=t,this.indexBuffer=e,this.segments=i}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class pn{constructor(t,i){this.context=new Ri(t),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:e.ao(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ht.maxUnderzooming+ht.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new le}resize(t,e,i){if(this.width=Math.floor(t*i),this.height=Math.floor(e*i),this.pixelRatio=i,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style._order)this.style._layers[t].resize()}setup(){const t=this.context,i=new e.aX;i.emplaceBack(0,0),i.emplaceBack(e.X,0),i.emplaceBack(0,e.X),i.emplaceBack(e.X,e.X),this.tileExtentBuffer=t.createVertexBuffer(i,de.members),this.tileExtentSegments=e.a0.simpleSegment(0,0,4,2);const n=new e.aX;n.emplaceBack(0,0),n.emplaceBack(e.X,0),n.emplaceBack(0,e.X),n.emplaceBack(e.X,e.X),this.debugBuffer=t.createVertexBuffer(n,de.members),this.debugSegments=e.a0.simpleSegment(0,0,4,5);const r=new e.$;r.emplaceBack(0,0,0,0),r.emplaceBack(e.X,0,e.X,0),r.emplaceBack(0,e.X,0,e.X),r.emplaceBack(e.X,e.X,e.X,e.X),this.rasterBoundsBuffer=t.createVertexBuffer(r,Y.members),this.rasterBoundsSegments=e.a0.simpleSegment(0,0,4,2);const o=new e.aX;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(o,de.members),this.viewportSegments=e.a0.simpleSegment(0,0,4,2);const s=new e.aZ;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(s);const a=new e.aY;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a);const l=this.context.gl;this.stencilClearMode=new Oi({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const n=e.H();e.aQ(n,0,this.width,this.height,0,0,1),e.K(n,n,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,i.TRIANGLES,Bi.disabled,this.stencilClearMode,Li.disabled,ji.disabled,Ae(n),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e){if(this.currentStencilSource===t.source||!t.isTileClipped()||!e||!e.length)return;this.currentStencilSource=t.source;const i=this.context,n=i.gl;this.nextStencilID+e.length>256&&this.clearStencil(),i.setColorMode(Li.disabled),i.setDepthMode(Bi.disabled);const r=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of e){const e=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,o=this.style.map.terrain&&this.style.map.terrain.getTerrainData(t);r.draw(i,n.TRIANGLES,Bi.disabled,new Oi({func:n.ALWAYS,mask:0},e,255,n.KEEP,n.KEEP,n.REPLACE),Li.disabled,ji.disabled,Ae(t.posMatrix),o,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Oi({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){const e=this.context.gl;return new Oi({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),n=i[i.length-1].overscaledZ,r=i[0].overscaledZ-n+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const t={};for(let i=0;i<r;i++)t[i+n]=new Oi({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=r,[t,i]}return[{[n]:Oi.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Li([t.CONSTANT_COLOR,t.ONE],new e.aN(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Li.unblended:Li.alphaBlended}depthModeForSublayer(t,e,i){if(!this.opaquePassEnabledForLayer())return Bi.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Bi(i||this.context.gl.LEQUAL,e,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.now()),this.imageManager.beginFrame();const n=this.style._order,r=this.style.sourceCaches,s={},a={},l={};for(const t in r){const e=r[t];e.used&&e.prepare(this.context),s[t]=e.getVisibleCoordinates(),a[t]=s[t].slice().reverse(),l[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<n.length;t++)if(this.style._layers[n[t]].is3D()){this.opaquePassCutoff=t;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const t of n){const e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=a[e.source];("custom"===e.type||i.length)&&this.renderLayer(this,r[e.source],e,i)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?e.aN.black:e.aN.transparent,depth:1}),this.clearStencil(),this.style.stylesheet.sky&&function(t,i){const n=t.context,r=n.gl,o=((t,e,i)=>({u_sky_color:t.properties.get("sky-color"),u_horizon_color:t.properties.get("horizon-color"),u_horizon:(e.height/2+e.getHorizon())*i,u_sky_horizon_blend:t.properties.get("sky-horizon-blend")*e.height/2*i}))(i,t.style.map.transform,t.pixelRatio),s=new Bi(r.LEQUAL,Bi.ReadWrite,[0,1]),a=Oi.disabled,l=t.colorModeForRenderPass(),c=t.useProgram("sky");if(!i.mesh){const t=new e.aX;t.emplaceBack(-1,-1),t.emplaceBack(1,-1),t.emplaceBack(1,1),t.emplaceBack(-1,1);const r=new e.aY;r.emplaceBack(0,1,2),r.emplaceBack(0,2,3),i.mesh=new dn(n.createVertexBuffer(t,de.members),n.createIndexBuffer(r),e.a0.simpleSegment(0,0,t.length,r.length))}c.draw(n,r.TRIANGLES,s,a,l,ji.disabled,o,void 0,"sky",i.mesh.vertexBuffer,i.mesh.indexBuffer,i.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[n[this.currentLayer]],e=r[t.source],i=s[t.source];this._renderTileClippingMasks(t,i),this.renderLayer(this,e,t,i)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const t=this.style._layers[n[this.currentLayer]],e=r[t.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(t))continue;const i=("symbol"===t.type?l:a)[t.source];this._renderTileClippingMasks(t,s[t.source]),this.renderLayer(this,e,t,i)}if(this.options.showTileBoundaries){const t=function(t,e){let i=null;const n=Object.values(t._layers).flatMap((i=>i.source&&!i.isHidden(e)?[t.sourceCaches[i.source]]:[])),r=n.filter((t=>"vector"===t.getSource().type)),o=n.filter((t=>"vector"!==t.getSource().type)),s=t=>{(!i||i.getSource().maxzoom<t.getSource().maxzoom)&&(i=t)};return r.forEach((t=>s(t))),i||o.forEach((t=>s(t))),i}(this.style,this.transform.zoom);t&&function(t,e,i){for(let n=0;n<i.length;n++)un(t,e,i[n])}(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;an(t,t.transform.height-(e.top||0),3,en),an(t,e.bottom||0,3,nn),ln(t,e.left||0,3,rn),ln(t,t.transform.width-(e.right||0),3,on);const i=t.transform.centerPoint;!function(t,e,i,n){cn(t,e-1,i-10,2,20,n),cn(t,e-10,i-1,20,2,n)}(t,i.x,t.transform.height-i.y,sn)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,n=this.transform.modelViewProjectionMatrix;let r=this.terrainFacilitator.dirty;r||(r=t?!e.a_(i,n):!e.a$(i,n)),r||(r=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),r&&(e.b0(i,n),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(t,i){const n=t.context,r=n.gl,o=Li.unblended,s=new Bi(r.LEQUAL,Bi.ReadWrite,[0,1]),a=i.getTerrainMesh(),l=i.sourceCache.getRenderableTiles(),c=t.useProgram("terrainDepth");n.bindFramebuffer.set(i.getFramebuffer("depth").framebuffer),n.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),n.clear({color:e.aN.transparent,depth:1});for(const e of l){const l=i.getTerrainData(e.tileID),u={u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped()),u_ele_delta:i.getMeshFrameDelta(t.transform.zoom)};c.draw(n,r.TRIANGLES,s,Oi.disabled,o,ji.backCCW,u,l,"terrain",a.vertexBuffer,a.indexBuffer,a.segments)}n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain),function(t,i){const n=t.context,r=n.gl,o=Li.unblended,s=new Bi(r.LEQUAL,Bi.ReadWrite,[0,1]),a=i.getTerrainMesh(),l=i.getCoordsTexture(),c=i.sourceCache.getRenderableTiles(),u=t.useProgram("terrainCoords");n.bindFramebuffer.set(i.getFramebuffer("coords").framebuffer),n.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),n.clear({color:e.aN.transparent,depth:1}),i.coordsIndex=[];for(const e of c){const c=i.getTerrainData(e.tileID);n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture);const h={u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped()),u_terrain_coords_id:(255-i.coordsIndex.length)/255,u_texture:0,u_ele_delta:i.getMeshFrameDelta(t.transform.zoom)};u.draw(n,r.TRIANGLES,s,Oi.disabled,o,ji.backCCW,h,c,"terrain",a.vertexBuffer,a.indexBuffer,a.segments),i.coordsIndex.push(e.tileID.key)}n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain))}renderLayer(t,i,n,r){if(!n.isHidden(this.transform.zoom)&&("background"===n.type||"custom"===n.type||(r||[]).length))switch(this.id=n.id,n.type){case"symbol":!function(t,i,n,r,o){if("translucent"!==t.renderPass)return;const s=Oi.disabled,a=t.colorModeForRenderPass();(n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(t,i,n,r,o,s,a,l,c){const u=i.transform,h=ee(),d="map"===o,p="map"===s;for(const o of t){const t=r.getTile(o),s=t.getBucket(n);if(!s||!s.text||!s.text.segments.get().length)continue;const f=e.ah(s.textSizeData,u.zoom),m=Bt(t,1,i.transform.zoom),g=yt(o.posMatrix,p,d,i.transform,m),y="none"!==n.layout.get("icon-text-fit")&&s.hasIconData();if(f){const e=Math.pow(2,u.zoom-t.tileID.overscaledZ),n=i.style.map.terrain?(t,e)=>i.style.map.terrain.getElevation(o,t,e):null,r=h.translatePosition(u,t,a,l);Zi(s,d,p,c,u,g,o.posMatrix,e,f,y,h,r,o.toUnwrapped(),n)}}}(r,t,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&Ki(t,i,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),s,a),0!==n.paint.get("text-opacity").constantOr(1)&&Ki(t,i,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(Vi(t,i,n,r,!0),Vi(t,i,n,r,!1))}(t,i,n,r,this.style.placement.variableOffsets);break;case"circle":!function(t,i,n,r){if("translucent"!==t.renderPass)return;const o=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=!n.layout.get("circle-sort-key").isConstant();if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=t.context,u=c.gl,h=t.depthModeForSublayer(0,Bi.ReadOnly),d=Oi.disabled,p=t.colorModeForRenderPass(),f=[];for(let o=0;o<r.length;o++){const s=r[o],a=i.getTile(s),c=a.getBucket(n);if(!c)continue;const u=c.programConfigurations.get(n.id),h=t.useProgram("circle",u),d=c.layoutVertexBuffer,p=c.indexBuffer,m=t.style.map.terrain&&t.style.map.terrain.getTerrainData(s),g={programConfiguration:u,program:h,layoutVertexBuffer:d,indexBuffer:p,uniformValues:Pe(t,s,a,n),terrainData:m};if(l){const t=c.segments.get();for(const i of t)f.push({segments:new e.a0([i]),sortKey:i.sortKey,state:g})}else f.push({segments:c.segments,sortKey:0,state:g})}l&&f.sort(((t,e)=>t.sortKey-e.sortKey));for(const e of f){const{programConfiguration:i,program:r,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l}=e.state;r.draw(c,u.TRIANGLES,h,d,p,ji.disabled,a,l,n.id,o,s,e.segments,n.paint,t.transform.zoom,i)}}(t,i,n,r);break;case"heatmap":!function(t,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=Oi.disabled,l=new Li([s.ONE,s.ONE],e.aN.transparent,[!0,!0,!0,!0]);!function(t,e,i){const n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let r=i.heatmapFbo;if(r)n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{const o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),r=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1,!1),function(t,e,i,n){var r,o;const s=t.gl,a=null!==(r=t.HALF_FLOAT)&&void 0!==r?r:s.UNSIGNED_BYTE,l=null!==(o=t.RGBA16F)&&void 0!==o?o:s.RGBA;s.texImage2D(s.TEXTURE_2D,0,l,e.width/4,e.height/4,0,s.RGBA,a,null),n.colorAttachment.set(i)}(t,e,o,r)}}(o,t,n),o.clear({color:e.aN.transparent});for(let e=0;e<r.length;e++){const c=r[e];if(i.hasRenderableParent(c))continue;const u=i.getTile(c),h=u.getBucket(n);if(!h)continue;const d=h.programConfigurations.get(n.id),p=t.useProgram("heatmap",d),{zoom:f}=t.transform;p.draw(o,s.TRIANGLES,Bi.disabled,a,l,ji.disabled,Ee(c.posMatrix,u,f,n.paint.get("heatmap-intensity")),null,n.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,n.paint,t.transform.zoom,d)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const n=t.context,r=n.gl,o=i.heatmapFbo;if(!o)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new b(n,i.colorRamp,r.RGBA)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(n,r.TRIANGLES,Bi.disabled,Oi.disabled,t.colorModeForRenderPass(),ji.disabled,((t,i,n,r)=>{const o=e.H();e.aQ(o,0,t.width,t.height,0,0,1);const s=t.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}})(t,i),null,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,n))}(t,i,n,r);break;case"line":!function(t,i,n,r){if("translucent"!==t.renderPass)return;const o=n.paint.get("line-opacity"),s=n.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=t.depthModeForSublayer(0,Bi.ReadOnly),l=t.colorModeForRenderPass(),c=n.paint.get("line-dasharray"),u=n.paint.get("line-pattern"),h=u.constantOr(1),d=n.paint.get("line-gradient"),p=n.getCrossfadeParameters(),f=h?"linePattern":c?"lineSDF":d?"lineGradient":"line",m=t.context,g=m.gl;let y=!0;for(const o of r){const r=i.getTile(o);if(h&&!r.patternsLoaded())continue;const s=r.getBucket(n);if(!s)continue;const _=s.programConfigurations.get(n.id),v=t.context.program.get(),x=t.useProgram(f,_),w=y||x.program!==v,S=t.style.map.terrain&&t.style.map.terrain.getTerrainData(o),T=u.constantOr(null);if(T&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[T.to.toString()],i=t.patternPositions[T.from.toString()];e&&i&&_.setConstantPatternPositions(e,i)}const I=S?o:null,P=h?Le(t,r,n,p,I):c?Re(t,r,n,c,p,I):d?De(t,r,n,s.lineClipsArray.length,I):ze(t,r,n,I);if(h)m.activeTexture.set(g.TEXTURE0),r.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),_.updatePaintBuffers(p);else if(c&&(w||t.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),t.lineAtlas.bind(m);else if(d){const r=s.gradients[n.id];let a=r.texture;if(n.gradientVersion!==r.version){let l=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=o.canonical.z===n?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.ad(e.aV(s.maxLineLength/e.X*1024*r),256,m.maxTextureSize)}r.gradient=e.aW({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new b(m,r.gradient,g.RGBA),r.version=n.gradientVersion,a=r.texture}m.activeTexture.set(g.TEXTURE0),a.bind(n.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}x.draw(m,g.TRIANGLES,a,t.stencilModeForClipping(o),l,ji.disabled,P,S,n.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,n.paint,t.transform.zoom,_,s.layoutVertexBuffer2),y=!1}}(t,i,n,r);break;case"fill":!function(t,i,n,r){const o=n.paint.get("fill-color"),s=n.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=t.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(e.aN.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const e=t.depthModeForSublayer(1,"opaque"===t.renderPass?Bi.ReadWrite:Bi.ReadOnly);Xi(t,i,n,r,e,a,!1)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const e=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Bi.ReadOnly);Xi(t,i,n,r,e,a,!0)}}(t,i,n,r);break;case"fill-extrusion":!function(t,e,i,n){const r=i.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===t.renderPass){const o=new Bi(t.context.gl.LEQUAL,Bi.ReadWrite,t.depthRangeFor3D);if(1!==r||i.paint.get("fill-extrusion-pattern").constantOr(1))Ji(t,e,i,n,o,Oi.disabled,Li.disabled),Ji(t,e,i,n,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const r=t.colorModeForRenderPass();Ji(t,e,i,n,o,Oi.disabled,r)}}}(t,i,n,r);break;case"hillshade":!function(t,e,i,n){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const r=t.context,o=t.depthModeForSublayer(0,Bi.ReadOnly),s=t.colorModeForRenderPass(),[a,l]="translucent"===t.renderPass?t.stencilConfigForOverlap(n):[{},n];for(const n of l){const r=e.getTile(n);void 0!==r.needsHillshadePrepare&&r.needsHillshadePrepare&&"offscreen"===t.renderPass?Qi(t,r,i,o,Oi.disabled,s):"translucent"===t.renderPass&&Yi(t,n,r,i,o,a[n.overscaledZ],s)}r.viewport.set([0,0,t.width,t.height])}(t,i,n,r);break;case"raster":!function(t,e,i,n){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!n.length)return;const r=t.context,o=r.gl,s=e.getSource(),a=t.useProgram("raster"),l=t.colorModeForRenderPass(),[c,u]=s instanceof Q?[{},n]:t.stencilConfigForOverlap(n),h=u[u.length-1].overscaledZ,d=!t.options.moving;for(const n of u){const u=t.depthModeForSublayer(n.overscaledZ-h,1===i.paint.get("raster-opacity")?Bi.ReadWrite:Bi.ReadOnly,o.LESS),p=e.getTile(n);p.registerFadeDuration(i.paint.get("raster-fade-duration"));const f=e.findLoadedParent(n,0),m=e.findLoadedSibling(n),g=tn(p,f||m||null,e,i,t.transform,t.style.map.terrain);let y,_;const v="nearest"===i.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;r.activeTexture.set(o.TEXTURE0),p.texture.bind(v,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(o.TEXTURE1),f?(f.texture.bind(v,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),y=Math.pow(2,f.tileID.overscaledZ-p.tileID.overscaledZ),_=[p.tileID.canonical.x*y%1,p.tileID.canonical.y*y%1]):p.texture.bind(v,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);const x=t.style.map.terrain&&t.style.map.terrain.getTerrainData(n),b=x?n:null,w=b?b.posMatrix:t.transform.calculatePosMatrix(n.toUnwrapped(),d),S=Oe(w,_||[0,0],y||1,g,i);s instanceof Q?a.draw(r,o.TRIANGLES,u,Oi.disabled,l,ji.disabled,S,x,i.id,s.boundsBuffer,t.quadTriangleIndexBuffer,s.boundsSegments):a.draw(r,o.TRIANGLES,u,c[n.overscaledZ],l,ji.disabled,S,x,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}(t,i,n,r);break;case"background":!function(t,e,i,n){const r=i.paint.get("background-color"),o=i.paint.get("background-opacity");if(0===o)return;const s=t.context,a=s.gl,l=t.transform,c=l.tileSize,u=i.paint.get("background-pattern");if(t.isPatternMissing(u))return;const h=!u&&1===r.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==h)return;const d=Oi.disabled,p=t.depthModeForSublayer(0,"opaque"===h?Bi.ReadWrite:Bi.ReadOnly),f=t.colorModeForRenderPass(),m=t.useProgram(u?"backgroundPattern":"background"),g=n||l.coveringTiles({tileSize:c,terrain:t.style.map.terrain});u&&(s.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));const y=i.getCrossfadeParameters();for(const e of g){const l=n?e.posMatrix:t.transform.calculatePosMatrix(e.toUnwrapped()),h=u?qe(l,o,t,u,{tileID:e,tileSize:c},y):Ue(l,o,r),g=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e);m.draw(s,a.TRIANGLES,p,d,f,ji.disabled,h,g,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}(t,0,n,r);break;case"custom":!function(t,e,i){const n=t.context,r=i.implementation;if("offscreen"===t.renderPass){const e=r.prerender;e&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),e.call(r,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(Oi.disabled);const e="3d"===r.renderingMode?new Bi(t.context.gl.LEQUAL,Bi.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Bi.ReadOnly);n.setDepthMode(e),r.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}(t,0,n)}}translatePosMatrix(t,i,n,r,o){if(!n[0]&&!n[1])return t;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}const a=[o?n[0]:Bt(i,n[0],this.transform.zoom),o?n[1]:Bt(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return e.J(l,t,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i}useProgram(t,e){this.cache=this.cache||{};const i=t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[i]||(this.cache[i]=new _e(this.context,pe[t],e,Ze[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[i]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new b(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:e}=this.context.gl;return this.width!==t||this.height!==e}}class fn{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(t,i,n){const r=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((n=>{const o=1/(n=e.ag([],n,t))[3]/i*r;return e.b1(n,n,[o,o,1/n[3],o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=function(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}([],function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=r*l-o*a,t[1]=o*s-n*l,t[2]=n*a-r*s,t}([],y([],o[t[0]],o[t[1]]),y([],o[t[2]],o[t[1]]))),i=-((n=e)[0]*(r=o[t[1]])[0]+n[1]*r[1]+n[2]*r[2]);var n,r;return e.concat(i)}));return new fn(o,s)}}class mn{constructor(t,e){this.min=t,this.max=e,this.center=function(t,e,i){return t[0]=.5*e[0],t[1]=.5*e[1],t[2]=.5*e[2],t}([],function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}([],this.min,this.max))}quadrant(t){const e=[t%2==0,t<2],i=m(this.min),n=m(this.max);for(let t=0;t<e.length;t++)i[t]=e[t]?this.min[t]:this.center[t],n[t]=e[t]?this.center[t]:this.max[t];return n[2]=this.max[2],new mn(i,n)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const i=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let n=!0;for(let r=0;r<t.planes.length;r++){const o=t.planes[r];let s=0;for(let t=0;t<i.length;t++)e.b2(o,i[t])>=0&&s++;if(0===s)return 0;s!==i.length&&(n=!1)}if(n)return 2;for(let e=0;e<3;e++){let i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<t.points.length;r++){const o=t.points[r][e]-this.min[e];i=Math.min(i,o),n=Math.max(n,o)}if(n<0||i>this.max[e]-this.min[e])return 0}return 1}}class gn{constructor(t=0,e=0,i=0,n=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(t,i,n){return null!=i.top&&null!=t.top&&(this.top=e.z.number(t.top,i.top,n)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.z.number(t.bottom,i.bottom,n)),null!=i.left&&null!=t.left&&(this.left=e.z.number(t.left,i.left,n)),null!=i.right&&null!=t.right&&(this.right=e.z.number(t.right,i.right,n)),this}getCenter(t,i){const n=e.ad((this.left+t-this.right)/2,0,t),r=e.ad((this.top+i-this.bottom)/2,0,i);return new e.P(n,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new gn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const yn=85.051129;class _n{constructor(t,i,n,r,o){this.tileSize=512,this._renderWorldCopies=void 0===o||!!o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new gn,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new _n(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const i=-e.b3(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=function(){var t=new e.A(4);return e.A!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}(),function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=n*l+o*a,t[1]=r*l+s*a,t[2]=n*-a+o*l,t[3]=r*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.tileZoom=Math.max(0,Math.floor(e)),this.scale=this.zoomScale(e),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(t){const i=[new e.b4(0,t)];if(this._renderWorldCopies){const n=this.pointCoordinate(new e.P(0,0)),r=this.pointCoordinate(new e.P(this.width,0)),o=this.pointCoordinate(new e.P(this.width,this.height)),s=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(n.x,r.x,o.x,s.x)),l=Math.floor(Math.max(n.x,r.x,o.x,s.x)),c=1;for(let n=a-c;n<=l+c;n++)0!==n&&i.push(new e.b4(n,t))}return i}coveringTiles(t){var i,n;let r=this.coveringZoomLevel(t);const o=r;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);const s=this.pointCoordinate(this.getCameraPoint()),a=e.Z.fromLngLat(this.center),l=Math.pow(2,r),c=[l*s.x,l*s.y,0],u=[l*a.x,l*a.y,0],h=fn.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,r);let d=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(d=r);const p=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,f=t=>({aabb:new mn([t*l,0,0],[(t+1)*l,l,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),m=[],g=[],y=r,v=t.reparseOverscaled?o:r;if(this._renderWorldCopies)for(let t=1;t<=3;t++)m.push(f(-t)),m.push(f(t));for(m.push(f(0));m.length>0;){const r=m.pop(),o=r.x,s=r.y;let a=r.fullyVisible;if(!a){const t=r.aabb.intersects(h);if(0===t)continue;a=2===t}const l=t.terrain?c:u,f=r.aabb.distanceX(l),x=r.aabb.distanceY(l),b=Math.max(Math.abs(f),Math.abs(x));if(r.zoom===y||b>p+(1<<y-r.zoom)-2&&r.zoom>=d){const t=y-r.zoom,i=c[0]-.5-(o<<t),n=c[1]-.5-(s<<t);g.push({tileID:new e.S(r.zoom===y?v:r.zoom,r.wrap,r.zoom,o,s),distanceSq:_([u[0]-.5-o,u[1]-.5-s]),tileDistanceToCamera:Math.sqrt(i*i+n*n)})}else for(let l=0;l<4;l++){const c=(o<<1)+l%2,u=(s<<1)+(l>>1),h=r.zoom+1;let d=r.aabb.quadrant(l);if(t.terrain){const o=new e.S(h,r.wrap,h,c,u),s=t.terrain.getMinMaxElevation(o),a=null!==(i=s.minElevation)&&void 0!==i?i:this.elevation,l=null!==(n=s.maxElevation)&&void 0!==n?n:this.elevation;d=new mn([d.min[0],d.min[1],a],[d.max[0],d.max[1],l])}m.push({aabb:d,zoom:h,x:c,y:u,wrap:r.wrap,fullyVisible:a})}}return g.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const i=e.ad(t.lat,-85.051129,yn);return new e.P(e.O(t.lng)*this.worldSize,e.Q(i)*this.worldSize)}unproject(t){return new e.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const i=this.elevation,n=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,r=this.pointLocation(this.centerPoint,t),o=t.getElevationForLngLatZoom(r,this.tileZoom);if(!(this.elevation-o))return;const s=n+i-o,a=Math.cos(this._pitch)*this.cameraToCenterDistance/s/e.b5(1,r.lat),l=this.scaleZoom(a/this.tileSize);this._elevation=o,this._center=r,this.zoom=l}setLocationAtPoint(t,i){const n=this.pointCoordinate(i),r=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(t),s=new e.Z(o.x-(n.x-r.x),o.y-(n.y-r.y));this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,e){return e?this.coordinatePoint(this.locationCoordinate(t),e.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,e){return this.coordinateLocation(this.pointCoordinate(t,e))}locationCoordinate(t){return e.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,i){if(i){const e=i.pointCoordinate(t);if(null!=e)return e}const n=[t.x,t.y,0,1],r=[t.x,t.y,1,1];e.ag(n,n,this.pixelMatrixInverse),e.ag(r,r,this.pixelMatrixInverse);const o=n[3],s=r[3],a=n[1]/o,l=r[1]/s,c=n[2]/o,u=r[2]/s,h=c===u?0:(0-c)/(u-c);return new e.Z(e.z.number(n[0]/o,r[0]/s,h)/this.worldSize,e.z.number(a,l,h)/this.worldSize)}coordinatePoint(t,i=0,n=this.pixelMatrix){const r=[t.x*this.worldSize,t.y*this.worldSize,i,1];return e.ag(r,r,n),new e.P(r[0]/r[3],r[1]/r[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return(new G).extend(this.pointLocation(new e.P(0,t))).extend(this.pointLocation(new e.P(this.width,t))).extend(this.pointLocation(new e.P(this.width,this.height))).extend(this.pointLocation(new e.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new G([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,yn])}calculateTileMatrix(t){const i=t.canonical,n=this.worldSize/this.zoomScale(i.z),r=i.x+Math.pow(2,i.z)*t.wrap,o=e.ao(new Float64Array(16));return e.J(o,o,[r*n,i.y*n,0]),e.K(o,o,[n/e.X,n/e.X,1]),o}calculatePosMatrix(t,i=!1){const n=t.key,r=i?this._alignedPosMatrixCache:this._posMatrixCache;if(r[n])return r[n];const o=this.calculateTileMatrix(t);return e.L(o,i?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,o),r[n]=new Float32Array(o),r[n]}calculateFogMatrix(t){const i=t.key,n=this._fogMatrixCache;if(n[i])return n[i];const r=this.calculateTileMatrix(t);return e.L(r,this.fogMatrix,r),n[i]=new Float32Array(r),n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,i){i=e.ad(+i,this.minZoom,this.maxZoom);const n={center:new e.N(t.lng,t.lat),zoom:i};let r=this.lngRange;if(!this._renderWorldCopies&&null===r){const t=180-1e-10;r=[-t,t]}const o=this.tileSize*this.zoomScale(n.zoom);let s=0,a=o,l=0,c=o,u=0,h=0;const{x:d,y:p}=this.size;if(this.latRange){const t=this.latRange;s=e.Q(t[1])*o,a=e.Q(t[0])*o,a-s<p&&(u=p/(a-s))}r&&(l=e.b3(e.O(r[0])*o,0,o),c=e.b3(e.O(r[1])*o,0,o),c<l&&(c+=o),c-l<d&&(h=d/(c-l)));const{x:f,y:m}=this.project.call({worldSize:o},t);let g,y;const _=Math.max(h||0,u||0);if(_){const t=new e.P(h?(c+l)/2:f,u?(a+s)/2:m);return n.center=this.unproject.call({worldSize:o},t).wrap(),n.zoom+=this.scaleZoom(_),n}if(this.latRange){const t=p/2;m-t<s&&(y=s+t),m+t>a&&(y=a-t)}if(r){const t=(l+c)/2;let i=f;this._renderWorldCopies&&(i=e.b3(f,t-o/2,t+o/2));const n=d/2;i-n<l&&(g=l+n),i+n>c&&(g=c-n)}if(void 0!==g||void 0!==y){const t=new e.P(null!=g?g:f,null!=y?y:m);n.center=this.unproject.call({worldSize:o},t).wrap()}return n}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:e,zoom:i}=this.getConstrained(this.center,this.zoom);this.center=e,this.zoom=i,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.point.x,n=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=e.b5(1,this.center.lat)*this.worldSize;let r=e.ao(new Float64Array(16));e.K(r,r,[this.width/2,-this.height/2,1]),e.J(r,r,[1,-1,0]),this.labelPlaneMatrix=r,r=e.ao(new Float64Array(16)),e.K(r,r,[1,-1,1]),e.J(r,r,[-1,-1,0]),e.K(r,r,[2/this.width,2/this.height,1]),this.glCoordMatrix=r;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this.minElevationForCurrentTile),a=o-s*this._pixelPerMeter/Math.cos(this._pitch),l=s<0?a:o,c=Math.PI/2+this._pitch,u=this._fov*(.5+t.y/this.height),h=Math.sin(u)*l/Math.sin(e.ad(Math.PI-c-u,.01,Math.PI-.01)),d=this.getHorizon(),p=2*Math.atan(d/this.cameraToCenterDistance)*(.5+t.y/(2*d)),f=Math.sin(p)*l/Math.sin(e.ad(Math.PI-c-p,.01,Math.PI-.01)),m=Math.min(h,f),g=1.01*(Math.cos(Math.PI/2-this._pitch)*m+l),y=this.height/50;r=new Float64Array(16),e.b6(r,this._fov,this.width/this.height,y,g),r[8]=2*-t.x/this.width,r[9]=2*t.y/this.height,e.K(r,r,[1,-1,1]),e.J(r,r,[0,0,-this.cameraToCenterDistance]),e.b7(r,r,this._pitch),e.ae(r,r,this.angle),e.J(r,r,[-i,-n,0]),this.mercatorMatrix=e.K([],r,[this.worldSize,this.worldSize,this.worldSize]),e.K(r,r,[1,1,this._pixelPerMeter]),this.pixelMatrix=e.L(new Float64Array(16),this.labelPlaneMatrix,r),e.J(r,r,[0,0,-this.elevation]),this.modelViewProjectionMatrix=r,this.invModelViewProjectionMatrix=e.at([],r),this.fogMatrix=new Float64Array(16),e.b6(this.fogMatrix,this._fov,this.width/this.height,o,g),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,e.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),e.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),e.b7(this.fogMatrix,this.fogMatrix,this._pitch),e.ae(this.fogMatrix,this.fogMatrix,this.angle),e.J(this.fogMatrix,this.fogMatrix,[-i,-n,0]),e.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),e.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=e.L(new Float64Array(16),this.labelPlaneMatrix,r);const _=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=i-Math.round(i)+x*_+b*v,S=n-Math.round(n)+x*v+b*_,T=new Float64Array(r);if(e.J(T,T,[w>.5?w-1:w,S>.5?S-1:S,0]),this.alignedModelViewProjectionMatrix=T,r=e.at(new Float64Array(16),this.pixelMatrix),!r)throw new Error("failed to invert matrix");this.pixelMatrixInverse=r,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new e.P(0,0)),i=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.ag(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}getCameraQueryGeometry(t){const i=this.getCameraPoint();if(1===t.length)return[t[0],i];{let n=i.x,r=i.y,o=i.x,s=i.y;for(const e of t)n=Math.min(n,e.x),r=Math.min(r,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y);return[new e.P(n,r),new e.P(o,r),new e.P(o,s),new e.P(n,s),new e.P(n,r)]}}lngLatToCameraDepth(t,i){const n=this.locationCoordinate(t),r=[n.x*this.worldSize,n.y*this.worldSize,i,1];return e.ag(r,r,this.modelViewProjectionMatrix),r[2]/r[3]}}function vn(t,e){let i,n=!1,r=null,o=null;const s=()=>{r=null,n&&(t.apply(o,i),r=setTimeout(s,e),n=!1)};return(...t)=>(n=!0,o=this,i=t,r||s(),r)}class xn{constructor(t){this._getCurrentHash=()=>{const t=window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")},this._onHashChange=()=>{const t=this._getCurrentHash();if(t.length>=3&&!t.some((t=>isNaN(t)))){const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch(t){}},this._updateHash=vn(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,n),o=Math.round(e.lng*r)/r,s=Math.round(e.lat*r)/r,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=t?`/${o}/${s}/${i}`:`${i}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const t=this._hashName;let e=!1;const i=window.location.hash.slice(1).split("&").map((i=>{const n=i.split("=")[0];return n===t?(e=!0,`${n}=${c}`):i})).filter((t=>t));return e||i.push(`${t}=${c}`),`#${i.join("&")}`}return`#${c}`}}const bn={linearity:.3,easing:e.b8(0,0,.3,1)},wn=e.e({deceleration:2500,maxSpeed:1400},bn),Sn=e.e({deceleration:20,maxSpeed:1400},bn),Tn=e.e({deceleration:1e3,maxSpeed:360},bn),In=e.e({deceleration:1e3,maxSpeed:90},bn);class Pn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=o.now();for(;t.length>0&&e-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const o=Cn(i.pan.mag(),n,e.e({},wn,t||{}));r.offset=i.pan.mult(o.amount/i.pan.mag()),r.center=this._map.transform.center,kn(r,o)}if(i.zoom){const t=Cn(i.zoom,n,Sn);r.zoom=this._map.transform.zoom+t.amount,kn(r,t)}if(i.bearing){const t=Cn(i.bearing,n,Tn);r.bearing=this._map.transform.bearing+e.ad(t.amount,-179,179),kn(r,t)}if(i.pitch){const t=Cn(i.pitch,n,In);r.pitch=this._map.transform.pitch+t.amount,kn(r,t)}if(r.zoom||r.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),e.e(r,{noMoveStart:!0})}}function kn(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Cn(t,i,n){const{maxSpeed:r,linearity:o,deceleration:s}=n,a=e.ad(t*o/(i/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class An extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n,r={}){const o=s.mousePos(i.getCanvas(),n),a=i.unproject(o);super(t,e.e({point:o,lngLat:a,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class En extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n){const r="touchend"===t?n.changedTouches:n.touches,o=s.touchPos(i.getCanvasContainer(),r),a=o.map((t=>i.unproject(t))),l=o.reduce(((t,e,i,n)=>t.add(e.div(n.length))),new e.P(0,0));super(t,{points:o,point:l,lngLats:a,lngLat:i.unproject(l),originalEvent:n}),this._defaultPrevented=!1}}class Mn extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class zn{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Mn(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new An(t.type,this._map,t))}mouseup(t){this._map.fire(new An(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new An(t.type,this._map,t))}dblclick(t){return this._firePreventable(new An(t.type,this._map,t))}mouseover(t){this._map.fire(new An(t.type,this._map,t))}mouseout(t){this._map.fire(new An(t.type,this._map,t))}touchstart(t){return this._firePreventable(new En(t.type,this._map,t))}touchmove(t){this._map.fire(new En(t.type,this._map,t))}touchend(t){this._map.fire(new En(t.type,this._map,t))}touchcancel(t){this._map.fire(new En(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new An(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new An("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new An(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ln{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(e.P.convert(t),this._map.terrain)}}class Rn{constructor(t,e){this._map=t,this._tr=new Ln(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(s.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=i,this._box||(this._box=s.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(n.x,i.x),o=Math.max(n.x,i.x),a=Math.min(n.y,i.y),l=Math.max(n.y,i.y);s.setTransform(this._box,`translate(${r}px,${a}px)`),this._box.style.width=o-r+"px",this._box.style.height=l-a+"px"}mouseupWindow(t,i){if(!this._active)return;if(0!==t.button)return;const n=this._startPos,r=i;if(this.reset(),s.suppressClick(),n.x!==r.x||n.y!==r.y)return this._map.fire(new e.k("boxzoomend",{originalEvent:t})),{cameraAnimation:t=>t.fitScreenCoordinates(n,r,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.k(t,{originalEvent:i}))}}function Bn(t,e){if(t.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${t.length}, points ${e.length}`);const i={};for(let n=0;n<t.length;n++)i[t[n].identifier]=e[n];return i}class Fn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){const i=new e.P(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=Bn(n,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=Bn(i,e);for(const t in this.touches){const e=n[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class On{constructor(t){this.singleTap=new Fn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class jn{constructor(t){this._tr=new Ln(t),this._zoomIn=new On({numTouches:1,numTaps:2}),this._zoomOut=new On({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),r=this._zoomOut.touchend(t,e,i),o=this._tr;return n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(n)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const e=this._moveFunction(...t);if(e.bearingDelta||e.pitchDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(t,e){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=e.length?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const n=e.length?e[0]:e;return!this._moved&&n.dist(i)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=n,this._move(i,n))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&s.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Vn={0:1,2:2};class $n{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const e=s.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(t,e){const i=Vn[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton)}isValidEndEvent(t){return s.mouseButton(t)===this._eventButton}}class Un{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return 1===t.targetTouches.length}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const qn=t=>{t.mousedown=t.dragStart,t.mousemoveWindow=t.dragMove,t.mouseup=t.dragEnd,t.contextmenu=t=>{t.preventDefault()}},Zn=({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:i=.8})=>{const n=new $n({checkCorrectEvent:t=>0===s.mouseButton(t)&&t.ctrlKey||2===s.mouseButton(t)});return new Nn({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*i}),moveStateManager:n,enable:t,assignEvents:qn})},Gn=({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:i=-.5})=>{const n=new $n({checkCorrectEvent:t=>0===s.mouseButton(t)&&t.ctrlKey||2===s.mouseButton(t)});return new Nn({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:n,enable:t,assignEvents:qn})};class Kn{constructor(t,e){this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._active&&!(i.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,e,i)}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,n){n.length>0&&(this._active=!0);const r=Bn(n,i),o=new e.P(0,0),s=new e.P(0,0);let a=0;for(const t in r){const e=r[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,r[t]=e)}if(this._touches=r,a<this.minTouchs()||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(!this._firstTwoTouches)return;t.preventDefault();const[n,r]=this._firstTwoTouches,o=Wn(i,e,n),s=Wn(i,e,r);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,o=Wn(i,e,n),a=Wn(i,e,r);o&&a||(this._active&&s.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Wn(t,e,i){for(let n=0;n<t.length;n++)if(t[n].identifier===i)return e[n]}function Xn(t,e){return Math.log(t/e)/Math.LN2}class Jn extends Hn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Xn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xn(this._distance,i),pinchAround:e}}}function Yn(t,e){return 180*t.angleWith(e)/Math.PI}class Qn extends Hn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e,i){const n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Yn(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=Yn(t,this._startVector);return Math.abs(i)<e}}function tr(t){return Math.abs(t.y)>Math.abs(t.x)}class er extends Hn{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,i){super.touchstart(t,e,i),this._currentTouchCount=i.length}_start(t){this._lastPoints=t,tr(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const n=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(n,r,i.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+r.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,r=e.mag()>=2;if(!n&&!r)return;if(!n||!r)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return tr(t)&&tr(e)&&o}}const ir={panStep:100,bearingStep:15,pitchStep:10};class nr{constructor(t){this._tr=new Ln(t);const e=ir;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:rr,zoom:e?Math.round(a.zoom)+e*(t.shiftKey?2:1):a.zoom,bearing:a.bearing+i*this._bearingStep,pitch:a.pitch+n*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:a.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rr(t){return t*(2-t)}const or=4.000244140625;class sr{constructor(t,e){this._onTimeout=t=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},this._map=t,this._tr=new Ln(t),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=o.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==e&&e%or==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=s.mousePos(this._map.getCanvas(),t),n=this._tr;this._around=i.y>n.transform.height/2-n.transform.getHorizon()?e.N.convert(this._aroundCenter?n.center:n.unproject(i)):e.N.convert(n.center),this._aroundPoint=n.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._tr.transform;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>or?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);const n="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(n*i))),"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:t.zoom,n=this._startZoom,r=this._easing;let s,a=!1;if("wheel"===this._type&&n&&r){const t=Math.min((o.now()-this._lastWheelEventTime)/200,1),l=r(t);s=e.z.number(n,i,l),t<1?this._frameId||(this._frameId=!0):a=!0}else s=i,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.b9;if(this._prevEase){const t=this._prevEase,n=(o.now()-t.start)/t.duration,r=t.easing(n+.01)-t.easing(n),s=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-s*s);i=e.b8(s,a,.25,1)}return this._prevEase={start:o.now(),duration:t,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ar{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class lr{constructor(t){this._tr=new Ln(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cr{constructor(){this._tap=new On({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,i){if(!this._swipePoint)if(this._tapTime){const n=e[0],r=t.timeStamp-this._tapTime<500,o=this._tapPoint.dist(n)<30;r&&o?i.length>0&&(this._swipePoint=n,this._swipeTouch=i[0].identifier):this.reset()}else this._tap.touchstart(t,e,i)}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){if(this._tapTime)this._swipePoint&&0===i.length&&this.reset();else{const n=this._tap.touchend(t,e,i);n&&(this._tapTime=t.timeStamp,this._tapPoint=n)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ur{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hr{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class dr{constructor(t,e,i,n){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class pr{constructor(t,e){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=t,this._options=e,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=s.create("div","maplibregl-cooperative-gesture-screen",t);let e=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(e=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const i=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),n=document.createElement("div");n.className="maplibregl-desktop-message",n.textContent=e,this._container.appendChild(n);const r=document.createElement("div");r.className="maplibregl-mobile-message",r.textContent=i,this._container.appendChild(r),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(s.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(1===t.touches.length)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const fr=t=>t.zoom||t.drag||t.pitch||t.rotate;class mr extends e.k{}function gr(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class yr{constructor(t,e){this.handleWindowEvent=t=>{this.handleEvent(t,`${t.type}Window`)},this.handleEvent=(t,e)=>{if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const i="renderFrame"===t.type?void 0:t,n={needsRenderFrame:!1},r={},o={},a=t.touches,l=a?this._getMapTouches(a):void 0,c=l?s.touchPos(this._map.getCanvas(),l):s.mousePos(this._map.getCanvas(),t);for(const{handlerName:s,handler:a,allowed:u}of this._handlers){if(!a.isEnabled())continue;let h;this._blockedByActive(o,u,s)?a.reset():a[e||t.type]&&(h=a[e||t.type](t,c,l),this.mergeHandlerResult(n,r,h,s,i),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||a.isActive())&&(o[s]=a)}const u={};for(const t in this._previousActiveHandlers)o[t]||(u[t]=i);this._previousActiveHandlers=o,(Object.keys(u).length||gr(n))&&(this._changes.push([n,r,u]),this._triggerRenderFrame()),(Object.keys(o).length||gr(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=n;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pn(t),this._bearingSnap=e.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(e);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,i]of this._listeners)s.addEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,i)}destroy(){for(const[t,e,i]of this._listeners)s.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new zn(e,t));const n=e.boxZoom=new Rn(e,t);this._add("boxZoom",n),t.interactive&&t.boxZoom&&n.enable();const r=e.cooperativeGestures=new pr(e,t.cooperativeGestures);this._add("cooperativeGestures",r),t.cooperativeGestures&&r.enable();const o=new jn(e),a=new lr(e);e.doubleClickZoom=new ar(a,o),this._add("tapZoom",o),this._add("clickZoom",a),t.interactive&&t.doubleClickZoom&&e.doubleClickZoom.enable();const l=new cr;this._add("tapDragZoom",l);const c=e.touchPitch=new er(e);this._add("touchPitch",c),t.interactive&&t.touchPitch&&e.touchPitch.enable(t.touchPitch);const u=Zn(t),h=Gn(t);e.dragRotate=new hr(t,u,h),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",h,["mouseRotate"]),t.interactive&&t.dragRotate&&e.dragRotate.enable();const d=(({enable:t,clickTolerance:e})=>{const i=new $n({checkCorrectEvent:t=>0===s.mouseButton(t)&&!t.ctrlKey});return new Nn({clickTolerance:e,move:(t,e)=>({around:e,panDelta:e.sub(t)}),activateOnStart:!0,moveStateManager:i,enable:t,assignEvents:qn})})(t),p=new Kn(t,e);e.dragPan=new ur(i,d,p),this._add("mousePan",d),this._add("touchPan",p,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&e.dragPan.enable(t.dragPan);const f=new Qn,m=new Jn;e.touchZoomRotate=new dr(i,m,f,l),this._add("touchRotate",f,["touchPan","touchZoom"]),this._add("touchZoom",m,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&e.touchZoomRotate.enable(t.touchZoomRotate);const g=e.scrollZoom=new sr(e,(()=>this._triggerRenderFrame()));this._add("scrollZoom",g,["mousePan"]),t.interactive&&t.scrollZoom&&e.scrollZoom.enable(t.scrollZoom);const y=e.keyboard=new nr(e);this._add("keyboard",y),t.interactive&&t.keyboard&&e.keyboard.enable(),this._add("blockableMapEvent",new Dn(e))}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(fr(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}mergeHandlerResult(t,i,n,r,o){if(!n)return;e.e(t,n);const s={handlerName:r,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(i.zoom=s),void 0!==n.panDelta&&(i.drag=s),void 0!==n.pitchDelta&&(i.pitch=s),void 0!==n.bearingDelta&&(i.rotate=s)}_applyChanges(){const t={},i={},n={};for(const[r,o,s]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.e(i,o),e.e(n,s);this._updateMapTransform(t,i,n),this._changes=[]}_updateMapTransform(t,e,i){const n=this._map,r=n._getTransformForUpdate(),o=n.terrain;if(!(gr(t)||o&&this._terrainMovement))return this._fireEvents(e,i,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,pinchAround:h}=t;void 0!==h&&(u=h),n._stop(!0),u=u||n.transform.centerPoint;const d=r.pointLocation(s?u.sub(s):u);l&&(r.bearing+=l),c&&(r.pitch+=c),a&&(r.zoom+=a),o?this._terrainMovement||!e.drag&&!e.zoom?e.drag&&this._terrainMovement?r.center=r.pointLocation(r.centerPoint.sub(s)):r.setLocationAtPoint(d,u):(this._terrainMovement=!0,this._map._elevationFreeze=!0,r.setLocationAtPoint(d,u)):r.setLocationAtPoint(d,u),n._applyUpdatedTransform(r),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(t,i,n){const r=fr(this._eventsInProgress),s=fr(t),a={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(a[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!r&&s&&this._fireEvent("movestart",s.originalEvent);for(const t in a)this._fireEvent(t,a[t]);s&&this._fireEvent("move",s.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const l={};let c;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],c=i[e]||n,l[`${t}end`]=c)}for(const t in l)this._fireEvent(t,l[t]);const u=fr(this._eventsInProgress),h=(r||s)&&!u;if(h&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),n&&h){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;!t||!t.essential&&o.prefersReducedMotion?(this._map.fire(new e.k("moveend",{originalEvent:c})),i(this._map.getBearing())&&this._map.resetNorth()):(i(t.bearing||this._map.getBearing())&&(t.bearing=0),t.freezeElevation=!0,this._map.easeTo(t,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.k(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new mr("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class _r extends e.E{constructor(t,e){super(),this._renderFrameCallback=()=>{const t=Math.min((o.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new e.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(t,i,n){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},i),n)}panTo(t,i,n){return this.easeTo(e.e({center:t},i),n)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,i,n){return this.easeTo(e.e({zoom:t},i),n)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,i,n){return this.easeTo(e.e({bearing:t},i),n)}resetNorth(t,i){return this.rotateTo(0,e.e({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.e({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=G.convert(t);const i=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,e)}_cameraForBoxAndBearing(t,i,n,r){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=e.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const t=r.padding;r.padding={top:t,bottom:t,right:t,left:t}}r.padding=e.e(o,r.padding);const s=this.transform,a=s.padding,l=new G(t,i),c=s.project(l.getNorthWest()),u=s.project(l.getNorthEast()),h=s.project(l.getSouthEast()),d=s.project(l.getSouthWest()),p=e.ba(-n),f=c.rotate(p),m=u.rotate(p),g=h.rotate(p),y=d.rotate(p),_=new e.P(Math.max(f.x,m.x,y.x,g.x),Math.max(f.y,m.y,y.y,g.y)),v=new e.P(Math.min(f.x,m.x,y.x,g.x),Math.min(f.y,m.y,y.y,g.y)),x=_.sub(v),b=(s.width-(a.left+a.right+r.padding.left+r.padding.right))/x.x,w=(s.height-(a.top+a.bottom+r.padding.top+r.padding.bottom))/x.y;if(w<0||b<0)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const S=Math.min(s.scaleZoom(s.scale*Math.min(b,w)),r.maxZoom),T=e.P.convert(r.offset),I=new e.P((r.padding.left-r.padding.right)/2,(r.padding.top-r.padding.bottom)/2).rotate(e.ba(n)),P=T.add(I).mult(s.scale/s.zoomScale(S));return{center:s.unproject(c.add(h).div(2).sub(P)),zoom:S,bearing:n}}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}fitScreenCoordinates(t,i,n,r,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.P.convert(t)),this.transform.pointLocation(e.P.convert(i)),n,r),r,o)}_fitInternal(t,i,n){return t?(delete(i=e.e(t,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(t,i){this.stop();const n=this._getTransformForUpdate();let r=!1,o=!1,s=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=e.N.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(o=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(s=!0,n.pitch=+t.pitch),null==t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),this._applyUpdatedTransform(n),this.fire(new e.k("movestart",i)).fire(new e.k("move",i)),r&&this.fire(new e.k("zoomstart",i)).fire(new e.k("zoom",i)).fire(new e.k("zoomend",i)),o&&this.fire(new e.k("rotatestart",i)).fire(new e.k("rotate",i)).fire(new e.k("rotateend",i)),s&&this.fire(new e.k("pitchstart",i)).fire(new e.k("pitch",i)).fire(new e.k("pitchend",i)),this.fire(new e.k("moveend",i))}calculateCameraOptionsFromTo(t,i,n,r=0){const o=e.Z.fromLngLat(t,i),s=e.Z.fromLngLat(n,r),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),d=this.transform.scaleZoom(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),zoom:d,pitch:f,bearing:p}}easeTo(t,i){var n;this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.b9},t)).animate||!t.essential&&o.prefersReducedMotion)&&(t.duration=0);const r=this._getTransformForUpdate(),s=this.getZoom(),a=this.getBearing(),l=this.getPitch(),c=this.getPadding(),u="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:l,d="padding"in t?t.padding:r.padding,p=e.P.convert(t.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),{center:g,zoom:y}=r.getConstrained(e.N.convert(t.center||m),null!==(n=t.zoom)&&void 0!==n?n:s);this._normalizeCenter(g);const _=r.project(m),v=r.project(g).sub(_),x=r.zoomScale(y-s);let b,w;t.around&&(b=e.N.convert(t.around),w=r.locationPoint(b));const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||y!==s,this._rotating=this._rotating||a!==u,this._pitching=this._pitching||h!==l,this._padding=!r.isPaddingEqual(d),this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,S),this.terrain&&this._prepareElevation(g),this._ease((n=>{if(this._zooming&&(r.zoom=e.z.number(s,y,n)),this._rotating&&(r.bearing=e.z.number(a,u,n)),this._pitching&&(r.pitch=e.z.number(l,h,n)),this._padding&&(r.interpolatePadding(c,d,n),f=r.centerPoint.add(p)),this.terrain&&!t.freezeElevation&&this._updateElevation(n),b)r.setLocationAtPoint(b,w);else{const t=r.zoomScale(r.zoom-s),e=y>s?Math.min(2,x):Math.max(.5,x),i=Math.pow(e,1-n),o=r.unproject(_.add(v.mult(n*i)).mult(t));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,f)}this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(e=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,n={}){this._moving=!0,i||n.moving||this.fire(new e.k("movestart",t)),this._zooming&&!n.zooming&&this.fire(new e.k("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new e.k("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new e.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&i!==this._elevationTarget){const e=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(e-(i-(e*t+this._elevationStart))/(1-t)),this._elevationTarget=i}this.transform.elevation=e.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const e=t.clone(),{center:i,zoom:n,pitch:r,bearing:o,elevation:s}=this.transformCameraUpdate(e);i&&(e.center=i),void 0!==n&&(e.zoom=n),void 0!==r&&(e.pitch=r),void 0!==o&&(e.bearing=o),void 0!==s&&(e.elevation=s),this.transform.apply(e)}_fireMoveEvents(t){this.fire(new e.k("move",t)),this._zooming&&this.fire(new e.k("zoom",t)),this._rotating&&this.fire(new e.k("rotate",t)),this._pitching&&this.fire(new e.k("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const n=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new e.k("zoomend",t)),r&&this.fire(new e.k("rotateend",t)),o&&this.fire(new e.k("pitchend",t)),this.fire(new e.k("moveend",t))}flyTo(t,i){var n;if(!t.essential&&o.prefersReducedMotion){const n=e.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.b9},t);const r=this._getTransformForUpdate(),s=this.getZoom(),a=this.getBearing(),l=this.getPitch(),c=this.getPadding(),u="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:l,d="padding"in t?t.padding:r.padding,p=e.P.convert(t.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),{center:g,zoom:y}=r.getConstrained(e.N.convert(t.center||m),null!==(n=t.zoom)&&void 0!==n?n:s);this._normalizeCenter(g);const _=r.zoomScale(y-s),v=r.project(m),x=r.project(g).sub(v);let b=t.curve;const w=Math.max(r.width,r.height),S=w/_,T=x.mag();if("minZoom"in t){const i=e.ad(Math.min(t.minZoom,s,y),r.minZoom,r.maxZoom),n=w/r.zoomScale(i-s);b=Math.sqrt(n/T*2)}const I=b*b;function P(t){const e=(S*S-w*w+(t?-1:1)*I*I*T*T)/(2*(t?S:w)*I*T);return Math.log(Math.sqrt(e*e+1)-e)}function k(t){return(Math.exp(t)-Math.exp(-t))/2}function C(t){return(Math.exp(t)+Math.exp(-t))/2}const A=P(!1);let E=function(t){return C(A)/C(A+b*t)},M=function(t){return w*((C(A)*(k(e=A+b*t)/C(e))-k(A))/I)/T;var e},z=(P(!0)-A)/b;if(Math.abs(T)<1e-6||!isFinite(z)){if(Math.abs(w-S)<1e-6)return this.easeTo(t,i);const e=S<w?-1:1;z=Math.abs(Math.log(S/w))/b,M=()=>0,E=t=>Math.exp(e*b*t)}return t.duration="duration"in t?+t.duration:1e3*z/("screenSpeed"in t?+t.screenSpeed/b:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=a!==u,this._pitching=h!==l,this._padding=!r.isPaddingEqual(d),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(g),this._ease((n=>{const o=n*z,m=1/E(o);r.zoom=1===n?y:s+r.scaleZoom(m),this._rotating&&(r.bearing=e.z.number(a,u,n)),this._pitching&&(r.pitch=e.z.number(l,h,n)),this._padding&&(r.interpolatePadding(c,d,n),f=r.centerPoint.add(p)),this.terrain&&!t.freezeElevation&&this._updateElevation(n);const _=1===n?g:r.unproject(v.add(x.mult(M(o))).mult(m));r.setLocationAtPoint(r.renderWorldCopies?_.wrap():_,f),this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(i)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){var i;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}return t||null===(i=this.handlers)||void 0===i||i.stop(!1),this}_ease(t,e,i){!1===i.animate||0===i.duration?(t(1),e()):(this._easeStart=o.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,i){t=e.b3(t,-180,180);const n=Math.abs(t-i);return Math.abs(t-360-i)<n&&(t-=360),Math.abs(t+360-i)<n&&(t+=360),t}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(e.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const vr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xr{constructor(t=vr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=t=>{!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType&&"terrain"!==t.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=s.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=s.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=s.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.title=i,t.setAttribute("aria-label",i)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((t=>"string"!=typeof t?"":t))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style.sourceCaches;for(const i in e){const n=e[i];if(n.used||n.usedForTerrain){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t=t.filter((t=>String(t).trim())),t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0}));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class br{constructor(t={}){this._updateCompact=()=>{const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&e.classList.add("maplibregl-compact"):e.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=s.create("div","maplibregl-ctrl");const e=s.create("a","maplibregl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){s.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class wr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Sr=e.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Tr extends e.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,i){this.sourceCache.update(t,i),this._renderableTilesKeys=[];const n={};for(const r of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i}))n[r.key]=!0,this._renderableTilesKeys.push(r.key),this._tiles[r.key]||(r.posMatrix=new Float64Array(16),e.aQ(r.posMatrix,0,e.X,0,e.X,0,1),this._tiles[r.key]=new lt(r,this.tileSize));for(const t in this._tiles)n[t]||delete this._tiles[t]}freeRtt(t){for(const e in this._tiles){const i=this._tiles[e];(!t||i.tileID.equals(t)||i.tileID.isChildOf(t)||t.isChildOf(i.tileID))&&(i.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const i={};for(const n of this._renderableTilesKeys){const r=this._tiles[n].tileID;if(r.canonical.equals(t.canonical)){const r=t.clone();r.posMatrix=new Float64Array(16),e.aQ(r.posMatrix,0,e.X,0,e.X,0,1),i[n]=r}else if(r.canonical.isChildOf(t.canonical)){const o=t.clone();o.posMatrix=new Float64Array(16);const s=r.canonical.z-t.canonical.z,a=r.canonical.x-(r.canonical.x>>s<<s),l=r.canonical.y-(r.canonical.y>>s<<s),c=e.X>>s;e.aQ(o.posMatrix,0,c,0,c,0,1),e.J(o.posMatrix,o.posMatrix,[-a*c,-l*c,0]),i[n]=o}else if(t.canonical.isChildOf(r.canonical)){const o=t.clone();o.posMatrix=new Float64Array(16);const s=t.canonical.z-r.canonical.z,a=t.canonical.x-(t.canonical.x>>s<<s),l=t.canonical.y-(t.canonical.y>>s<<s),c=e.X>>s;e.aQ(o.posMatrix,0,e.X,0,e.X,0,1),e.J(o.posMatrix,o.posMatrix,[a*c,l*c,0]),e.K(o.posMatrix,o.posMatrix,[1/2**s,1/2**s,0]),i[n]=o}}return i}getSourceTile(t,e){const i=this.sourceCache._source;let n=t.overscaledZ-this.deltaZoom;if(n>i.maxzoom&&(n=i.maxzoom),n<i.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(n).key);let r=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!r||!r.dem)&&e)for(;n>=i.minzoom&&(!r||!r.dem);)r=this.sourceCache.getTileByID(t.scaledTo(n--).key);return r}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter((e=>e.timeAdded>=t))}}class Ir{constructor(t,e,i){this.painter=t,this.sourceCache=new Tr(e),this.options=i,this.exaggeration="number"==typeof i.exaggeration?i.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,i,n,r=e.X){var o;if(!(i>=0&&i<r&&n>=0&&n<r))return 0;const s=this.getTerrainData(t),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t}([],[i/r*e.X,n/r*e.X],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return a.get(u,h)*(1-d)*(1-p)+a.get(u+1,h)*d*(1-p)+a.get(u,h+1)*(1-d)*p+a.get(u+1,h+1)*d*p}getElevationForLngLatZoom(t,i){const{tileID:n,mercatorX:r,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(t,i);return this.getElevation(n,r%e.X,o%e.X,e.X)}getElevation(t,i,n,r=e.X){return this.getDEMElevation(t,i,n,r)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const t=this.painter.context,i=new e.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new b(t,i,t.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new b(t,new e.R({width:1,height:1}),t.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=e.ao([])}const i=this.sourceCache.getSourceTile(t,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const t=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new b(t,i.dem.getPixels(),t.gl.RGBA,{premultiply:!1}),i.demTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const n=i&&i+i.tileID.key+t.key;if(n&&!this._demMatrixCache[n]){const n=this.sourceCache.sourceCache._source.maxzoom;let r=t.canonical.z-i.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=n?r=t.canonical.z-n:e.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=t.canonical.x-(t.canonical.x>>r<<r),s=t.canonical.y-(t.canonical.y>>r<<r),a=e.bb(new Float64Array(16),[1/(e.X<<r),1/(e.X<<r),0]);e.J(a,a,[o*e.X,s*e.X,0]),this._demMatrixCache[t.key]={matrix:a,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:n?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(t){const e=this.painter,i=e.width/devicePixelRatio,n=e.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===n||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new b(e.context,{width:i,height:n,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new b(e.context,{width:i,height:n,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=e.context.createFramebuffer(i,n,!0,!1),this._fbo.depthAttachment.set(e.context.createRenderbuffer(e.context.gl.DEPTH_COMPONENT16,i,n))),this._fbo.colorAttachment.set("coords"===t?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let t=0,e=0;t<this._coordsTextureSize;t++)for(let n=0;n<this._coordsTextureSize;n++,e+=4)i[e+0]=255&n,i[e+1]=255&t,i[e+2]=n>>8<<4|t>>8,i[e+3]=0;const n=new e.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),r=new b(t,n,t.gl.RGBA,{premultiply:!1});return r.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=r,r}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),n=this.painter.context,r=n.gl,o=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),s=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),a=Math.round(this.painter.height/devicePixelRatio);n.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),r.readPixels(o,a-s-1,1,1,r.RGBA,r.UNSIGNED_BYTE,i),n.bindFramebuffer.set(null);const l=i[0]+(i[2]>>4<<8),c=i[1]+((15&i[2])<<8),u=this.coordsIndex[255-i[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new e.Z((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(t){const e=new Uint8Array(4),i=this.painter.context,n=i.gl;return i.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),n.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,n.RGBA,n.UNSIGNED_BYTE,e),i.bindFramebuffer.set(null),(e[0]/16777216+e[1]/65536+e[2]/256+e[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,i=new e.bc,n=new e.aY,r=this.meshSize,o=e.X/r,s=r*r;for(let t=0;t<=r;t++)for(let e=0;e<=r;e++)i.emplaceBack(e*o,t*o,0);for(let t=0;t<s;t+=r+1)for(let e=0;e<r;e++)n.emplaceBack(e+t,r+e+t+1,r+e+t+2),n.emplaceBack(e+t,r+e+t+2,e+t+1);const a=i.length,l=a+2*(r+1);for(const t of[0,1])for(let n=0;n<=r;n++)for(const r of[0,1])i.emplaceBack(n*o,t*e.X,r);for(let t=0;t<2*r;t+=2)n.emplaceBack(l+t,l+t+1,l+t+3),n.emplaceBack(l+t,l+t+3,l+t+2),n.emplaceBack(a+t,a+t+3,a+t+1),n.emplaceBack(a+t,a+t+2,a+t+3);const c=i.length,u=c+2*(r+1);for(const t of[0,1])for(let n=0;n<=r;n++)for(const r of[0,1])i.emplaceBack(t*e.X,n*o,r);for(let t=0;t<2*r;t+=2)n.emplaceBack(c+t,c+t+1,c+t+3),n.emplaceBack(c+t,c+t+3,c+t+2),n.emplaceBack(u+t,u+t+3,u+t+1),n.emplaceBack(u+t,u+t+2,u+t+3);return this._mesh=new dn(t.createVertexBuffer(i,Sr.members),t.createIndexBuffer(n),e.a0.simpleSegment(0,0,i.length,n.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*e.bd/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,e){var i;const{tileID:n}=this._getOverscaledTileIDFromLngLatZoom(t,e);return null!==(i=this.getMinMaxElevation(n).minElevation)&&void 0!==i?i:0}getMinMaxElevation(t){const e=this.getTerrainData(t).tile,i={minElevation:null,maxElevation:null};return e&&e.dem&&(i.minElevation=e.dem.min*this.exaggeration,i.maxElevation=e.dem.max*this.exaggeration),i}_getOverscaledTileIDFromLngLatZoom(t,i){const n=e.Z.fromLngLat(t.wrap()),r=(1<<i)*e.X,o=n.x*r,s=n.y*r,a=Math.floor(o/e.X),l=Math.floor(s/e.X);return{tileID:new e.S(i,0,i,a,l),mercatorX:o,mercatorY:s}}}class Pr{constructor(t,e,i){this._context=t,this._size=e,this._tileSize=i,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const e=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new b(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),e.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),e.colorAttachment.set(i.texture),{id:t,fbo:e,texture:i,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((e=>t.id!==e)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const t of this._recentlyUsed)if(!this._objects[t].inUse)return this._objects[t];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((t=>!t.inUse))}}const kr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Cr{constructor(t,e){this.painter=t,this.terrain=e,this.pool=new Pr(t.context,30,e.sourceCache.tileSize*e.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,e){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter((i=>!t._layers[i].isHidden(e))),this._coordsDescendingInv={};for(const e in t.sourceCaches){this._coordsDescendingInv[e]={};const i=t.sourceCaches[e].getVisibleCoordinates();for(const t of i){const i=this.terrain.sourceCache.getTerrainCoords(t);for(const t in i)this._coordsDescendingInv[e][t]||(this._coordsDescendingInv[e][t]=[]),this._coordsDescendingInv[e][t].push(i[t])}}this._coordsDescendingInvStr={};for(const e of t._order){const i=t._layers[e],n=i.source;if(kr[i.type]&&!this._coordsDescendingInvStr[n]){this._coordsDescendingInvStr[n]={};for(const t in this._coordsDescendingInv[n])this._coordsDescendingInvStr[n][t]=this._coordsDescendingInv[n][t].map((t=>t.key)).sort().join()}}for(const t of this._renderableTiles)for(const e in this._coordsDescendingInvStr){const i=this._coordsDescendingInvStr[e][t.tileID.key];i&&i!==t.rttCoords[e]&&(t.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const i=t.type,n=this.painter,r=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(kr[i]&&(this._prevType&&kr[this._prevType]||this._stacks.push([]),this._prevType=i,this._stacks[this._stacks.length-1].push(t.id),!r))return!0;if(kr[this._prevType]||kr[i]&&r){this._prevType=i;const t=this._stacks.length-1,r=this._stacks[t]||[];for(const i of this._renderableTiles){if(this.pool.isFull()&&(hn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(i),i.rtt[t]){const e=this.pool.getObjectForId(i.rtt[t].id);if(e.stamp===i.rtt[t].stamp){this.pool.useObject(e);continue}}const o=this.pool.getOrCreateFreeObject();this.pool.useObject(o),this.pool.stampObject(o),i.rtt[t]={id:o.id,stamp:o.stamp},n.context.bindFramebuffer.set(o.fbo.framebuffer),n.context.clear({color:e.aN.transparent,stencil:0}),n.currentStencilSource=void 0;for(let t=0;t<r.length;t++){const e=n.style._layers[r[t]],s=e.source?this._coordsDescendingInv[e.source][i.tileID.key]:[i.tileID];n.context.viewport.set([0,0,o.fbo.width,o.fbo.height]),n._renderTileClippingMasks(e,s),n.renderLayer(n,n.style.sourceCaches[e.source],e,s),e.source&&(i.rttCoords[e.source]=this._coordsDescendingInvStr[e.source][i.tileID.key])}}return hn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),kr[i]}return!1}}const Ar={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Er=i,Mr={hash:!1,interactive:!0,bearingSnap:7,attributionControl:vr,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:e.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},zr=t=>{t.touchstart=t.dragStart,t.touchmoveWindow=t.dragMove,t.touchend=t.dragEnd},Dr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Lr{constructor(t,i,n=!1){this.mousedown=t=>{this.startMouse(e.e({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),s.mousePos(this.element,t)),s.addEventListener(window,"mousemove",this.mousemove),s.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=t=>{this.moveMouse(t,s.mousePos(this.element,t))},this.mouseup=t=>{this.mouseRotate.dragEnd(t),this.mousePitch&&this.mousePitch.dragEnd(t),this.offTemp()},this.touchstart=t=>{1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.startTouch(t,this._startPos),s.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.addEventListener(window,"touchend",this.touchend))},this.touchmove=t=>{1!==t.targetTouches.length?this.reset():(this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.moveTouch(t,this._lastPos))},this.touchend=t=>{0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const r=t.dragRotate._mouseRotate.getClickTolerance(),o=t.dragRotate._mousePitch.getClickTolerance();this.element=i,this.mouseRotate=Zn({clickTolerance:r,enable:!0}),this.touchRotate=(({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:i=.8})=>{const n=new Un;return new Nn({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*i}),moveStateManager:n,enable:t,assignEvents:zr})})({clickTolerance:r,enable:!0}),this.map=t,n&&(this.mousePitch=Gn({clickTolerance:o,enable:!0}),this.touchPitch=(({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:i=-.5})=>{const n=new Un;return new Nn({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:n,enable:t,assignEvents:zr})})({clickTolerance:o,enable:!0})),s.addEventListener(i,"mousedown",this.mousedown),s.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),s.addEventListener(i,"touchcancel",this.reset)}startMouse(t,e){this.mouseRotate.dragStart(t,e),this.mousePitch&&this.mousePitch.dragStart(t,e),s.disableDrag()}startTouch(t,e){this.touchRotate.dragStart(t,e),this.touchPitch&&this.touchPitch.dragStart(t,e),s.disableDrag()}moveMouse(t,e){const i=this.map,{bearingDelta:n}=this.mouseRotate.dragMove(t,e)||{};if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const{pitchDelta:n}=this.mousePitch.dragMove(t,e)||{};n&&i.setPitch(i.getPitch()+n)}}moveTouch(t,e){const i=this.map,{bearingDelta:n}=this.touchRotate.dragMove(t,e)||{};if(n&&i.setBearing(i.getBearing()+n),this.touchPitch){const{pitchDelta:n}=this.touchPitch.dragMove(t,e)||{};n&&i.setPitch(i.getPitch()+n)}}off(){const t=this.element;s.removeEventListener(t,"mousedown",this.mousedown),s.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend),s.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){s.enableDrag(),s.removeEventListener(window,"mousemove",this.mousemove),s.removeEventListener(window,"mouseup",this.mouseup),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend)}}let Rr;function Br(t,i,n){const r=new e.N(t.lng,t.lat);if(t=new e.N(t.lng,t.lat),i){const r=new e.N(t.lng-360,t.lat),o=new e.N(t.lng+360,t.lat),s=n.locationPoint(t).distSqr(i);n.locationPoint(r).distSqr(i)<s?t=r:n.locationPoint(o).distSqr(i)<s&&(t=o)}for(;Math.abs(t.lng-n.center.lng)>180;){const e=n.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t.lng!==r.lng&&n.locationPoint(t).y>n.height/2-n.getHorizon()?t:r}const Fr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Or(t,e,i){const n=t.classList;for(const t in Fr)n.remove(`maplibregl-${i}-anchor-${t}`);n.add(`maplibregl-${i}-anchor-${e}`)}class jr extends e.E{constructor(t){if(super(),this._onKeyPress=t=>{const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()},this._onMapClick=t=>{const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},this._update=t=>{var e;if(!this._map)return;const i=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==t?void 0:t.type)||"render"===(null==t?void 0:t.type)&&!i)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Br(this._lngLat,this._flatPos,this._map.transform):null===(e=this._lngLat)||void 0===e?void 0:e.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let n="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?n=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(n=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),s.setTransform(this._element,`${Fr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${r} ${n}`),o.frameAsync(new AbortController).then((()=>{this._updateOpacity(t&&"moveend"===t.type)})).catch((()=>{}))},this._onMove=t=>{if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.k("dragstart"))),this.fire(new e.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.k("dragend")),this._state="inactive"},this._addDragHandler=t=>{this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(null==t?void 0:t.opacity,null==t?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=s.create("div");const i=s.createNS("http://www.w3.org/2000/svg","svg"),n=41,r=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${n}px`),i.setAttributeNS(null,"width",`${r}px`),i.setAttributeNS(null,"viewBox",`0 0 ${r} ${n}`);const o=s.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const a=s.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=s.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=s.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=s.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=s.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=s.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=s.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=s.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=s.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=s.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=s.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(f),a.appendChild(m),i.appendChild(a),i.setAttributeNS(null,"height",n*this._scale+"px"),i.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(i),this._offset=e.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()})),Or(this._element,this._anchor,"marker"),t&&t.className)for(const e of t.className.split(" "))this._element.classList.add(e);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),s.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,n=Math.abs(i)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[n,-1*(e-i+n)],"bottom-right":[-n,-1*(e-i+n)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var i,n;if(!(null===(i=this._map)||void 0===i?void 0:i.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const r=this._map,o=r.terrain.depthAtPoint(this._pos),s=r.terrain.getElevationForLngLatZoom(this._lngLat,r.transform.tileZoom);if(r.transform.lngLatToCameraDepth(this._lngLat,s)-o<.006)return void(this._element.style.opacity=this._opacity);const a=-this._offset.y/r.transform._pixelPerMeter,l=Math.sin(r.getPitch()*Math.PI/180)*a,c=r.terrain.depthAtPoint(new e.P(this._pos.x,this._pos.y-this._offset.y)),u=r.transform.lngLatToCameraDepth(this._lngLat,s+l)-c>.006;(null===(n=this._popup)||void 0===n?void 0:n.isOpen())&&u&&this._popup.remove(),this._element.style.opacity=u?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,e){return void 0===t&&void 0===e&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==t&&(this._opacity=t),void 0!==e&&(this._opacityWhenCovered=e),this._map&&this._updateOpacity(!0),this}}const Nr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Vr=0,$r=!1;const Ur={maxWidth:100,unit:"metric"};function qr(t,e,i){const n=i&&i.maxWidth||100,r=t._container.clientHeight/2,o=t.unproject([0,r]),s=t.unproject([n,r]),a=o.distanceTo(s);if(i&&"imperial"===i.unit){const i=3.2808*a;i>5280?Zr(e,n,i/5280,t._getUIString("ScaleControl.Miles")):Zr(e,n,i,t._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?Zr(e,n,a/1852,t._getUIString("ScaleControl.NauticalMiles")):a>=1e3?Zr(e,n,a/1e3,t._getUIString("ScaleControl.Kilometers")):Zr(e,n,a,t._getUIString("ScaleControl.Meters"))}function Zr(t,e,i,n){const r=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(i);t.style.width=e*(r/i)+"px",t.innerHTML=`${r}&nbsp;${n}`}const Gr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Kr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hr(t){if(t){if("number"==typeof t){const i=Math.round(Math.abs(t)/Math.SQRT2);return{center:new e.P(0,0),top:new e.P(0,t),"top-left":new e.P(i,i),"top-right":new e.P(-i,i),bottom:new e.P(0,-t),"bottom-left":new e.P(i,-i),"bottom-right":new e.P(-i,-i),left:new e.P(t,0),right:new e.P(-t,0)}}if(t instanceof e.P||Array.isArray(t)){const i=e.P.convert(t);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:e.P.convert(t.center||[0,0]),top:e.P.convert(t.top||[0,0]),"top-left":e.P.convert(t["top-left"]||[0,0]),"top-right":e.P.convert(t["top-right"]||[0,0]),bottom:e.P.convert(t.bottom||[0,0]),"bottom-left":e.P.convert(t["bottom-left"]||[0,0]),"bottom-right":e.P.convert(t["bottom-right"]||[0,0]),left:e.P.convert(t.left||[0,0]),right:e.P.convert(t.right||[0,0])}}return Hr(new e.P(0,0))}const Wr=i;t.AJAXError=e.bg,t.Evented=e.E,t.LngLat=e.N,t.MercatorCoordinate=e.Z,t.Point=e.P,t.addProtocol=e.bh,t.config=e.a,t.removeProtocol=e.bi,t.AttributionControl=xr,t.BoxZoomHandler=Rn,t.CanvasSource=et,t.CooperativeGesturesHandler=pr,t.DoubleClickZoomHandler=ar,t.DragPanHandler=ur,t.DragRotateHandler=hr,t.EdgeInsets=gn,t.FullscreenControl=class extends e.E{constructor(t={}){super(),this._onFullscreenChange=()=>{var t;let e=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(t=null==e?void 0:e.shadowRoot)||void 0===t?void 0:t.fullscreenElement;)e=e.shadowRoot.fullscreenElement;e===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){s.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const t=this._fullscreenButton=s.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);s.create("span","maplibregl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new e.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new e.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},t.GeoJSONSource=J,t.GeolocateControl=class extends e.E{constructor(t){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new e.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const i=new e.N(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,r=this._map.getBearing(),o=e.e({bearing:r},this.options.fitBoundsOptions),s=G.fromLngLat(i,n);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const i=new e.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&$r)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new e.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=s.create("button","maplibregl-ctrl-geolocate",this._container),s.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jr({element:this._dotElement}),this._circleElement=s.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new e.k("trackuserlocationend")),this.fire(new e.k("userlocationlostfocus")))}))}},this.options=e.e({},Nr,t)}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return e._(this,arguments,void 0,(function*(t=!1){if(void 0!==Rr&&!t)return Rr;if(void 0===window.navigator.permissions)return Rr=!!window.navigator.geolocation,Rr;try{const t=yield window.navigator.permissions.query({name:"geolocation"});Rr="denied"!==t.state}catch(t){Rr=!!window.navigator.geolocation}return Rr}))}().then((t=>this._setupUI(t))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),s.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Vr=0,$r=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const t=this._map.getBounds(),e=t.getSouthEast(),i=t.getNorthEast(),n=e.distanceTo(i),r=Math.ceil(this._accuracy/(n/this._map._container.clientHeight)*2);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Vr--,$r=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new e.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.k("trackuserlocationstart")),this.fire(new e.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Vr++,Vr>1?(t={maximumAge:6e5,timeout:0},$r=!0):(t=this.options.positionOptions,$r=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},t.Hash=xn,t.ImageSource=Q,t.KeyboardHandler=nr,t.LngLatBounds=G,t.LogoControl=br,t.Map=class extends _r{constructor(t){e.be.mark(e.bf.create);const i=Object.assign(Object.assign({},Mr),t);if(null!=i.minZoom&&null!=i.maxZoom&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=i.minPitch&&null!=i.maxPitch&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=i.minPitch&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=i.maxPitch&&i.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new _n(i.minZoom,i.maxZoom,i.minPitch,i.maxPitch,i.renderWorldCopies),{bearingSnap:i.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new wr,this._controls=[],this._mapId=e.a4(),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new e.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new e.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=!0===i.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=!0===i.preserveDrawingBuffer,this._antialias=!0===i.antialias,this._trackResize=!0===i.trackResize,this._bearingSnap=i.bearingSnap,this._refreshExpiredTiles=!0===i.refreshExpiredTiles,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=!0===i.crossSourceCollisions,this._collectResourceTiming=!0===i.collectResourceTiming,this._locale=Object.assign(Object.assign({},Ar),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this.transformCameraUpdate=i.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===i.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=p.addThrottleControl((()=>this.isMoving())),this._requestManager=new f(i.transformRequest),"string"==typeof i.container){if(this._container=document.getElementById(i.container),!this._container)throw new Error(`Container '${i.container}' not found.`)}else{if(!(i.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let t=!1;const e=vn((t=>{this._trackResize&&!this._removed&&this.resize(t)._update()}),50);this._resizeObserver=new ResizeObserver((i=>{t?e(i):t=!0})),this._resizeObserver.observe(this._container)}this.handlers=new yr(this,i),this._hash=i.hash&&new xn("string"==typeof i.hash&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,e.e({},i.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new xr("boolean"==typeof i.attributionControl?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new br,i.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.k(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.k(`${t.dataType}dataloading`,t))})),this.on("dataabort",(t=>{this.fire(new e.k("sourcedataabort",t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}calculateCameraOptionsFromTo(t,e,i,n){return null==n&&this.terrain&&(n=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(t,e,i,n)}resize(t){var i;const n=this._containerDimensions(),r=n[0],o=n[1],s=this._getClampedPixelRatio(r,o);if(this._resizeCanvas(r,o,s),this.painter.resize(r,o,s),this.painter.overLimit()){const t=this.painter.context.gl;this._maxCanvasSize=[t.drawingBufferWidth,t.drawingBufferHeight];const e=this._getClampedPixelRatio(r,o);this._resizeCanvas(r,o,e),this.painter.resize(r,o,e)}this.transform.resize(r,o),null===(i=this._requestedCameraState)||void 0===i||i.resize(r,o);const a=!this._moving;return a&&(this.stop(),this.fire(new e.k("movestart",t)).fire(new e.k("move",t))),this.fire(new e.k("resize",t)),a&&this.fire(new e.k("moveend",t)),this}_getClampedPixelRatio(t,e){const{0:i,1:n}=this._maxCanvasSize,r=this.getPixelRatio(),o=t*r,s=e*r;return Math.min(o>i?i/o:1,s>n?n/s:1)*r}getPixelRatio(){var t;return null!==(t=this._overridePixelRatio)&&void 0!==t?t:devicePixelRatio}setPixelRatio(t){this._overridePixelRatio=t,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(G.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}project(t){return this.transform.locationPoint(e.N.convert(t),this.style&&this.terrain)}unproject(t){return this.transform.pointLocation(e.P.convert(t),this.terrain)}isMoving(){var t;return this._moving||(null===(t=this.handlers)||void 0===t?void 0:t.isMoving())}isZooming(){var t;return this._zooming||(null===(t=this.handlers)||void 0===t?void 0:t.isZooming())}isRotating(){var t;return this._rotating||(null===(t=this.handlers)||void 0===t?void 0:t.isRotating())}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let n=!1;const r=r=>{const o=this.getLayer(e)?this.queryRenderedFeatures(r.point,{layers:[e]}):[];o.length?n||(n=!0,i.call(this,new An(t,this,r.originalEvent,{features:o}))):n=!1};return{layer:e,listener:i,delegates:{mousemove:r,mouseout:()=>{n=!1}}}}if("mouseleave"===t||"mouseout"===t){let n=!1;const r=r=>{(this.getLayer(e)?this.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?n=!0:n&&(n=!1,i.call(this,new An(t,this,r.originalEvent)))},o=e=>{n&&(n=!1,i.call(this,new An(t,this,e.originalEvent)))};return{layer:e,listener:i,delegates:{mousemove:r,mouseout:o}}}{const n=t=>{const n=this.getLayer(e)?this.queryRenderedFeatures(t.point,{layers:[e]}):[];n.length&&(t.features=n,i.call(this,t),delete t.features)};return{layer:e,listener:i,delegates:{[t]:n}}}}on(t,e,i){if(void 0===i)return super.on(t,e);const n=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n);for(const t in n.delegates)this.on(t,n.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);const n=this._createDelegatedListener(t,e,i);for(const t in n.delegates)this.once(t,n.delegates[t]);return this}off(t,e,i){return void 0===i?super.off(t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&(n=>{const r=this._delegatedListeners[t];for(let t=0;t<r.length;t++){const n=r[t];if(n.layer===e&&n.listener===i){for(const t in n.delegates)this.off(t,n.delegates[t]);return r.splice(t,1),this}}})(),this)}queryRenderedFeatures(t,i){if(!this.style)return[];let n;const r=t instanceof e.P||Array.isArray(t),o=r?t:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(r?{}:t)||{},o instanceof e.P||"number"==typeof o[0])n=[e.P.convert(o)];else{const t=e.P.convert(o[0]),i=e.P.convert(o[1]);n=[t,new e.P(i.x,t.y),i,new e.P(t.x,i.y),t]}return this.style.queryRenderedFeatures(n,i,this.transform)}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(t,i){return!1!==(i=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(t,i))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(t,e)));const i=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!t)),t?(this.style=new he(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t,e,i):this.style.loadJSON(t,e,i),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new he(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const n=this._requestManager.transformRequest(t,"Style");e.h(n,new AbortController).then((t=>{this._updateDiff(t.data,i)})).catch((t=>{t&&this.fire(new e.j(t))}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t,i)&&this._update(!0)}catch(n){e.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.w("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){const i=this.style&&this.style.sourceCaches[t];if(void 0!==i)return i.loaded();this.fire(new e.j(new Error(`There is no source with ID '${t}'`)))}setTerrain(t){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),t){const i=this.style.sourceCaches[t.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);null===this.terrain&&i.reload();for(const i in this.style._layers){const n=this.style._layers[i];"hillshade"===n.type&&n.source===t.source&&e.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ir(this.painter,i,t),this.painter.renderToTexture=new Cr(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=e=>{"style"===e.dataType?this.terrain.sourceCache.freeRtt():"source"===e.dataType&&e.tile&&(e.sourceId!==t.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(e.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new e.k("terrain",{terrain:t})),this}getTerrain(){var t,e;return null!==(e=null===(t=this.terrain)||void 0===t?void 0:t.options)&&void 0!==e?e:null}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(t,i,n={}){const{pixelRatio:r=1,sdf:s=!1,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=n;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||e.b(i))){if(void 0===i.width||void 0===i.height)return this.fire(new e.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:n,height:o,data:d}=i,p=i;return this.style.addImage(t,{data:new e.R({width:n,height:o},new Uint8Array(d)),pixelRatio:r,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:s,version:0,userImage:p}),p.onAdd&&p.onAdd(this,t),this}}{const{width:n,height:d,data:p}=o.getImageData(i);this.style.addImage(t,{data:new e.R({width:n,height:d},p),pixelRatio:r,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:s,version:0})}}updateImage(t,i){const n=this.style.getImage(t);if(!n)return this.fire(new e.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof HTMLImageElement||e.b(i)?o.getImageData(i):i,{width:s,height:a,data:l}=r;if(void 0===s||void 0===a)return this.fire(new e.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==n.data.width||a!==n.data.height)return this.fire(new e.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(i instanceof HTMLImageElement||e.b(i));return n.data.replace(l,c),this.style.updateImage(t,n),this}getImage(t){return this.style.getImage(t)}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.j(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t){return p.getImage(this._requestManager.transformRequest(t,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,n={}){return this.style.setPaintProperty(t,e,i,n),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,n={}){return this.style.setLayoutProperty(t,e,i,n),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setGlyphs(t,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(t,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(t,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(t,e,i,(t=>{t||this._update(!0)})),this}removeSprite(t){return this._lazyInitEmptyStyle(),this.style.removeSprite(t),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(t,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(t,e,(t=>{t||this._update(!0)})),this}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(t){return this._lazyInitEmptyStyle(),this.style.setSky(t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map");const e=this._canvasContainer=s.create("div","maplibregl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=s.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),n=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],n);const r=this._controlContainer=s.create("div","maplibregl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{o[t]=s.create("div",`maplibregl-ctrl-${t} `,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e,i){this._canvas.width=Math.floor(i*t),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const t={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(i=>{e={requestedAttributes:t},i&&(e.statusMessage=i.statusMessage,e.type=i.type)}),{once:!0});const i=this._canvas.getContext("webgl2",t)||this._canvas.getContext("webgl",t);if(!i){const t="Failed to initialize WebGL";throw e?(e.message=t,new Error(JSON.stringify(e))):new Error(t)}this.painter=new pn(i,this.transform),a.testSupport(i)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,r=o.now();this.style.zoomHistory.update(t,r);const s=new e.a9(t,{now:r,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=s.crossFadingFactor();1===a&&a===this._crossFadingFactor||(n=!0,this._crossFadingFactor=a),this.style.update(s)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new e.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,e.be.mark(e.bf.load),this.fire(new e.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const r=this._sourcesDirty||this._styleDirty||this._placementDirty;return r||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.k("idle")),!this._loaded||this._fullyLoaded||r||(this._fullyLoaded=!0,e.be.mark(e.bf.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var t;this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),p.removeThrottleControl(this._imageQueueHandle),null===(t=this._resizeObserver)||void 0===t||t.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==i?void 0:i.loseContext)&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),s.remove(this._canvasContainer),s.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),e.be.clearMetrics(),this._removed=!0,this.fire(new e.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,o.frameAsync(this._frameRequest).then((t=>{e.be.frame(t),this._frameRequest=null,this._render(t)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get version(){return Er}getCameraTargetElevation(){return this.transform.elevation}},t.MapMouseEvent=An,t.MapTouchEvent=En,t.MapWheelEvent=Mn,t.Marker=jr,t.NavigationControl=class{constructor(t){this._updateZoomButtons=()=>{const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),i=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,e)=>{const i=this._map._getUIString(`NavigationControl.${e}`);t.title=i,t.setAttribute("aria-label",i)},this.options=e.e({},Dr,t),this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),s.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),s.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=s.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){s.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const i=s.create("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}},t.Popup=class extends e.E{constructor(t){super(),this.remove=()=>(this._content&&s.remove(this._content),this._container&&(s.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new e.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var e;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=s.create("div","maplibregl-popup",this._map.getContainer()),this._tip=s.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const t of this.options.className.split(" "))this._container.classList.add(t);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Br(this._lngLat,this._flatPos,this._map.transform):null===(e=this._lngLat)||void 0===e?void 0:e.wrap(),this._trackPointer&&!t)return;const i=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let n=this.options.anchor;const r=Hr(this.options.offset);if(!n){const t=this._container.offsetWidth,e=this._container.offsetHeight;let o;o=i.y+r.bottom.y<e?["top"]:i.y>this._map.transform.height-e?["bottom"]:[],i.x<t/2?o.push("left"):i.x>this._map.transform.width-t/2&&o.push("right"),n=0===o.length?"bottom":o.join("-")}let o=i.add(r[n]);this.options.subpixelPositioning||(o=o.round()),s.setTransform(this._container,`${Fr[n]} translate(${o.x}px,${o.y}px)`),Or(this._container,n,"popup")},this._onClose=()=>{this.remove()},this.options=e.e(Object.create(Gr),t)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new e.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.N.convert(t),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let n;for(i.innerHTML=t;n=i.firstChild,n;)e.appendChild(n);return this.setDOMContent(e)}getMaxWidth(){var t;return null===(t=this._container)||void 0===t?void 0:t.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=s.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){return this._container&&this._container.classList.add(t),this}removeClassName(t){return this._container&&this._container.classList.remove(t),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}setSubpixelPositioning(t){this.options.subpixelPositioning=t}_createCloseButton(){this.options.closeButton&&(this._closeButton=s.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(Kr);t&&t.focus()}},t.RasterDEMTileSource=X,t.RasterTileSource=W,t.ScaleControl=class{constructor(t){this._onMove=()=>{qr(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,qr(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ur),t)}getDefaultPosition(){return"bottom-left"}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){s.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},t.ScrollZoomHandler=sr,t.Style=he,t.TerrainControl=class{constructor(t){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=t}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=s.create("button","maplibregl-ctrl-terrain",this._container),s.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){s.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},t.TwoFingersTouchPitchHandler=er,t.TwoFingersTouchRotateHandler=Qn,t.TwoFingersTouchZoomHandler=Jn,t.TwoFingersTouchZoomRotateHandler=dr,t.VectorTileSource=H,t.VideoSource=tt,t.addSourceType=(t,i)=>e._(void 0,void 0,void 0,(function*(){if(nt(t))throw new Error(`A source type called "${t}" already exists.`);((t,e)=>{it[t]=e})(t,i)})),t.clearPrewarmedResources=function(){const t=F;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(L),F=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.getMaxParallelImageRequests=function(){return e.a.MAX_PARALLEL_IMAGE_REQUESTS},t.getRTLTextPluginStatus=function(){return at().getRTLTextPluginStatus()},t.getVersion=function(){return Wr},t.getWorkerCount=function(){return R.workerCount},t.getWorkerUrl=function(){return e.a.WORKER_URL},t.importScriptInWorkers=function(t){return V().broadcast("IS",t)},t.prewarm=function(){j().acquire(L)},t.setMaxParallelImageRequests=function(t){e.a.MAX_PARALLEL_IMAGE_REQUESTS=t},t.setRTLTextPlugin=function(t,e){return at().setRTLTextPlugin(t,e)},t.setWorkerCount=function(t){R.workerCount=t},t.setWorkerUrl=function(t){e.a.WORKER_URL=t}}));var n=t;return n}()}(dt);var pt=Z(dt.exports),ft=Object.defineProperty,mt=(t,e,i)=>(((t,e,i)=>{e in t?ft(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);class gt{constructor(t){mt(this,"map"),mt(this,"listeners",{}),mt(this,"oneTimeListeners",{}),this.map=t}fire(t){var e,i;t.target=this.map;const n=t.type;null==(e=this.listeners[n])||e.forEach((e=>e(t))),null==(i=this.oneTimeListeners[n])||i.forEach((e=>{var i,r;e(t);const o=null==(i=this.oneTimeListeners[n])?void 0:i.indexOf(e);void 0!==o&&~o&&(null==(r=this.oneTimeListeners[n])||r.splice(o,1))}))}on(t,e){this.listeners[t]=this.listeners[t]??[],this.listeners[t].push(e)}off(t,e){var i,n;const r=null==(i=this.listeners[t])?void 0:i.indexOf(e);void 0!==r&&~r&&(null==(n=this.listeners[t])||n.splice(r,1))}once(t,e){this.oneTimeListeners[t]=this.oneTimeListeners[t]??[],this.oneTimeListeners[t].push(e)}}class yt{constructor(t,e,i){mt(this,"type"),mt(this,"target"),mt(this,"originalEvent"),mt(this,"data"),this.type=t,this.originalEvent=e,this.data=i}}class _t{constructor(t,e,i){mt(this,"type"),mt(this,"target"),mt(this,"originalEvent"),mt(this,"data"),this.type=t,this.originalEvent=e,this.data=i}}const vt={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1,bearings:!1},xt={snapline:"#34343f",altRouteline:"#9e91be",routelineFoot:"#3665ff",routelineBike:"#63c4ff",routeline:"#7b51f8",congestionLow:"#42c74c",congestionHigh:"#d72359",hoverpoint:"#30a856",snappoint:"#cb3373",snappointHighlight:"#e50d3f",waypointFoot:"#3665ff",waypointFootHighlight:"#0942ff",waypointBike:"#63c4ff",waypointBikeHighlight:"#0bb8ff",waypoint:"#7b51f8",waypointHighlight:"#6d26d7"},bt=["case",["==",["get","profile",["get","arriveSnappointProperties"]],"foot"],xt.routelineFoot,["==",["get","profile",["get","arriveSnappointProperties"]],"bike"],xt.routelineBike,["interpolate-hcl",["linear"],["get","congestion"],0,xt.routeline,1,xt.congestionLow,100,xt.congestionHigh]],wt=["case",["==",["get","profile"],"foot"],["case",["boolean",["get","highlight"],!1],xt.waypointFootHighlight,xt.waypointFoot],["==",["get","profile"],"bike"],["case",["boolean",["get","highlight"],!1],xt.waypointBikeHighlight,xt.waypointBike],["case",["boolean",["get","highlight"],!1],xt.waypointHighlight,xt.waypoint]],St=["case",["boolean",["get","highlight"],!1],xt.snappointHighlight,xt.snappoint];let Tt,It=(t=21)=>{let e="",i=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&i[t]];return e};function Pt(t){return 1&t?~(t>>1):t>>1}function kt(t,e=5){const i=Math.pow(10,e);let n=0,r=0,o=0;const s=[];let a,l,c=0,u=0,h=null;for(;n<t.length;){h=null,c=0,u=0;do{h=t.charCodeAt(n++)-63,u|=(31&h)<<c,c+=5}while(h>=32);a=Pt(u),c=u=0;do{h=t.charCodeAt(n++)-63,u|=(31&h)<<c,c+=5}while(h>=32);l=Pt(u),r+=a,o+=l,s.push([o/i,r/i])}return s}function Ct(t){return t.map((t=>[t.geometry.coordinates[0],t.geometry.coordinates[1]]))}function At(t){return t.map((t=>{var e,i,n;return Array.isArray(null==(e=t.properties)?void 0:e.bearing)?[null==(i=t.properties)?void 0:i.bearing[0],null==(n=t.properties)?void 0:n.bearing[1]]:void 0}))}function Et(t){const e=function(t=1,e=1,i="maplibre-gl-directions"){const n=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*t,12*t],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*t,12*t],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],33*t,28*t]],r=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*t,7*t],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*t,7*t],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],21*t,16*t]],o=["interpolate",["exponential",1.5],["zoom"],0,3*e,5,3*e,18,10*e],s=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*e,7*e],5,["case",["boolean",["get","highlight"],!1],10*e,7*e],18,["case",["boolean",["get","highlight"],!1],32*e,23*e]];return[{id:`${i}-snapline`,type:"line",source:i,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":xt.snapline,"line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${i}-alt-routeline-casing`,type:"line",source:i,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":xt.altRouteline,"line-opacity":.55,"line-width":s},filter:["==",["get","route"],"ALT"]},{id:`${i}-alt-routeline`,type:"line",source:i,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":xt.altRouteline,"line-opacity":.85,"line-width":o},filter:["==",["get","route"],"ALT"]},{id:`${i}-routeline-casing`,type:"line",source:i,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":bt,"line-opacity":.55,"line-width":s},filter:["==",["get","route"],"SELECTED"]},{id:`${i}-routeline`,type:"line",source:i,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":bt,"line-opacity":.85,"line-width":o},filter:["==",["get","route"],"SELECTED"]},{id:`${i}-hoverpoint-casing`,type:"circle",source:i,paint:{"circle-radius":n,"circle-color":xt.hoverpoint,"circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${i}-hoverpoint`,type:"circle",source:i,paint:{"circle-radius":r,"circle-color":xt.hoverpoint},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${i}-snappoint-casing`,type:"circle",source:i,paint:{"circle-radius":n,"circle-color":St,"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${i}-snappoint`,type:"circle",source:i,paint:{"circle-radius":r,"circle-color":St},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${i}-waypoint-casing`,type:"circle",source:i,paint:{"circle-radius":n,"circle-color":wt,"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${i}-waypoint`,type:"circle",source:i,paint:{"circle-radius":r,"circle-color":wt},filter:["==",["get","type"],"WAYPOINT"]}]}(null==t?void 0:t.pointsScalingFactor,null==t?void 0:t.linesScalingFactor,null==t?void 0:t.sourceName);return Object.assign({},vt,{layers:e},t)}function Mt(t,e,i){const n=t.makePostRequest?"post":"get";let r,o;if("get"===n)r=`${t.api}/${t.profile}/${e.join(";")}`,o=new URLSearchParams(t.requestOptions);else{r=`${t.api}/${t.profile}${t.requestOptions.access_token?`?access_token=${t.requestOptions.access_token}`:""}`;const i=new FormData;Object.entries(t.requestOptions).forEach((([t,e])=>{"access_token"!==t&&i.set(t,e)})),i.set("coordinates",e.join(";")),o=new URLSearchParams(i)}return t.bearings&&i&&o.set("bearings",i.map((t=>t?`${t[0]},${t[1]}`:"")).join(";")),{method:n,url:r,payload:o}}function zt(t,e,i){return{type:"Feature",geometry:{type:"Point",coordinates:t},properties:{type:e,id:It(),...i??{}}}}function Dt(t,e,i,n,r=!1){if(t.length!==e.length)return[];const o=t.map(((t,i)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[t[0],t[1]],[e[i][0],e[i][1]]]},properties:{type:"SNAPLINE"}})));return~n&&void 0!==i&&r&&(o.push({type:"Feature",geometry:{type:"LineString",coordinates:[[i[0],i[1]],[e[n][0],e[n][1]]]},properties:{type:"SNAPLINE"}}),o.push({type:"Feature",geometry:{type:"LineString",coordinates:[[i[0],i[1]],[e[n+1][0],e[n+1][1]]]},properties:{type:"SNAPLINE"}})),o}function Lt(t,e,i,n){return e.map(((e,r)=>{const o=function(t,e){return"geojson"===t.geometries?e.coordinates:"polyline6"===t.geometries?kt(e,6):kt(e,5)}(t,e.geometry),s=n.map((t=>t.geometry.coordinates));let a=0;const l=s.map(((e,i)=>{const n=o.slice(a).findIndex((i=>function(t,e,i){return t.geometries&&"polyline"!==t.geometries?e[0]===i[0]&&e[1]===i[1]:Math.abs(e[0]-i[0])<=1e-5&&Math.abs(e[1]-i[1])<=1e-5}(t,i,e))),r=i===s.length-1;if(-1!==n)a+=n;else if(r)return o.length-1;return a})).slice(1);let c=0;const u=l.map((t=>o.slice(c,c=t+1))),h=[];return u.forEach(((o,s)=>{const a=It();o.forEach(((o,l)=>{var c,u,d;const p=h[h.length-1],f=function(t,e,i){var n,r,o,s;if(null!=(n=t.annotations)&&n.includes("congestion_numeric"))return(null==(r=null==e?void 0:e.congestion_numeric)?void 0:r[i])??0;if(null==(o=t.annotations)||!o.includes("congestion"))return 0;switch((null==(s=null==e?void 0:e.congestion)?void 0:s[i])??""){case"unknown":default:return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100}}(t,null==(c=e.legs[s])?void 0:c.annotation,l);if(s===(null==(u=null==p?void 0:p.properties)?void 0:u.legIndex)&&(null==(d=p.properties)?void 0:d.congestion)===f)p.geometry.coordinates.push(o);else{const t=n[s].properties??{},e=n[s+1].properties??{},l={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:a,routeIndex:r,route:r===i?"SELECTED":"ALT",legIndex:s,congestion:f,departSnappointProperties:t,arriveSnappointProperties:e}};p&&l.geometry.coordinates.push(p.geometry.coordinates[p.geometry.coordinates.length-1]),l.geometry.coordinates.push(o),h.push(l)}}))})),h}))}class Rt extends gt{constructor(t,e){super(t),mt(this,"configuration"),mt(this,"_interactive",!1),mt(this,"_hoverable",!1),mt(this,"buildRequest",Mt),mt(this,"buildPoint",zt),mt(this,"buildSnaplines",Dt),mt(this,"buildRoutelines",Lt),mt(this,"onMoveHandler"),mt(this,"onDragDownHandler"),mt(this,"onDragMoveHandler"),mt(this,"onDragUpHandler"),mt(this,"onClickHandler"),mt(this,"liveRefreshHandler"),mt(this,"profiles",[]),mt(this,"_waypoints",[]),mt(this,"snappoints",[]),mt(this,"routelines",[]),mt(this,"selectedRouteIndex",0),mt(this,"hoverpoint"),mt(this,"highlightedWaypoints",[]),mt(this,"highlightedSnappoints",[]),mt(this,"dragDownPosition",{x:0,y:0}),mt(this,"waypointBeingDragged"),mt(this,"waypointBeingDraggedInitialCoordinates"),mt(this,"departSnappointIndex",-1),mt(this,"currentMousePosition",{x:0,y:0}),mt(this,"refreshOnMoveIsRefreshing",!1),mt(this,"noMouseMovementTimer"),mt(this,"lastRequestMousePosition",{x:0,y:0}),mt(this,"allowRouteSwitch",!1),mt(this,"abortController"),this.map=t,this.configuration=Et(e),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return Ct(this._waypoints)}get snappointsCoordinates(){return this.snappoints.map((t=>[t.geometry.coordinates[0],t.geometry.coordinates[1]]))}get snaplines(){var t,e,i;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,null==(t=this.hoverpoint)?void 0:t.geometry.coordinates,this.departSnappointIndex,null==(i=null==(e=this.hoverpoint)?void 0:e.properties)?void 0:i.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach((t=>{this.map.addLayer(t)}))}async fetch({method:t,url:e,payload:i}){var n,r;const o=await("get"===t?await fetch(`${e}?${i}`,{signal:null==(n=this.abortController)?void 0:n.signal}):await fetch(`${e}`,{signal:null==(r=this.abortController)?void 0:r.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i})).json();if("Ok"!==o.code)throw new Error(o.message??"An unexpected error occurred.");return o}async fetchDirections(t){var e,i;null==(e=this.abortController)||e.abort();const n=this.interactive;if(this._waypoints.length>=2){this.fire(new _t("fetchroutesstart",t)),this.abortController=new AbortController;let e;this.abortController.signal.onabort=()=>{this.interactive=n},this.interactive=!1,null!==this.configuration.requestTimeout&&(e=setTimeout((()=>{var t;return null==(t=this.abortController)?void 0:t.abort()}),this.configuration.requestTimeout)),this.profiles.length||(this.profiles=[this.configuration.profile]);const r=[],o=[];this.profiles.reduce(((t,e,i)=>{const n=i===this.profiles.length-1,s=e===(i>0?this.profiles[i-1]:void 0),a=n?this._waypoints.length:s?t+1:t+2;return s?o[o.length-1].push(...this._waypoints.slice(t,a)):(o.push(this._waypoints.slice(t,a)),r.push(e)),a}),0);const s=r.map(((t,e)=>this.buildRequest({...this.configuration,profile:t},Ct(o[e]),this.configuration.bearings?At(o[e]):void 0)));let a;try{a=await Promise.all(s.map((async e=>{let i;try{i=await this.fetch(e)}finally{this.fire(new _t("fetchroutesend",t,i))}return i})))}finally{"DESTROY"!==(null==(i=this.abortController)?void 0:i.signal.reason)&&(this.interactive=n),this.abortController=void 0,clearTimeout(e)}const l=a.flatMap(((t,e)=>{const i=r[e],n=t.waypoints.map(((t,n)=>this.buildPoint(t.location,"SNAPPOINT",{profile:i,waypointProperties:o[e][n].properties??{}})));return{snappoints:n,routelines:this.buildRoutelines(this.configuration.requestOptions,t.routes,this.selectedRouteIndex,n)}})),c=a.flatMap((t=>t.routes));this.snappoints=l.flatMap((t=>t.snappoints)),this.routelines=l.flatMap((t=>t.routelines)),c.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(t=!0){const e=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce(((e,i)=>t?e.concat(...i):e.concat(...i.map((t=>(t.properties&&(t.properties.route=t.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),t))))),[])];this.hoverpoint&&e.push(this.hoverpoint);const i={type:"FeatureCollection",features:e};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(i)}deHighlight(){this.highlightedWaypoints.forEach((t=>{null!=t&&t.properties&&(t.properties.highlight=!1)})),this.highlightedSnappoints.forEach((t=>{null!=t&&t.properties&&(t.properties.highlight=!1)})),this.routelines.forEach((t=>{t.forEach((t=>{t.properties&&(t.properties.highlight=!1)}))}))}onMove(t){var e,i,n,r;const o=this.map.queryRenderedFeatures(t.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((null==o?void 0:o.layer.id)??"")){this.map.getCanvas().style.cursor="pointer",this.interactive&&this.map.dragPan.disable();const t=this._waypoints.find((t=>{var e,i;return(null==(e=t.properties)?void 0:e.id)===(null==(i=null==o?void 0:o.properties)?void 0:i.id)})),n=t&&this.snappoints.find((e=>{var i,n,r;return(null==(n=null==(i=e.properties)?void 0:i.waypointProperties)?void 0:n.id)===(null==(r=t.properties)?void 0:r.id)}));t&&(this.highlightedWaypoints=[t]),n&&(this.highlightedSnappoints=[n]),null!=(e=this.highlightedWaypoints[0])&&e.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),null!=(i=this.highlightedSnappoints[0])&&i.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((null==o?void 0:o.layer.id)??"")){this.map.getCanvas().style.cursor="pointer";const t=this.snappoints.findIndex((t=>{var e,i;return(null==(e=t.properties)?void 0:e.id)===(null==(i=null==o?void 0:o.properties)?void 0:i.id)}));this.highlightedSnappoints=[this.snappoints[t]],this.highlightedWaypoints=[this._waypoints[t]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((null==o?void 0:o.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.interactive&&(this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat]:this.hoverpoint=this.buildPoint([t.lngLat.lng,t.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse((null==(n=null==o?void 0:o.properties)?void 0:n.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse((null==(r=null==o?void 0:o.properties)?void 0:r.arriveSnappointProperties)??"{}")}})),this.routelines.forEach((t=>{t.forEach((t=>{var e,i;t.properties&&(null==(e=t.properties)?void 0:e.id)===(null==(i=null==o?void 0:o.properties)?void 0:i.id)&&(t.properties.highlight=!0)}))}))):this.configuration.sensitiveAltRoutelineLayers.includes((null==o?void 0:o.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach((t=>{t.forEach((t=>{var e,i;t.properties&&(null==(e=t.properties)?void 0:e.id)===(null==(i=null==o?void 0:o.properties)?void 0:i.id)&&(t.properties.highlight=!0)}))})),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(t){var e,i,n,r,o,s;if("touchstart"===t.type&&1!==t.originalEvent.touches.length||"mousedown"===t.type&&1!==t.originalEvent.which)return;const a=this.map.queryRenderedFeatures(t.point);if(a.length&&a[0].source===this.configuration.sourceName){const l=a.filter((t=>this.configuration.sensitiveWaypointLayers.includes((null==t?void 0:t.layer.id)??"")||this.configuration.sensitiveSnappointLayers.includes((null==t?void 0:t.layer.id)??"")||this.configuration.sensitiveRoutelineLayers.includes((null==t?void 0:t.layer.id)??"")))[0];if(this.dragDownPosition=t.point,this.currentMousePosition=t.point,this.configuration.sensitiveWaypointLayers.includes((null==l?void 0:l.layer.id)??""))this.waypointBeingDragged=this._waypoints.find((t=>{var e,i;return(null==(e=t.properties)?void 0:e.id)===(null==(i=null==l?void 0:l.properties)?void 0:i.id)})),this.waypointBeingDraggedInitialCoordinates=null==(e=this.waypointBeingDragged)?void 0:e.geometry.coordinates;else if(this.configuration.sensitiveRoutelineLayers.includes((null==l?void 0:l.layer.id)??"")){if(this.departSnappointIndex=JSON.parse(null==(i=null==l?void 0:l.properties)?void 0:i.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const e=void 0!==this.departSnappointIndex?this.departSnappointIndex+1:void 0;this._addWaypoint([t.lngLat.lng,t.lngLat.lat],e,t),this.waypointBeingDragged=e?this._waypoints[e]:void 0,this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat];else this.hoverpoint=this.buildPoint([t.lngLat.lng,t.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse((null==(n=null==l?void 0:l.properties)?void 0:n.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse((null==(r=null==l?void 0:l.properties)?void 0:r.arriveSnappointProperties)??"{}")}});null!=(o=this.hoverpoint)&&o.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&null!=(s=this.snappoints[this.departSnappointIndex])&&s.properties&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),"touchstart"===t.type?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):"mousedown"===t.type&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(t){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,t)),"touchmove"===t.type&&1!==t.originalEvent.touches.length)return t.originalEvent.preventDefault();"mousemove"===t.type&&1!==t.originalEvent.which||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat]),this.currentMousePosition=t.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(t))}async onDragUp(t){var e,i,n;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),"mouseup"!==t.type||1===t.originalEvent.which){if(null!=(e=this.hoverpoint)&&e.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(t.point.x-(null==(i=this.dragDownPosition)?void 0:i.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(t.point.y-(null==(n=this.dragDownPosition)?void 0:n.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat];const e=new yt("movewaypoint",t,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(e);try{await this.fetchDirections(e)}catch(t){t instanceof DOMException&&"AbortError"==t.name||this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)}this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([t.lngLat.lng,t.lngLat.lat],void 0!==this.departSnappointIndex?this.departSnappointIndex+1:void 0,t),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),"touchend"===t.type?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):"mouseup"===t.type&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.map.dragPan.enable(),this.draw()}}async liveRefresh(t){var e,i,n,r;if(Math.abs((null==(e=this.lastRequestMousePosition)?void 0:e.x)-(null==(i=this.currentMousePosition)?void 0:i.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs((null==(n=this.lastRequestMousePosition)?void 0:n.y)-(null==(r=this.currentMousePosition)?void 0:r.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const e=new yt("movewaypoint",t,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(e);try{await this.fetchDirections(e)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(t){const e=this.map.queryRenderedFeatures(t.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this._interactive&&this.configuration.sensitiveWaypointLayers.includes((null==e?void 0:e.layer.id)??"")){const i=this._waypoints.findIndex((t=>{var i,n;return(null==(i=t.properties)?void 0:i.id)===(null==(n=null==e?void 0:e.properties)?void 0:n.id)}));~i&&this._removeWaypoint(i,t)}else if(this._interactive&&this.configuration.sensitiveSnappointLayers.includes((null==e?void 0:e.layer.id)??"")){const i=this.snappoints.findIndex((t=>{var i,n;return(null==(i=t.properties)?void 0:i.id)===(null==(n=null==e?void 0:e.properties)?void 0:n.id)}));~i&&this._removeWaypoint(i,t)}else(this.interactive||this.allowRouteSwitch)&&this.configuration.sensitiveAltRoutelineLayers.includes((null==e?void 0:e.layer.id)??"")?this.selectedRouteIndex=this.routelines.findIndex((t=>!!t.find((t=>{var i,n;return(null==(i=t.properties)?void 0:i.id)===(null==(n=null==e?void 0:e.properties)?void 0:n.id)})))):this._interactive&&!this.configuration.sensitiveRoutelineLayers.includes((null==e?void 0:e.layer.id)??"")&&this._addWaypoint([t.lngLat.lng,t.lngLat.lat],void 0,t);this.draw(!1)}assignWaypointsCategories(){this._waypoints.forEach(((t,e)=>{const i=0===e?"ORIGIN":e===this._waypoints.length-1?"DESTINATION":void 0;t.properties&&(t.properties.index=e,t.properties.category=i)}))}async _addWaypoint(t,e,i){var n;null==(n=this.abortController)||n.abort(),e=e??this._waypoints.length,this._waypoints.splice(e,0,this.buildPoint(t,"WAYPOINT",this.configuration.bearings?{bearing:void 0}:void 0)),this.assignWaypointsCategories();const r=new yt("addwaypoint",i,{index:e});this.fire(r),this.draw();try{await this.fetchDirections(r)}catch{}}async _removeWaypoint(t,e){var i;null==(i=this.abortController)||i.abort(),this._waypoints.splice(t,1),this.snappoints.splice(t,1),this.assignWaypointsCategories();const n=new yt("removewaypoint",e,{index:t});this.fire(n),this.draw();try{await this.fetchDirections(n)}catch{}}get interactive(){return this._interactive}set interactive(t){this._interactive=t,t?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler),this.hoverable||(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler))):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousedown",this.onDragDownHandler),this.hoverable||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler)))}get hoverable(){return this._hoverable}set hoverable(t){this._hoverable=t,t&&!this.interactive?(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler)):this.interactive||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(t){this.setWaypoints(t)}get waypointsBearings(){return this.configuration.bearings?At(this._waypoints):(console.warn("The `waypointsBearings` getter was referred to, but the `bearings` configuration option is not enabled!"),[])}set waypointsBearings(t){if(!this.configuration.bearings)return void console.warn("The `waypointsBearings` setter was referred to, but the `bearings` configuration option is not enabled!");this._waypoints.forEach(((e,i)=>{(e.properties||(e.properties={})).bearing=t[i]}));const e=new yt("rotatewaypoints",void 0);this.fire(e),this.draw();try{this.fetchDirections(e)}catch{}}async setWaypoints(t,e=[]){var i;null==(i=this.abortController)||i.abort(),this.profiles=e.slice(0,t.length-1),0===this.profiles.length&&this.profiles.push(this.configuration.profile),this._waypoints=this.profiles.flatMap(((e,i)=>{const n=i===this.profiles.length-1,r=i>0?this.profiles[i-1]:void 0,o=e===r?i+1:i,s=n?t.length:i+2;return t.slice(o,s).map(((t,i)=>this.buildPoint(t,"WAYPOINT",{profile:e,...this.configuration.bearings?{bearing:this.waypointsBearings[i]}:void 0})))})),this.assignWaypointsCategories();const n=new yt("setwaypoints",void 0);this.fire(n),this.draw();try{await this.fetchDirections(n)}catch{}}async addWaypoint(t,e){await this._addWaypoint(t,e)}async removeWaypoint(t){await this._removeWaypoint(t)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){var t;null==(t=this.abortController)||t.abort("DESTROY"),this.clear(),this.hoverable=!1,this.interactive=!1,this.configuration.layers.forEach((t=>{this.map.removeLayer(t.id)})),this.map.removeSource(this.configuration.sourceName)}}function Bt(){}function Ft(t){return t()}function Ot(){return Object.create(null)}function jt(t){t.forEach(Ft)}function Nt(t){return"function"==typeof t}function Vt(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function $t(t,e){t.appendChild(e)}function Ut(t,e,i){t.insertBefore(e,i||null)}function qt(t){t.parentNode&&t.parentNode.removeChild(t)}function Zt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Gt(){return t="",document.createTextNode(t);var t}function Kt(t,e,i){null==i?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function Ht(t){Tt=t}const Wt=[],Xt=[];let Jt=[];const Yt=[],Qt=Promise.resolve();let te=!1;function ee(t){Jt.push(t)}const ie=new Set;let ne=0;function re(){if(0!==ne)return;const t=Tt;do{try{for(;ne<Wt.length;){const t=Wt[ne];ne++,Ht(t),oe(t.$$)}}catch(t){throw Wt.length=0,ne=0,t}for(Ht(null),Wt.length=0,ne=0;Xt.length;)Xt.pop()();for(let t=0;t<Jt.length;t+=1){const e=Jt[t];ie.has(e)||(ie.add(e),e())}Jt.length=0}while(Wt.length);for(;Yt.length;)Yt.pop()();te=!1,ie.clear(),Ht(t)}function oe(t){if(null!==t.fragment){t.update(),jt(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ee)}}const se=new Set;function ae(t,e){const i=t.$$;null!==i.fragment&&(function(t){const e=[],i=[];Jt.forEach((n=>-1===t.indexOf(n)?e.push(n):i.push(n))),i.forEach((t=>t())),Jt=e}(i.after_update),jt(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function le(t,e){-1===t.$$.dirty[0]&&(Wt.push(t),te||(te=!0,Qt.then(re)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ce(t,e,i,n,r,o,s=null,a=[-1]){const l=Tt;Ht(t);const c=t.$$={fragment:null,ctx:[],props:o,update:Bt,not_equal:r,bound:Ot(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Ot(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};s&&s(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},((e,i,...n)=>{const o=n.length?n[0]:i;return c.ctx&&r(c.ctx[e],c.ctx[e]=o)&&(!c.skip_bound&&c.bound[e]&&c.bound[e](o),u&&le(t,e)),i})):[],c.update(),u=!0,jt(c.before_update),c.fragment=!!n&&n(c.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);c.fragment&&c.fragment.l(t),t.forEach(qt)}else c.fragment&&c.fragment.c();e.intro&&function(t,e){t&&t.i&&(se.delete(t),t.i(e))}(t.$$.fragment),function(t,e,i){const{fragment:n,after_update:r}=t.$$;n&&n.m(e,i),ee((()=>{const e=t.$$.on_mount.map(Ft).filter(Nt);t.$$.on_destroy?t.$$.on_destroy.push(...e):jt(e),t.$$.on_mount=[]})),r.forEach(ee)}(t,e.target,e.anchor),re()}Ht(l)}class ue{constructor(){mt(this,"$$"),mt(this,"$$set")}$destroy(){ae(this,1),this.$destroy=Bt}$on(t,e){if(!Nt(e))return Bt;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function he(t){let e,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g;return{c(){e=Zt("svg"),i=Zt("circle"),r=Zt("path"),s=Zt("g"),a=Zt("path"),c=Zt("path"),h=Zt("path"),p=Zt("animateTransform"),Kt(i,"cx","64.13"),Kt(i,"cy","64.13"),Kt(i,"r","27.63"),Kt(i,"fill",n=t[0].fill),Kt(r,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),Kt(r,"fill-rule","evenodd"),Kt(r,"fill",o=t[0].fill),Kt(a,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),Kt(a,"fill",l=t[0].fill),Kt(c,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),Kt(c,"fill",u=t[0].fill),Kt(c,"transform","rotate(120 64 64)"),Kt(h,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),Kt(h,"fill",d=t[0].fill),Kt(h,"transform","rotate(240 64 64)"),Kt(p,"attributeName","transform"),Kt(p,"type","rotate"),Kt(p,"from","0 64 64"),Kt(p,"to","120 64 64"),Kt(p,"dur","360ms"),Kt(p,"repeatCount","indefinite"),Kt(e,"xmlns","http://www.w3.org/2000/svg"),Kt(e,"width",f=t[0].size),Kt(e,"height",m=t[0].size),Kt(e,"viewBox","0 0 128 128"),Kt(e,"xml:space","preserve"),Kt(e,"class",g=t[0].class)},m(t,n){Ut(t,e,n),$t(e,i),$t(e,r),$t(e,s),$t(s,a),$t(s,c),$t(s,h),$t(s,p)},p(t,s){1&s&&n!==(n=t[0].fill)&&Kt(i,"fill",n),1&s&&o!==(o=t[0].fill)&&Kt(r,"fill",o),1&s&&l!==(l=t[0].fill)&&Kt(a,"fill",l),1&s&&u!==(u=t[0].fill)&&Kt(c,"fill",u),1&s&&d!==(d=t[0].fill)&&Kt(h,"fill",d),1&s&&f!==(f=t[0].size)&&Kt(e,"width",f),1&s&&m!==(m=t[0].size)&&Kt(e,"height",m),1&s&&g!==(g=t[0].class)&&Kt(e,"class",g)},d(t){t&&qt(e)}}}function de(t){let e,i=t[1]&&he(t);return{c(){i&&i.c(),e=Gt()},m(t,n){i&&i.m(t,n),Ut(t,e,n)},p(t,[n]){t[1]?i?i.p(t,n):(i=he(t),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:Bt,o:Bt,d(t){t&&qt(e),i&&i.d(t)}}}function pe(t,e,i){let n,{directions:r}=e,{configuration:o}=e;return r.on("fetchroutesstart",(()=>{i(1,n=!0)})),r.on("fetchroutesend",(()=>{i(1,n=!1)})),t.$$set=t=>{"directions"in t&&i(2,r=t.directions),"configuration"in t&&i(0,o=t.configuration)},[o,n,r]}typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class fe extends ue{constructor(t){super(),ce(this,t,pe,de,Vt,{directions:2,configuration:0})}}const me={fill:"#6d26d7",size:"24px",class:""};class ge{constructor(t,e){mt(this,"controlElement"),mt(this,"directions"),mt(this,"configuration"),this.directions=t,this.configuration=Object.assign({},me,e)}onAdd(){return this.controlElement=document.createElement("div"),new fe({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function ye(e){let i,r,o,s,f,m,g,y,_,v,x,b,w,S,T;return{c(){i=u("div"),r=u("button"),r.textContent="Start Tracking",o=h(),s=u("button"),s.textContent="Stop Tracking",f=h(),m=u("button"),m.textContent="Show Location List",g=h(),y=u("button"),y.textContent="Download map Route",_=h(),v=u("label"),x=u("input"),b=h(),w=u("span"),w.innerHTML='<span class="on">ON</span> \n            <span class="off">OFF</span>',p(m,"id","toggleList"),p(x,"type","checkbox"),p(w,"class","slider round"),p(v,"class","switch"),p(v,"title","Toggle to ON/OFF Add Location Manually"),p(i,"id","controls")},m(t,n){l(t,i,n),a(i,r),a(i,o),a(i,s),a(i,f),a(i,m),a(i,g),a(i,y),a(i,_),a(i,v),a(v,x),x.checked=e[0],a(v,b),a(v,w),S||(T=[d(r,"click",e[1]),d(s,"click",e[2]),d(m,"click",e[3]),d(y,"click",_e),d(x,"change",e[6])],S=!0)},p(t,[e]){1&e&&(x.checked=t[0])},i:t,o:t,d(t){t&&c(i),S=!1,n(T)}}}function _e(){var t=document.getElementById("map");html2canvas(t).then((t=>{const e=t.toDataURL("image/png"),i=document.createElement("a");i.href=e,i.download="route.png",i.click()}))}function ve(t,e,i){let n,r,o;s(t,it,(t=>i(13,n=t))),s(t,et,(t=>i(14,t))),s(t,Q,(t=>i(15,r=t))),s(t,Y,(t=>i(0,o=t)));let a,{map:l}=e,{directions:c}=e;let u,h,d=!0,p=0,f=[];return t.$$set=t=>{"map"in t&&i(4,l=t.map),"directions"in t&&i(5,c=t.directions)},[o,function(){console.log("Start Tracking"),r||(Q.set(!0),a=setInterval((()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{let{latitude:e,longitude:i}=t.coords;if(h!=i||u!=e||3==p){if(console.log(`Latitude: ${e}, Longitude: ${i}`),h=i,u=e,d){const t=(new maplibregl.Marker).setLngLat([i,e]).addTo(l);d=!1,f.push(t)}else f.forEach((t=>t.remove())),f=[];lt(e,i,l,c,p),3!=p?p=0:p++}else p++}))}),5e3))},function(){console.log("Stop Tracking"),Q&&(Q.set(!1),clearInterval(a))},function(){it.update((t=>!t)),n?(document.getElementById("map").style.width="0vw",document.getElementById("locations").style.width="100vw",document.getElementById("toggleList").textContent="Hide Location List"):(document.getElementById("map").style.width="100vw",document.getElementById("locations").style.width="0vw",document.getElementById("toggleList").textContent="View Location List")},l,c,function(){o=this.checked,Y.set(o)}]}class xe extends V{constructor(t){super(),N(this,t,ve,ye,o,{map:4,directions:5})}}function be(t){let e,i,n,r,o,s,a,d;function f(e){t[2](e)}function m(e){t[3](e)}let g={};return void 0!==t[0]&&(g.map=t[0]),void 0!==t[1]&&(g.directions=t[1]),e=new xe({props:g}),x.push((()=>R(e,"map",f))),x.push((()=>R(e,"directions",m))),{c(){B(e.$$.fragment),r=h(),o=u("div"),s=h(),a=u("div"),a.innerHTML='<h2>Location List</h2> \n    <input type="text" id="searchBar" placeholder="Search by name, type, or rating..."/> \n    <ul id="locationList"></ul>',p(o,"id","map"),p(a,"id","locations")},m(t,i){F(e,t,i),l(t,r,i),l(t,o,i),l(t,s,i),l(t,a,i),d=!0},p(t,[r]){const o={};!i&&1&r&&(i=!0,o.map=t[0],P((()=>i=!1))),!n&&2&r&&(n=!0,o.directions=t[1],P((()=>n=!1))),e.$set(o)},i(t){d||(D(e.$$.fragment,t),d=!0)},o(t){L(e.$$.fragment,t),d=!1},d(t){O(e,t),t&&c(r),t&&c(o),t&&c(s),t&&c(a)}}}function we(t,e,i){let n,r,o,a;var l;function c(t){d=t.target.value.toLowerCase(),async function(t){return(await X.locations.toArray()).filter((e=>e.lname.toLowerCase().includes(t)||e.type.toLowerCase().includes(t)||e.ratings.toString().includes(t)||e.note.toLowerCase().includes(t)))}(d).then((t=>{at(t,o)})).catch((t=>{console.error("Search error:",t)}))}function u(){o.flyTo({center:h,zoom:10})}s(t,tt,(t=>i(6,n=t))),s(t,Y,(t=>i(7,r=t))),l=()=>{i(0,o=new pt.Map({container:"map",style:"https://raw.githubusercontent.com/go2garret/maps/main/src/assets/json/openStreetMap.json",center:h,zoom:10,preserveDrawingBuffer:!0})),o.addControl(new pt.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),o.addControl(new pt.NavigationControl);const t=document.createElement("button");t.className="maplibregl-ctrl-icon maplibregl-ctrl-home ",t.type="button",t.onclick=u,t.title="Reset to Home";const e=document.querySelector(".maplibregl-ctrl-top-right .maplibregl-ctrl-group");e&&e.insertBefore(t,e.firstChild),o.on("click",(t=>{r&&function(t,e){if(0===n.length){const i=(new pt.Marker).setLngLat([e,t]).addTo(o);tt.set([i])}else n.forEach((t=>t.remove()));lt(t,e,o,"",3)}(t.lngLat.lat,t.lngLat.lng)})),o.on("load",(async()=>{await async function(){let t,e;rt.subscribe((e=>{t=e})),ot.subscribe((t=>{e=t})),console.log(t,"::",e);const i={username:t,password:e,client:"referer",referer:"localhost:8080",f:"json"};var n=[];for(var r in i){var o=encodeURIComponent(r),s=encodeURIComponent(i[r]);n.push(o+"="+s)}n=n.join("&");const a=await fetch("https://gistest.twdb.texas.gov/portal/sharing/rest/generateToken",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:n}),l=`https://gistest.twdb.texas.gov/server/rest/services/TxGIO_GIT/Dipak_Test_Collection_Rating/FeatureServer/0/query?where=1%3D1&outFields=*&f=pjson&token=${(await a.json()).token}`;try{const t=await fetch(l,{method:"GET",headers:{"Content-Type":"application/json"}}),e=await t.json();console.log("Fetched Data: ",e.features);const i=e.features.filter((t=>"Restaurant"===t.attributes.Type||"Monument"===t.attributes.Type)).map((t=>({OBJECTID:t.attributes.OBJECTID,lname:t.attributes.Name,type:t.attributes.Type,ratings:t.attributes.Rating,timestamp:(new Date).getTime(),note:t.attributes.Notes,longitude:t.geometry.x,latitude:t.geometry.y})));console.log("Fetched Data: ",i),await X.locations.clear(),await X.locations.bulkPut(i)}catch(t){console.error("Error fetching data: ",t)}}(),async function(){try{const t=await fetch("https://data.austintexas.gov/resource/a7ap-j2yt.geojson"),e=await t.json();o.addSource("source",{type:"geojson",data:e}),o.addLayer({id:"polygons",type:"fill",source:"source",paint:{"fill-color":"#888888","fill-outline-color":"red","fill-opacity":.5},filter:["==","$type","Polygon"]});const i=new pt.Popup({closeButton:!1,closeOnClick:!1});o.on("mouseover","polygons",(t=>{o.getCanvas().style.cursor="pointer";const e=t.features[0].properties.neighname;i.setLngLat(t.lngLat).setHTML(e).addTo(o)})),o.on("click","polygons",(t=>{o.getCanvas().style.cursor="pointer";const e=t.features[0].properties.neighname;i.setLngLat(t.lngLat).setHTML(e).addTo(o)})),o.on("mouseleave","polygons",(()=>{o.getCanvas().style.cursor="",i.remove()}))}catch(t){console.error("Error fetching neighborhood data:",t)}}(),async function(t){const e=await X.locations.toArray(),i=e.filter((t=>t.type)),n=e.filter((t=>!t.type));for(const t of n)await X.locations.delete(t.id);console.log("Valid Loc: ",i),i.forEach((e=>{let i="";switch(e.type){case"Restaurant":i="https://img.icons8.com/?size=100&id=qvscHBGB7saA&format=png&color=000000";break;case"Monument":i="https://img.icons8.com/?size=100&id=17621&format=png&color=000000"}if(i){const n=document.createElement("div");n.className="marker",n.style.backgroundImage=`url(${i})`,n.style.backgroundSize="30px 30px",n.style.backgroundRepeat="no-repeat",n.style.width="30px",n.style.height="30px";const r=new maplibregl.Marker({element:n}).setLngLat([e.longitude,e.latitude]).addTo(t);ht.push({newMarker:r}),r.getElement().addEventListener("click",(()=>{new maplibregl.Popup({closeOnClick:!1}).setLngLat([e.longitude,e.latitude]).setHTML(`<h3>Rating</h3><p>${e.ratings}</p>`).addTo(t)}))}})),i.map((t=>[t.longitude,t.latitude])).length>0&&at(i,t),J.set(i)}(o),i(1,a=new Rt(o)),a.clear(),o.addControl(new ge(a))})),document.getElementById("searchBar").addEventListener("input",c)},y().$$.on_mount.push(l);const h=[-97.69,30.28];let d="";return[o,a,function(t){o=t,i(0,o)},function(t){a=t,i(1,a)}]}let Se=class extends V{constructor(t){super(),N(this,t,we,be,o,{})}};function Te(e){let i,r,o,s,m,g,y,_,v,x,b,w,S,T,I,P;return{c(){i=u("form"),r=u("h1"),r.textContent="Login",o=h(),s=u("div"),m=u("label"),m.textContent="Username",g=h(),y=u("input"),_=h(),v=u("div"),x=u("label"),x.textContent="Password",b=h(),w=u("input"),S=h(),T=u("button"),T.textContent="Login",p(r,"class","svelte-1jjohh8"),p(m,"for","username"),p(m,"class","svelte-1jjohh8"),p(y,"type","text"),p(y,"id","username"),y.required=!0,p(y,"class","svelte-1jjohh8"),p(s,"class","input-group svelte-1jjohh8"),p(x,"for","password"),p(x,"class","svelte-1jjohh8"),p(w,"type","password"),p(w,"id","password"),w.required=!0,p(w,"class","svelte-1jjohh8"),p(v,"class","input-group svelte-1jjohh8"),p(T,"type","submit"),p(T,"class","svelte-1jjohh8"),p(i,"class","svelte-1jjohh8")},m(t,n){l(t,i,n),a(i,r),a(i,o),a(i,s),a(s,m),a(s,g),a(s,y),f(y,e[0]),a(i,_),a(i,v),a(v,x),a(v,b),a(v,w),f(w,e[1]),a(i,S),a(i,T),I||(P=[d(y,"input",e[3]),d(w,"input",e[4]),d(i,"submit",e[2])],I=!0)},p(t,[e]){1&e&&y.value!==t[0]&&f(y,t[0]),2&e&&w.value!==t[1]&&f(w,t[1])},i:t,o:t,d(t){t&&c(i),I=!1,n(P)}}}function Ie(t,e,i){const n=_();let r="",o="";return[r,o,function(t){t.preventDefault(),rt.set(r),ot.set(o),nt.set(!0),n("login")},function(){r=this.value,i(0,r)},function(){o=this.value,i(1,o)}]}class Pe extends V{constructor(t){super(),N(this,t,Ie,Te,o,{})}}function ke(e){let i,n;return i=new Pe({}),i.$on("login",e[2]),{c(){B(i.$$.fragment)},m(t,e){F(i,t,e),n=!0},p:t,i(t){n||(D(i.$$.fragment,t),n=!0)},o(t){L(i.$$.fragment,t),n=!1},d(t){O(i,t)}}}function Ce(e){let i,n;return i=new Se({}),{c(){B(i.$$.fragment)},m(t,e){F(i,t,e),n=!0},p:t,i(t){n||(D(i.$$.fragment,t),n=!0)},o(t){L(i.$$.fragment,t),n=!1},d(t){O(i,t)}}}function Ae(t){let e,i,r,o;const s=[Ce,ke],a=[];function h(t,e){return t[0]?0:1}return i=h(t),r=a[i]=s[i](t),{c(){var t,i,n,o;e=u("main"),r.c(),t=e,i="display",null==(n="flex")?t.style.removeProperty(i):t.style.setProperty(i,n,o?"important":"")},m(t,n){l(t,e,n),a[i].m(e,null),o=!0},p(t,[o]){let l=i;i=h(t),i===l?a[i].p(t,o):(z={r:0,c:[],p:z},L(a[l],1,1,(()=>{a[l]=null})),z.r||n(z.c),z=z.p,r=a[i],r?r.p(t,o):(r=a[i]=s[i](t),r.c()),D(r,1),r.m(e,null))},i(t){o||(D(r),o=!0)},o(t){L(r),o=!1},d(t){t&&c(e),a[i].d()}}}function Ee(t,e,i){let n;const r=U(!1);return s(t,r,(t=>i(0,n=t))),[n,r,function(){r.set(!0)}]}return new class extends V{constructor(t){super(),N(this,t,Ee,Ae,o,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
